<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="EMsoft main library">
    
    <meta name="author" content="Marc De Graef Research Group/Carnegie Mellon University" >
    <link rel="icon" href="../favicon.png">

    <title>CLsupport.f90 &ndash; Fortran Program</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran Program </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../lists/programs.html">Programs</a></li>
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>CLsupport.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 1.3% of total for source files.">396 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/CLsupport.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">CLsupport.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/clsupport.html">CLsupport</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/clsupport.f90.html#src">CLsupport.f90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
      
      <h3>Files Dependent On This One</h3>
      
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~clsupport.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileclsupportf90AfferentGraph" width="487pt" height="52pt"
 viewBox="0.00 0.00 487.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~clsupport.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~clsupport.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-48 483,-48 483,4 -4,4"/>
<!-- sourcefile~clsupport.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_node1" class="node"><title>sourcefile~clsupport.f90</title>
<polygon fill="none" stroke="black" points="78,-44 0,-44 0,-20 78,-20 78,-44"/>
<text text-anchor="middle" x="39" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">CLsupport.f90</text>
</g>
<!-- sourcefile~emdymod.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_node2" class="node"><title>sourcefile~emdymod.f90</title>
<g id="a_sourcefile~~clsupport.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/emdymod.f90.html" xlink:title="EMdymod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="317,-44 240,-44 240,-20 317,-20 317,-44"/>
<text text-anchor="middle" x="278.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">EMdymod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~clsupport.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~clsupport.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M78.0251,-32.6123C89.5781,-32.7718 102.308,-32.921 114,-33 153.999,-33.2703 164.001,-33.2721 204,-33 212.256,-32.9438 221.033,-32.8522 229.541,-32.7466"/>
<polygon fill="#ff0000" stroke="#ff0000" points="229.779,-36.2439 239.732,-32.6123 229.687,-29.2445 229.779,-36.2439"/>
</g>
<!-- sourcefile~indexingmod.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_node3" class="node"><title>sourcefile~indexingmod.f90</title>
<g id="a_sourcefile~~clsupport.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/indexingmod.f90.html" xlink:title="Indexingmod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="204,-24 114,-24 114,-0 204,-0 204,-24"/>
<text text-anchor="middle" x="159" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Indexingmod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~clsupport.f90&#45;&gt;sourcefile~indexingmod.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_edge4" class="edge"><title>sourcefile~clsupport.f90&#45;&gt;sourcefile~indexingmod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M78.3112,-25.5066C86.4371,-24.1293 95.1625,-22.6504 103.753,-21.1945"/>
<polygon fill="#ff0000" stroke="#ff0000" points="104.456,-24.6252 113.731,-19.5033 103.286,-17.7237 104.456,-24.6252"/>
</g>
<!-- sourcefile~simulated_annealing.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_node4" class="node"><title>sourcefile~simulated_annealing.f90</title>
<g id="a_sourcefile~~clsupport.f90~~AfferentGraph_node4"><a xlink:href="../sourcefile/simulated_annealing.f90.html" xlink:title="simulated_annealing.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="479,-44 353,-44 353,-20 479,-20 479,-44"/>
<text text-anchor="middle" x="416" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">simulated_annealing.f90</text>
</a>
</g>
</g>
<!-- sourcefile~emdymod.f90&#45;&gt;sourcefile~simulated_annealing.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~emdymod.f90&#45;&gt;sourcefile~simulated_annealing.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M317.244,-32C325.18,-32 333.805,-32 342.534,-32"/>
<polygon fill="#ff0000" stroke="#ff0000" points="342.794,-35.5001 352.794,-32 342.794,-28.5001 342.794,-35.5001"/>
</g>
<!-- sourcefile~indexingmod.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~clsupport.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~indexingmod.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M204.087,-19.5042C212.42,-20.9226 221.174,-22.4126 229.617,-23.8498"/>
<polygon fill="#00ffff" stroke="#00ffff" points="229.268,-27.3405 239.713,-25.5682 230.443,-20.4398 229.268,-27.3405"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/clsupport.html">CLsupport</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/clsupport.f90.html#src">CLsupport.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! ###################################################################</span>
<a name="ln-2"></a><span class="c">! Copyright (c) 2013-2016, Marc De Graef Research Group/Carnegie Mellon University</span>
<a name="ln-3"></a><span class="c">! All rights reserved.</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">! Redistribution and use in source and binary forms, with or without modification, are</span>
<a name="ln-6"></a><span class="c">! permitted provided that the following conditions are met:</span>
<a name="ln-7"></a><span class="c">!</span>
<a name="ln-8"></a><span class="c">!     - Redistributions of source code must retain the above copyright notice, this list</span>
<a name="ln-9"></a><span class="c">!        of conditions and the following disclaimer.</span>
<a name="ln-10"></a><span class="c">!     - Redistributions in binary form must reproduce the above copyright notice, this</span>
<a name="ln-11"></a><span class="c">!        list of conditions and the following disclaimer in the documentation and/or</span>
<a name="ln-12"></a><span class="c">!        other materials provided with the distribution.</span>
<a name="ln-13"></a><span class="c">!     - Neither the names of Marc De Graef, Carnegie Mellon University nor the names</span>
<a name="ln-14"></a><span class="c">!        of its contributors may be used to endorse or promote products derived from</span>
<a name="ln-15"></a><span class="c">!        this software without specific prior written permission.</span>
<a name="ln-16"></a><span class="c">!</span>
<a name="ln-17"></a><span class="c">! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<a name="ln-18"></a><span class="c">! AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="ln-19"></a><span class="c">! IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="ln-20"></a><span class="c">! ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span>
<a name="ln-21"></a><span class="c">! LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="ln-22"></a><span class="c">! DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="ln-23"></a><span class="c">! SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="ln-24"></a><span class="c">! CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<a name="ln-25"></a><span class="c">! OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE</span>
<a name="ln-26"></a><span class="c">! USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="ln-27"></a><span class="c">! ###################################################################</span>
<a name="ln-28"></a><span class="k">module </span><span class="n">CLsupport</span>
<a name="ln-29"></a>
<a name="ln-30"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-31"></a><span class="k">use </span><span class="n">clfortran</span>
<a name="ln-32"></a>
<a name="ln-33"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-34"></a>
<a name="ln-35"></a>
<a name="ln-36"></a><span class="k">contains</span>
<a name="ln-37"></a>
<a name="ln-38"></a>
<a name="ln-39"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-40"></a><span class="c">!</span>
<a name="ln-41"></a><span class="c">! SUBROUTINE:CLquery_platform_info</span>
<a name="ln-42"></a><span class="c">!</span>
<a name="ln-43"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-44"></a><span class="c">!</span>
<a name="ln-45"></a><span class="c">!&gt; @brief display information about an OpenCL device (based on (clfortran&#39;s query_platforms_devices.f90)</span>
<a name="ln-46"></a><span class="c">!</span>
<a name="ln-47"></a><span class="c">!&gt; @param platform_id id number of platform</span>
<a name="ln-48"></a><span class="c">!</span>
<a name="ln-49"></a><span class="c">!&gt; @date 02/18/16 MDG 1.0 modification of clfortran&#39;s original routine</span>
<a name="ln-50"></a><span class="c">!&gt; @date 05/21/16 MDG 1.1 split CPU and GPU device information into separate blocks</span>
<a name="ln-51"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-52"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-53"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-54"></a><span class="c">! original Copyright information (clfortran&#39;s query_platforms_devices.f90)</span>
<a name="ln-55"></a><span class="c">! -----------------------------------------------------------------------------</span>
<a name="ln-56"></a><span class="c">!</span>
<a name="ln-57"></a><span class="c">! Copyright (C) 2013-2014 Company for Advanced Supercomputing Solutions LTD</span>
<a name="ln-58"></a><span class="c">! Bosmat 2a St.</span>
<a name="ln-59"></a><span class="c">! Shoham</span>
<a name="ln-60"></a><span class="c">! Israel 60850</span>
<a name="ln-61"></a><span class="c">! http://www.cass-hpc.com</span>
<a name="ln-62"></a><span class="c">!</span>
<a name="ln-63"></a><span class="c">! Author: Mordechai Butrashvily &lt;support@cass-hpc.com&gt;</span>
<a name="ln-64"></a><span class="c">!</span>
<a name="ln-65"></a><span class="c">! -----------------------------------------------------------------------------</span>
<a name="ln-66"></a><span class="c">!</span>
<a name="ln-67"></a><span class="c">! This program is free software: you can redistribute it and/or modify</span>
<a name="ln-68"></a><span class="c">! it under the terms of the GNU Lesser General Public License as published by</span>
<a name="ln-69"></a><span class="c">! the Free Software Foundation, either version 3 of the License, or</span>
<a name="ln-70"></a><span class="c">! (at your option) any later version.</span>
<a name="ln-71"></a><span class="c">!</span>
<a name="ln-72"></a><span class="c">! This program is distributed in the hope that it will be useful,</span>
<a name="ln-73"></a><span class="c">! but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="ln-74"></a><span class="c">! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="ln-75"></a><span class="c">! GNU Lesser General Public License for more details.</span>
<a name="ln-76"></a><span class="c">!</span>
<a name="ln-77"></a><span class="c">! You should have received a copy of the GNU Lesser General Public License</span>
<a name="ln-78"></a><span class="c">! along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="ln-79"></a><span class="c">!</span>
<a name="ln-80"></a><span class="c">! -----------------------------------------------------------------------------</span>
<a name="ln-81"></a><span class="k">recursive subroutine </span><span class="n">CLquery_platform_info</span><span class="p">(</span><span class="n">platform_id</span><span class="p">)</span>
<a name="ln-82"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: CLquery_platform_info</span>
<a name="ln-83"></a>
<a name="ln-84"></a><span class="k">use </span><span class="nb">ISO_C_BINDING</span>
<a name="ln-85"></a>
<a name="ln-86"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-87"></a>
<a name="ln-88"></a><span class="c">! Input variable.</span>
<a name="ln-89"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_intptr_t</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="kd">::</span> <span class="n">platform_id</span>
<a name="ln-90"></a>
<a name="ln-91"></a><span class="c">! Helper variables to work with OpenCL API.</span>
<a name="ln-92"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int32_t</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">err</span>
<a name="ln-93"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_size_t</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">zero_size</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-94"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_size_t</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">temp_size</span>
<a name="ln-95"></a><span class="c">! For quering devices.</span>
<a name="ln-96"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int64_t</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">device_type</span>
<a name="ln-97"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int32_t</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">num_devices</span>
<a name="ln-98"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">i</span>
<a name="ln-99"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_intptr_t</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">device_ids</span><span class="p">(:)</span>
<a name="ln-100"></a>
<a name="ln-101"></a><span class="c">! String arrays for holding platform details.</span>
<a name="ln-102"></a><span class="kt">character</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">platform_profile</span><span class="p">(:)</span>
<a name="ln-103"></a><span class="kt">character</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">platform_version</span><span class="p">(:)</span>
<a name="ln-104"></a><span class="kt">character</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">platform_name</span><span class="p">(:)</span>
<a name="ln-105"></a><span class="kt">character</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">platform_vendor</span><span class="p">(:)</span>
<a name="ln-106"></a><span class="kt">character</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">platform_extensions</span><span class="p">(:)</span>
<a name="ln-107"></a>
<a name="ln-108"></a><span class="c">! String array for holding device name.</span>
<a name="ln-109"></a><span class="kt">character</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">device_name</span><span class="p">(:)</span>
<a name="ln-110"></a><span class="c">! Maximum compute units for device.</span>
<a name="ln-111"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_size_t</span><span class="p">),</span> <span class="k">target</span>      <span class="kd">::</span> <span class="n">device_mwgs</span><span class="p">,</span> <span class="n">device_mwis</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-112"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int32_t</span><span class="p">),</span> <span class="k">target</span>     <span class="kd">::</span> <span class="n">device_cu</span>
<a name="ln-113"></a>
<a name="ln-114"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int64_t</span><span class="p">),</span> <span class="k">target</span>     <span class="kd">::</span> <span class="n">device_gms</span><span class="p">,</span> <span class="n">device_mmas</span>
<a name="ln-115"></a>
<a name="ln-116"></a>
<a name="ln-117"></a><span class="c">! Profile.</span>
<a name="ln-118"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_PROFILE</span><span class="p">,</span> <span class="n">zero_size</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-119"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-120"></a><span class="k">allocate</span><span class="p">(</span><span class="n">platform_profile</span><span class="p">(</span><span class="n">temp_size</span><span class="p">))</span>
<a name="ln-121"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_PROFILE</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">platform_profile</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-122"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-123"></a><span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Profile: &#39;</span><span class="p">,</span> <span class="n">platform_profile</span>
<a name="ln-124"></a><span class="k">deallocate</span><span class="p">(</span><span class="n">platform_profile</span><span class="p">)</span>
<a name="ln-125"></a>
<a name="ln-126"></a><span class="c">! Version.</span>
<a name="ln-127"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_VERSION</span><span class="p">,</span> <span class="n">zero_size</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-128"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-129"></a><span class="k">allocate</span><span class="p">(</span><span class="n">platform_version</span><span class="p">(</span><span class="n">temp_size</span><span class="p">))</span>
<a name="ln-130"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_VERSION</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">platform_version</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-131"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-132"></a><span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Version: &#39;</span><span class="p">,</span> <span class="n">platform_version</span>
<a name="ln-133"></a><span class="k">deallocate</span><span class="p">(</span><span class="n">platform_version</span><span class="p">)</span>
<a name="ln-134"></a>
<a name="ln-135"></a><span class="c">! Name.</span>
<a name="ln-136"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_NAME</span><span class="p">,</span> <span class="n">zero_size</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-137"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-138"></a><span class="k">allocate</span><span class="p">(</span><span class="n">platform_name</span><span class="p">(</span><span class="n">temp_size</span><span class="p">))</span>
<a name="ln-139"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_NAME</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">platform_name</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-140"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-141"></a><span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Name: &#39;</span><span class="p">,</span> <span class="n">platform_name</span>
<a name="ln-142"></a><span class="k">deallocate</span><span class="p">(</span><span class="n">platform_name</span><span class="p">)</span>
<a name="ln-143"></a>
<a name="ln-144"></a><span class="c">! Vendor.</span>
<a name="ln-145"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_VENDOR</span><span class="p">,</span> <span class="n">zero_size</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-146"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-147"></a><span class="k">allocate</span><span class="p">(</span><span class="n">platform_vendor</span><span class="p">(</span><span class="n">temp_size</span><span class="p">))</span>
<a name="ln-148"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_VENDOR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">platform_vendor</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-149"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-150"></a><span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Vendor: &#39;</span><span class="p">,</span> <span class="n">platform_vendor</span>
<a name="ln-151"></a><span class="k">deallocate</span><span class="p">(</span><span class="n">platform_vendor</span><span class="p">)</span>
<a name="ln-152"></a>
<a name="ln-153"></a><span class="c">! Extensions.</span>
<a name="ln-154"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_EXTENSIONS</span><span class="p">,</span> <span class="n">zero_size</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-155"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-156"></a><span class="k">allocate</span><span class="p">(</span><span class="n">platform_extensions</span><span class="p">(</span><span class="n">temp_size</span><span class="p">))</span>
<a name="ln-157"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetPlatformInfo</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_PLATFORM_EXTENSIONS</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">platform_extensions</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-158"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetPlatformInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-159"></a><span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Extensions: &#39;</span><span class="p">,</span> <span class="n">platform_extensions</span>
<a name="ln-160"></a><span class="k">deallocate</span><span class="p">(</span><span class="n">platform_extensions</span><span class="p">)</span>
<a name="ln-161"></a>
<a name="ln-162"></a><span class="c">!</span>
<a name="ln-163"></a><span class="c">! Print device information for this platform.</span>
<a name="ln-164"></a><span class="c">!</span>
<a name="ln-165"></a><span class="c">! Get device count.</span>
<a name="ln-166"></a><span class="k">print</span> <span class="o">*</span>
<a name="ln-167"></a><span class="c">! device_type = CL_DEVICE_TYPE_CPU</span>
<a name="ln-168"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceIDs</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_DEVICE_TYPE_CPU</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">num_devices</span><span class="p">)</span>
<a name="ln-169"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceIDs&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">,.</span><span class="n">TRUE</span><span class="p">.)</span>
<a name="ln-170"></a>
<a name="ln-171"></a><span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">/=</span> <span class="n">CL_SUCCESS</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">num_devices</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-172"></a><span class="k">  print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;No CPU devices found on this platform&#39;</span>
<a name="ln-173"></a><span class="k">else</span>
<a name="ln-174"></a><span class="k">  print</span> <span class="o">*</span>
<a name="ln-175"></a>  <span class="k">print</span> <span class="s1">&#39;(A, I2)&#39;</span><span class="p">,</span> <span class="s1">&#39;Num CPU Devices: &#39;</span><span class="p">,</span> <span class="n">num_devices</span>
<a name="ln-176"></a>
<a name="ln-177"></a><span class="c">! Allocate an array to hold device handles.</span>
<a name="ln-178"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">num_devices</span><span class="p">))</span>
<a name="ln-179"></a>
<a name="ln-180"></a><span class="c">! Get device IDs.</span>
<a name="ln-181"></a>  <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceIDs</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_DEVICE_TYPE_CPU</span><span class="p">,</span> <span class="n">num_devices</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_ids</span><span class="p">),</span> <span class="n">num_devices</span><span class="p">)</span>
<a name="ln-182"></a>  <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceIDs&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-183"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">/=</span> <span class="n">CL_SUCCESS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-184"></a><span class="k">    print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Error quering CPU devices: &#39;</span><span class="p">,</span> <span class="n">err</span>
<a name="ln-185"></a>    <span class="k">return</span>
<a name="ln-186"></a><span class="k">  end if</span>
<a name="ln-187"></a>
<a name="ln-188"></a><span class="c">! Loop over devices and print information.</span>
<a name="ln-189"></a>  <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_devices</span>
<a name="ln-190"></a><span class="c">! Maximum compute units.</span>
<a name="ln-191"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-192"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_MAX_COMPUTE_UNITS</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_cu</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-193"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-194"></a>  
<a name="ln-195"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-196"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_GLOBAL_MEM_SIZE</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_gms</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-197"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-198"></a>    <span class="n">device_gms</span> <span class="o">=</span> <span class="n">device_gms</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span>
<a name="ln-199"></a>
<a name="ln-200"></a><span class="c">! temp_size = 8</span>
<a name="ln-201"></a><span class="c">! err = clGetDeviceInfo(device_ids(i), CL_DEVICE_MAX_MEM_ALLOC_SIZE, temp_size, C_LOC(device_gms), temp_size)</span>
<a name="ln-202"></a><span class="c">!write (*,*) &#39;mmas : &#39;, device_mmas</span>
<a name="ln-203"></a>
<a name="ln-204"></a><span class="c">! CL_DEVICE_MAX_WORK_GROUP_SIZE</span>
<a name="ln-205"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span> 
<a name="ln-206"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_MAX_WORK_GROUP_SIZE</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_mwgs</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-207"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-208"></a>
<a name="ln-209"></a>
<a name="ln-210"></a><span class="c">! CL_DEVICE_MAX_WORK_ITEM_SIZES</span>
<a name="ln-211"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">3</span>
<a name="ln-212"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_MAX_WORK_ITEM_SIZES</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_mwis</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-213"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-214"></a>
<a name="ln-215"></a><span class="c">! Name.</span>
<a name="ln-216"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-217"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_NAME</span><span class="p">,</span> <span class="n">zero_size</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-218"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-219"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">device_name</span><span class="p">(</span><span class="n">temp_size</span><span class="p">))</span>
<a name="ln-220"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_NAME</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_name</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-221"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-222"></a>
<a name="ln-223"></a><span class="c">! Print brief device details. Since this routine can be used by the user to determine GPU device IDs,</span>
<a name="ln-224"></a><span class="c">! we subtract 1 from the device ID to make sure that the CPU gets number 0...</span>
<a name="ln-225"></a>    <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(A,I2,A,I4,A,I4,A,I4,A,I4,A,I4,A,I3,A,$)&#39;</span><span class="p">)</span> <span class="s1">&#39; Device (#&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;, CU/MWGS/MWIS/GMS: &#39;</span><span class="p">,</span><span class="n">device_cu</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">device_mwgs</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,&amp;</span>
<a name="ln-226"></a>                                                   <span class="n">device_mwis</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">device_mwis</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">device_mwis</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">device_gms</span><span class="p">,</span><span class="s1">&#39;) - &#39;</span>
<a name="ln-227"></a>    <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="n">device_name</span>
<a name="ln-228"></a>    <span class="k">deallocate</span><span class="p">(</span><span class="n">device_name</span><span class="p">)</span>
<a name="ln-229"></a>  <span class="k">end do</span>
<a name="ln-230"></a>
<a name="ln-231"></a><span class="k">end if</span>
<a name="ln-232"></a>
<a name="ln-233"></a><span class="c">! Get device count.</span>
<a name="ln-234"></a><span class="c">!device_type = CL_DEVICE_TYPE_ALL</span>
<a name="ln-235"></a><span class="k">print</span> <span class="o">*</span>
<a name="ln-236"></a><span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceIDs</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_DEVICE_TYPE_GPU</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">num_devices</span><span class="p">)</span>
<a name="ln-237"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceIDs&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">,.</span><span class="n">TRUE</span><span class="p">.)</span>
<a name="ln-238"></a>
<a name="ln-239"></a><span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">/=</span> <span class="n">CL_SUCCESS</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">num_devices</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-240"></a><span class="k">  print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;No GPU devices found on this platform &#39;</span>
<a name="ln-241"></a><span class="k">else</span>
<a name="ln-242"></a><span class="k">  print</span> <span class="o">*</span>
<a name="ln-243"></a>  <span class="k">print</span> <span class="s1">&#39;(A, I2)&#39;</span><span class="p">,</span> <span class="s1">&#39;Num GPU Devices: &#39;</span><span class="p">,</span> <span class="n">num_devices</span>
<a name="ln-244"></a>
<a name="ln-245"></a><span class="c">! Allocate an array to hold device handles.</span>
<a name="ln-246"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">device_ids</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)</span>
<a name="ln-247"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">num_devices</span><span class="p">))</span>
<a name="ln-248"></a>
<a name="ln-249"></a><span class="c">! Get device IDs.</span>
<a name="ln-250"></a>  <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceIDs</span><span class="p">(</span><span class="n">platform_id</span><span class="p">,</span> <span class="n">CL_DEVICE_TYPE_GPU</span><span class="p">,</span> <span class="n">num_devices</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_ids</span><span class="p">),</span> <span class="n">num_devices</span><span class="p">)</span>
<a name="ln-251"></a>  <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceIDs&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-252"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">/=</span> <span class="n">CL_SUCCESS</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-253"></a><span class="k">    print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Error quering devices: &#39;</span><span class="p">,</span> <span class="n">err</span>
<a name="ln-254"></a>    <span class="k">return</span>
<a name="ln-255"></a><span class="k">  end if</span>
<a name="ln-256"></a>
<a name="ln-257"></a>
<a name="ln-258"></a><span class="c">! Loop over devices and print information.</span>
<a name="ln-259"></a>  <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_devices</span>
<a name="ln-260"></a><span class="c">! Maximum compute units.</span>
<a name="ln-261"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-262"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_MAX_COMPUTE_UNITS</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_cu</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-263"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-264"></a>
<a name="ln-265"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-266"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_GLOBAL_MEM_SIZE</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_gms</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-267"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-268"></a>    <span class="n">device_gms</span> <span class="o">=</span> <span class="n">device_gms</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span>
<a name="ln-269"></a>
<a name="ln-270"></a><span class="c">! temp_size = 8</span>
<a name="ln-271"></a><span class="c">! err = clGetDeviceInfo(device_ids(i), CL_DEVICE_MAX_MEM_ALLOC_SIZE, temp_size, C_LOC(device_gms), temp_size)</span>
<a name="ln-272"></a><span class="c">!write (*,*) &#39;mmas : &#39;, device_mmas</span>
<a name="ln-273"></a>
<a name="ln-274"></a><span class="c">! CL_DEVICE_MAX_WORK_GROUP_SIZE</span>
<a name="ln-275"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span> 
<a name="ln-276"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_MAX_WORK_GROUP_SIZE</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_mwgs</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-277"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-278"></a>
<a name="ln-279"></a>
<a name="ln-280"></a><span class="c">! CL_DEVICE_MAX_WORK_ITEM_SIZES</span>
<a name="ln-281"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">3</span>
<a name="ln-282"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_MAX_WORK_ITEM_SIZES</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_mwis</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-283"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-284"></a>
<a name="ln-285"></a><span class="c">! Name.</span>
<a name="ln-286"></a>    <span class="n">temp_size</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-287"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_NAME</span><span class="p">,</span> <span class="n">zero_size</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-288"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-289"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">device_name</span><span class="p">(</span><span class="n">temp_size</span><span class="p">))</span>
<a name="ln-290"></a>    <span class="n">err</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device_ids</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CL_DEVICE_NAME</span><span class="p">,</span> <span class="n">temp_size</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device_name</span><span class="p">),</span> <span class="n">temp_size</span><span class="p">)</span>
<a name="ln-291"></a>    <span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLquery_platform_info:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">err</span><span class="p">)</span>
<a name="ln-292"></a>
<a name="ln-293"></a><span class="c">! Print brief device details. Since this routine can be used by the user to determine GPU device IDs,</span>
<a name="ln-294"></a><span class="c">! we subtract 1 from the device ID to make sure that the CPU gets number 0...</span>
<a name="ln-295"></a>    <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(A,I2,A,I4,A,I4,A,I4,A,I4,A,I4,A,I3,A,$)&#39;</span><span class="p">)</span> <span class="s1">&#39; Device (#&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;, CU/MWGS/MWIS/GMS: &#39;</span><span class="p">,</span><span class="n">device_cu</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">device_mwgs</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,&amp;</span>
<a name="ln-296"></a>                                                   <span class="n">device_mwis</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">device_mwis</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">device_mwis</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">device_gms</span><span class="p">,</span><span class="s1">&#39;) - &#39;</span>
<a name="ln-297"></a>    <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="n">device_name</span>
<a name="ln-298"></a>    <span class="k">deallocate</span><span class="p">(</span><span class="n">device_name</span><span class="p">)</span>
<a name="ln-299"></a>  <span class="k">end do</span>
<a name="ln-300"></a><span class="k">end if</span>
<a name="ln-301"></a>
<a name="ln-302"></a><span class="k">print</span> <span class="o">*</span><span class="p">,</span><span class="s1">&#39; &#39;</span>
<a name="ln-303"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;[CU = Compute Units; MWGS = Maximum Work Group Size; MWIS = Maximum Work Item Sizes (3D); &#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-304"></a>            <span class="s1">&#39;GMS = Global Memory Size (Gb)]&#39;</span>
<a name="ln-305"></a>
<a name="ln-306"></a><span class="k">end subroutine </span><span class="n">CLquery_platform_info</span>
<a name="ln-307"></a>
<a name="ln-308"></a>
<a name="ln-309"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-310"></a><span class="c">!</span>
<a name="ln-311"></a><span class="c">! SUBROUTINE:CLread_source_file</span>
<a name="ln-312"></a><span class="c">!</span>
<a name="ln-313"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-314"></a><span class="c">!</span>
<a name="ln-315"></a><span class="c">!&gt; @brief read an OpenCL source file and return the source properly formatted</span>
<a name="ln-316"></a><span class="c">!</span>
<a name="ln-317"></a><span class="c">!&gt; @param sourcefile filename for the OpenCL source code</span>
<a name="ln-318"></a><span class="c">!&gt; @param source c_str containing the source, NULL-terminated</span>
<a name="ln-319"></a><span class="c">!&gt; @param slength source string length</span>
<a name="ln-320"></a><span class="c">!</span>
<a name="ln-321"></a><span class="c">!&gt; @date 02/18/16  MDG 1.0 original</span>
<a name="ln-322"></a><span class="c">!&gt; @date 01/15/17  MDG 1.1 added functionality for second opencl folder for developers...</span>
<a name="ln-323"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-324"></a><span class="k">recursive subroutine </span><span class="n">CLread_source_file</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">,</span> <span class="n">csource</span><span class="p">,</span> <span class="n">slength</span><span class="p">)</span>
<a name="ln-325"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: CLread_source_file</span>
<a name="ln-326"></a>
<a name="ln-327"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-328"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-329"></a><span class="k">use </span><span class="nb">ISO_C_BINDING</span>
<a name="ln-330"></a>
<a name="ln-331"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-332"></a>
<a name="ln-333"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span>                      <span class="kd">::</span> <span class="n">source_length</span> <span class="o">=</span> <span class="mi">50000</span>
<a name="ln-334"></a>
<a name="ln-335"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">sourcefile</span>
<a name="ln-336"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">source_length</span><span class="p">,</span> <span class="nb">KIND</span><span class="o">=</span><span class="kt">c_char</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">csource</span>
<a name="ln-337"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_size_t</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">slength</span>
<a name="ln-338"></a>
<a name="ln-339"></a>
<a name="ln-340"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">source_length</span><span class="p">),</span><span class="k">target</span>     <span class="kd">::</span> <span class="n">source</span>
<a name="ln-341"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">fname</span><span class="p">,</span> <span class="n">clpath</span><span class="p">,</span> <span class="n">clpath2</span><span class="p">,</span> <span class="n">tcf</span>
<a name="ln-342"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">irec</span><span class="p">,</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">ipos</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-343"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">develop</span><span class="p">,</span> <span class="n">fexist</span>
<a name="ln-344"></a>
<a name="ln-345"></a><span class="c">! find the cl file in the main opencl folder or the private folder if the Develop mode equals Yes...</span>
<a name="ln-346"></a><span class="n">clpath</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_getOpenCLpathname</span><span class="p">())</span>
<a name="ln-347"></a>
<a name="ln-348"></a><span class="c">! then, determine whether or not the user is working in develop mode by checking for the </span>
<a name="ln-349"></a><span class="c">! Develop keyword in the EMsoftconfig.json file... Regular users will only have a single</span>
<a name="ln-350"></a><span class="c">! opencl folder, but developers have two, so we need to make sure we check both</span>
<a name="ln-351"></a><span class="c">! locations.  The second location is the private folder...</span>
<a name="ln-352"></a><span class="n">develop</span> <span class="o">=</span> <span class="n">EMsoft_getEMdevelop</span><span class="p">()</span>
<a name="ln-353"></a><span class="n">clpath2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-354"></a><span class="k">if</span> <span class="p">(</span><span class="n">develop</span><span class="p">.</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-355"></a><span class="k">  </span><span class="n">ipos</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">clpath</span><span class="p">,</span><span class="s1">&#39;Public&#39;</span><span class="p">)</span>
<a name="ln-356"></a>  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ipos</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-357"></a>    <span class="n">clpath2</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">clpath</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-358"></a>  <span class="k">end do</span>
<a name="ln-359"></a><span class="k">  </span><span class="n">tcf</span> <span class="o">=</span> <span class="s1">&#39;Private/opencl/&#39;</span>
<a name="ln-360"></a>  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">ipos</span><span class="p">,</span><span class="n">ipos</span><span class="o">+</span><span class="mi">15</span>
<a name="ln-361"></a>    <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-362"></a>    <span class="n">clpath2</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">tcf</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span>
<a name="ln-363"></a>  <span class="k">end do</span>
<a name="ln-364"></a><span class="k">end if</span>
<a name="ln-365"></a>
<a name="ln-366"></a><span class="n">fname</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">clpath</span><span class="p">)</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">)</span>
<a name="ln-367"></a><span class="n">fname</span> <span class="o">=</span> <span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<a name="ln-368"></a><span class="k">inquire</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span><span class="n">exist</span><span class="o">=</span><span class="n">fexist</span><span class="p">)</span>
<a name="ln-369"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">fexist</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-370"></a><span class="k">  if</span> <span class="p">(</span><span class="n">develop</span><span class="p">.</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-371"></a><span class="k">   </span><span class="n">fname</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">clpath2</span><span class="p">)</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">)</span>
<a name="ln-372"></a>   <span class="n">fname</span> <span class="o">=</span> <span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<a name="ln-373"></a>   <span class="k">inquire</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span><span class="n">exist</span><span class="o">=</span><span class="n">fexist</span><span class="p">)</span>
<a name="ln-374"></a>   <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">fexist</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-375"></a><span class="k">     call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;CLread_source_file&#39;</span><span class="p">,</span><span class="s1">&#39;opencl source file &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; not found in either opencl folder.&#39;</span><span class="p">&amp;</span>
<a name="ln-376"></a>     <span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
<a name="ln-377"></a>   <span class="k">end if</span>
<a name="ln-378"></a><span class="k">  else</span>
<a name="ln-379"></a><span class="k">   call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;CLread_source_file&#39;</span><span class="p">,</span><span class="s1">&#39;opencl source  file &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; not found&#39;</span><span class="p">)</span>
<a name="ln-380"></a>  <span class="k">end if</span>
<a name="ln-381"></a><span class="k"> end if</span>
<a name="ln-382"></a>
<a name="ln-383"></a><span class="c">! read the source file from the opencl folder</span>
<a name="ln-384"></a><span class="k">open</span><span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="n">dataunit</span><span class="p">,</span> <span class="k">file</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-385"></a>     <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="n">iostat</span> <span class="o">=</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">recl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-386"></a><span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s2">&quot;CLread_source_file: &quot;</span><span class="p">,</span><span class="s1">&#39;Cannot open file &#39;</span><span class="o">//</span><span class="n">fname</span><span class="p">)</span>
<a name="ln-387"></a>
<a name="ln-388"></a><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a name="ln-389"></a><span class="n">irec</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-390"></a><span class="k">do</span>
<a name="ln-391"></a><span class="k">  read</span><span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="n">dataunit</span><span class="p">,</span> <span class="n">rec</span> <span class="o">=</span> <span class="n">irec</span><span class="p">,</span> <span class="n">iostat</span> <span class="o">=</span> <span class="n">ierr</span><span class="p">)</span> <span class="n">source</span><span class="p">(</span><span class="n">irec</span><span class="p">:</span><span class="n">irec</span><span class="p">)</span>
<a name="ln-392"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-393"></a><span class="k">  if</span><span class="p">(</span><span class="n">irec</span> <span class="o">==</span> <span class="n">source_length</span><span class="p">)</span> <span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s2">&quot;CLread_source_file: &quot;</span><span class="p">,</span><span class="s1">&#39;Error: CL source file is too big&#39;</span><span class="p">)</span>
<a name="ln-394"></a>  <span class="n">irec</span> <span class="o">=</span> <span class="n">irec</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-395"></a><span class="k">end do</span>
<a name="ln-396"></a><span class="k">close</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">dataunit</span><span class="p">)</span>
<a name="ln-397"></a>
<a name="ln-398"></a><span class="n">csource</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<a name="ln-399"></a><span class="n">csource</span><span class="p">(</span><span class="n">irec</span><span class="p">:</span><span class="n">irec</span><span class="p">)</span> <span class="o">=</span> <span class="nb">C_NULL_CHAR</span>
<a name="ln-400"></a><span class="n">slength</span> <span class="o">=</span> <span class="n">irec</span>
<a name="ln-401"></a>
<a name="ln-402"></a><span class="k">end subroutine </span><span class="n">CLread_source_file</span>
<a name="ln-403"></a>
<a name="ln-404"></a>
<a name="ln-405"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-406"></a><span class="c">!</span>
<a name="ln-407"></a><span class="c">! SUBROUTINE:CLinit_PDCCQ</span>
<a name="ln-408"></a><span class="c">!</span>
<a name="ln-409"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-410"></a><span class="c">!</span>
<a name="ln-411"></a><span class="c">!&gt; @brief initalize a CL platform, device, context, and command queue</span>
<a name="ln-412"></a><span class="c">!</span>
<a name="ln-413"></a><span class="c">!&gt; @param </span>
<a name="ln-414"></a><span class="c">!</span>
<a name="ln-415"></a><span class="c">!&gt; @date 02/23/16  MDG 1.0 original</span>
<a name="ln-416"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-417"></a><span class="k">recursive subroutine </span><span class="n">CLinit_PDCCQ</span><span class="p">(</span><span class="n">platform</span><span class="p">,</span> <span class="n">nump</span><span class="p">,</span> <span class="n">selnump</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">numd</span><span class="p">,</span> <span class="n">selnumd</span><span class="p">,</span> <span class="n">devinfo</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">command_queue</span><span class="p">)</span>
<a name="ln-418"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: CLinit_PDCCQ</span>
<a name="ln-419"></a>
<a name="ln-420"></a><span class="k">use </span><span class="nb">ISO_C_BINDING</span>
<a name="ln-421"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-422"></a><span class="k">use </span><span class="n">io</span>
<a name="ln-423"></a>
<a name="ln-424"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-425"></a>
<a name="ln-426"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_intptr_t</span><span class="p">),</span><span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span>  <span class="kd">::</span> <span class="n">platform</span><span class="p">(:)</span>
<a name="ln-427"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">nump</span>
<a name="ln-428"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">selnump</span>
<a name="ln-429"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_intptr_t</span><span class="p">),</span><span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span>  <span class="kd">::</span> <span class="n">device</span><span class="p">(:)</span>
<a name="ln-430"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">numd</span>
<a name="ln-431"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">selnumd</span>
<a name="ln-432"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">devinfo</span>
<a name="ln-433"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_intptr_t</span><span class="p">),</span><span class="k">target</span>               <span class="kd">::</span> <span class="n">context</span>
<a name="ln-434"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_intptr_t</span><span class="p">),</span><span class="k">target</span>               <span class="kd">::</span> <span class="n">command_queue</span>
<a name="ln-435"></a>
<a name="ln-436"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int32_t</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-437"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_size_t</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">cnuminfo</span>
<a name="ln-438"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">target</span>                  <span class="kd">::</span> <span class="n">info</span> 
<a name="ln-439"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_intptr_t</span><span class="p">),</span><span class="k">target</span>               <span class="kd">::</span> <span class="n">ctx_props</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-440"></a><span class="kt">integer</span><span class="p">(</span><span class="kt">c_int64_t</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">cmd_queue_props</span>
<a name="ln-441"></a>
<a name="ln-442"></a><span class="c">! get the platform ID</span>
<a name="ln-443"></a><span class="n">ierr</span> <span class="o">=</span> <span class="n">clGetPlatformIDs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">nump</span><span class="p">)</span>
<a name="ln-444"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLinit_PDCCQ:clGetPlatformIDs&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-445"></a><span class="k">allocate</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="n">nump</span><span class="p">))</span>
<a name="ln-446"></a><span class="n">ierr</span> <span class="o">=</span> <span class="n">clGetPlatformIDs</span><span class="p">(</span><span class="n">nump</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">platform</span><span class="p">),</span> <span class="n">nump</span><span class="p">)</span>
<a name="ln-447"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLinit_PDCCQ:clGetPlatformIDs&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-448"></a>
<a name="ln-449"></a><span class="k">if</span> <span class="p">(</span><span class="n">selnump</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">nump</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-450"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s2">&quot;CLinit_PDCCQ&quot;</span><span class="p">,</span><span class="s2">&quot;non-existing platform id requested&quot;</span><span class="p">)</span>
<a name="ln-451"></a><span class="k">end if</span>
<a name="ln-452"></a>
<a name="ln-453"></a><span class="c">! get the device ID</span>
<a name="ln-454"></a><span class="n">ierr</span> <span class="o">=</span>  <span class="n">clGetDeviceIDs</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="n">selnump</span><span class="p">),</span> <span class="n">CL_DEVICE_TYPE_GPU</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">numd</span><span class="p">)</span>
<a name="ln-455"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLinit_PDCCQ:clGetDeviceIDs&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-456"></a><span class="k">allocate</span><span class="p">(</span><span class="n">device</span><span class="p">(</span><span class="n">numd</span><span class="p">))</span>
<a name="ln-457"></a><span class="n">ierr</span> <span class="o">=</span>  <span class="n">clGetDeviceIDs</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="n">selnump</span><span class="p">),</span> <span class="n">CL_DEVICE_TYPE_GPU</span><span class="p">,</span> <span class="n">numd</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">numd</span><span class="p">)</span>
<a name="ln-458"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLinit_PDCCQ:clGetDeviceIDs&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-459"></a>
<a name="ln-460"></a><span class="k">if</span> <span class="p">(</span><span class="n">selnumd</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">numd</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-461"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s2">&quot;CLinit_PDCCQ&quot;</span><span class="p">,</span><span class="s2">&quot;non-existing device id requested&quot;</span><span class="p">)</span>
<a name="ln-462"></a><span class="k">end if</span>
<a name="ln-463"></a>
<a name="ln-464"></a><span class="c">! get the device name and return it as devinfo</span>
<a name="ln-465"></a><span class="n">ierr</span> <span class="o">=</span> <span class="n">clGetDeviceInfo</span><span class="p">(</span><span class="n">device</span><span class="p">(</span><span class="n">selnumd</span><span class="p">),</span> <span class="n">CL_DEVICE_NAME</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">info</span><span class="p">),</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">info</span><span class="p">),</span> <span class="n">cnuminfo</span><span class="p">)</span>
<a name="ln-466"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLinit_PDCCQ:clGetDeviceInfo&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-467"></a>
<a name="ln-468"></a><span class="k">if</span> <span class="p">(</span><span class="n">cnuminfo</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">fnlen</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-469"></a><span class="k">  call </span><span class="n">WriteValue</span><span class="p">(</span><span class="s2">&quot;CLinit_PDCCQ&quot;</span><span class="p">,</span><span class="s2">&quot;device info string truncated to 132 characters&quot;</span><span class="p">)</span>
<a name="ln-470"></a>  <span class="n">devinfo</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">info</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">132</span><span class="p">))</span>
<a name="ln-471"></a><span class="k">else</span>
<a name="ln-472"></a><span class="k">  </span><span class="n">devinfo</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">info</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">cnuminfo</span><span class="p">))</span>
<a name="ln-473"></a><span class="k">end if</span>
<a name="ln-474"></a>
<a name="ln-475"></a><span class="c">! create the context and the command queue</span>
<a name="ln-476"></a><span class="n">ctx_props</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">CL_CONTEXT_PLATFORM</span>
<a name="ln-477"></a><span class="n">ctx_props</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">platform</span><span class="p">(</span><span class="n">selnump</span><span class="p">)</span>
<a name="ln-478"></a><span class="n">ctx_props</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-479"></a><span class="n">context</span> <span class="o">=</span> <span class="n">clCreateContext</span><span class="p">(</span><span class="nb">C_LOC</span><span class="p">(</span><span class="n">ctx_props</span><span class="p">),</span> <span class="n">numd</span><span class="p">,</span> <span class="nb">C_LOC</span><span class="p">(</span><span class="n">device</span><span class="p">),</span><span class="nb">C_NULL_FUNPTR</span><span class="p">,</span> <span class="nb">C_NULL_PTR</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-480"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLinit_PDCCQ:clCreateContext&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-481"></a>
<a name="ln-482"></a><span class="n">cmd_queue_props</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-483"></a><span class="n">command_queue</span> <span class="o">=</span> <span class="n">clCreateCommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">(</span><span class="n">selnumd</span><span class="p">),</span> <span class="n">cmd_queue_props</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-484"></a><span class="k">call </span><span class="n">CLerror_check</span><span class="p">(</span><span class="s1">&#39;CLinit_PDCCQ:clCreateCommandQueue&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-485"></a>
<a name="ln-486"></a><span class="k">end subroutine </span><span class="n">CLinit_PDCCQ</span>
<a name="ln-487"></a>
<a name="ln-488"></a>
<a name="ln-489"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-490"></a><span class="c">!</span>
<a name="ln-491"></a><span class="c">! SUBROUTINE:CLerror_check</span>
<a name="ln-492"></a><span class="c">!</span>
<a name="ln-493"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-494"></a><span class="c">!</span>
<a name="ln-495"></a><span class="c">!&gt; @brief checks whether or not there was a CL 1.2 error and returns the error message.</span>
<a name="ln-496"></a><span class="c">!</span>
<a name="ln-497"></a><span class="c">!&gt; @param ierr error number (0 is no error) </span>
<a name="ln-498"></a><span class="c">!</span>
<a name="ln-499"></a><span class="c">!&gt; @date 06/06/16  MDG 1.0 original</span>
<a name="ln-500"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-501"></a><span class="k">recursive subroutine </span><span class="n">CLerror_check</span><span class="p">(</span><span class="n">routine</span><span class="p">,</span> <span class="n">ierr</span><span class="p">,</span> <span class="n">nonfatal</span><span class="p">)</span>
<a name="ln-502"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: CLerror_check</span>
<a name="ln-503"></a>
<a name="ln-504"></a><span class="k">use </span><span class="nb">ISO_C_BINDING</span>
<a name="ln-505"></a><span class="k">use </span><span class="n">error</span> 
<a name="ln-506"></a><span class="k">use </span><span class="n">io</span>
<a name="ln-507"></a>
<a name="ln-508"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-509"></a>
<a name="ln-510"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">routine</span>
<a name="ln-511"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">c_int32_t</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-512"></a><span class="kt">logical</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">),</span><span class="k">OPTIONAL</span>             <span class="kd">::</span> <span class="n">nonfatal</span>
<a name="ln-513"></a>
<a name="ln-514"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">estr</span>
<a name="ln-515"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">iout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-516"></a>
<a name="ln-517"></a><span class="k">if</span> <span class="p">(</span><span class="n">ierr</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-518"></a>
<a name="ln-519"></a><span class="k">  select case</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-520"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
<a name="ln-521"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_DEVICE_NOT_FOUND&#39;</span> <span class="c">!                       = -1</span>
<a name="ln-522"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> 
<a name="ln-523"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_DEVICE_NOT_AVAILABLE&#39;</span> <span class="c">!                   = -2</span>
<a name="ln-524"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> 
<a name="ln-525"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_COMPILER_NOT_AVAILABLE&#39;</span> <span class="c">!                 = -3</span>
<a name="ln-526"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> 
<a name="ln-527"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_MEM_OBJECT_ALLOCATION_FAILURE&#39;</span> <span class="c">!          = -4</span>
<a name="ln-528"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> 
<a name="ln-529"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_OUT_OF_RESOURCES&#39;</span> <span class="c">!                       = -5</span>
<a name="ln-530"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span> 
<a name="ln-531"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_OUT_OF_HOST_MEMORY&#39;</span> <span class="c">!                     = -6</span>
<a name="ln-532"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> 
<a name="ln-533"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_PROFILING_INFO_NOT_AVAILABLE&#39;</span> <span class="c">!           = -7</span>
<a name="ln-534"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> 
<a name="ln-535"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_MEM_COPY_OVERLAP&#39;</span> <span class="c">!                       = -8</span>
<a name="ln-536"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span> 
<a name="ln-537"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_IMAGE_FORMAT_MISMATCH&#39;</span> <span class="c">!                  = -9</span>
<a name="ln-538"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> 
<a name="ln-539"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_IMAGE_FORMAT_NOT_SUPPORTED&#39;</span> <span class="c">!             = -10</span>
<a name="ln-540"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">)</span> 
<a name="ln-541"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_BUILD_PROGRAM_FAILURE&#39;</span> <span class="c">!                  = -11</span>
<a name="ln-542"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">)</span> 
<a name="ln-543"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_MAP_FAILURE&#39;</span> <span class="c">!                            = -12</span>
<a name="ln-544"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">13</span><span class="p">)</span> 
<a name="ln-545"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_MISALIGNED_SUB_BUFFER_OFFSET&#39;</span> <span class="c">!           = -13</span>
<a name="ln-546"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">14</span><span class="p">)</span> 
<a name="ln-547"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_EXEC_STATUS_ERROR_FOR_EVENTS_IN_WAIT_LIST&#39;</span> <span class="c">! 14</span>
<a name="ln-548"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span> 
<a name="ln-549"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_COMPILE_PROGRAM_FAILURE&#39;</span> <span class="c">!                = -15</span>
<a name="ln-550"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">)</span> 
<a name="ln-551"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_LINKER_NOT_AVAILABLE&#39;</span> <span class="c">!                   = -16</span>
<a name="ln-552"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">17</span><span class="p">)</span> 
<a name="ln-553"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_LINK_PROGRAM_FAILURE&#39;</span> <span class="c">!                   = -17</span>
<a name="ln-554"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">18</span><span class="p">)</span> 
<a name="ln-555"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_DEVICE_PARTITION_FAILED&#39;</span> <span class="c">!                = -18</span>
<a name="ln-556"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">19</span><span class="p">)</span> 
<a name="ln-557"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_KERNEL_ARG_INFO_NOT_AVAILABLE&#39;</span> <span class="c">!          = -19</span>
<a name="ln-558"></a>
<a name="ln-559"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span> 
<a name="ln-560"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_VALUE&#39;</span> <span class="c">!                          = -30</span>
<a name="ln-561"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">31</span><span class="p">)</span> 
<a name="ln-562"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_DEVICE_TYPE&#39;</span> <span class="c">!                    = -31</span>
<a name="ln-563"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">32</span><span class="p">)</span> 
<a name="ln-564"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_PLATFORM&#39;</span> <span class="c">!                       = -32</span>
<a name="ln-565"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">33</span><span class="p">)</span> 
<a name="ln-566"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_DEVICE&#39;</span> <span class="c">!                         = -33</span>
<a name="ln-567"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">34</span><span class="p">)</span> 
<a name="ln-568"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_CONTEXT&#39;</span> <span class="c">!                        = -34</span>
<a name="ln-569"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">35</span><span class="p">)</span> 
<a name="ln-570"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_QUEUE_PROPERTIES&#39;</span> <span class="c">!               = -35</span>
<a name="ln-571"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">36</span><span class="p">)</span> 
<a name="ln-572"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_COMMAND_QUEUE&#39;</span> <span class="c">!                  = -36</span>
<a name="ln-573"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">37</span><span class="p">)</span> 
<a name="ln-574"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_HOST_PTR&#39;</span> <span class="c">!                       = -37</span>
<a name="ln-575"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">38</span><span class="p">)</span> 
<a name="ln-576"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_MEM_OBJECT&#39;</span> <span class="c">!                     = -38</span>
<a name="ln-577"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">39</span><span class="p">)</span> 
<a name="ln-578"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_IMAGE_FORMAT_DESCRIPTOR&#39;</span> <span class="c">!        = -39</span>
<a name="ln-579"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">)</span> 
<a name="ln-580"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_IMAGE_SIZE&#39;</span> <span class="c">!                     = -40</span>
<a name="ln-581"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">41</span><span class="p">)</span> 
<a name="ln-582"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_SAMPLER&#39;</span> <span class="c">!                        = -41</span>
<a name="ln-583"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">42</span><span class="p">)</span> 
<a name="ln-584"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_BINARY&#39;</span> <span class="c">!                         = -42</span>
<a name="ln-585"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">43</span><span class="p">)</span> 
<a name="ln-586"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_BUILD_OPTION&#39;</span> <span class="c">!                   = -43</span>
<a name="ln-587"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">44</span><span class="p">)</span> 
<a name="ln-588"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_PROGRAM&#39;</span> <span class="c">!                        = -44</span>
<a name="ln-589"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">45</span><span class="p">)</span> 
<a name="ln-590"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_PROGRAM_EXECUTABLE&#39;</span> <span class="c">!             = -45</span>
<a name="ln-591"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">46</span><span class="p">)</span> 
<a name="ln-592"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_KERNEL_NAME&#39;</span> <span class="c">!                    = -46</span>
<a name="ln-593"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">47</span><span class="p">)</span> 
<a name="ln-594"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_KERNEL_DEFINITION&#39;</span> <span class="c">!              = -47</span>
<a name="ln-595"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">48</span><span class="p">)</span> 
<a name="ln-596"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_KERNEL&#39;</span> <span class="c">!                         = -48</span>
<a name="ln-597"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">49</span><span class="p">)</span> 
<a name="ln-598"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_ARG_INDEX&#39;</span> <span class="c">!                      = -49</span>
<a name="ln-599"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">)</span> 
<a name="ln-600"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_ARG_VALUE&#39;</span> <span class="c">!                      = -50</span>
<a name="ln-601"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">51</span><span class="p">)</span> 
<a name="ln-602"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_ARG_SIZE&#39;</span> <span class="c">!                       = -51</span>
<a name="ln-603"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">52</span><span class="p">)</span> 
<a name="ln-604"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_KERNEL_ARGS&#39;</span> <span class="c">!                    = -52</span>
<a name="ln-605"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">53</span><span class="p">)</span> 
<a name="ln-606"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_WORK_DIMENSION&#39;</span> <span class="c">!                 = -53</span>
<a name="ln-607"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">54</span><span class="p">)</span> 
<a name="ln-608"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_WORK_GROUP_SIZE&#39;</span> <span class="c">!                = -54</span>
<a name="ln-609"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">55</span><span class="p">)</span> 
<a name="ln-610"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_WORK_ITEM_SIZE&#39;</span> <span class="c">!                 = -55</span>
<a name="ln-611"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">56</span><span class="p">)</span> 
<a name="ln-612"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_GLOBAL_OFFSET&#39;</span> <span class="c">!                  = -56</span>
<a name="ln-613"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">57</span><span class="p">)</span> 
<a name="ln-614"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_EVENT_WAIT_LIST&#39;</span> <span class="c">!                = -57</span>
<a name="ln-615"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">58</span><span class="p">)</span> 
<a name="ln-616"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_EVENT&#39;</span> <span class="c">!                          = -58</span>
<a name="ln-617"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">59</span><span class="p">)</span> 
<a name="ln-618"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_OPERATION&#39;</span> <span class="c">!                      = -59</span>
<a name="ln-619"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">)</span> 
<a name="ln-620"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_GL_OBJECT&#39;</span> <span class="c">!                      = -60</span>
<a name="ln-621"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">61</span><span class="p">)</span> 
<a name="ln-622"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_BUFFER_SIZE&#39;</span> <span class="c">!                    = -61</span>
<a name="ln-623"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">62</span><span class="p">)</span> 
<a name="ln-624"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_MIP_LEVEL&#39;</span> <span class="c">!                      = -62</span>
<a name="ln-625"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">63</span><span class="p">)</span> 
<a name="ln-626"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_GLOBAL_WORK_SIZE&#39;</span> <span class="c">!               = -63</span>
<a name="ln-627"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">64</span><span class="p">)</span> 
<a name="ln-628"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_PROPERTY&#39;</span> <span class="c">!                       = -64</span>
<a name="ln-629"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">65</span><span class="p">)</span> 
<a name="ln-630"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_IMAGE_DESCRIPTOR&#39;</span> <span class="c">!               = -65</span>
<a name="ln-631"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">66</span><span class="p">)</span> 
<a name="ln-632"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_COMPILER_OPTIONS&#39;</span> <span class="c">!               = -66</span>
<a name="ln-633"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">67</span><span class="p">)</span> 
<a name="ln-634"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_LINKER_OPTIONS&#39;</span> <span class="c">!                 = -67</span>
<a name="ln-635"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">68</span><span class="p">)</span> 
<a name="ln-636"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: CL_INVALID_DEVICE_PARTITION_COUNT&#39;</span> <span class="c">!         = -68</span>
<a name="ln-637"></a>   <span class="k">case </span><span class="n">default</span>  
<a name="ln-638"></a>        <span class="n">estr</span> <span class="o">=</span> <span class="s1">&#39;Error: Unknown CL error code&#39;</span>
<a name="ln-639"></a>        <span class="n">iout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ierr</span>
<a name="ln-640"></a>        <span class="k">call </span><span class="n">WriteValue</span><span class="p">(</span><span class="s1">&#39;Unknown CL error code : &#39;</span><span class="p">,</span> <span class="n">iout</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-641"></a>  <span class="k">end select</span>
<a name="ln-642"></a>
<a name="ln-643"></a><span class="k">  if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">nonfatal</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-644"></a><span class="k">    if</span> <span class="p">(</span><span class="n">nonfatal</span><span class="p">.</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-645"></a><span class="k">      print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39; Non-fatal error: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
<a name="ln-646"></a>    <span class="k">end if</span>
<a name="ln-647"></a><span class="k">  else</span>
<a name="ln-648"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">routine</span><span class="p">),</span><span class="nb">trim</span><span class="p">(</span><span class="n">estr</span><span class="p">))</span>
<a name="ln-649"></a>  <span class="k">end if</span>
<a name="ln-650"></a>
<a name="ln-651"></a><span class="k">end if</span>
<a name="ln-652"></a>
<a name="ln-653"></a><span class="k">end subroutine </span><span class="n">CLerror_check</span>
<a name="ln-654"></a>
<a name="ln-655"></a>
<a name="ln-656"></a><span class="k">end module </span><span class="n">CLsupport</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 <a rel="license" href="http://www.freebsd.org/copyright/freebsd-doc-license.html">FreeBSD Documentation License</a></p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> Fortran Program was developed by Marc De Graef Research Group/Carnegie Mellon University</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>