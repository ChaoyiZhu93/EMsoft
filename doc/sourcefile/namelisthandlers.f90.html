<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="EMsoft main library">
    
    <meta name="author" content="Marc De Graef Research Group/Carnegie Mellon University" >
    <link rel="icon" href="../favicon.png">

    <title>NameListHandlers.f90 &ndash; Fortran Program</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran Program </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../lists/programs.html">Programs</a></li>
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>NameListHandlers.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title="12.0% of total for source files.">3667 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/NameListHandlers.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">NameListHandlers.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/namelisthandlers.html">NameListHandlers</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html#src">NameListHandlers.f90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
    <h3>This File Depends On</h3>
    
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~namelisthandlers.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilenamelisthandlersf90EfferentGraph" width="278pt" height="74pt"
 viewBox="0.00 0.00 278.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~namelisthandlers.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~namelisthandlers.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-70 274,-70 274,4 -4,4"/>
<!-- sourcefile~namelisthandlers.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~EfferentGraph_node1" class="node"><title>sourcefile~namelisthandlers.f90</title>
<polygon fill="none" stroke="black" points="270,-45 154,-45 154,-21 270,-21 270,-45"/>
<text text-anchor="middle" x="212" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50">NameListHandlers.f90</text>
</g>
<!-- sourcefile~namelisttypedefs.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~EfferentGraph_node2" class="node"><title>sourcefile~namelisttypedefs.f90</title>
<g id="a_sourcefile~~namelisthandlers.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/namelisttypedefs.f90.html" xlink:title="NameListTypedefs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="118,-66 0,-66 0,-42 118,-42 118,-66"/>
<text text-anchor="middle" x="59" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">NameListTypedefs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~namelisttypedefs.f90&#45;&gt;sourcefile~namelisthandlers.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~namelisttypedefs.f90&#45;&gt;sourcefile~namelisthandlers.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M118.381,-45.8809C126.641,-44.7321 135.19,-43.5432 143.603,-42.3732"/>
<polygon fill="#ff0000" stroke="#ff0000" points="144.346,-45.8035 153.769,-40.9593 143.382,-38.8702 144.346,-45.8035"/>
</g>
<!-- sourcefile~constants.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~EfferentGraph_node3" class="node"><title>sourcefile~constants.f90</title>
<g id="a_sourcefile~~namelisthandlers.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/constants.f90.html" xlink:title="constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="96.5,-24 21.5,-24 21.5,-0 96.5,-0 96.5,-24"/>
<text text-anchor="middle" x="59" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~constants.f90&#45;&gt;sourcefile~namelisthandlers.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~constants.f90&#45;&gt;sourcefile~namelisthandlers.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M96.5529,-17.0835C110.792,-19.0638 127.577,-21.3981 143.839,-23.6597"/>
<polygon fill="#ff0000" stroke="#ff0000" points="143.483,-27.1438 153.87,-25.0547 144.447,-20.2105 143.483,-27.1438"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
    
      
      <h3>Files Dependent On This One</h3>
      
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~namelisthandlers.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilenamelisthandlersf90AfferentGraph" width="487pt" height="32pt"
 viewBox="0.00 0.00 487.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~namelisthandlers.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 483,-28 483,4 -4,4"/>
<!-- sourcefile~namelisthandlers.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph_node1" class="node"><title>sourcefile~namelisthandlers.f90</title>
<polygon fill="none" stroke="black" points="116,-24 0,-24 0,-0 116,-0 116,-24"/>
<text text-anchor="middle" x="58" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">NameListHandlers.f90</text>
</g>
<!-- sourcefile~jsonsupport.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph_node2" class="node"><title>sourcefile~jsonsupport.f90</title>
<g id="a_sourcefile~~namelisthandlers.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/jsonsupport.f90.html" xlink:title="JSONsupport.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="245,-24 152,-24 152,-0 245,-0 245,-24"/>
<text text-anchor="middle" x="198.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">JSONsupport.f90</text>
</a>
</g>
</g>
<!-- sourcefile~namelisthandlers.f90&#45;&gt;sourcefile~jsonsupport.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~namelisthandlers.f90&#45;&gt;sourcefile~jsonsupport.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M116.133,-12C124.609,-12 133.335,-12 141.781,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="141.91,-15.5001 151.91,-12 141.91,-8.5001 141.91,-15.5001"/>
</g>
<!-- sourcefile~defectmodule.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph_node3" class="node"><title>sourcefile~defectmodule.f90</title>
<g id="a_sourcefile~~namelisthandlers.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/defectmodule.f90.html" xlink:title="defectmodule.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-24 281,-24 281,-0 374,-0 374,-24"/>
<text text-anchor="middle" x="327.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">defectmodule.f90</text>
</a>
</g>
</g>
<!-- sourcefile~jsonsupport.f90&#45;&gt;sourcefile~defectmodule.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~jsonsupport.f90&#45;&gt;sourcefile~defectmodule.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M245.35,-12C253.533,-12 262.141,-12 270.568,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="270.717,-15.5001 280.717,-12 270.717,-8.5001 270.717,-15.5001"/>
</g>
<!-- sourcefile~dispfield.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph_node4" class="node"><title>sourcefile~dispfield.f90</title>
<g id="a_sourcefile~~namelisthandlers.f90~~AfferentGraph_node4"><a xlink:href="../sourcefile/dispfield.f90.html" xlink:title="dispfield.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="479,-24 410,-24 410,-0 479,-0 479,-24"/>
<text text-anchor="middle" x="444.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dispfield.f90</text>
</a>
</g>
</g>
<!-- sourcefile~defectmodule.f90&#45;&gt;sourcefile~dispfield.f90 -->
<g id="sourcefile~~namelisthandlers.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~defectmodule.f90&#45;&gt;sourcefile~dispfield.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M374.281,-12C382.649,-12 391.363,-12 399.672,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="399.925,-15.5001 409.924,-12 399.924,-8.5001 399.925,-15.5001"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/namelisthandlers.html">NameListHandlers</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html#src">NameListHandlers.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! ###################################################################</span>
<a name="ln-2"></a><span class="c">! Copyright (c) 2013-2014, Marc De Graef/Carnegie Mellon University</span>
<a name="ln-3"></a><span class="c">! All rights reserved.</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">! Redistribution and use in source and binary forms, with or without modification, are </span>
<a name="ln-6"></a><span class="c">! permitted provided that the following conditions are met:</span>
<a name="ln-7"></a><span class="c">!</span>
<a name="ln-8"></a><span class="c">!     - Redistributions of source code must retain the above copyright notice, this list </span>
<a name="ln-9"></a><span class="c">!        of conditions and the following disclaimer.</span>
<a name="ln-10"></a><span class="c">!     - Redistributions in binary form must reproduce the above copyright notice, this </span>
<a name="ln-11"></a><span class="c">!        list of conditions and the following disclaimer in the documentation and/or </span>
<a name="ln-12"></a><span class="c">!        other materials provided with the distribution.</span>
<a name="ln-13"></a><span class="c">!     - Neither the names of Marc De Graef, Carnegie Mellon University nor the names </span>
<a name="ln-14"></a><span class="c">!        of its contributors may be used to endorse or promote products derived from </span>
<a name="ln-15"></a><span class="c">!        this software without specific prior written permission.</span>
<a name="ln-16"></a><span class="c">!</span>
<a name="ln-17"></a><span class="c">! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; </span>
<a name="ln-18"></a><span class="c">! AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE </span>
<a name="ln-19"></a><span class="c">! IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE </span>
<a name="ln-20"></a><span class="c">! ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE </span>
<a name="ln-21"></a><span class="c">! LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL </span>
<a name="ln-22"></a><span class="c">! DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR </span>
<a name="ln-23"></a><span class="c">! SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER </span>
<a name="ln-24"></a><span class="c">! CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, </span>
<a name="ln-25"></a><span class="c">! OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE </span>
<a name="ln-26"></a><span class="c">! USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="ln-27"></a><span class="c">! ###################################################################</span>
<a name="ln-28"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-29"></a><span class="c">! EMsoft:NameListHandlers.f90</span>
<a name="ln-30"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-31"></a><span class="c">!</span>
<a name="ln-32"></a><span class="c">! PROGRAM: NameListHandlers</span>
<a name="ln-33"></a><span class="c">!</span>
<a name="ln-34"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-35"></a><span class="c">!</span>
<a name="ln-36"></a><span class="c">!&gt; @brief routines for reading and returning name list type structures</span>
<a name="ln-37"></a><span class="c">!</span>
<a name="ln-38"></a><span class="c">!&gt; @date 06/13/14 MDG 1.0 original</span>
<a name="ln-39"></a><span class="c">!&gt; @date 05/05/15 MDG 1.1 removed primelist variable from name list files</span>
<a name="ln-40"></a><span class="c">!&gt; @date 08/12/15 MDG 1.2 added initonly optional keyword to skip reading from file</span>
<a name="ln-41"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-42"></a><span class="k">module </span><span class="n">NameListHandlers</span>
<a name="ln-43"></a>
<a name="ln-44"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-45"></a><span class="k">use </span><span class="n">NameListTypedefs</span>
<a name="ln-46"></a>
<a name="ln-47"></a><span class="k">contains</span>
<a name="ln-48"></a>
<a name="ln-49"></a>
<a name="ln-50"></a>
<a name="ln-51"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-52"></a><span class="c">!</span>
<a name="ln-53"></a><span class="c">! SUBROUTINE:GetMultiPhaseNameList</span>
<a name="ln-54"></a><span class="c">!</span>
<a name="ln-55"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-56"></a><span class="c">!</span>
<a name="ln-57"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMMultiphase.f90)</span>
<a name="ln-58"></a><span class="c">!</span>
<a name="ln-59"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-60"></a><span class="c">!&gt; @param enl multiphase name list structure</span>
<a name="ln-61"></a><span class="c">!&gt; @param initonly [optional] logical</span>
<a name="ln-62"></a><span class="c">!</span>
<a name="ln-63"></a><span class="c">!&gt; @date 02/21/17  MDG 1.0 new routine</span>
<a name="ln-64"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-65"></a><span class="k">recursive subroutine </span><span class="n">GetMultiPhaseNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-66"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetMultiPhaseNameList</span>
<a name="ln-67"></a>
<a name="ln-68"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-69"></a>
<a name="ln-70"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-71"></a>
<a name="ln-72"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-73"></a><span class="k">type</span><span class="p">(</span><span class="n">MultiPhaseNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-74"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-75"></a>
<a name="ln-76"></a><span class="kt">logical</span>                                     <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-77"></a>
<a name="ln-78"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-79"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dp1file</span>
<a name="ln-80"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dp2file</span>
<a name="ln-81"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dp3file</span>
<a name="ln-82"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outputfile</span>
<a name="ln-83"></a>
<a name="ln-84"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">multiphaselist</span><span class="o">/</span> <span class="n">dp1file</span><span class="p">,</span> <span class="n">dp2file</span><span class="p">,</span> <span class="n">dp3file</span><span class="p">,</span> <span class="n">outputfile</span><span class="p">,</span> <span class="n">nthreads</span>
<a name="ln-85"></a>
<a name="ln-86"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-87"></a><span class="n">dp1file</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-88"></a><span class="n">dp2file</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-89"></a><span class="n">dp3file</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-90"></a><span class="n">outputfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-91"></a>
<a name="ln-92"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-93"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-94"></a><span class="k">end if</span>
<a name="ln-95"></a>
<a name="ln-96"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-97"></a><span class="c">! read the namelist file</span>
<a name="ln-98"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-99"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">multiphaselist</span><span class="p">)</span>
<a name="ln-100"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-101"></a>
<a name="ln-102"></a><span class="c">! check for required entries</span>
<a name="ln-103"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dp1file</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-104"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;Emultiphase:&#39;</span><span class="p">,</span><span class="s1">&#39; dp1 file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-105"></a> <span class="k">end if</span>
<a name="ln-106"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dp2file</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-107"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;Emultiphase:&#39;</span><span class="p">,</span><span class="s1">&#39; dp2 file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-108"></a> <span class="k">end if</span>
<a name="ln-109"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dp3file</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-110"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;Emultiphase:&#39;</span><span class="p">,</span><span class="s1">&#39; dp3 file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-111"></a> <span class="k">end if</span>
<a name="ln-112"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">outputfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-113"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;Emultiphase:&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-114"></a> <span class="k">end if</span>
<a name="ln-115"></a><span class="k">end if</span>
<a name="ln-116"></a>
<a name="ln-117"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-118"></a><span class="n">enl</span><span class="p">%</span><span class="n">dp1file</span> <span class="o">=</span> <span class="n">dp1file</span>
<a name="ln-119"></a><span class="n">enl</span><span class="p">%</span><span class="n">dp2file</span> <span class="o">=</span> <span class="n">dp2file</span>
<a name="ln-120"></a><span class="n">enl</span><span class="p">%</span><span class="n">dp3file</span> <span class="o">=</span> <span class="n">dp3file</span>
<a name="ln-121"></a><span class="n">enl</span><span class="p">%</span><span class="n">outputfile</span> <span class="o">=</span> <span class="n">outputfile</span>
<a name="ln-122"></a>
<a name="ln-123"></a><span class="k">end subroutine </span><span class="n">GetMultiPhaseNameList</span>
<a name="ln-124"></a>
<a name="ln-125"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-126"></a><span class="c">!</span>
<a name="ln-127"></a><span class="c">! SUBROUTINE:GetKosselNameList</span>
<a name="ln-128"></a><span class="c">!</span>
<a name="ln-129"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-130"></a><span class="c">!</span>
<a name="ln-131"></a><span class="c">!&gt; @brief read namelist file and fill knl structure (used by EMKossel.f90)</span>
<a name="ln-132"></a><span class="c">!</span>
<a name="ln-133"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-134"></a><span class="c">!&gt; @param knl Kossel name list structure</span>
<a name="ln-135"></a><span class="c">!&gt; @param initonly [optional] logical</span>
<a name="ln-136"></a><span class="c">!</span>
<a name="ln-137"></a><span class="c">!&gt; @date 06/13/14  MDG 1.0 new routine</span>
<a name="ln-138"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-139"></a><span class="k">recursive subroutine </span><span class="n">GetKosselNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">knl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-140"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetKosselNameList</span>
<a name="ln-141"></a>
<a name="ln-142"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-143"></a>
<a name="ln-144"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-145"></a>
<a name="ln-146"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-147"></a><span class="k">type</span><span class="p">(</span><span class="n">KosselNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">knl</span>
<a name="ln-148"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-149"></a>
<a name="ln-150"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-151"></a>
<a name="ln-152"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-153"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numthick</span>
<a name="ln-154"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-155"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">maxHOLZ</span>
<a name="ln-156"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-157"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">k</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-158"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">fn</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-159"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-160"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-161"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">convergence</span>
<a name="ln-162"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">startthick</span>
<a name="ln-163"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thickinc</span>
<a name="ln-164"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">minten</span>
<a name="ln-165"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-166"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outname</span>
<a name="ln-167"></a>
<a name="ln-168"></a>
<a name="ln-169"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">Kossellist</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">convergence</span><span class="p">,</span> <span class="n">minten</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-170"></a>                              <span class="n">startthick</span><span class="p">,</span> <span class="n">thickinc</span><span class="p">,</span> <span class="n">numthick</span><span class="p">,</span> <span class="n">outname</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">maxHOLZ</span>
<a name="ln-171"></a>
<a name="ln-172"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-173"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>                      <span class="c">! standard output</span>
<a name="ln-174"></a><span class="n">numthick</span> <span class="o">=</span> <span class="mi">10</span>                   <span class="c">! number of increments</span>
<a name="ln-175"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">256</span>                      <span class="c">! output arrays will have size npix x npix</span>
<a name="ln-176"></a><span class="n">maxHOLZ</span> <span class="o">=</span> <span class="mi">3</span>                     <span class="c">! output arrays will have size npix x npix</span>
<a name="ln-177"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">4</span>                    <span class="c">! default number of threads for OpenMP</span>
<a name="ln-178"></a><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>               <span class="c">! beam direction [direction indices]</span>
<a name="ln-179"></a><span class="n">fn</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>              <span class="c">! foil normal [direction indices]</span>
<a name="ln-180"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">20000</span><span class="mf">0.0</span>              <span class="c">! acceleration voltage [V]</span>
<a name="ln-181"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.025</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-182"></a><span class="n">convergence</span> <span class="o">=</span> <span class="mi">2</span><span class="mf">5.0</span>              <span class="c">! beam convergence angle [mrad]</span>
<a name="ln-183"></a><span class="n">startthick</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>               <span class="c">! starting thickness [nm]</span>
<a name="ln-184"></a><span class="n">thickinc</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>                 <span class="c">! thickness increment</span>
<a name="ln-185"></a><span class="n">minten</span> <span class="o">=</span> <span class="mf">1.0E-5</span>                 <span class="c">! minimum intensity in diffraction disk to make it into the output file</span>
<a name="ln-186"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>          <span class="c">! initial value to check that the keyword is present in the nml file</span>
<a name="ln-187"></a><span class="n">outname</span> <span class="o">=</span> <span class="s1">&#39;Kosselout.data&#39;</span>      <span class="c">! output filename</span>
<a name="ln-188"></a>
<a name="ln-189"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-190"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-191"></a><span class="k">end if</span>
<a name="ln-192"></a>
<a name="ln-193"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-194"></a><span class="c">! read the namelist file</span>
<a name="ln-195"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-196"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">Kossellist</span><span class="p">)</span>
<a name="ln-197"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-198"></a>
<a name="ln-199"></a><span class="c">! check for required entries</span>
<a name="ln-200"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-201"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMKossel:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-202"></a> <span class="k">end if</span>
<a name="ln-203"></a><span class="k">end if</span>
<a name="ln-204"></a>
<a name="ln-205"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the knl fields</span>
<a name="ln-206"></a><span class="n">knl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-207"></a><span class="n">knl</span><span class="p">%</span><span class="n">numthick</span> <span class="o">=</span> <span class="n">numthick</span>
<a name="ln-208"></a><span class="n">knl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-209"></a><span class="n">knl</span><span class="p">%</span><span class="n">maxHOLZ</span> <span class="o">=</span> <span class="n">maxHOLZ</span>
<a name="ln-210"></a><span class="n">knl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-211"></a><span class="n">knl</span><span class="p">%</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
<a name="ln-212"></a><span class="n">knl</span><span class="p">%</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
<a name="ln-213"></a><span class="n">knl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-214"></a><span class="n">knl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-215"></a><span class="n">knl</span><span class="p">%</span><span class="n">convergence</span> <span class="o">=</span> <span class="n">convergence</span>
<a name="ln-216"></a><span class="n">knl</span><span class="p">%</span><span class="n">startthick</span> <span class="o">=</span> <span class="n">startthick</span>
<a name="ln-217"></a><span class="n">knl</span><span class="p">%</span><span class="n">thickinc</span> <span class="o">=</span> <span class="n">thickinc</span>
<a name="ln-218"></a><span class="n">knl</span><span class="p">%</span><span class="n">minten</span> <span class="o">=</span> <span class="n">minten</span>
<a name="ln-219"></a><span class="n">knl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-220"></a><span class="n">knl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
<a name="ln-221"></a>
<a name="ln-222"></a><span class="k">end subroutine </span><span class="n">GetKosselNameList</span>
<a name="ln-223"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-224"></a><span class="c">!</span>
<a name="ln-225"></a><span class="c">! SUBROUTINE:GetKosselMasterNameList</span>
<a name="ln-226"></a><span class="c">!</span>
<a name="ln-227"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-228"></a><span class="c">!</span>
<a name="ln-229"></a><span class="c">!&gt; @brief read namelist file and fill knl structure (used by EMKosselmaster.f90)</span>
<a name="ln-230"></a><span class="c">!</span>
<a name="ln-231"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-232"></a><span class="c">!&gt; @param knl Kossel name list structure</span>
<a name="ln-233"></a><span class="c">!</span>
<a name="ln-234"></a><span class="c">!&gt; @date 09/09/14  MDG 1.0 new routine</span>
<a name="ln-235"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-236"></a><span class="k">recursive subroutine </span><span class="n">GetKosselMasterNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">knl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-237"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetKosselMasterNameList</span>
<a name="ln-238"></a>
<a name="ln-239"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-240"></a>
<a name="ln-241"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-242"></a>
<a name="ln-243"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-244"></a><span class="k">type</span><span class="p">(</span><span class="n">KosselMasterNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">knl</span>
<a name="ln-245"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-246"></a>
<a name="ln-247"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-248"></a>
<a name="ln-249"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-250"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numthick</span>
<a name="ln-251"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npx</span>
<a name="ln-252"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-253"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-254"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-255"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">startthick</span>
<a name="ln-256"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thickinc</span>
<a name="ln-257"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">tfraction</span>
<a name="ln-258"></a><span class="kt">character</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">Kosselmode</span>
<a name="ln-259"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-260"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outname</span>
<a name="ln-261"></a>
<a name="ln-262"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">Kosselmasterlist</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span>  <span class="n">nthreads</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-263"></a>                              <span class="n">startthick</span><span class="p">,</span> <span class="n">thickinc</span><span class="p">,</span> <span class="n">numthick</span><span class="p">,</span> <span class="n">tfraction</span><span class="p">,</span> <span class="n">outname</span><span class="p">,</span> <span class="n">npx</span><span class="p">,</span> <span class="n">Kosselmode</span>
<a name="ln-264"></a>
<a name="ln-265"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-266"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>                      <span class="c">! standard output</span>
<a name="ln-267"></a><span class="n">numthick</span> <span class="o">=</span> <span class="mi">10</span>                   <span class="c">! number of increments</span>
<a name="ln-268"></a><span class="n">npx</span> <span class="o">=</span> <span class="mi">256</span>                       <span class="c">! output arrays will have size npix x npix</span>
<a name="ln-269"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">4</span>                    <span class="c">! default number of threads for OpenMP</span>
<a name="ln-270"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">20000</span><span class="mf">0.0</span>              <span class="c">! acceleration voltage [V]</span>
<a name="ln-271"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.025</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-272"></a><span class="n">startthick</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>               <span class="c">! starting thickness [nm]</span>
<a name="ln-273"></a><span class="n">thickinc</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>                 <span class="c">! thickness increment</span>
<a name="ln-274"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>          <span class="c">! initial value to check that the keyword is present in the nml file</span>
<a name="ln-275"></a><span class="n">outname</span> <span class="o">=</span> <span class="s1">&#39;Kosselout.data&#39;</span>      <span class="c">! output filename</span>
<a name="ln-276"></a><span class="n">Kosselmode</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>           <span class="c">! &#39;thicks&#39; for thickness determination, &#39;normal&#39; for normal plot</span>
<a name="ln-277"></a><span class="n">tfraction</span> <span class="o">=</span> <span class="mf">0.1</span>                 <span class="c">! thickness fraction for &#39;thicks&#39; mode</span>
<a name="ln-278"></a>
<a name="ln-279"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-280"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-281"></a><span class="k">end if</span>
<a name="ln-282"></a>
<a name="ln-283"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-284"></a><span class="c">! read the namelist file</span>
<a name="ln-285"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-286"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">Kosselmasterlist</span><span class="p">)</span>
<a name="ln-287"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-288"></a>
<a name="ln-289"></a><span class="c">! check for required entries</span>
<a name="ln-290"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-291"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMKosselMaster:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-292"></a> <span class="k">end if</span>
<a name="ln-293"></a><span class="k">end if</span>
<a name="ln-294"></a>
<a name="ln-295"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the knl fields</span>
<a name="ln-296"></a><span class="n">knl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-297"></a><span class="n">knl</span><span class="p">%</span><span class="n">numthick</span> <span class="o">=</span> <span class="n">numthick</span>
<a name="ln-298"></a><span class="n">knl</span><span class="p">%</span><span class="n">npx</span> <span class="o">=</span> <span class="n">npx</span>
<a name="ln-299"></a><span class="n">knl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-300"></a><span class="n">knl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-301"></a><span class="n">knl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-302"></a><span class="n">knl</span><span class="p">%</span><span class="n">startthick</span> <span class="o">=</span> <span class="n">startthick</span>
<a name="ln-303"></a><span class="n">knl</span><span class="p">%</span><span class="n">thickinc</span> <span class="o">=</span> <span class="n">thickinc</span>
<a name="ln-304"></a><span class="n">knl</span><span class="p">%</span><span class="n">tfraction</span> <span class="o">=</span> <span class="n">tfraction</span>
<a name="ln-305"></a><span class="n">knl</span><span class="p">%</span><span class="n">Kosselmode</span> <span class="o">=</span> <span class="n">Kosselmode</span>
<a name="ln-306"></a><span class="n">knl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-307"></a><span class="n">knl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
<a name="ln-308"></a>
<a name="ln-309"></a><span class="k">end subroutine </span><span class="n">GetKosselMasterNameList</span>
<a name="ln-310"></a>
<a name="ln-311"></a>
<a name="ln-312"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-313"></a><span class="c">!</span>
<a name="ln-314"></a><span class="c">! SUBROUTINE:GetMCNameList</span>
<a name="ln-315"></a><span class="c">!</span>
<a name="ln-316"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-317"></a><span class="c">!</span>
<a name="ln-318"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMMC.f90)</span>
<a name="ln-319"></a><span class="c">!</span>
<a name="ln-320"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-321"></a><span class="c">!&gt; @param mcnl Monte Carloname list structure</span>
<a name="ln-322"></a><span class="c">!</span>
<a name="ln-323"></a><span class="c">!&gt; @date 06/18/14  MDG 1.0 new routine</span>
<a name="ln-324"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-325"></a><span class="k">recursive subroutine </span><span class="n">GetMCNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">mcnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-326"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetMCNameList</span>
<a name="ln-327"></a>
<a name="ln-328"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-329"></a>
<a name="ln-330"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-331"></a>
<a name="ln-332"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-333"></a><span class="k">type</span><span class="p">(</span><span class="n">MCNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">mcnl</span>
<a name="ln-334"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-335"></a>
<a name="ln-336"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-337"></a>
<a name="ln-338"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-339"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-340"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">num_el</span>
<a name="ln-341"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">primeseed</span>
<a name="ln-342"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-343"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sig</span>
<a name="ln-344"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-345"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">EkeV</span>
<a name="ln-346"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ehistmin</span>
<a name="ln-347"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ebinsize</span>
<a name="ln-348"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthmax</span>
<a name="ln-349"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthstep</span>
<a name="ln-350"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MCmode</span>
<a name="ln-351"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-352"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-353"></a>
<a name="ln-354"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-355"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">MCdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">num_el</span><span class="p">,</span> <span class="n">primeseed</span><span class="p">,</span> <span class="n">EkeV</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-356"></a>                <span class="n">dataname</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">Ehistmin</span><span class="p">,</span> <span class="n">Ebinsize</span><span class="p">,</span> <span class="n">depthmax</span><span class="p">,</span> <span class="n">depthstep</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">MCmode</span>
<a name="ln-357"></a>
<a name="ln-358"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-359"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-360"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">1501</span>
<a name="ln-361"></a><span class="n">primeseed</span> <span class="o">=</span> <span class="mi">932117</span>
<a name="ln-362"></a><span class="n">num_el</span> <span class="o">=</span> <span class="mi">12500000</span>
<a name="ln-363"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-364"></a><span class="n">sig</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-365"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-366"></a><span class="n">EkeV</span> <span class="o">=</span> <span class="mi">3</span><span class="mf">0.D0</span>
<a name="ln-367"></a><span class="n">Ehistmin</span> <span class="o">=</span> <span class="mf">5.D0</span>
<a name="ln-368"></a><span class="n">Ebinsize</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-369"></a><span class="n">depthmax</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.D0</span>
<a name="ln-370"></a><span class="n">depthstep</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-371"></a><span class="n">MCmode</span> <span class="o">=</span> <span class="s1">&#39;CSDA&#39;</span>
<a name="ln-372"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-373"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;MCoutput.data&#39;</span>
<a name="ln-374"></a>
<a name="ln-375"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-376"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-377"></a><span class="k">end if</span>
<a name="ln-378"></a>
<a name="ln-379"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-380"></a><span class="c">! read the namelist file</span>
<a name="ln-381"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-382"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">MCdata</span><span class="p">)</span>
<a name="ln-383"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-384"></a>
<a name="ln-385"></a><span class="c">! check for required entries</span>
<a name="ln-386"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-387"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMMC:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-388"></a> <span class="k">end if</span>
<a name="ln-389"></a><span class="k">end if</span>
<a name="ln-390"></a>
<a name="ln-391"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the mcnl fields</span>
<a name="ln-392"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-393"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-394"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">primeseed</span> <span class="o">=</span> <span class="n">primeseed</span>
<a name="ln-395"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">num_el</span> <span class="o">=</span> <span class="n">num_el</span>
<a name="ln-396"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-397"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span>
<a name="ln-398"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-399"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">EkeV</span> <span class="o">=</span> <span class="n">EkeV</span>
<a name="ln-400"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ehistmin</span> <span class="o">=</span> <span class="n">Ehistmin</span>
<a name="ln-401"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ebinsize</span> <span class="o">=</span> <span class="n">Ebinsize</span>
<a name="ln-402"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthmax</span> <span class="o">=</span> <span class="n">depthmax</span>
<a name="ln-403"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthstep</span> <span class="o">=</span> <span class="n">depthstep</span>
<a name="ln-404"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">MCmode</span> <span class="o">=</span> <span class="n">MCmode</span>
<a name="ln-405"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-406"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-407"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-408"></a>
<a name="ln-409"></a><span class="k">end subroutine </span><span class="n">GetMCNameList</span>
<a name="ln-410"></a>
<a name="ln-411"></a>
<a name="ln-412"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-413"></a><span class="c">!</span>
<a name="ln-414"></a><span class="c">! SUBROUTINE:GetMCLIPSSNameList</span>
<a name="ln-415"></a><span class="c">!</span>
<a name="ln-416"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-417"></a><span class="c">!</span>
<a name="ln-418"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMMC.f90)</span>
<a name="ln-419"></a><span class="c">!</span>
<a name="ln-420"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-421"></a><span class="c">!&gt; @param mcnl Monte Carloname list structure</span>
<a name="ln-422"></a><span class="c">!</span>
<a name="ln-423"></a><span class="c">!&gt; @date 12/01/15  PGC 1.0 new routine</span>
<a name="ln-424"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-425"></a><span class="k">recursive subroutine </span><span class="n">GetMCLIPSSNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">mcnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-426"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetMCLIPSSNameList</span>
<a name="ln-427"></a>
<a name="ln-428"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-429"></a>
<a name="ln-430"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-431"></a>
<a name="ln-432"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-433"></a><span class="k">type</span><span class="p">(</span><span class="n">MCLIPSSNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">mcnl</span>
<a name="ln-434"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-435"></a>
<a name="ln-436"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-437"></a>
<a name="ln-438"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-439"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-440"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">num_el</span>
<a name="ln-441"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">primeseed</span>
<a name="ln-442"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-443"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sig</span>
<a name="ln-444"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-445"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">EkeV</span>
<a name="ln-446"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ehistmin</span>
<a name="ln-447"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ebinsize</span>
<a name="ln-448"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthmax</span>
<a name="ln-449"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthstep</span>
<a name="ln-450"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">lipssamp</span> <span class="c">! lipss amplitude</span>
<a name="ln-451"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">lipsswave</span> <span class="c">! lipss wavelength</span>
<a name="ln-452"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">scaled</span> <span class="c">! scale factor</span>
<a name="ln-453"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npx</span> <span class="c">! array size of trajectory accumulator</span>
<a name="ln-454"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">vis</span> <span class="c">! write large trajectory accumulator (0-no, 1-yes)</span>
<a name="ln-455"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MCmode</span>
<a name="ln-456"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-457"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-458"></a>
<a name="ln-459"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-460"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">MCdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">num_el</span><span class="p">,</span> <span class="n">primeseed</span><span class="p">,</span> <span class="n">EkeV</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-461"></a>                <span class="n">dataname</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">Ehistmin</span><span class="p">,</span> <span class="n">Ebinsize</span><span class="p">,</span> <span class="n">depthmax</span><span class="p">,</span> <span class="n">depthstep</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-462"></a>                <span class="n">lipssamp</span><span class="p">,</span> <span class="n">lipsswave</span><span class="p">,</span> <span class="n">scaled</span><span class="p">,</span> <span class="n">npx</span><span class="p">,</span> <span class="n">vis</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">MCmode</span>
<a name="ln-463"></a>
<a name="ln-464"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-465"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-466"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">1501</span>
<a name="ln-467"></a><span class="n">primeseed</span> <span class="o">=</span> <span class="mi">932117</span>
<a name="ln-468"></a><span class="n">num_el</span> <span class="o">=</span> <span class="mi">12500000</span>
<a name="ln-469"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-470"></a><span class="n">sig</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-471"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-472"></a><span class="n">EkeV</span> <span class="o">=</span> <span class="mi">3</span><span class="mf">0.D0</span>
<a name="ln-473"></a><span class="n">Ehistmin</span> <span class="o">=</span> <span class="mf">5.D0</span>
<a name="ln-474"></a><span class="n">Ebinsize</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-475"></a><span class="n">depthmax</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.D0</span>
<a name="ln-476"></a><span class="n">depthstep</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-477"></a><span class="n">lipssamp</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">0.D0</span>
<a name="ln-478"></a><span class="n">lipsswave</span> <span class="o">=</span> <span class="mi">30</span><span class="mf">0.D0</span>
<a name="ln-479"></a><span class="n">scaled</span><span class="o">=</span><span class="mf">1.0D7</span>
<a name="ln-480"></a><span class="n">npx</span> <span class="o">=</span> <span class="mi">500</span>
<a name="ln-481"></a><span class="n">vis</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-482"></a><span class="n">MCmode</span> <span class="o">=</span> <span class="s1">&#39;CSDA&#39;</span>
<a name="ln-483"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-484"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;MCLIPSSoutput.data&#39;</span>
<a name="ln-485"></a>
<a name="ln-486"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-487"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-488"></a><span class="k">end if</span>
<a name="ln-489"></a>
<a name="ln-490"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-491"></a><span class="c">! read the namelist file</span>
<a name="ln-492"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-493"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">MCdata</span><span class="p">)</span>
<a name="ln-494"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-495"></a>
<a name="ln-496"></a><span class="c">! check for required entries</span>
<a name="ln-497"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-498"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMMCLIPSS:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-499"></a> <span class="k">end if</span>
<a name="ln-500"></a><span class="k">end if</span>
<a name="ln-501"></a>
<a name="ln-502"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the mcnl fields</span>
<a name="ln-503"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-504"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-505"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">primeseed</span> <span class="o">=</span> <span class="n">primeseed</span>
<a name="ln-506"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">num_el</span> <span class="o">=</span> <span class="n">num_el</span>
<a name="ln-507"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-508"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span>
<a name="ln-509"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-510"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">EkeV</span> <span class="o">=</span> <span class="n">EkeV</span>
<a name="ln-511"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ehistmin</span> <span class="o">=</span> <span class="n">Ehistmin</span>
<a name="ln-512"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ebinsize</span> <span class="o">=</span> <span class="n">Ebinsize</span>
<a name="ln-513"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthmax</span> <span class="o">=</span> <span class="n">depthmax</span>
<a name="ln-514"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthstep</span> <span class="o">=</span> <span class="n">depthstep</span>
<a name="ln-515"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">MCmode</span> <span class="o">=</span> <span class="n">MCmode</span>
<a name="ln-516"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-517"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-518"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-519"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">lipssamp</span> <span class="o">=</span> <span class="n">lipssamp</span>
<a name="ln-520"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">lipsswave</span> <span class="o">=</span> <span class="n">lipsswave</span>
<a name="ln-521"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">scaled</span> <span class="o">=</span> <span class="n">scaled</span>
<a name="ln-522"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">npx</span> <span class="o">=</span> <span class="n">npx</span>
<a name="ln-523"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">vis</span> <span class="o">=</span> <span class="n">vis</span>
<a name="ln-524"></a>
<a name="ln-525"></a><span class="k">end subroutine </span><span class="n">GetMCLIPSSNameList</span>
<a name="ln-526"></a>
<a name="ln-527"></a>
<a name="ln-528"></a>
<a name="ln-529"></a>
<a name="ln-530"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-531"></a><span class="c">!</span>
<a name="ln-532"></a><span class="c">! SUBROUTINE:GetConvertOrientationsNameList</span>
<a name="ln-533"></a><span class="c">!</span>
<a name="ln-534"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-535"></a><span class="c">!</span>
<a name="ln-536"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMConvertOrientations.f90 program)</span>
<a name="ln-537"></a><span class="c">!</span>
<a name="ln-538"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-539"></a><span class="c">!&gt; @param enl name list structure</span>
<a name="ln-540"></a><span class="c">!</span>
<a name="ln-541"></a><span class="c">!&gt; @date 01/31/17 MDG 1.0 new routine</span>
<a name="ln-542"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-543"></a><span class="k">recursive subroutine </span><span class="n">GetConvertOrientationsNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-544"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetConvertOrientationsNameList</span>
<a name="ln-545"></a>
<a name="ln-546"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-547"></a>
<a name="ln-548"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-549"></a>
<a name="ln-550"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-551"></a><span class="k">type</span><span class="p">(</span><span class="n">ConvertOrientationsNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-552"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-553"></a>
<a name="ln-554"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-555"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">cnt</span>
<a name="ln-556"></a>
<a name="ln-557"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">reducetoRFZ</span>
<a name="ln-558"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-559"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">cubochoric</span>
<a name="ln-560"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">homochoric</span>
<a name="ln-561"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">rodrigues</span>
<a name="ln-562"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">stereographic</span>
<a name="ln-563"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">eulerangles</span>
<a name="ln-564"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">axisangle</span>
<a name="ln-565"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">quaternion</span>
<a name="ln-566"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">rotationmatrix</span>
<a name="ln-567"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">anglefile</span>
<a name="ln-568"></a>
<a name="ln-569"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-570"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">EMConvertOrientations</span> <span class="o">/</span> <span class="n">cubochoric</span><span class="p">,</span> <span class="n">homochoric</span><span class="p">,</span> <span class="n">rodrigues</span><span class="p">,</span> <span class="n">stereographic</span><span class="p">,</span> <span class="n">eulerangles</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-571"></a>                              <span class="n">axisangle</span><span class="p">,</span> <span class="n">quaternion</span><span class="p">,</span> <span class="n">rotationmatrix</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">anglefile</span><span class="p">,</span> <span class="n">reducetoRFZ</span>
<a name="ln-572"></a>
<a name="ln-573"></a><span class="c">! initialize</span>
<a name="ln-574"></a><span class="n">reducetoRFZ</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-575"></a><span class="n">cubochoric</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-576"></a><span class="n">homochoric</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-577"></a><span class="n">rodrigues</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-578"></a><span class="n">stereographic</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-579"></a><span class="n">eulerangles</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-580"></a><span class="n">axisangle</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-581"></a><span class="n">quaternion</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-582"></a><span class="n">rotationmatrix</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-583"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-584"></a><span class="n">anglefile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-585"></a>
<a name="ln-586"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-587"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-588"></a><span class="k">end if</span>
<a name="ln-589"></a>
<a name="ln-590"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-591"></a><span class="c">! read the namelist file</span>
<a name="ln-592"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-593"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EMConvertOrientations</span><span class="p">)</span>
<a name="ln-594"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-595"></a>
<a name="ln-596"></a><span class="c">! check for required entries</span>
<a name="ln-597"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-598"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetConvertOrientationsNameList:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-599"></a> <span class="k">end if</span>
<a name="ln-600"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">anglefile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-601"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetConvertOrientationsNameList:&#39;</span><span class="p">,</span><span class="s1">&#39; angle file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-602"></a> <span class="k">end if</span>
<a name="ln-603"></a><span class="c">! at least one of the output file strings must be different from &#39;undefined&#39;</span>
<a name="ln-604"></a> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-605"></a> <span class="k">if</span> <span class="p">(</span><span class="n">cubochoric</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-606"></a> <span class="k">if</span> <span class="p">(</span><span class="n">homochoric</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-607"></a> <span class="k">if</span> <span class="p">(</span><span class="n">rodrigues</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-608"></a> <span class="k">if</span> <span class="p">(</span><span class="n">stereographic</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-609"></a> <span class="k">if</span> <span class="p">(</span><span class="n">eulerangles</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-610"></a> <span class="k">if</span> <span class="p">(</span><span class="n">quaternion</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-611"></a> <span class="k">if</span> <span class="p">(</span><span class="n">axisangle</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-612"></a> <span class="k">if</span> <span class="p">(</span><span class="n">rotationmatrix</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-613"></a> <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">8</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-614"></a><span class="k">   call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetConvertOrientationsNameList&#39;</span><span class="p">,</span><span class="s1">&#39; at least one output file name must be defined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-615"></a> <span class="k">end if</span>
<a name="ln-616"></a><span class="k">end if</span>
<a name="ln-617"></a>
<a name="ln-618"></a><span class="n">enl</span><span class="p">%</span><span class="n">reducetoRFZ</span> <span class="o">=</span> <span class="n">reducetoRFZ</span>
<a name="ln-619"></a><span class="n">enl</span><span class="p">%</span><span class="n">cubochoric</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">cubochoric</span><span class="p">)</span>
<a name="ln-620"></a><span class="n">enl</span><span class="p">%</span><span class="n">homochoric</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">homochoric</span><span class="p">)</span>
<a name="ln-621"></a><span class="n">enl</span><span class="p">%</span><span class="n">rodrigues</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">rodrigues</span><span class="p">)</span>
<a name="ln-622"></a><span class="n">enl</span><span class="p">%</span><span class="n">stereographic</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">stereographic</span><span class="p">)</span>
<a name="ln-623"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerangles</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">eulerangles</span><span class="p">)</span>
<a name="ln-624"></a><span class="n">enl</span><span class="p">%</span><span class="n">axisangle</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">axisangle</span><span class="p">)</span>
<a name="ln-625"></a><span class="n">enl</span><span class="p">%</span><span class="n">quaternion</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">quaternion</span><span class="p">)</span>
<a name="ln-626"></a><span class="n">enl</span><span class="p">%</span><span class="n">rotationmatrix</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">rotationmatrix</span><span class="p">)</span>
<a name="ln-627"></a><span class="n">enl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">)</span>
<a name="ln-628"></a><span class="n">enl</span><span class="p">%</span><span class="n">anglefile</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">anglefile</span><span class="p">)</span>
<a name="ln-629"></a>
<a name="ln-630"></a><span class="k">end subroutine </span><span class="n">GetConvertOrientationsNameList</span>
<a name="ln-631"></a>
<a name="ln-632"></a>
<a name="ln-633"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-634"></a><span class="c">!</span>
<a name="ln-635"></a><span class="c">! SUBROUTINE:GetOrientationVizNameList</span>
<a name="ln-636"></a><span class="c">!</span>
<a name="ln-637"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-638"></a><span class="c">!</span>
<a name="ln-639"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMOrientationViz.f90 program)</span>
<a name="ln-640"></a><span class="c">!</span>
<a name="ln-641"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-642"></a><span class="c">!&gt; @param enl name list structure</span>
<a name="ln-643"></a><span class="c">!</span>
<a name="ln-644"></a><span class="c">!&gt; @date 01/30/17 MDG 1.0 new routine</span>
<a name="ln-645"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-646"></a><span class="k">recursive subroutine </span><span class="n">GetOrientationVizNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-647"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetOrientationVizNameList</span>
<a name="ln-648"></a>
<a name="ln-649"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-650"></a>
<a name="ln-651"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-652"></a>
<a name="ln-653"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-654"></a><span class="k">type</span><span class="p">(</span><span class="n">OrientationVizNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-655"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-656"></a>
<a name="ln-657"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-658"></a>
<a name="ln-659"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">cubochoric</span>
<a name="ln-660"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">homochoric</span>
<a name="ln-661"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">rodrigues</span>
<a name="ln-662"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stereographic</span>
<a name="ln-663"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">eulerspace</span>
<a name="ln-664"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">reducetoRFZ</span>
<a name="ln-665"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-666"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-667"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-668"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">overridepgnum</span>
<a name="ln-669"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">MacKenzieCell</span>
<a name="ln-670"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">rgb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-671"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sphrad</span>
<a name="ln-672"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">distance</span>
<a name="ln-673"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">scalingmode</span>
<a name="ln-674"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">df3file</span>
<a name="ln-675"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-676"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">povrayfile</span>
<a name="ln-677"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">anglefile</span>
<a name="ln-678"></a>
<a name="ln-679"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-680"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">EMOrientationViz</span> <span class="o">/</span> <span class="n">cubochoric</span><span class="p">,</span> <span class="n">homochoric</span><span class="p">,</span> <span class="n">rodrigues</span><span class="p">,</span> <span class="n">stereographic</span><span class="p">,</span> <span class="n">eulerspace</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-681"></a>                              <span class="n">xtalname</span><span class="p">,</span> <span class="n">povrayfile</span><span class="p">,</span> <span class="n">anglefile</span><span class="p">,</span> <span class="n">reducetoRFZ</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">sphrad</span><span class="p">,</span> <span class="n">df3file</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-682"></a>                              <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">scalingmode</span><span class="p">,</span> <span class="n">overridepgnum</span><span class="p">,</span> <span class="n">MacKenzieCell</span>
<a name="ln-683"></a>
<a name="ln-684"></a><span class="c">! initialize</span>
<a name="ln-685"></a><span class="n">cubochoric</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-686"></a><span class="n">homochoric</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-687"></a><span class="n">rodrigues</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-688"></a><span class="n">stereographic</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-689"></a><span class="n">eulerspace</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-690"></a><span class="n">reducetoRFZ</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-691"></a><span class="n">overridepgnum</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-692"></a><span class="n">MacKenzieCell</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-693"></a><span class="n">rgb</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-694"></a><span class="n">sphrad</span> <span class="o">=</span> <span class="mf">0.015</span>
<a name="ln-695"></a><span class="n">distance</span> <span class="o">=</span> <span class="mf">4.0</span>
<a name="ln-696"></a><span class="n">nx</span> <span class="o">=</span> <span class="mi">64</span>
<a name="ln-697"></a><span class="n">ny</span> <span class="o">=</span> <span class="mi">64</span>
<a name="ln-698"></a><span class="n">nz</span> <span class="o">=</span> <span class="mi">64</span>
<a name="ln-699"></a><span class="n">scalingmode</span> <span class="o">=</span> <span class="s1">&#39;lev&#39;</span>   <span class="c">! or &#39;log&#39; or &#39;lev&#39; (for equi-level contours)</span>
<a name="ln-700"></a><span class="n">df3file</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-701"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-702"></a><span class="n">povrayfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-703"></a><span class="n">anglefile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-704"></a>
<a name="ln-705"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-706"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-707"></a><span class="k">end if</span>
<a name="ln-708"></a>
<a name="ln-709"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-710"></a><span class="c">! read the namelist file</span>
<a name="ln-711"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-712"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EMOrientationViz</span><span class="p">)</span>
<a name="ln-713"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-714"></a>
<a name="ln-715"></a><span class="c">! check for required entries</span>
<a name="ln-716"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-717"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMOrientationViz:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-718"></a> <span class="k">end if</span>
<a name="ln-719"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">povrayfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-720"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMOrientationViz:&#39;</span><span class="p">,</span><span class="s1">&#39; povray file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-721"></a> <span class="k">end if</span>
<a name="ln-722"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">anglefile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-723"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMOrientationViz:&#39;</span><span class="p">,</span><span class="s1">&#39; angle file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-724"></a> <span class="k">end if</span>
<a name="ln-725"></a><span class="k">end if</span>
<a name="ln-726"></a>
<a name="ln-727"></a><span class="n">enl</span><span class="p">%</span><span class="n">cubochoric</span> <span class="o">=</span> <span class="n">cubochoric</span>
<a name="ln-728"></a><span class="n">enl</span><span class="p">%</span><span class="n">homochoric</span> <span class="o">=</span> <span class="n">homochoric</span>
<a name="ln-729"></a><span class="n">enl</span><span class="p">%</span><span class="n">rodrigues</span> <span class="o">=</span> <span class="n">rodrigues</span>
<a name="ln-730"></a><span class="n">enl</span><span class="p">%</span><span class="n">stereographic</span> <span class="o">=</span> <span class="n">stereographic</span>
<a name="ln-731"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerspace</span> <span class="o">=</span> <span class="n">eulerspace</span>
<a name="ln-732"></a><span class="n">enl</span><span class="p">%</span><span class="n">reducetoRFZ</span> <span class="o">=</span> <span class="n">reducetoRFZ</span>
<a name="ln-733"></a><span class="n">enl</span><span class="p">%</span><span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span>
<a name="ln-734"></a><span class="n">enl</span><span class="p">%</span><span class="n">ny</span> <span class="o">=</span> <span class="n">ny</span>
<a name="ln-735"></a><span class="n">enl</span><span class="p">%</span><span class="n">nz</span> <span class="o">=</span> <span class="n">nz</span>
<a name="ln-736"></a><span class="n">enl</span><span class="p">%</span><span class="n">overridepgnum</span> <span class="o">=</span> <span class="n">overridepgnum</span>
<a name="ln-737"></a><span class="n">enl</span><span class="p">%</span><span class="n">MacKenzieCell</span> <span class="o">=</span> <span class="n">MacKenzieCell</span>
<a name="ln-738"></a><span class="n">enl</span><span class="p">%</span><span class="n">rgb</span> <span class="o">=</span> <span class="n">rgb</span>
<a name="ln-739"></a><span class="n">enl</span><span class="p">%</span><span class="n">sphrad</span> <span class="o">=</span> <span class="n">sphrad</span>
<a name="ln-740"></a><span class="n">enl</span><span class="p">%</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>
<a name="ln-741"></a><span class="n">enl</span><span class="p">%</span><span class="n">scalingmode</span> <span class="o">=</span> <span class="n">scalingmode</span>
<a name="ln-742"></a><span class="n">enl</span><span class="p">%</span><span class="n">df3file</span> <span class="o">=</span> <span class="n">df3file</span>
<a name="ln-743"></a><span class="n">enl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">)</span>
<a name="ln-744"></a><span class="n">enl</span><span class="p">%</span><span class="n">povrayfile</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">povrayfile</span><span class="p">)</span>
<a name="ln-745"></a><span class="n">enl</span><span class="p">%</span><span class="n">anglefile</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">anglefile</span><span class="p">)</span>
<a name="ln-746"></a>
<a name="ln-747"></a><span class="k">end subroutine </span><span class="n">GetOrientationVizNameList</span>
<a name="ln-748"></a>
<a name="ln-749"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-750"></a><span class="c">!</span>
<a name="ln-751"></a><span class="c">! SUBROUTINE:GetMCCLNameList</span>
<a name="ln-752"></a><span class="c">!</span>
<a name="ln-753"></a><span class="c">!&gt; @author Saransh Singh/Marc De Graef, Carnegie Mellon University</span>
<a name="ln-754"></a><span class="c">!</span>
<a name="ln-755"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMMCCL.f90 and other programs)</span>
<a name="ln-756"></a><span class="c">!</span>
<a name="ln-757"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-758"></a><span class="c">!&gt; @param mcnl Monte Carloname list structure</span>
<a name="ln-759"></a><span class="c">!</span>
<a name="ln-760"></a><span class="c">!&gt; @date 06/18/14  SS 1.0 new routine</span>
<a name="ln-761"></a><span class="c">!&gt; @date 09/09/15 MDG 1.1 added devid (GPU device id)</span>
<a name="ln-762"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-763"></a><span class="k">recursive subroutine </span><span class="n">GetMCCLNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">mcnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-764"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetMCCLNameList</span>
<a name="ln-765"></a>
<a name="ln-766"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-767"></a>
<a name="ln-768"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-769"></a>
<a name="ln-770"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-771"></a><span class="k">type</span><span class="p">(</span><span class="n">MCCLNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">mcnl</span>
<a name="ln-772"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-773"></a>
<a name="ln-774"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-775"></a>
<a name="ln-776"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-777"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-778"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">globalworkgrpsz</span>
<a name="ln-779"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">num_el</span>
<a name="ln-780"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">totnum_el</span>
<a name="ln-781"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">multiplier</span>
<a name="ln-782"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-783"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-784"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sig</span>
<a name="ln-785"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sigstart</span>
<a name="ln-786"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sigend</span>
<a name="ln-787"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sigstep</span>
<a name="ln-788"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-789"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">EkeV</span>
<a name="ln-790"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ehistmin</span>
<a name="ln-791"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ebinsize</span>
<a name="ln-792"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthmax</span>
<a name="ln-793"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthstep</span>
<a name="ln-794"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MCmode</span>
<a name="ln-795"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-796"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-797"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">mode</span>
<a name="ln-798"></a>
<a name="ln-799"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-800"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">MCCLdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">sigstart</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">num_el</span><span class="p">,</span> <span class="n">globalworkgrpsz</span><span class="p">,</span> <span class="n">EkeV</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-801"></a><span class="n">dataname</span><span class="p">,</span> <span class="n">totnum_el</span><span class="p">,</span> <span class="n">Ehistmin</span><span class="p">,</span> <span class="n">Ebinsize</span><span class="p">,</span> <span class="n">depthmax</span><span class="p">,</span> <span class="n">depthstep</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">MCmode</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-802"></a><span class="n">sigend</span><span class="p">,</span> <span class="n">sigstep</span><span class="p">,</span> <span class="n">sig</span>
<a name="ln-803"></a>
<a name="ln-804"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-805"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-806"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">1501</span>
<a name="ln-807"></a><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="mi">100</span>
<a name="ln-808"></a><span class="n">num_el</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-809"></a><span class="n">totnum_el</span> <span class="o">=</span> <span class="mi">2000000000</span>
<a name="ln-810"></a><span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-811"></a><span class="n">devid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-812"></a><span class="n">platid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-813"></a><span class="n">sig</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-814"></a><span class="n">sigstart</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-815"></a><span class="n">sigend</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-816"></a><span class="n">sigstep</span> <span class="o">=</span> <span class="mf">1.D0</span>
<a name="ln-817"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-818"></a><span class="n">EkeV</span> <span class="o">=</span> <span class="mi">3</span><span class="mf">0.D0</span>
<a name="ln-819"></a><span class="n">Ehistmin</span> <span class="o">=</span> <span class="mf">5.D0</span>
<a name="ln-820"></a><span class="n">Ebinsize</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-821"></a><span class="n">depthmax</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.D0</span>
<a name="ln-822"></a><span class="n">depthstep</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-823"></a><span class="n">MCmode</span> <span class="o">=</span> <span class="s1">&#39;CSDA&#39;</span>
<a name="ln-824"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-825"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;MCoutput.data&#39;</span>
<a name="ln-826"></a><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>
<a name="ln-827"></a>
<a name="ln-828"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-829"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-830"></a><span class="k">end if</span>
<a name="ln-831"></a><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-832"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-833"></a><span class="c">! read the namelist file</span>
<a name="ln-834"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-835"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">MCCLdata</span><span class="p">)</span>
<a name="ln-836"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-837"></a>
<a name="ln-838"></a><span class="c">! check for required entries</span>
<a name="ln-839"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-840"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMMC:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-841"></a><span class="k">end if</span>
<a name="ln-842"></a><span class="k">end if</span>
<a name="ln-843"></a>
<a name="ln-844"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the mcnl fields</span>
<a name="ln-845"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-846"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-847"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="n">globalworkgrpsz</span>
<a name="ln-848"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">num_el</span> <span class="o">=</span> <span class="n">num_el</span>
<a name="ln-849"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">totnum_el</span> <span class="o">=</span> <span class="n">totnum_el</span>
<a name="ln-850"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">multiplier</span>
<a name="ln-851"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>
<a name="ln-852"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>
<a name="ln-853"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sigstart</span> <span class="o">=</span> <span class="n">sigstart</span>
<a name="ln-854"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sigend</span> <span class="o">=</span> <span class="n">sigend</span>
<a name="ln-855"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sigstep</span> <span class="o">=</span> <span class="n">sigstep</span>
<a name="ln-856"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span>
<a name="ln-857"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-858"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">EkeV</span> <span class="o">=</span> <span class="n">EkeV</span>
<a name="ln-859"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ehistmin</span> <span class="o">=</span> <span class="n">Ehistmin</span>
<a name="ln-860"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ebinsize</span> <span class="o">=</span> <span class="n">Ebinsize</span>
<a name="ln-861"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthmax</span> <span class="o">=</span> <span class="n">depthmax</span>
<a name="ln-862"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthstep</span> <span class="o">=</span> <span class="n">depthstep</span>
<a name="ln-863"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">MCmode</span> <span class="o">=</span> <span class="n">MCmode</span>
<a name="ln-864"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-865"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-866"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
<a name="ln-867"></a>
<a name="ln-868"></a><span class="k">end subroutine </span><span class="n">GetMCCLNameList</span>
<a name="ln-869"></a>
<a name="ln-870"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-871"></a><span class="c">!</span>
<a name="ln-872"></a><span class="c">! SUBROUTINE:GetMCCLMultiLayerNameList</span>
<a name="ln-873"></a><span class="c">!</span>
<a name="ln-874"></a><span class="c">!&gt; @author Saransh Singh/Marc De Graef, Carnegie Mellon University</span>
<a name="ln-875"></a><span class="c">!</span>
<a name="ln-876"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMMCCL.f90)</span>
<a name="ln-877"></a><span class="c">!</span>
<a name="ln-878"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-879"></a><span class="c">!&gt; @param mcnl Monte Carloname list structure</span>
<a name="ln-880"></a><span class="c">!</span>
<a name="ln-881"></a><span class="c">!&gt; @date 06/18/14  SS 1.0 new routine</span>
<a name="ln-882"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-883"></a><span class="k">recursive subroutine </span><span class="n">GetMCCLMultiLayerNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">mcnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-884"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetMCCLMultiLayerNameList</span>
<a name="ln-885"></a>
<a name="ln-886"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-887"></a>
<a name="ln-888"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-889"></a>
<a name="ln-890"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-891"></a><span class="k">type</span><span class="p">(</span><span class="n">MCCLMultiLayerNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">mcnl</span>
<a name="ln-892"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-893"></a>
<a name="ln-894"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-895"></a>
<a name="ln-896"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-897"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-898"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">globalworkgrpsz</span>
<a name="ln-899"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">num_el</span>
<a name="ln-900"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">totnum_el</span>
<a name="ln-901"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sig</span>
<a name="ln-902"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-903"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">EkeV</span>
<a name="ln-904"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ehistmin</span>
<a name="ln-905"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ebinsize</span>
<a name="ln-906"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthmax</span>
<a name="ln-907"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthstep</span>
<a name="ln-908"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">filmthickness</span>
<a name="ln-909"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">filmstep</span>
<a name="ln-910"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MCmode</span>
<a name="ln-911"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname_film</span>
<a name="ln-912"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname_subs</span>
<a name="ln-913"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-914"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">mode</span>
<a name="ln-915"></a>
<a name="ln-916"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-917"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">MCCLdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">num_el</span><span class="p">,</span> <span class="n">globalworkgrpsz</span><span class="p">,</span> <span class="n">EkeV</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-918"></a>        <span class="n">dataname</span><span class="p">,</span> <span class="n">totnum_el</span><span class="p">,</span> <span class="n">Ehistmin</span><span class="p">,</span> <span class="n">Ebinsize</span><span class="p">,</span> <span class="n">depthmax</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-919"></a>        <span class="n">depthstep</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">MCmode</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">xtalname_film</span><span class="p">,</span> <span class="n">xtalname_subs</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-920"></a>        <span class="n">filmthickness</span><span class="p">,</span> <span class="n">filmstep</span>
<a name="ln-921"></a>
<a name="ln-922"></a>
<a name="ln-923"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-924"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-925"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">1501</span>
<a name="ln-926"></a><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="mi">100</span>
<a name="ln-927"></a><span class="n">num_el</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-928"></a><span class="n">totnum_el</span> <span class="o">=</span> <span class="mi">100000</span>
<a name="ln-929"></a><span class="n">sig</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-930"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-931"></a><span class="n">EkeV</span> <span class="o">=</span> <span class="mi">3</span><span class="mf">0.D0</span>
<a name="ln-932"></a><span class="n">Ehistmin</span> <span class="o">=</span> <span class="mf">5.D0</span>
<a name="ln-933"></a><span class="n">Ebinsize</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-934"></a><span class="n">depthmax</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.D0</span>
<a name="ln-935"></a><span class="n">depthstep</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-936"></a><span class="n">MCmode</span> <span class="o">=</span> <span class="s1">&#39;CSDA&#39;</span>
<a name="ln-937"></a><span class="n">xtalname_film</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-938"></a><span class="n">xtalname_subs</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-939"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;MCoutput.data&#39;</span>
<a name="ln-940"></a><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>
<a name="ln-941"></a><span class="n">filmthickness</span> <span class="o">=</span> <span class="mi">2</span><span class="mf">0.D0</span>
<a name="ln-942"></a><span class="n">filmstep</span> <span class="o">=</span> <span class="mf">2.D0</span>
<a name="ln-943"></a>
<a name="ln-944"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-945"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-946"></a><span class="k">end if</span>
<a name="ln-947"></a>
<a name="ln-948"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-949"></a><span class="c">! read the namelist file</span>
<a name="ln-950"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-951"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">MCCLdata</span><span class="p">)</span>
<a name="ln-952"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-953"></a>
<a name="ln-954"></a><span class="c">! check for required entries</span>
<a name="ln-955"></a><span class="k">if</span> <span class="p">((</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname_film</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname_subs</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-956"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMMC:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-957"></a><span class="k">end if</span>
<a name="ln-958"></a><span class="k">end if</span>
<a name="ln-959"></a>
<a name="ln-960"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the mcnl fields</span>
<a name="ln-961"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-962"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-963"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="n">globalworkgrpsz</span>
<a name="ln-964"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">num_el</span> <span class="o">=</span> <span class="n">num_el</span>
<a name="ln-965"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">totnum_el</span> <span class="o">=</span> <span class="n">totnum_el</span>
<a name="ln-966"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span>
<a name="ln-967"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-968"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">EkeV</span> <span class="o">=</span> <span class="n">EkeV</span>
<a name="ln-969"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ehistmin</span> <span class="o">=</span> <span class="n">Ehistmin</span>
<a name="ln-970"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ebinsize</span> <span class="o">=</span> <span class="n">Ebinsize</span>
<a name="ln-971"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthmax</span> <span class="o">=</span> <span class="n">depthmax</span>
<a name="ln-972"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthstep</span> <span class="o">=</span> <span class="n">depthstep</span>
<a name="ln-973"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">MCmode</span> <span class="o">=</span> <span class="n">MCmode</span>
<a name="ln-974"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">xtalname_film</span> <span class="o">=</span> <span class="n">xtalname_film</span>
<a name="ln-975"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">xtalname_subs</span> <span class="o">=</span> <span class="n">xtalname_subs</span>
<a name="ln-976"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-977"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
<a name="ln-978"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">filmthickness</span> <span class="o">=</span> <span class="n">filmthickness</span>
<a name="ln-979"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">filmstep</span> <span class="o">=</span> <span class="n">filmstep</span>
<a name="ln-980"></a>
<a name="ln-981"></a><span class="k">end subroutine </span><span class="n">GetMCCLMultiLayerNameList</span>
<a name="ln-982"></a>
<a name="ln-983"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-984"></a><span class="c">!</span>
<a name="ln-985"></a><span class="c">! SUBROUTINE:GetDisorientationsNameList</span>
<a name="ln-986"></a><span class="c">!</span>
<a name="ln-987"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-988"></a><span class="c">!</span>
<a name="ln-989"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMDisorientations.f90)</span>
<a name="ln-990"></a><span class="c">!</span>
<a name="ln-991"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-992"></a><span class="c">!&gt; @param emnl name list structure</span>
<a name="ln-993"></a><span class="c">!</span>
<a name="ln-994"></a><span class="c">!&gt; @date 06/24/16  MDG 1.0 new routine</span>
<a name="ln-995"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-996"></a><span class="k">recursive subroutine </span><span class="n">GetDisorientationsNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-997"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetDisorientationsNameList</span>
<a name="ln-998"></a>
<a name="ln-999"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1000"></a>
<a name="ln-1001"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1002"></a>
<a name="ln-1003"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1004"></a><span class="k">type</span><span class="p">(</span><span class="n">DisorientationsNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1005"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1006"></a>
<a name="ln-1007"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1008"></a>
<a name="ln-1009"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">pgnum</span>
<a name="ln-1010"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">pgnum2</span>
<a name="ln-1011"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">inputfile</span>
<a name="ln-1012"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outputfile</span>
<a name="ln-1013"></a>
<a name="ln-1014"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1015"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">Disorientations</span><span class="o">/</span> <span class="n">pgnum</span><span class="p">,</span> <span class="n">pgnum2</span><span class="p">,</span> <span class="n">inputfile</span><span class="p">,</span> <span class="n">outputfile</span>
<a name="ln-1016"></a>
<a name="ln-1017"></a><span class="c">! set the input parameters to default values </span>
<a name="ln-1018"></a><span class="n">pgnum</span> <span class="o">=</span> <span class="mi">32</span>                  <span class="c">! </span>
<a name="ln-1019"></a><span class="n">pgnum2</span> <span class="o">=</span> <span class="mi">32</span>                 <span class="c">! </span>
<a name="ln-1020"></a><span class="n">inputfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>     <span class="c">! default filename for input file</span>
<a name="ln-1021"></a><span class="n">outputfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for input file</span>
<a name="ln-1022"></a>
<a name="ln-1023"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1024"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1025"></a><span class="k">end if</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1028"></a><span class="c">! read the namelist file</span>
<a name="ln-1029"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1030"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">Disorientations</span><span class="p">)</span>
<a name="ln-1031"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1032"></a>
<a name="ln-1033"></a><span class="c">! check for required entries</span>
<a name="ln-1034"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">inputfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1035"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMDisorientations&#39;</span><span class="p">,</span><span class="s1">&#39; input file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1036"></a> <span class="k">end if</span>
<a name="ln-1037"></a>
<a name="ln-1038"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">outputfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1039"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMDisorientations&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1040"></a> <span class="k">end if</span>
<a name="ln-1041"></a>
<a name="ln-1042"></a><span class="k">end if</span>
<a name="ln-1043"></a>
<a name="ln-1044"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1045"></a><span class="n">emnl</span><span class="p">%</span><span class="n">pgnum</span> <span class="o">=</span> <span class="n">pgnum</span>
<a name="ln-1046"></a><span class="n">emnl</span><span class="p">%</span><span class="n">pgnum2</span> <span class="o">=</span> <span class="n">pgnum2</span>
<a name="ln-1047"></a><span class="n">emnl</span><span class="p">%</span><span class="n">inputfile</span> <span class="o">=</span> <span class="n">inputfile</span>
<a name="ln-1048"></a><span class="n">emnl</span><span class="p">%</span><span class="n">outputfile</span> <span class="o">=</span> <span class="n">outputfile</span>
<a name="ln-1049"></a>
<a name="ln-1050"></a><span class="k">end subroutine </span><span class="n">GetDisorientationsNameList</span>
<a name="ln-1051"></a>
<a name="ln-1052"></a>
<a name="ln-1053"></a>
<a name="ln-1054"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1055"></a><span class="c">!</span>
<a name="ln-1056"></a><span class="c">! SUBROUTINE:GetAverageOrientationNameList</span>
<a name="ln-1057"></a><span class="c">!</span>
<a name="ln-1058"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1059"></a><span class="c">!</span>
<a name="ln-1060"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMAverageOrient.f90)</span>
<a name="ln-1061"></a><span class="c">!</span>
<a name="ln-1062"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1063"></a><span class="c">!&gt; @param emnl name list structure</span>
<a name="ln-1064"></a><span class="c">!</span>
<a name="ln-1065"></a><span class="c">!&gt; @date 06/24/16  MDG 1.0 new routine</span>
<a name="ln-1066"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1067"></a><span class="k">recursive subroutine </span><span class="n">GetAverageOrientationNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1068"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetAverageOrientationNameList</span>
<a name="ln-1069"></a>
<a name="ln-1070"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1071"></a>
<a name="ln-1072"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1073"></a>
<a name="ln-1074"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1075"></a><span class="k">type</span><span class="p">(</span><span class="n">AverageOrientationNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1076"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1077"></a>
<a name="ln-1078"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1079"></a>
<a name="ln-1080"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nmuse</span>
<a name="ln-1081"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">reldisx</span>
<a name="ln-1082"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">reldisy</span>
<a name="ln-1083"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">oldformat</span>
<a name="ln-1084"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-1085"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">averagectffile</span>
<a name="ln-1086"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">averagetxtfile</span>
<a name="ln-1087"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">disorientationmap</span>
<a name="ln-1088"></a>
<a name="ln-1089"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1090"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">AverageOrientation</span><span class="o">/</span> <span class="n">nmuse</span><span class="p">,</span> <span class="n">dotproductfile</span><span class="p">,</span> <span class="n">averagectffile</span><span class="p">,</span> <span class="n">oldformat</span><span class="p">,</span> <span class="n">averagetxtfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1091"></a>                              <span class="n">reldisx</span><span class="p">,</span> <span class="n">reldisy</span><span class="p">,</span> <span class="n">disorientationmap</span>
<a name="ln-1092"></a>
<a name="ln-1093"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1094"></a><span class="n">nmuse</span> <span class="o">=</span> <span class="mi">10</span>                      <span class="c">! number of near-matches to use</span>
<a name="ln-1095"></a><span class="n">reldisx</span> <span class="o">=</span> <span class="mi">0</span>                     <span class="c">! x-coordinate for relative disorientation map</span>
<a name="ln-1096"></a><span class="n">reldisy</span> <span class="o">=</span> <span class="mi">0</span>                     <span class="c">! y-coordinate for relative disorientation map</span>
<a name="ln-1097"></a><span class="n">oldformat</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>             <span class="c">! switch for older format of dot product files</span>
<a name="ln-1098"></a><span class="n">dotproductfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for input dotproduct file (HDF5)</span>
<a name="ln-1099"></a><span class="n">averagectffile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for output ctf file</span>
<a name="ln-1100"></a><span class="n">averagetxtfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for output txt file (only with oldformat=.TRUE.</span>
<a name="ln-1101"></a><span class="n">disorientationmap</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> <span class="c">! default filename for relative disorientation map file</span>
<a name="ln-1102"></a>
<a name="ln-1103"></a>
<a name="ln-1104"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1105"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1106"></a><span class="k">end if</span>
<a name="ln-1107"></a>
<a name="ln-1108"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1109"></a><span class="c">! read the namelist file</span>
<a name="ln-1110"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1111"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">AverageOrientation</span><span class="p">)</span>
<a name="ln-1112"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1113"></a>
<a name="ln-1114"></a><span class="c">! check for required entries</span>
<a name="ln-1115"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1116"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMAverageOrient&#39;</span><span class="p">,</span><span class="s1">&#39; dotproduct file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1117"></a> <span class="k">end if</span>
<a name="ln-1118"></a>
<a name="ln-1119"></a><span class="k"> if</span> <span class="p">(</span><span class="n">oldformat</span><span class="p">.</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-1120"></a><span class="k">   if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">averagetxtfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1121"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMAverageOrient&#39;</span><span class="p">,</span><span class="s1">&#39; txt output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1122"></a>   <span class="k">end if</span>
<a name="ln-1123"></a><span class="k"> else</span>
<a name="ln-1124"></a><span class="k">   if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">averagectffile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1125"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMAverageOrient&#39;</span><span class="p">,</span><span class="s1">&#39; ctf output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1126"></a>   <span class="k">end if</span>
<a name="ln-1127"></a><span class="k"> end if</span>
<a name="ln-1128"></a><span class="k">end if</span>
<a name="ln-1129"></a>
<a name="ln-1130"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1131"></a><span class="n">emnl</span><span class="p">%</span><span class="n">nmuse</span> <span class="o">=</span> <span class="n">nmuse</span>
<a name="ln-1132"></a><span class="n">emnl</span><span class="p">%</span><span class="n">reldisx</span> <span class="o">=</span> <span class="n">reldisx</span>
<a name="ln-1133"></a><span class="n">emnl</span><span class="p">%</span><span class="n">reldisy</span> <span class="o">=</span> <span class="n">reldisy</span>
<a name="ln-1134"></a><span class="n">emnl</span><span class="p">%</span><span class="n">oldformat</span> <span class="o">=</span> <span class="n">oldformat</span>
<a name="ln-1135"></a><span class="n">emnl</span><span class="p">%</span><span class="n">dotproductfile</span> <span class="o">=</span> <span class="n">dotproductfile</span>
<a name="ln-1136"></a><span class="n">emnl</span><span class="p">%</span><span class="n">averagectffile</span> <span class="o">=</span> <span class="n">averagectffile</span>
<a name="ln-1137"></a><span class="n">emnl</span><span class="p">%</span><span class="n">averagetxtfile</span> <span class="o">=</span> <span class="n">averagetxtfile</span>
<a name="ln-1138"></a><span class="n">emnl</span><span class="p">%</span><span class="n">disorientationmap</span> <span class="o">=</span> <span class="n">disorientationmap</span>
<a name="ln-1139"></a>
<a name="ln-1140"></a><span class="k">end subroutine </span><span class="n">GetAverageOrientationNameList</span>
<a name="ln-1141"></a>
<a name="ln-1142"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1143"></a><span class="c">!</span>
<a name="ln-1144"></a><span class="c">! SUBROUTINE:GetOrientationSimilarityNameList</span>
<a name="ln-1145"></a><span class="c">!</span>
<a name="ln-1146"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1147"></a><span class="c">!</span>
<a name="ln-1148"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMOrientationSimilarity.f90)</span>
<a name="ln-1149"></a><span class="c">!</span>
<a name="ln-1150"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1151"></a><span class="c">!&gt; @param emnl name list structure</span>
<a name="ln-1152"></a><span class="c">!</span>
<a name="ln-1153"></a><span class="c">!&gt; @date 07/29/16  MDG 1.0 new routine</span>
<a name="ln-1154"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1155"></a><span class="k">recursive subroutine </span><span class="n">GetOrientationSimilarityNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1156"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetOrientationSimilarityNameList</span>
<a name="ln-1157"></a>
<a name="ln-1158"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1159"></a>
<a name="ln-1160"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1161"></a>
<a name="ln-1162"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1163"></a><span class="k">type</span><span class="p">(</span><span class="n">OrientationSimilarityNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1164"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1165"></a>
<a name="ln-1166"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1167"></a>
<a name="ln-1168"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nmuse</span>
<a name="ln-1169"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-1170"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">osmtiff</span>
<a name="ln-1171"></a>
<a name="ln-1172"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1173"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">OrientationSimilarity</span><span class="o">/</span> <span class="n">nmuse</span><span class="p">,</span> <span class="n">dotproductfile</span><span class="p">,</span> <span class="n">osmtiff</span>
<a name="ln-1174"></a>
<a name="ln-1175"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1176"></a><span class="n">nmuse</span> <span class="o">=</span> <span class="mi">10</span>                      <span class="c">! number of near-matches to use</span>
<a name="ln-1177"></a><span class="n">dotproductfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for input dotproduct file (HDF5)</span>
<a name="ln-1178"></a><span class="n">osmtiff</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for input dotproduct file (HDF5)</span>
<a name="ln-1179"></a>
<a name="ln-1180"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1181"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1182"></a><span class="k">end if</span>
<a name="ln-1183"></a>
<a name="ln-1184"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1185"></a><span class="c">! read the namelist file</span>
<a name="ln-1186"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1187"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">OrientationSimilarity</span><span class="p">)</span>
<a name="ln-1188"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1189"></a>
<a name="ln-1190"></a><span class="c">! check for required entries</span>
<a name="ln-1191"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1192"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMOrientationSimilarity&#39;</span><span class="p">,</span><span class="s1">&#39; dotproduct file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1193"></a> <span class="k">end if</span>
<a name="ln-1194"></a>
<a name="ln-1195"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">osmtiff</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1196"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMOrientationSimilarity&#39;</span><span class="p">,</span><span class="s1">&#39; osm.tiff output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1197"></a> <span class="k">end if</span>
<a name="ln-1198"></a><span class="k">end if</span>
<a name="ln-1199"></a>
<a name="ln-1200"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1201"></a><span class="n">emnl</span><span class="p">%</span><span class="n">nmuse</span> <span class="o">=</span> <span class="n">nmuse</span>
<a name="ln-1202"></a><span class="n">emnl</span><span class="p">%</span><span class="n">dotproductfile</span> <span class="o">=</span> <span class="n">dotproductfile</span>
<a name="ln-1203"></a><span class="n">emnl</span><span class="p">%</span><span class="n">osmtiff</span> <span class="o">=</span> <span class="n">osmtiff</span>
<a name="ln-1204"></a>
<a name="ln-1205"></a><span class="k">end subroutine </span><span class="n">GetOrientationSimilarityNameList</span>
<a name="ln-1206"></a>
<a name="ln-1207"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1208"></a><span class="c">!</span>
<a name="ln-1209"></a><span class="c">! SUBROUTINE:GetKAMNameList</span>
<a name="ln-1210"></a><span class="c">!</span>
<a name="ln-1211"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1212"></a><span class="c">!</span>
<a name="ln-1213"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMOrientationSimilarity.f90)</span>
<a name="ln-1214"></a><span class="c">!</span>
<a name="ln-1215"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1216"></a><span class="c">!&gt; @param emnl name list structure</span>
<a name="ln-1217"></a><span class="c">!</span>
<a name="ln-1218"></a><span class="c">!&gt; @date 07/29/16  MDG 1.0 new routine</span>
<a name="ln-1219"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1220"></a><span class="k">recursive subroutine </span><span class="n">GetKAMNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1221"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetKAMNameList</span>
<a name="ln-1222"></a>
<a name="ln-1223"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1224"></a>
<a name="ln-1225"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1226"></a>
<a name="ln-1227"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1228"></a><span class="k">type</span><span class="p">(</span><span class="n">KAMNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1229"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1232"></a>
<a name="ln-1233"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">kamcutoff</span>
<a name="ln-1234"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">orav</span>
<a name="ln-1235"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-1236"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">kamtiff</span>
<a name="ln-1237"></a>
<a name="ln-1238"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1239"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">KAM</span><span class="o">/</span> <span class="n">kamcutoff</span><span class="p">,</span> <span class="n">orav</span><span class="p">,</span> <span class="n">dotproductfile</span><span class="p">,</span> <span class="n">kamtiff</span>
<a name="ln-1240"></a>
<a name="ln-1241"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1242"></a><span class="n">kamcutoff</span> <span class="o">=</span> <span class="mf">5.0</span>                 <span class="c">! number of near-matches to use</span>
<a name="ln-1243"></a><span class="n">orav</span> <span class="o">=</span> <span class="mi">0</span>                        <span class="c">! perform orientation average first ?</span>
<a name="ln-1244"></a><span class="n">dotproductfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for input dotproduct file (HDF5)</span>
<a name="ln-1245"></a><span class="n">kamtiff</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for input dotproduct file (HDF5)</span>
<a name="ln-1246"></a>
<a name="ln-1247"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1248"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1249"></a><span class="k">end if</span>
<a name="ln-1250"></a>
<a name="ln-1251"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1252"></a><span class="c">! read the namelist file</span>
<a name="ln-1253"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1254"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">KAM</span><span class="p">)</span>
<a name="ln-1255"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1256"></a>
<a name="ln-1257"></a><span class="c">! check for required entries</span>
<a name="ln-1258"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1259"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMKAM&#39;</span><span class="p">,</span><span class="s1">&#39; dotproduct file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1260"></a> <span class="k">end if</span>
<a name="ln-1261"></a>
<a name="ln-1262"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">kamtiff</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1263"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMKAM&#39;</span><span class="p">,</span><span class="s1">&#39; kam.tiff output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1264"></a> <span class="k">end if</span>
<a name="ln-1265"></a><span class="k">end if</span>
<a name="ln-1266"></a>
<a name="ln-1267"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1268"></a><span class="n">emnl</span><span class="p">%</span><span class="n">kamcutoff</span> <span class="o">=</span> <span class="n">kamcutoff</span>
<a name="ln-1269"></a><span class="n">emnl</span><span class="p">%</span><span class="n">orav</span> <span class="o">=</span> <span class="n">orav</span>
<a name="ln-1270"></a><span class="n">emnl</span><span class="p">%</span><span class="n">dotproductfile</span> <span class="o">=</span> <span class="n">dotproductfile</span>
<a name="ln-1271"></a><span class="n">emnl</span><span class="p">%</span><span class="n">kamtiff</span> <span class="o">=</span> <span class="n">kamtiff</span>
<a name="ln-1272"></a>
<a name="ln-1273"></a><span class="k">end subroutine </span><span class="n">GetKAMNameList</span>
<a name="ln-1274"></a>
<a name="ln-1275"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1276"></a><span class="c">!</span>
<a name="ln-1277"></a><span class="c">! SUBROUTINE:GetDvsDNameList</span>
<a name="ln-1278"></a><span class="c">!</span>
<a name="ln-1279"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1280"></a><span class="c">!</span>
<a name="ln-1281"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMOrientationSimilarity.f90)</span>
<a name="ln-1282"></a><span class="c">!</span>
<a name="ln-1283"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1284"></a><span class="c">!&gt; @param emnl name list structure</span>
<a name="ln-1285"></a><span class="c">!</span>
<a name="ln-1286"></a><span class="c">!&gt; @date 07/29/16  MDG 1.0 new routine</span>
<a name="ln-1287"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1288"></a><span class="k">recursive subroutine </span><span class="n">GetDvsDNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1289"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetDvsDNameList</span>
<a name="ln-1290"></a>
<a name="ln-1291"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1292"></a>
<a name="ln-1293"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1294"></a>
<a name="ln-1295"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1296"></a><span class="k">type</span><span class="p">(</span><span class="n">DvsDNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1297"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1298"></a>
<a name="ln-1299"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1300"></a>
<a name="ln-1301"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nmuse</span>
<a name="ln-1302"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">maxdis</span>
<a name="ln-1303"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">minang</span>
<a name="ln-1304"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">maxang</span>
<a name="ln-1305"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-1306"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outfile</span>
<a name="ln-1307"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">povfile</span>
<a name="ln-1308"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalfile</span>
<a name="ln-1309"></a>
<a name="ln-1310"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1311"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">DvsD</span><span class="o">/</span> <span class="n">nmuse</span><span class="p">,</span> <span class="n">maxdis</span><span class="p">,</span> <span class="n">minang</span><span class="p">,</span> <span class="n">maxang</span><span class="p">,</span> <span class="n">dotproductfile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">povfile</span><span class="p">,</span> <span class="n">xtalfile</span>
<a name="ln-1312"></a>
<a name="ln-1313"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1314"></a><span class="n">nmuse</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-1315"></a><span class="n">maxdis</span> <span class="o">=</span> <span class="mf">3.0</span>
<a name="ln-1316"></a><span class="n">minang</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>
<a name="ln-1317"></a><span class="n">maxang</span> <span class="o">=</span> <span class="mi">2</span><span class="mf">0.0</span>
<a name="ln-1318"></a><span class="n">dotproductfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for input dotproduct file (HDF5)</span>
<a name="ln-1319"></a><span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for output file (txt)</span>
<a name="ln-1320"></a><span class="n">povfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for output file (txt)</span>
<a name="ln-1321"></a><span class="n">xtalfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! default filename for output file (txt)</span>
<a name="ln-1322"></a>
<a name="ln-1323"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1324"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1325"></a><span class="k">end if</span>
<a name="ln-1326"></a>
<a name="ln-1327"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1328"></a><span class="c">! read the namelist file</span>
<a name="ln-1329"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1330"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">DvsD</span><span class="p">)</span>
<a name="ln-1331"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1332"></a>
<a name="ln-1333"></a><span class="c">! check for required entries</span>
<a name="ln-1334"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1335"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMDvsD&#39;</span><span class="p">,</span><span class="s1">&#39; xtal file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1336"></a> <span class="k">end if</span>
<a name="ln-1337"></a>
<a name="ln-1338"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1339"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMDvsD&#39;</span><span class="p">,</span><span class="s1">&#39; dotproduct file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1340"></a> <span class="k">end if</span>
<a name="ln-1341"></a>
<a name="ln-1342"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">outfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1343"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39; EMDvsD&#39;</span><span class="p">,</span><span class="s1">&#39; outfile output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1344"></a> <span class="k">end if</span>
<a name="ln-1345"></a><span class="k">end if</span>
<a name="ln-1346"></a>
<a name="ln-1347"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1348"></a><span class="n">emnl</span><span class="p">%</span><span class="n">nmuse</span> <span class="o">=</span> <span class="n">nmuse</span>
<a name="ln-1349"></a><span class="n">emnl</span><span class="p">%</span><span class="n">maxdis</span> <span class="o">=</span> <span class="n">maxdis</span>
<a name="ln-1350"></a><span class="n">emnl</span><span class="p">%</span><span class="n">minang</span> <span class="o">=</span> <span class="n">minang</span>
<a name="ln-1351"></a><span class="n">emnl</span><span class="p">%</span><span class="n">maxang</span> <span class="o">=</span> <span class="n">maxang</span>
<a name="ln-1352"></a><span class="n">emnl</span><span class="p">%</span><span class="n">dotproductfile</span> <span class="o">=</span> <span class="n">dotproductfile</span>
<a name="ln-1353"></a><span class="n">emnl</span><span class="p">%</span><span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span>
<a name="ln-1354"></a><span class="n">emnl</span><span class="p">%</span><span class="n">povfile</span> <span class="o">=</span> <span class="n">povfile</span>
<a name="ln-1355"></a><span class="n">emnl</span><span class="p">%</span><span class="n">xtalfile</span> <span class="o">=</span> <span class="n">xtalfile</span>
<a name="ln-1356"></a>
<a name="ln-1357"></a><span class="k">end subroutine </span><span class="n">GetDvsDNameList</span>
<a name="ln-1358"></a>
<a name="ln-1359"></a>
<a name="ln-1360"></a>
<a name="ln-1361"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1362"></a><span class="c">!</span>
<a name="ln-1363"></a><span class="c">! SUBROUTINE:GetEBSDMasterNameList</span>
<a name="ln-1364"></a><span class="c">!</span>
<a name="ln-1365"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1366"></a><span class="c">!</span>
<a name="ln-1367"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMEBSDmaster.f90)</span>
<a name="ln-1368"></a><span class="c">!</span>
<a name="ln-1369"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1370"></a><span class="c">!&gt; @param emnl EBSD master name list structure</span>
<a name="ln-1371"></a><span class="c">!</span>
<a name="ln-1372"></a><span class="c">!&gt; @date 06/19/14  MDG 1.0 new routine</span>
<a name="ln-1373"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1374"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDMasterNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1375"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDMasterNameList</span>
<a name="ln-1376"></a>
<a name="ln-1377"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1378"></a>
<a name="ln-1379"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1380"></a>
<a name="ln-1381"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1382"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDMasterNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1383"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1384"></a>
<a name="ln-1385"></a><span class="kt">logical</span>                                         <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1386"></a>
<a name="ln-1387"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-1388"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npx</span>
<a name="ln-1389"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">Esel</span>
<a name="ln-1390"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-1391"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-1392"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span>
<a name="ln-1393"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">restart</span>
<a name="ln-1394"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">uniform</span>
<a name="ln-1395"></a>
<a name="ln-1396"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1397"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">EBSDmastervars</span><span class="o">/</span> <span class="nb">dmin</span><span class="p">,</span><span class="n">npx</span><span class="p">,</span><span class="n">nthreads</span><span class="p">,</span><span class="n">energyfile</span><span class="p">,</span><span class="n">Esel</span><span class="p">,</span><span class="n">restart</span><span class="p">,</span><span class="n">uniform</span>
<a name="ln-1398"></a>
<a name="ln-1399"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1400"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-1401"></a><span class="n">npx</span> <span class="o">=</span> <span class="mi">500</span>                       <span class="c">! Nx pixels (total = 2Nx+1)</span>
<a name="ln-1402"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1403"></a><span class="n">Esel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                       <span class="c">! selected energy value for single energy run</span>
<a name="ln-1404"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.025</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-1405"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! default filename for z_0(E_e) data from EMMC Monte Carlo simulations</span>
<a name="ln-1406"></a><span class="n">restart</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>               <span class="c">! when .TRUE. an existing file will be assumed </span>
<a name="ln-1407"></a><span class="n">uniform</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>               <span class="c">! when .TRUE., the output master patterns will contain 1.0 everywhere</span>
<a name="ln-1408"></a>
<a name="ln-1409"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1410"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1411"></a><span class="k">end if</span>
<a name="ln-1412"></a>
<a name="ln-1413"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1414"></a><span class="c">! read the namelist file</span>
<a name="ln-1415"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1416"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDmastervars</span><span class="p">)</span>
<a name="ln-1417"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1418"></a>
<a name="ln-1419"></a><span class="c">! check for required entries</span>
<a name="ln-1420"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1421"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDmaster:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1422"></a> <span class="k">end if</span>
<a name="ln-1423"></a><span class="k">end if</span>
<a name="ln-1424"></a>
<a name="ln-1425"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1426"></a><span class="n">emnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-1427"></a><span class="n">emnl</span><span class="p">%</span><span class="n">npx</span> <span class="o">=</span> <span class="n">npx</span>
<a name="ln-1428"></a><span class="n">emnl</span><span class="p">%</span><span class="n">Esel</span> <span class="o">=</span> <span class="n">Esel</span>
<a name="ln-1429"></a><span class="n">emnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-1430"></a><span class="n">emnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-1431"></a><span class="n">emnl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-1432"></a><span class="n">emnl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">energyfile</span>       <span class="c">! as off release 3.1, outname must be the same as energyfile</span>
<a name="ln-1433"></a><span class="n">emnl</span><span class="p">%</span><span class="n">restart</span> <span class="o">=</span> <span class="n">restart</span>
<a name="ln-1434"></a><span class="n">emnl</span><span class="p">%</span><span class="n">uniform</span> <span class="o">=</span> <span class="n">uniform</span>
<a name="ln-1435"></a>
<a name="ln-1436"></a><span class="k">end subroutine </span><span class="n">GetEBSDMasterNameList</span>
<a name="ln-1437"></a>
<a name="ln-1438"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1439"></a><span class="c">!</span>
<a name="ln-1440"></a><span class="c">! SUBROUTINE:GetTKDMasterNameList</span>
<a name="ln-1441"></a><span class="c">!</span>
<a name="ln-1442"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1443"></a><span class="c">!</span>
<a name="ln-1444"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMTKDmaster.f90)</span>
<a name="ln-1445"></a><span class="c">!</span>
<a name="ln-1446"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1447"></a><span class="c">!&gt; @param emnl TKD master name list structure</span>
<a name="ln-1448"></a><span class="c">!</span>
<a name="ln-1449"></a><span class="c">!&gt; @date 01/16/17  MDG 1.0 new routine</span>
<a name="ln-1450"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1451"></a><span class="k">recursive subroutine </span><span class="n">GetTKDMasterNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1452"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetTKDMasterNameList</span>
<a name="ln-1453"></a>
<a name="ln-1454"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1455"></a>
<a name="ln-1456"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1457"></a>
<a name="ln-1458"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1459"></a><span class="k">type</span><span class="p">(</span><span class="n">TKDMasterNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1460"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1461"></a>
<a name="ln-1462"></a><span class="kt">logical</span>                                         <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1463"></a>
<a name="ln-1464"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-1465"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npx</span>
<a name="ln-1466"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">Esel</span>
<a name="ln-1467"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-1468"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-1469"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span>
<a name="ln-1470"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">restart</span>
<a name="ln-1471"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">uniform</span>
<a name="ln-1472"></a>
<a name="ln-1473"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1474"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">TKDmastervars</span><span class="o">/</span> <span class="nb">dmin</span><span class="p">,</span><span class="n">npx</span><span class="p">,</span><span class="n">nthreads</span><span class="p">,</span><span class="n">energyfile</span><span class="p">,</span><span class="n">Esel</span><span class="p">,</span><span class="n">restart</span><span class="p">,</span><span class="n">uniform</span>
<a name="ln-1475"></a>
<a name="ln-1476"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1477"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-1478"></a><span class="n">npx</span> <span class="o">=</span> <span class="mi">500</span>                       <span class="c">! Nx pixels (total = 2Nx+1)</span>
<a name="ln-1479"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1480"></a><span class="n">Esel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                       <span class="c">! selected energy value for single energy run</span>
<a name="ln-1481"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.025</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-1482"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! default filename for z_0(E_e) data from EMMC Monte Carlo simulations</span>
<a name="ln-1483"></a><span class="n">restart</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>               <span class="c">! when .TRUE. an existing file will be assumed </span>
<a name="ln-1484"></a><span class="n">uniform</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>               <span class="c">! when .TRUE., the output master patterns will contain 1.0 everywhere</span>
<a name="ln-1485"></a>
<a name="ln-1486"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1487"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1488"></a><span class="k">end if</span>
<a name="ln-1489"></a>
<a name="ln-1490"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1491"></a><span class="c">! read the namelist file</span>
<a name="ln-1492"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1493"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">TKDmastervars</span><span class="p">)</span>
<a name="ln-1494"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1495"></a>
<a name="ln-1496"></a><span class="c">! check for required entries</span>
<a name="ln-1497"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1498"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMTKDmaster:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1499"></a> <span class="k">end if</span>
<a name="ln-1500"></a><span class="k">end if</span>
<a name="ln-1501"></a>
<a name="ln-1502"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1503"></a><span class="n">emnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-1504"></a><span class="n">emnl</span><span class="p">%</span><span class="n">npx</span> <span class="o">=</span> <span class="n">npx</span>
<a name="ln-1505"></a><span class="n">emnl</span><span class="p">%</span><span class="n">Esel</span> <span class="o">=</span> <span class="n">Esel</span>
<a name="ln-1506"></a><span class="n">emnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-1507"></a><span class="n">emnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-1508"></a><span class="n">emnl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-1509"></a><span class="n">emnl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">energyfile</span>       <span class="c">! as off release 3.1, outname must be the same as energyfile</span>
<a name="ln-1510"></a><span class="n">emnl</span><span class="p">%</span><span class="n">restart</span> <span class="o">=</span> <span class="n">restart</span>
<a name="ln-1511"></a><span class="n">emnl</span><span class="p">%</span><span class="n">uniform</span> <span class="o">=</span> <span class="n">uniform</span>
<a name="ln-1512"></a>
<a name="ln-1513"></a><span class="k">end subroutine </span><span class="n">GetTKDMasterNameList</span>
<a name="ln-1514"></a>
<a name="ln-1515"></a>
<a name="ln-1516"></a>
<a name="ln-1517"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1518"></a><span class="c">!</span>
<a name="ln-1519"></a><span class="c">! SUBROUTINE:GetEBSDMasterOpenCLNameList</span>
<a name="ln-1520"></a><span class="c">!</span>
<a name="ln-1521"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1522"></a><span class="c">!</span>
<a name="ln-1523"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMEBSDmasterOpenCL.f90)</span>
<a name="ln-1524"></a><span class="c">!</span>
<a name="ln-1525"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1526"></a><span class="c">!&gt; @param emnl EBSD master name list structure</span>
<a name="ln-1527"></a><span class="c">!</span>
<a name="ln-1528"></a><span class="c">!&gt; @date 12/10/16  MDG 1.0 new routine</span>
<a name="ln-1529"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1530"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDMasterOpenCLNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1531"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDMasterOpenCLNameList</span>
<a name="ln-1532"></a>
<a name="ln-1533"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1534"></a>
<a name="ln-1535"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1536"></a>
<a name="ln-1537"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1538"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDMasterOpenCLNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span><span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1539"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1540"></a>
<a name="ln-1541"></a><span class="kt">logical</span>                                         <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1542"></a>
<a name="ln-1543"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-1544"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npx</span>
<a name="ln-1545"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">Esel</span>
<a name="ln-1546"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-1547"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-1548"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-1549"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">globalworkgrpsz</span>
<a name="ln-1550"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-1551"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span>
<a name="ln-1552"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">restart</span>
<a name="ln-1553"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">uniform</span>
<a name="ln-1554"></a>
<a name="ln-1555"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1556"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">EBSDmastervars</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span><span class="nb">dmin</span><span class="p">,</span><span class="n">npx</span><span class="p">,</span><span class="n">platid</span><span class="p">,</span><span class="n">devid</span><span class="p">,</span><span class="n">globalworkgrpsz</span><span class="p">,</span><span class="n">energyfile</span><span class="p">,</span><span class="n">restart</span><span class="p">,</span><span class="n">uniform</span><span class="p">,</span><span class="n">Esel</span><span class="p">,</span><span class="n">nthreads</span>
<a name="ln-1557"></a>
<a name="ln-1558"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1559"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-1560"></a><span class="n">npx</span> <span class="o">=</span> <span class="mi">500</span>                       <span class="c">! Nx pixels (total = 2Nx+1)</span>
<a name="ln-1561"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1562"></a><span class="n">platid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1563"></a><span class="n">devid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1564"></a><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="mi">150</span>
<a name="ln-1565"></a><span class="n">Esel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                       <span class="c">! selected energy value for single energy run</span>
<a name="ln-1566"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.025</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-1567"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! default filename for z_0(E_e) data from EMMC Monte Carlo simulations</span>
<a name="ln-1568"></a><span class="n">restart</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>               <span class="c">! when .TRUE. an existing file will be assumed </span>
<a name="ln-1569"></a><span class="n">uniform</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>               <span class="c">! when .TRUE., the output master patterns will contain 1.0 everywhere</span>
<a name="ln-1570"></a>
<a name="ln-1571"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1572"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1573"></a><span class="k">end if</span>
<a name="ln-1574"></a>
<a name="ln-1575"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1576"></a><span class="c">! read the namelist file</span>
<a name="ln-1577"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1578"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDmastervars</span><span class="p">)</span>
<a name="ln-1579"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1580"></a>
<a name="ln-1581"></a><span class="c">! check for required entries</span>
<a name="ln-1582"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1583"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDmaster:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1584"></a> <span class="k">end if</span>
<a name="ln-1585"></a><span class="k">end if</span>
<a name="ln-1586"></a>
<a name="ln-1587"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1588"></a><span class="n">emnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-1589"></a><span class="n">emnl</span><span class="p">%</span><span class="n">npx</span> <span class="o">=</span> <span class="n">npx</span>
<a name="ln-1590"></a><span class="n">emnl</span><span class="p">%</span><span class="n">Esel</span> <span class="o">=</span> <span class="n">Esel</span>
<a name="ln-1591"></a><span class="n">emnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-1592"></a><span class="n">emnl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span> 
<a name="ln-1593"></a><span class="n">emnl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span> 
<a name="ln-1594"></a><span class="n">emnl</span><span class="p">%</span><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="n">globalworkgrpsz</span> 
<a name="ln-1595"></a><span class="n">emnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-1596"></a><span class="n">emnl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-1597"></a><span class="n">emnl</span><span class="p">%</span><span class="n">restart</span> <span class="o">=</span> <span class="n">restart</span>
<a name="ln-1598"></a><span class="n">emnl</span><span class="p">%</span><span class="n">uniform</span> <span class="o">=</span> <span class="n">uniform</span>
<a name="ln-1599"></a>
<a name="ln-1600"></a><span class="k">end subroutine </span><span class="n">GetEBSDMasterOpenCLNameList</span>
<a name="ln-1601"></a>
<a name="ln-1602"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1603"></a><span class="c">!</span>
<a name="ln-1604"></a><span class="c">! SUBROUTINE:GetEBSDclusterNameList</span>
<a name="ln-1605"></a><span class="c">!</span>
<a name="ln-1606"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1607"></a><span class="c">!</span>
<a name="ln-1608"></a><span class="c">!&gt; @brief read namelist file and fill emnl structure (used by EMEBSDcluster.f90)</span>
<a name="ln-1609"></a><span class="c">!</span>
<a name="ln-1610"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1611"></a><span class="c">!&gt; @param emnl EBSD master name list structure</span>
<a name="ln-1612"></a><span class="c">!</span>
<a name="ln-1613"></a><span class="c">!&gt; @date 06/19/14  MDG 1.0 new routine</span>
<a name="ln-1614"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1615"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDclusterNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">emnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1616"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDclusterNameList</span>
<a name="ln-1617"></a>
<a name="ln-1618"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1619"></a>
<a name="ln-1620"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1621"></a>
<a name="ln-1622"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1623"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDclusterNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">emnl</span>
<a name="ln-1624"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1625"></a>
<a name="ln-1626"></a><span class="kt">logical</span>                                         <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1627"></a>
<a name="ln-1628"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-1629"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">NClusters</span><span class="p">,</span> <span class="n">NIterations</span><span class="p">,</span> <span class="n">binfactor</span>
<a name="ln-1630"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">inputfilename</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">datasetname</span>
<a name="ln-1631"></a>
<a name="ln-1632"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1633"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">EBSDclustervars</span><span class="o">/</span> <span class="n">NClusters</span><span class="p">,</span> <span class="n">NIterations</span><span class="p">,</span> <span class="n">binfactor</span><span class="p">,</span> <span class="n">inputfilename</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">datasetname</span>
<a name="ln-1634"></a>
<a name="ln-1635"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1636"></a><span class="n">NClusters</span> <span class="o">=</span> <span class="mi">100</span>                 <span class="c">! initial number of clusters to look for</span>
<a name="ln-1637"></a><span class="n">NIterations</span> <span class="o">=</span> <span class="mi">50</span>                <span class="c">! number of iterations in K-means algorithm</span>
<a name="ln-1638"></a><span class="n">binfactor</span> <span class="o">=</span> <span class="mi">1</span>                   <span class="c">! no binning by default</span>
<a name="ln-1639"></a><span class="n">inputfilename</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>     <span class="c">! default filename for HDF5 data input file</span>
<a name="ln-1640"></a><span class="n">groupname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>         <span class="c">! default groupname for EBSD data</span>
<a name="ln-1641"></a><span class="n">datasetname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>       <span class="c">! default dataset name </span>
<a name="ln-1642"></a>
<a name="ln-1643"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1644"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1645"></a><span class="k">end if</span>
<a name="ln-1646"></a>
<a name="ln-1647"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1648"></a><span class="c">! read the namelist file</span>
<a name="ln-1649"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1650"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDclustervars</span><span class="p">)</span>
<a name="ln-1651"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1652"></a>
<a name="ln-1653"></a><span class="c">! check for required entries</span>
<a name="ln-1654"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">inputfilename</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1655"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDcluster:&#39;</span><span class="p">,</span><span class="s1">&#39; HDF5 input data file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1656"></a> <span class="k">end if</span>
<a name="ln-1657"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">groupname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1658"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDcluster:&#39;</span><span class="p">,</span><span class="s1">&#39; Data group name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1659"></a> <span class="k">end if</span>
<a name="ln-1660"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">datasetname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1661"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDcluster:&#39;</span><span class="p">,</span><span class="s1">&#39; Data set name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1662"></a> <span class="k">end if</span>
<a name="ln-1663"></a><span class="k">end if</span>
<a name="ln-1664"></a>
<a name="ln-1665"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1666"></a><span class="n">emnl</span><span class="p">%</span><span class="n">NClusters</span> <span class="o">=</span> <span class="n">NClusters</span>
<a name="ln-1667"></a><span class="n">emnl</span><span class="p">%</span><span class="n">NIterations</span> <span class="o">=</span> <span class="n">NIterations</span>
<a name="ln-1668"></a><span class="n">emnl</span><span class="p">%</span><span class="n">binfactor</span> <span class="o">=</span> <span class="n">binfactor</span>
<a name="ln-1669"></a><span class="n">emnl</span><span class="p">%</span><span class="n">inputfilename</span> <span class="o">=</span> <span class="n">inputfilename</span>
<a name="ln-1670"></a><span class="n">emnl</span><span class="p">%</span><span class="n">groupname</span> <span class="o">=</span> <span class="n">groupname</span>
<a name="ln-1671"></a><span class="n">emnl</span><span class="p">%</span><span class="n">datasetname</span> <span class="o">=</span> <span class="n">datasetname</span>
<a name="ln-1672"></a>
<a name="ln-1673"></a><span class="c">! parameters that are not in the nml file</span>
<a name="ln-1674"></a><span class="n">emnl</span><span class="p">%</span><span class="n">NScanColumns</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1675"></a><span class="n">emnl</span><span class="p">%</span><span class="n">NScanRows</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1676"></a>
<a name="ln-1677"></a><span class="k">end subroutine </span><span class="n">GetEBSDclusterNameList</span>
<a name="ln-1678"></a>
<a name="ln-1679"></a>
<a name="ln-1680"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1681"></a><span class="c">!</span>
<a name="ln-1682"></a><span class="c">! SUBROUTINE:GetECPMasterNameList</span>
<a name="ln-1683"></a><span class="c">!</span>
<a name="ln-1684"></a><span class="c">!&gt; @author Saransh Singh/Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1685"></a><span class="c">!</span>
<a name="ln-1686"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMECPmaster.f90)</span>
<a name="ln-1687"></a><span class="c">!</span>
<a name="ln-1688"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1689"></a><span class="c">!&gt; @param emnl ECP master name list structure</span>
<a name="ln-1690"></a><span class="c">!</span>
<a name="ln-1691"></a><span class="c">!&gt; @date 06/19/14  SS 1.0 new routine</span>
<a name="ln-1692"></a><span class="c">!&gt; @date 08/12/15 MDG 1.1 correction of type for startthick and fn(3)</span>
<a name="ln-1693"></a><span class="c">!&gt; @date 09/15/15  SS 1.2 clean up of the subroutine</span>
<a name="ln-1694"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1695"></a><span class="k">recursive subroutine </span><span class="n">GetECPMasterNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">ecpnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1696"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetECPMasterNameList</span>
<a name="ln-1697"></a>
<a name="ln-1698"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1699"></a>
<a name="ln-1700"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1701"></a>
<a name="ln-1702"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1703"></a><span class="k">type</span><span class="p">(</span><span class="n">ECPMasterNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">ecpnl</span>
<a name="ln-1704"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1705"></a>
<a name="ln-1706"></a><span class="kt">logical</span>                                        <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1707"></a>
<a name="ln-1708"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-1709"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npx</span>
<a name="ln-1710"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">Esel</span>
<a name="ln-1711"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-1712"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-1713"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">compmode</span>
<a name="ln-1714"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span>
<a name="ln-1715"></a>
<a name="ln-1716"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1717"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">ECPmastervars</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">compmode</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1718"></a>    <span class="n">energyfile</span><span class="p">,</span> <span class="n">Esel</span><span class="p">,</span> <span class="n">npx</span><span class="p">,</span> <span class="n">nthreads</span>
<a name="ln-1719"></a>
<a name="ln-1720"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1721"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-1722"></a><span class="n">Esel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                       <span class="c">! selected energy value for single energy run</span>
<a name="ln-1723"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1724"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.04</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-1725"></a><span class="n">npx</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-1726"></a><span class="n">compmode</span> <span class="o">=</span> <span class="s1">&#39;Blochwv&#39;</span>
<a name="ln-1727"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! default filename for z_0(E_e) data from EMMC Monte Carlo simulations</span>
<a name="ln-1728"></a>
<a name="ln-1729"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1730"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1731"></a><span class="k">end if</span>
<a name="ln-1732"></a>
<a name="ln-1733"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1734"></a><span class="c">! read the namelist file</span>
<a name="ln-1735"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1736"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">ECPmastervars</span><span class="p">)</span>
<a name="ln-1737"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1738"></a>
<a name="ln-1739"></a><span class="c">! check for required entries</span>
<a name="ln-1740"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1741"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECPmaster:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1742"></a><span class="k">end if</span>
<a name="ln-1743"></a><span class="k">end if</span>
<a name="ln-1744"></a>
<a name="ln-1745"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1746"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-1747"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">Esel</span> <span class="o">=</span> <span class="n">Esel</span>
<a name="ln-1748"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">npx</span> <span class="o">=</span> <span class="n">npx</span>
<a name="ln-1749"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-1750"></a><span class="n">ecpnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-1751"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">compmode</span> <span class="o">=</span> <span class="n">compmode</span>
<a name="ln-1752"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-1753"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-1754"></a>
<a name="ln-1755"></a><span class="k">end subroutine </span><span class="n">GetECPMasterNameList</span>
<a name="ln-1756"></a>
<a name="ln-1757"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1758"></a><span class="c">!</span>
<a name="ln-1759"></a><span class="c">! SUBROUTINE:GetreflectorNameList</span>
<a name="ln-1760"></a><span class="c">!</span>
<a name="ln-1761"></a><span class="c">!&gt; @author Marc De Graef</span>
<a name="ln-1762"></a><span class="c">!</span>
<a name="ln-1763"></a><span class="c">!&gt; @brief read reflector namelist for EMreflectors program</span>
<a name="ln-1764"></a><span class="c">!</span>
<a name="ln-1765"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1766"></a><span class="c">!&gt; @param rnl reflect name list structure</span>
<a name="ln-1767"></a><span class="c">!</span>
<a name="ln-1768"></a><span class="c">!&gt; @date 05/31/16 MDG 1.0 new routine</span>
<a name="ln-1769"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1770"></a><span class="k">recursive subroutine </span><span class="n">GetreflectorNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">rnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1771"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetreflectorNameList</span>
<a name="ln-1772"></a>
<a name="ln-1773"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1774"></a>
<a name="ln-1775"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1776"></a>
<a name="ln-1777"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1778"></a><span class="k">type</span><span class="p">(</span><span class="n">reflectorNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">rnl</span>
<a name="ln-1779"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1780"></a>
<a name="ln-1781"></a><span class="kt">logical</span>                                        <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1782"></a>
<a name="ln-1783"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                              <span class="kd">::</span> <span class="n">numphi</span>
<a name="ln-1784"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                              <span class="kd">::</span> <span class="n">numtheta</span>
<a name="ln-1785"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-1786"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                               <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-1787"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                               <span class="kd">::</span> <span class="n">energyfile</span>
<a name="ln-1788"></a>
<a name="ln-1789"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1790"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">EBSDreflectors</span><span class="o">/</span> <span class="n">numphi</span><span class="p">,</span> <span class="n">numtheta</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">energyfile</span>
<a name="ln-1791"></a>
<a name="ln-1792"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1793"></a><span class="n">numphi</span> <span class="o">=</span> <span class="mi">360</span>
<a name="ln-1794"></a><span class="n">numtheta</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-1795"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.05</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-1796"></a><span class="n">masterfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! default filename for z_0(E_e) data from EMMC Monte Carlo simulations</span>
<a name="ln-1797"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! default filename for z_0(E_e) data from EMMC Monte Carlo simulations</span>
<a name="ln-1798"></a>
<a name="ln-1799"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1800"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1801"></a><span class="k">end if</span>
<a name="ln-1802"></a>
<a name="ln-1803"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1804"></a><span class="c">! read the namelist file</span>
<a name="ln-1805"></a>  <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1806"></a>  <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDreflectors</span><span class="p">)</span>
<a name="ln-1807"></a>  <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1808"></a>
<a name="ln-1809"></a><span class="c">! check for required entries</span>
<a name="ln-1810"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1811"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMreflectors:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1812"></a>  <span class="k">end if</span>
<a name="ln-1813"></a><span class="k">  if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1814"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMreflectors:&#39;</span><span class="p">,</span><span class="s1">&#39; master file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1815"></a>  <span class="k">end if</span>
<a name="ln-1816"></a><span class="k">end if</span>
<a name="ln-1817"></a>
<a name="ln-1818"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1819"></a><span class="n">rnl</span><span class="p">%</span><span class="n">numphi</span> <span class="o">=</span> <span class="n">numphi</span>
<a name="ln-1820"></a><span class="n">rnl</span><span class="p">%</span><span class="n">numtheta</span> <span class="o">=</span> <span class="n">numtheta</span>
<a name="ln-1821"></a><span class="n">rnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-1822"></a><span class="n">rnl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span>
<a name="ln-1823"></a><span class="n">rnl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-1824"></a>
<a name="ln-1825"></a><span class="k">end subroutine </span><span class="n">GetreflectorNameList</span>
<a name="ln-1826"></a>
<a name="ln-1827"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1828"></a><span class="c">!</span>
<a name="ln-1829"></a><span class="c">! SUBROUTINE:GetkinematicalNameList</span>
<a name="ln-1830"></a><span class="c">!</span>
<a name="ln-1831"></a><span class="c">!&gt; @author Marc De Graef</span>
<a name="ln-1832"></a><span class="c">!</span>
<a name="ln-1833"></a><span class="c">!&gt; @brief read reflector namelist for EMreflectors program</span>
<a name="ln-1834"></a><span class="c">!</span>
<a name="ln-1835"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1836"></a><span class="c">!&gt; @param rnl reflect name list structure</span>
<a name="ln-1837"></a><span class="c">!</span>
<a name="ln-1838"></a><span class="c">!&gt; @date 05/31/16 MDG 1.0 new routine</span>
<a name="ln-1839"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1840"></a><span class="k">recursive subroutine </span><span class="n">GetkinematicalNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">knl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1841"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetkinematicalNameList</span>
<a name="ln-1842"></a>
<a name="ln-1843"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1844"></a>
<a name="ln-1845"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1846"></a>
<a name="ln-1847"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1848"></a><span class="k">type</span><span class="p">(</span><span class="n">kinematicalNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">knl</span>
<a name="ln-1849"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1850"></a>
<a name="ln-1851"></a><span class="kt">logical</span>                                        <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1852"></a>
<a name="ln-1853"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-1854"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">thr</span>
<a name="ln-1855"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-1856"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                               <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-1857"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                               <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-1858"></a>
<a name="ln-1859"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1860"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">EMkinematical</span><span class="o">/</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">thr</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">datafile</span>
<a name="ln-1861"></a>
<a name="ln-1862"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1863"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.05</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-1864"></a><span class="n">thr</span> <span class="o">=</span> <span class="mf">1.0</span>                      <span class="c">! smallest |structurefactor|^2 to include</span>
<a name="ln-1865"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">3000</span><span class="mf">0.0</span>              <span class="c">! microscope voltage [V]</span>
<a name="ln-1866"></a><span class="n">datafile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>         <span class="c">! output file name</span>
<a name="ln-1867"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>         <span class="c">! structure file name</span>
<a name="ln-1868"></a>
<a name="ln-1869"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1870"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1871"></a><span class="k">end if</span>
<a name="ln-1872"></a>
<a name="ln-1873"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1874"></a><span class="c">! read the namelist file</span>
<a name="ln-1875"></a>  <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1876"></a>  <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EMkinematical</span><span class="p">)</span>
<a name="ln-1877"></a>  <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1878"></a>
<a name="ln-1879"></a><span class="c">! check for required entries</span>
<a name="ln-1880"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1881"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMkinematical:&#39;</span><span class="p">,</span><span class="s1">&#39;  crystal structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1882"></a>  <span class="k">end if</span>
<a name="ln-1883"></a><span class="k">  if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">datafile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1884"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMkinematical:&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-1885"></a>  <span class="k">end if</span>
<a name="ln-1886"></a><span class="k">end if</span>
<a name="ln-1887"></a>
<a name="ln-1888"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-1889"></a><span class="n">knl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-1890"></a><span class="n">knl</span><span class="p">%</span><span class="n">thr</span> <span class="o">=</span> <span class="n">thr</span>
<a name="ln-1891"></a><span class="n">knl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-1892"></a><span class="n">knl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-1893"></a><span class="n">knl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-1894"></a>
<a name="ln-1895"></a><span class="k">end subroutine </span><span class="n">GetkinematicalNameList</span>
<a name="ln-1896"></a>
<a name="ln-1897"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1898"></a><span class="c">!</span>
<a name="ln-1899"></a><span class="c">! SUBROUTINE:GetEBSDdetparmscanNameList</span>
<a name="ln-1900"></a><span class="c">!</span>
<a name="ln-1901"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1902"></a><span class="c">!</span>
<a name="ln-1903"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMEBSD.f90)</span>
<a name="ln-1904"></a><span class="c">!</span>
<a name="ln-1905"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1906"></a><span class="c">!&gt; @param enl EBSD name list structure</span>
<a name="ln-1907"></a><span class="c">!</span>
<a name="ln-1908"></a><span class="c">!&gt; @date 06/23/14  MDG 1.0 new routine</span>
<a name="ln-1909"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1910"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDdetparmscanNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1911"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDdetparmscanNameList</span>
<a name="ln-1912"></a>
<a name="ln-1913"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1914"></a>
<a name="ln-1915"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1916"></a>
<a name="ln-1917"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1918"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDdetparmscanNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-1919"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1920"></a>
<a name="ln-1921"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1922"></a>
<a name="ln-1923"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numdetparm</span>
<a name="ln-1924"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numeuler</span>
<a name="ln-1925"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">DetParms</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1926"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Eulertriplet</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1927"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">DetParmstepsize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1928"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Cubochoricstepsize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1929"></a>
<a name="ln-1930"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-1931"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">EBSDscandata</span> <span class="o">/</span> <span class="n">numdetparm</span><span class="p">,</span> <span class="n">numeuler</span><span class="p">,</span> <span class="n">DetParms</span><span class="p">,</span> <span class="n">Eulertriplet</span><span class="p">,</span> <span class="n">DetParmstepsize</span><span class="p">,</span> <span class="n">Cubochoricstepsize</span>
<a name="ln-1932"></a>
<a name="ln-1933"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-1934"></a><span class="n">numdetparm</span>      <span class="o">=</span> <span class="mi">10</span>            <span class="c">! number of detector parameter steps (2x+1)</span>
<a name="ln-1935"></a><span class="n">numeuler</span>        <span class="o">=</span> <span class="mi">10</span>            <span class="c">! number of Euler angle steps (2x+1)</span>
<a name="ln-1936"></a><span class="n">DetParms</span>        <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1500</span><span class="mf">0.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1937"></a><span class="n">Eulertriplet</span>    <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1938"></a><span class="n">DetParmstepsize</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="mf">0.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1939"></a><span class="n">Cubochoricstepsize</span>   <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1940"></a>
<a name="ln-1941"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1942"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1943"></a><span class="k">end if</span>
<a name="ln-1944"></a>
<a name="ln-1945"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1946"></a><span class="c">! read the namelist file</span>
<a name="ln-1947"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1948"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDscandata</span><span class="p">)</span>
<a name="ln-1949"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1950"></a><span class="k">end if</span>
<a name="ln-1951"></a>
<a name="ln-1952"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the enl fields</span>
<a name="ln-1953"></a><span class="n">enl</span><span class="p">%</span><span class="n">numdetparm</span> <span class="o">=</span> <span class="n">numdetparm</span>
<a name="ln-1954"></a><span class="n">enl</span><span class="p">%</span><span class="n">numeuler</span> <span class="o">=</span> <span class="n">numeuler</span>
<a name="ln-1955"></a><span class="n">enl</span><span class="p">%</span><span class="n">DetParms</span> <span class="o">=</span> <span class="n">DetParms</span> 
<a name="ln-1956"></a><span class="n">enl</span><span class="p">%</span><span class="n">DetParmstepsize</span> <span class="o">=</span> <span class="n">DetParmstepsize</span>
<a name="ln-1957"></a><span class="n">enl</span><span class="p">%</span><span class="n">Eulertriplet</span> <span class="o">=</span> <span class="n">Eulertriplet</span> 
<a name="ln-1958"></a><span class="n">enl</span><span class="p">%</span><span class="n">Cubochoricstepsize</span> <span class="o">=</span> <span class="n">Cubochoricstepsize</span> 
<a name="ln-1959"></a>
<a name="ln-1960"></a><span class="k">end subroutine </span><span class="n">GetEBSDdetparmscanNameList</span>
<a name="ln-1961"></a>
<a name="ln-1962"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1963"></a><span class="c">!</span>
<a name="ln-1964"></a><span class="c">! SUBROUTINE:GetEBSDNameList</span>
<a name="ln-1965"></a><span class="c">!</span>
<a name="ln-1966"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1967"></a><span class="c">!</span>
<a name="ln-1968"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMEBSD.f90)</span>
<a name="ln-1969"></a><span class="c">!</span>
<a name="ln-1970"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-1971"></a><span class="c">!&gt; @param enl EBSD name list structure</span>
<a name="ln-1972"></a><span class="c">!</span>
<a name="ln-1973"></a><span class="c">!&gt; @date 06/23/14  MDG 1.0 new routine</span>
<a name="ln-1974"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1975"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-1976"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDNameList</span>
<a name="ln-1977"></a>
<a name="ln-1978"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-1979"></a>
<a name="ln-1980"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1981"></a>
<a name="ln-1982"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-1983"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-1984"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-1985"></a>
<a name="ln-1986"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1987"></a>
<a name="ln-1988"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-1989"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-1990"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsy</span>
<a name="ln-1991"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">binning</span>
<a name="ln-1992"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-1993"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">energyaverage</span>
<a name="ln-1994"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">L</span>
<a name="ln-1995"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-1996"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-1997"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">xpc</span>
<a name="ln-1998"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ypc</span>
<a name="ln-1999"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-2000"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">energymin</span>
<a name="ln-2001"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">energymax</span>
<a name="ln-2002"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-2003"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">alphaBD</span>
<a name="ln-2004"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">axisangle</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2005"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">beamcurrent</span>
<a name="ln-2006"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dwelltime</span>
<a name="ln-2007"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-2008"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">spatialaverage</span>
<a name="ln-2009"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">scalingmode</span>
<a name="ln-2010"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">eulerconvention</span>
<a name="ln-2011"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">outputformat</span>
<a name="ln-2012"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">anglefile</span>
<a name="ln-2013"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-2014"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span> 
<a name="ln-2015"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-2016"></a>
<a name="ln-2017"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-2018"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">EBSDdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">numsy</span><span class="p">,</span> <span class="n">xpc</span><span class="p">,</span> <span class="n">ypc</span><span class="p">,</span> <span class="n">anglefile</span><span class="p">,</span> <span class="n">eulerconvention</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2019"></a>                        <span class="n">energyfile</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">beamcurrent</span><span class="p">,</span> <span class="n">dwelltime</span><span class="p">,</span> <span class="n">energymin</span><span class="p">,</span> <span class="n">energymax</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">alphaBD</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2020"></a>                        <span class="n">scalingmode</span><span class="p">,</span> <span class="n">axisangle</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">outputformat</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">energyaverage</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">spatialaverage</span>
<a name="ln-2021"></a>
<a name="ln-2022"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-2023"></a><span class="n">stdout</span>          <span class="o">=</span> <span class="mi">6</span>
<a name="ln-2024"></a><span class="n">numsx</span>           <span class="o">=</span> <span class="mi">640</span>           <span class="c">! [dimensionless]</span>
<a name="ln-2025"></a><span class="n">numsy</span>           <span class="o">=</span> <span class="mi">480</span>           <span class="c">! [dimensionless]</span>
<a name="ln-2026"></a><span class="n">binning</span>         <span class="o">=</span> <span class="mi">1</span>             <span class="c">! binning mode  (1, 2, 4, or 8)</span>
<a name="ln-2027"></a><span class="n">L</span>               <span class="o">=</span> <span class="mi">2000</span><span class="mf">0.0</span>       <span class="c">! [microns]</span>
<a name="ln-2028"></a><span class="n">nthreads</span>        <span class="o">=</span> <span class="mi">1</span>             <span class="c">! number of OpenMP threads</span>
<a name="ln-2029"></a><span class="n">energyaverage</span>   <span class="o">=</span> <span class="mi">0</span>             <span class="c">! apply energy averaging (1) or not (0); useful for dictionary computations</span>
<a name="ln-2030"></a><span class="n">thetac</span>          <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [degrees]</span>
<a name="ln-2031"></a><span class="n">delta</span>           <span class="o">=</span> <span class="mi">2</span><span class="mf">5.0</span>          <span class="c">! [microns]</span>
<a name="ln-2032"></a><span class="n">xpc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-2033"></a><span class="n">ypc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-2034"></a><span class="n">omega</span>           <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-2035"></a><span class="n">energymin</span>       <span class="o">=</span> <span class="mi">1</span><span class="mf">5.0</span>          <span class="c">! minimum energy to consider</span>
<a name="ln-2036"></a><span class="n">energymax</span>       <span class="o">=</span> <span class="mi">3</span><span class="mf">0.0</span>          <span class="c">! maximum energy to consider</span>
<a name="ln-2037"></a><span class="n">gammavalue</span>      <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! gamma factor</span>
<a name="ln-2038"></a><span class="n">alphaBD</span>         <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! transfer lens barrel distortion parameter</span>
<a name="ln-2039"></a><span class="n">axisangle</span>       <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="o">/</span><span class="p">)</span>        <span class="c">! no additional axis angle rotation</span>
<a name="ln-2040"></a><span class="n">beamcurrent</span>     <span class="o">=</span> <span class="mi">1</span><span class="mf">4.513D0</span>      <span class="c">! beam current (actually emission current) in nano ampere</span>
<a name="ln-2041"></a><span class="n">dwelltime</span>       <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0D0</span>       <span class="c">! in microseconds</span>
<a name="ln-2042"></a><span class="n">maskpattern</span>     <span class="o">=</span> <span class="s1">&#39;n&#39;</span>           <span class="c">! &#39;y&#39; or &#39;n&#39; to include a circular mask</span>
<a name="ln-2043"></a><span class="n">scalingmode</span>     <span class="o">=</span> <span class="s1">&#39;not&#39;</span>         <span class="c">! intensity selector (&#39;lin&#39;, &#39;gam&#39;, or &#39;not&#39;)</span>
<a name="ln-2044"></a><span class="n">eulerconvention</span> <span class="o">=</span> <span class="s1">&#39;tsl&#39;</span>         <span class="c">! convention for the first Euler angle [&#39;tsl&#39; or &#39;hkl&#39;]</span>
<a name="ln-2045"></a><span class="n">outputformat</span>    <span class="o">=</span> <span class="s1">&#39;gui&#39;</span>         <span class="c">! output format for &#39;bin&#39; or &#39;gui&#39; use</span>
<a name="ln-2046"></a><span class="n">anglefile</span>       <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-2047"></a><span class="n">masterfile</span>      <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-2048"></a><span class="n">energyfile</span>      <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! name of file that contains energy histograms for all scintillator pixels (output from MC program)</span>
<a name="ln-2049"></a><span class="n">datafile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! output file name</span>
<a name="ln-2050"></a><span class="n">spatialaverage</span>  <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<a name="ln-2051"></a>
<a name="ln-2052"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2053"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2054"></a><span class="k">end if</span>
<a name="ln-2055"></a>
<a name="ln-2056"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2057"></a><span class="c">! read the namelist file</span>
<a name="ln-2058"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2059"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDdata</span><span class="p">)</span>
<a name="ln-2060"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2061"></a>
<a name="ln-2062"></a><span class="c">! check for required entries</span>
<a name="ln-2063"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2064"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2065"></a> <span class="k">end if</span>
<a name="ln-2066"></a>
<a name="ln-2067"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">anglefile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2068"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; angle file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2069"></a> <span class="k">end if</span>
<a name="ln-2070"></a>
<a name="ln-2071"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2072"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2073"></a> <span class="k">end if</span>
<a name="ln-2074"></a>
<a name="ln-2075"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">datafile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2076"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2077"></a> <span class="k">end if</span>
<a name="ln-2078"></a><span class="k">end if</span>
<a name="ln-2079"></a>
<a name="ln-2080"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-2081"></a><span class="n">enl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2082"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-2083"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsy</span> <span class="o">=</span> <span class="n">numsy</span>
<a name="ln-2084"></a><span class="n">enl</span><span class="p">%</span><span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span>
<a name="ln-2085"></a><span class="n">enl</span><span class="p">%</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
<a name="ln-2086"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-2087"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyaverage</span> <span class="o">=</span> <span class="n">energyaverage</span>
<a name="ln-2088"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-2089"></a><span class="n">enl</span><span class="p">%</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>
<a name="ln-2090"></a><span class="n">enl</span><span class="p">%</span><span class="n">xpc</span> <span class="o">=</span> <span class="n">xpc</span>
<a name="ln-2091"></a><span class="n">enl</span><span class="p">%</span><span class="n">ypc</span> <span class="o">=</span> <span class="n">ypc</span>
<a name="ln-2092"></a><span class="n">enl</span><span class="p">%</span><span class="n">energymin</span> <span class="o">=</span> <span class="n">energymin</span>
<a name="ln-2093"></a><span class="n">enl</span><span class="p">%</span><span class="n">energymax</span> <span class="o">=</span> <span class="n">energymax</span>
<a name="ln-2094"></a><span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-2095"></a><span class="n">enl</span><span class="p">%</span><span class="n">alphaBD</span> <span class="o">=</span> <span class="n">alphaBD</span>
<a name="ln-2096"></a><span class="n">enl</span><span class="p">%</span><span class="n">axisangle</span> <span class="o">=</span> <span class="n">axisangle</span>
<a name="ln-2097"></a><span class="n">enl</span><span class="p">%</span><span class="n">beamcurrent</span> <span class="o">=</span> <span class="n">beamcurrent</span>
<a name="ln-2098"></a><span class="n">enl</span><span class="p">%</span><span class="n">dwelltime</span> <span class="o">=</span> <span class="n">dwelltime</span>
<a name="ln-2099"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>
<a name="ln-2100"></a><span class="n">enl</span><span class="p">%</span><span class="n">scalingmode</span> <span class="o">=</span> <span class="n">scalingmode</span>
<a name="ln-2101"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerconvention</span> <span class="o">=</span> <span class="n">eulerconvention</span>
<a name="ln-2102"></a><span class="n">enl</span><span class="p">%</span><span class="n">outputformat</span> <span class="o">=</span> <span class="n">outputformat</span>
<a name="ln-2103"></a><span class="n">enl</span><span class="p">%</span><span class="n">anglefile</span> <span class="o">=</span> <span class="n">anglefile</span>
<a name="ln-2104"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span>
<a name="ln-2105"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-2106"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-2107"></a><span class="n">enl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-2108"></a><span class="n">enl</span><span class="p">%</span><span class="n">spatialaverage</span> <span class="o">=</span> <span class="n">spatialaverage</span>
<a name="ln-2109"></a><span class="k">end subroutine </span><span class="n">GetEBSDNameList</span>
<a name="ln-2110"></a>
<a name="ln-2111"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2112"></a><span class="c">!</span>
<a name="ln-2113"></a><span class="c">! SUBROUTINE:GetTKDNameList</span>
<a name="ln-2114"></a><span class="c">!</span>
<a name="ln-2115"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2116"></a><span class="c">!</span>
<a name="ln-2117"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMTKD.f90)</span>
<a name="ln-2118"></a><span class="c">!</span>
<a name="ln-2119"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2120"></a><span class="c">!&gt; @param enl TKD name list structure</span>
<a name="ln-2121"></a><span class="c">!</span>
<a name="ln-2122"></a><span class="c">!&gt; @date 05/09/17  MDG 1.0 new routine</span>
<a name="ln-2123"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2124"></a><span class="k">recursive subroutine </span><span class="n">GetTKDNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2125"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetTKDNameList</span>
<a name="ln-2126"></a>
<a name="ln-2127"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2128"></a>
<a name="ln-2129"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2130"></a>
<a name="ln-2131"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2132"></a><span class="k">type</span><span class="p">(</span><span class="n">TKDNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-2133"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2134"></a>
<a name="ln-2135"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2136"></a>
<a name="ln-2137"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2138"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-2139"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsy</span>
<a name="ln-2140"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">binning</span>
<a name="ln-2141"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-2142"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">energyaverage</span>
<a name="ln-2143"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">L</span>
<a name="ln-2144"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-2145"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-2146"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">xpc</span>
<a name="ln-2147"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ypc</span>
<a name="ln-2148"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-2149"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">energymin</span>
<a name="ln-2150"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">energymax</span>
<a name="ln-2151"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-2152"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">alphaBD</span>
<a name="ln-2153"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">axisangle</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2154"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">beamcurrent</span>
<a name="ln-2155"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dwelltime</span>
<a name="ln-2156"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-2157"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">spatialaverage</span>
<a name="ln-2158"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">scalingmode</span>
<a name="ln-2159"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">eulerconvention</span>
<a name="ln-2160"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">outputformat</span>
<a name="ln-2161"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">anglefile</span>
<a name="ln-2162"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-2163"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span> 
<a name="ln-2164"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-2165"></a>
<a name="ln-2166"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-2167"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">TKDdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">numsy</span><span class="p">,</span> <span class="n">xpc</span><span class="p">,</span> <span class="n">ypc</span><span class="p">,</span> <span class="n">anglefile</span><span class="p">,</span> <span class="n">eulerconvention</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2168"></a>                     <span class="n">energyfile</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">beamcurrent</span><span class="p">,</span> <span class="n">dwelltime</span><span class="p">,</span> <span class="n">energymin</span><span class="p">,</span> <span class="n">energymax</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">alphaBD</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2169"></a>                     <span class="n">scalingmode</span><span class="p">,</span> <span class="n">axisangle</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">outputformat</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">energyaverage</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">spatialaverage</span>
<a name="ln-2170"></a>
<a name="ln-2171"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-2172"></a><span class="n">stdout</span>          <span class="o">=</span> <span class="mi">6</span>
<a name="ln-2173"></a><span class="n">numsx</span>           <span class="o">=</span> <span class="mi">640</span>           <span class="c">! [dimensionless]</span>
<a name="ln-2174"></a><span class="n">numsy</span>           <span class="o">=</span> <span class="mi">480</span>           <span class="c">! [dimensionless]</span>
<a name="ln-2175"></a><span class="n">binning</span>         <span class="o">=</span> <span class="mi">1</span>             <span class="c">! binning mode  (1, 2, 4, or 8)</span>
<a name="ln-2176"></a><span class="n">L</span>               <span class="o">=</span> <span class="mi">2000</span><span class="mf">0.0</span>       <span class="c">! [microns]</span>
<a name="ln-2177"></a><span class="n">nthreads</span>        <span class="o">=</span> <span class="mi">1</span>             <span class="c">! number of OpenMP threads</span>
<a name="ln-2178"></a><span class="n">energyaverage</span>   <span class="o">=</span> <span class="mi">0</span>             <span class="c">! apply energy averaging (1) or not (0); useful for dictionary computations</span>
<a name="ln-2179"></a><span class="n">thetac</span>          <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [degrees]</span>
<a name="ln-2180"></a><span class="n">delta</span>           <span class="o">=</span> <span class="mi">2</span><span class="mf">5.0</span>          <span class="c">! [microns]</span>
<a name="ln-2181"></a><span class="n">xpc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-2182"></a><span class="n">ypc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-2183"></a><span class="n">omega</span>           <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-2184"></a><span class="n">energymin</span>       <span class="o">=</span> <span class="mi">1</span><span class="mf">5.0</span>          <span class="c">! minimum energy to consider</span>
<a name="ln-2185"></a><span class="n">energymax</span>       <span class="o">=</span> <span class="mi">3</span><span class="mf">0.0</span>          <span class="c">! maximum energy to consider</span>
<a name="ln-2186"></a><span class="n">gammavalue</span>      <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! gamma factor</span>
<a name="ln-2187"></a><span class="n">alphaBD</span>         <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! transfer lens barrel distortion parameter</span>
<a name="ln-2188"></a><span class="n">axisangle</span>       <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="o">/</span><span class="p">)</span>        <span class="c">! no additional axis angle rotation</span>
<a name="ln-2189"></a><span class="n">beamcurrent</span>     <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0D0</span>       <span class="c">! beam current (actually emission current) in nano ampere</span>
<a name="ln-2190"></a><span class="n">dwelltime</span>       <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0D0</span>       <span class="c">! in microseconds</span>
<a name="ln-2191"></a><span class="n">maskpattern</span>     <span class="o">=</span> <span class="s1">&#39;n&#39;</span>           <span class="c">! &#39;y&#39; or &#39;n&#39; to include a circular mask</span>
<a name="ln-2192"></a><span class="n">scalingmode</span>     <span class="o">=</span> <span class="s1">&#39;not&#39;</span>         <span class="c">! intensity selector (&#39;lin&#39;, &#39;gam&#39;, or &#39;not&#39;)</span>
<a name="ln-2193"></a><span class="n">eulerconvention</span> <span class="o">=</span> <span class="s1">&#39;tsl&#39;</span>         <span class="c">! convention for the first Euler angle [&#39;tsl&#39; or &#39;hkl&#39;]</span>
<a name="ln-2194"></a><span class="n">outputformat</span>    <span class="o">=</span> <span class="s1">&#39;gui&#39;</span>         <span class="c">! output format for &#39;bin&#39; or &#39;gui&#39; use</span>
<a name="ln-2195"></a><span class="n">anglefile</span>       <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-2196"></a><span class="n">masterfile</span>      <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-2197"></a><span class="n">energyfile</span>      <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! name of file that contains energy histograms for all scintillator pixels (output from MC program)</span>
<a name="ln-2198"></a><span class="n">datafile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! output file name</span>
<a name="ln-2199"></a><span class="n">spatialaverage</span>  <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<a name="ln-2200"></a>
<a name="ln-2201"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2202"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2203"></a><span class="k">end if</span>
<a name="ln-2204"></a>
<a name="ln-2205"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2206"></a><span class="c">! read the namelist file</span>
<a name="ln-2207"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2208"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">TKDdata</span><span class="p">)</span>
<a name="ln-2209"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2210"></a>
<a name="ln-2211"></a><span class="c">! check for required entries</span>
<a name="ln-2212"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2213"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetTKDNameList:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2214"></a> <span class="k">end if</span>
<a name="ln-2215"></a>
<a name="ln-2216"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">anglefile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2217"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetTKDNameList:&#39;</span><span class="p">,</span><span class="s1">&#39; angle file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2218"></a> <span class="k">end if</span>
<a name="ln-2219"></a>
<a name="ln-2220"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2221"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetTKDNameList:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2222"></a> <span class="k">end if</span>
<a name="ln-2223"></a>
<a name="ln-2224"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">datafile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2225"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetTKDNameList:&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2226"></a> <span class="k">end if</span>
<a name="ln-2227"></a><span class="k">end if</span>
<a name="ln-2228"></a>
<a name="ln-2229"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-2230"></a><span class="n">enl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2231"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-2232"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsy</span> <span class="o">=</span> <span class="n">numsy</span>
<a name="ln-2233"></a><span class="n">enl</span><span class="p">%</span><span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span>
<a name="ln-2234"></a><span class="n">enl</span><span class="p">%</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
<a name="ln-2235"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-2236"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyaverage</span> <span class="o">=</span> <span class="n">energyaverage</span>
<a name="ln-2237"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-2238"></a><span class="n">enl</span><span class="p">%</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>
<a name="ln-2239"></a><span class="n">enl</span><span class="p">%</span><span class="n">xpc</span> <span class="o">=</span> <span class="n">xpc</span>
<a name="ln-2240"></a><span class="n">enl</span><span class="p">%</span><span class="n">ypc</span> <span class="o">=</span> <span class="n">ypc</span>
<a name="ln-2241"></a><span class="n">enl</span><span class="p">%</span><span class="n">energymin</span> <span class="o">=</span> <span class="n">energymin</span>
<a name="ln-2242"></a><span class="n">enl</span><span class="p">%</span><span class="n">energymax</span> <span class="o">=</span> <span class="n">energymax</span>
<a name="ln-2243"></a><span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-2244"></a><span class="n">enl</span><span class="p">%</span><span class="n">alphaBD</span> <span class="o">=</span> <span class="n">alphaBD</span>
<a name="ln-2245"></a><span class="n">enl</span><span class="p">%</span><span class="n">axisangle</span> <span class="o">=</span> <span class="n">axisangle</span>
<a name="ln-2246"></a><span class="n">enl</span><span class="p">%</span><span class="n">beamcurrent</span> <span class="o">=</span> <span class="n">beamcurrent</span>
<a name="ln-2247"></a><span class="n">enl</span><span class="p">%</span><span class="n">dwelltime</span> <span class="o">=</span> <span class="n">dwelltime</span>
<a name="ln-2248"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>
<a name="ln-2249"></a><span class="n">enl</span><span class="p">%</span><span class="n">scalingmode</span> <span class="o">=</span> <span class="n">scalingmode</span>
<a name="ln-2250"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerconvention</span> <span class="o">=</span> <span class="n">eulerconvention</span>
<a name="ln-2251"></a><span class="n">enl</span><span class="p">%</span><span class="n">outputformat</span> <span class="o">=</span> <span class="n">outputformat</span>
<a name="ln-2252"></a><span class="n">enl</span><span class="p">%</span><span class="n">anglefile</span> <span class="o">=</span> <span class="n">anglefile</span>
<a name="ln-2253"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span>
<a name="ln-2254"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-2255"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-2256"></a><span class="n">enl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-2257"></a><span class="n">enl</span><span class="p">%</span><span class="n">spatialaverage</span> <span class="o">=</span> <span class="n">spatialaverage</span>
<a name="ln-2258"></a><span class="k">end subroutine </span><span class="n">GetTKDNameList</span>
<a name="ln-2259"></a>
<a name="ln-2260"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2261"></a><span class="c">!</span>
<a name="ln-2262"></a><span class="c">! SUBROUTINE:GetEBSDoverlapNameList</span>
<a name="ln-2263"></a><span class="c">!</span>
<a name="ln-2264"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2265"></a><span class="c">!</span>
<a name="ln-2266"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMEBSDoverlap.f90)</span>
<a name="ln-2267"></a><span class="c">!</span>
<a name="ln-2268"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2269"></a><span class="c">!&gt; @param enl EBSD name list structure</span>
<a name="ln-2270"></a><span class="c">!</span>
<a name="ln-2271"></a><span class="c">!&gt; @date 04/29/15  MDG 1.0 new routine</span>
<a name="ln-2272"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2273"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDoverlapNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2274"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDoverlapNameList</span>
<a name="ln-2275"></a>
<a name="ln-2276"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2277"></a>
<a name="ln-2278"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2279"></a>
<a name="ln-2280"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2281"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDoverlapNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-2282"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2283"></a>
<a name="ln-2284"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2285"></a>
<a name="ln-2286"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2287"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">PatternAxisA</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2288"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">HorizontalAxisA</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2289"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">tA</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2290"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">tB</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2291"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">gA</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2292"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">gB</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2293"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">fracA</span>
<a name="ln-2294"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">masterfileA</span>
<a name="ln-2295"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">masterfileB</span>
<a name="ln-2296"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-2297"></a>
<a name="ln-2298"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-2299"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">EBSDdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">PatternAxisA</span><span class="p">,</span> <span class="n">tA</span><span class="p">,</span> <span class="n">tB</span><span class="p">,</span> <span class="n">gA</span><span class="p">,</span> <span class="n">gB</span><span class="p">,</span> <span class="n">fracA</span><span class="p">,</span> <span class="n">masterfileA</span><span class="p">,</span> <span class="n">masterfileB</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">HorizontalAxisA</span>
<a name="ln-2300"></a>
<a name="ln-2301"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-2302"></a><span class="n">stdout</span>          <span class="o">=</span> <span class="mi">6</span>
<a name="ln-2303"></a><span class="n">PatternAxisA</span>    <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>                 <span class="c">! center axis for output pattern</span>
<a name="ln-2304"></a><span class="n">HorizontalAxisA</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>                 <span class="c">! horizontal axis for output pattern</span>
<a name="ln-2305"></a><span class="n">tA</span>              <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">)</span>             <span class="c">! direction vector in crystal A</span>
<a name="ln-2306"></a><span class="n">tB</span>              <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">)</span>             <span class="c">! direction vector in crystal B</span>
<a name="ln-2307"></a><span class="n">gA</span>              <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="o">/</span><span class="p">)</span>             <span class="c">! plane normal in crystal A</span>
<a name="ln-2308"></a><span class="n">gB</span>              <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="o">/</span><span class="p">)</span>             <span class="c">! plane normal in crystal B</span>
<a name="ln-2309"></a><span class="n">fracA</span>           <span class="o">=</span> <span class="mf">0.5</span>                           <span class="c">! volume fraction of phase A </span>
<a name="ln-2310"></a><span class="n">masterfileA</span>     <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-2311"></a><span class="n">masterfileB</span>     <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-2312"></a><span class="n">datafile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! output file name</span>
<a name="ln-2313"></a>
<a name="ln-2314"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2315"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2316"></a><span class="k">end if</span>
<a name="ln-2317"></a>
<a name="ln-2318"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2319"></a><span class="c">! read the namelist file</span>
<a name="ln-2320"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2321"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDdata</span><span class="p">)</span>
<a name="ln-2322"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2323"></a>
<a name="ln-2324"></a><span class="c">! check for required entries</span>
<a name="ln-2325"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfileA</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2326"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name A is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2327"></a> <span class="k">end if</span>
<a name="ln-2328"></a>
<a name="ln-2329"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfileB</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2330"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name B is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2331"></a> <span class="k">end if</span>
<a name="ln-2332"></a>
<a name="ln-2333"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">datafile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2334"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2335"></a> <span class="k">end if</span>
<a name="ln-2336"></a><span class="k">end if</span>
<a name="ln-2337"></a>
<a name="ln-2338"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-2339"></a><span class="n">enl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2340"></a><span class="n">enl</span><span class="p">%</span><span class="n">PatternAxisA</span> <span class="o">=</span> <span class="n">PatternAxisA</span>
<a name="ln-2341"></a><span class="n">enl</span><span class="p">%</span><span class="n">HorizontalAxisA</span> <span class="o">=</span> <span class="n">HorizontalAxisA</span>
<a name="ln-2342"></a><span class="n">enl</span><span class="p">%</span><span class="n">tA</span> <span class="o">=</span> <span class="n">tA</span>
<a name="ln-2343"></a><span class="n">enl</span><span class="p">%</span><span class="n">tB</span> <span class="o">=</span> <span class="n">tB</span>
<a name="ln-2344"></a><span class="n">enl</span><span class="p">%</span><span class="n">gA</span> <span class="o">=</span> <span class="n">gA</span>
<a name="ln-2345"></a><span class="n">enl</span><span class="p">%</span><span class="n">gB</span> <span class="o">=</span> <span class="n">gB</span>
<a name="ln-2346"></a><span class="n">enl</span><span class="p">%</span><span class="n">fracA</span> <span class="o">=</span> <span class="n">fracA</span>
<a name="ln-2347"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfileA</span> <span class="o">=</span> <span class="n">masterfileA</span>
<a name="ln-2348"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfileB</span> <span class="o">=</span> <span class="n">masterfileB</span>
<a name="ln-2349"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-2350"></a>
<a name="ln-2351"></a><span class="k">end subroutine </span><span class="n">GetEBSDoverlapNameList</span>
<a name="ln-2352"></a>
<a name="ln-2353"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2354"></a><span class="c">!</span>
<a name="ln-2355"></a><span class="c">! SUBROUTINE:GetECPZANameList</span>
<a name="ln-2356"></a><span class="c">!</span>
<a name="ln-2357"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2358"></a><span class="c">!</span>
<a name="ln-2359"></a><span class="c">!&gt; @brief read namelist file and fill ecpnl structure (used by EMECPZA.f90)</span>
<a name="ln-2360"></a><span class="c">!</span>
<a name="ln-2361"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2362"></a><span class="c">!&gt; @param ecpnl name list structure</span>
<a name="ln-2363"></a><span class="c">!</span>
<a name="ln-2364"></a><span class="c">!&gt; @date 01/25/17 MDG 1.0 new structure</span>
<a name="ln-2365"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2366"></a><span class="k">recursive subroutine </span><span class="n">GetECPZANameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">ecpnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2367"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetECPZANameList</span>
<a name="ln-2368"></a>
<a name="ln-2369"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2370"></a>
<a name="ln-2371"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2372"></a>
<a name="ln-2373"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2374"></a><span class="k">type</span><span class="p">(</span><span class="n">ECPZANameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">ecpnl</span>
<a name="ln-2375"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2376"></a>
<a name="ln-2377"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2378"></a>
<a name="ln-2379"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">fn</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2380"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">k</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2381"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-2382"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-2383"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-2384"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ktmax</span>
<a name="ln-2385"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-2386"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span> 
<a name="ln-2387"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outname</span>
<a name="ln-2388"></a>
<a name="ln-2389"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">ECPZAlist</span><span class="o">/</span> <span class="n">k</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">ktmax</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">outname</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">energyfile</span>
<a name="ln-2390"></a>
<a name="ln-2391"></a><span class="c">! default values</span>
<a name="ln-2392"></a><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>        <span class="c">! beam direction [direction indices]</span>
<a name="ln-2393"></a><span class="n">fn</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>       <span class="c">! foil normal [direction indices]</span>
<a name="ln-2394"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.05</span>              <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-2395"></a><span class="n">ktmax</span> <span class="o">=</span> <span class="mf">0.0</span>              <span class="c">! beam convergence in units of |g_a|</span>
<a name="ln-2396"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">256</span>               <span class="c">! output arrays will have size npix x npix</span>
<a name="ln-2397"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2398"></a><span class="n">maskpattern</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<a name="ln-2399"></a><span class="n">outname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! output filename</span>
<a name="ln-2400"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>    <span class="c">! output filename</span>
<a name="ln-2401"></a>
<a name="ln-2402"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2403"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2404"></a><span class="k">end if</span>
<a name="ln-2405"></a>
<a name="ln-2406"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2407"></a><span class="c">! read the namelist file</span>
<a name="ln-2408"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2409"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">ECPZAlist</span><span class="p">)</span>
<a name="ln-2410"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2411"></a>
<a name="ln-2412"></a><span class="c">! check for required entries</span>
<a name="ln-2413"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">outname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2414"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECPZA:&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2415"></a> <span class="k">end if</span>
<a name="ln-2416"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2417"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECPZA:&#39;</span><span class="p">,</span><span class="s1">&#39; Monte Carlo input file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2418"></a> <span class="k">end if</span>
<a name="ln-2419"></a><span class="k">end if</span>
<a name="ln-2420"></a>
<a name="ln-2421"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
<a name="ln-2422"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
<a name="ln-2423"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-2424"></a><span class="n">ecpnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-2425"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">ktmax</span> <span class="o">=</span> <span class="n">ktmax</span>
<a name="ln-2426"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
<a name="ln-2427"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-2428"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-2429"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>
<a name="ln-2430"></a>
<a name="ln-2431"></a><span class="k">end subroutine </span><span class="n">GetECPZANameList</span>
<a name="ln-2432"></a>
<a name="ln-2433"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2434"></a><span class="c">!</span>
<a name="ln-2435"></a><span class="c">! SUBROUTINE:GetECPNameList</span>
<a name="ln-2436"></a><span class="c">!</span>
<a name="ln-2437"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2438"></a><span class="c">!</span>
<a name="ln-2439"></a><span class="c">!&gt; @brief read namelist file and fill ecpnl structure (used by EMECP.f90)</span>
<a name="ln-2440"></a><span class="c">!</span>
<a name="ln-2441"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2442"></a><span class="c">!&gt; @param knl Kossel name list structure</span>
<a name="ln-2443"></a><span class="c">!</span>
<a name="ln-2444"></a><span class="c">!&gt; @date 06/13/14  MDG 1.0 new routine</span>
<a name="ln-2445"></a><span class="c">!&gt; @date 11/25/14  MDG 2.0 added parameters for film on substrate mode</span>
<a name="ln-2446"></a><span class="c">!&gt; @date 10/15/15 SS  1.2 changes for release</span>
<a name="ln-2447"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2448"></a><span class="k">recursive subroutine </span><span class="n">GetECPNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">ecpnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2449"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetECPNameList</span>
<a name="ln-2450"></a>
<a name="ln-2451"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2452"></a>
<a name="ln-2453"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2454"></a>
<a name="ln-2455"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2456"></a><span class="k">type</span><span class="p">(</span><span class="n">ECPNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">ecpnl</span>
<a name="ln-2457"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2458"></a>
<a name="ln-2459"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2460"></a>
<a name="ln-2461"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2462"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">fn_f</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2463"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">fn_s</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2464"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-2465"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-2466"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">gF</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2467"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">gS</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2468"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">tF</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2469"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">tS</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2470"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-2471"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-2472"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">filmthickness</span>
<a name="ln-2473"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-2474"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname2</span>
<a name="ln-2475"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span>
<a name="ln-2476"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">filmfile</span>
<a name="ln-2477"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">subsfile</span>
<a name="ln-2478"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-2479"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-2480"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-2481"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">anglefile</span>
<a name="ln-2482"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">eulerconvention</span>
<a name="ln-2483"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numangle_anglefile</span>
<a name="ln-2484"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-2485"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">outputformat</span>
<a name="ln-2486"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sampletilt</span>
<a name="ln-2487"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">workingdistance</span>
<a name="ln-2488"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Rin</span>
<a name="ln-2489"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Rout</span>
<a name="ln-2490"></a>
<a name="ln-2491"></a><span class="c">! namelist /ECPlist/ stdout, xtalname, voltage, k, fn, dmin, distort, abcdist, albegadist, ktmax, &amp;</span>
<a name="ln-2492"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">ECPlist</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">xtalname2</span><span class="p">,</span> <span class="n">fn_f</span><span class="p">,</span> <span class="n">fn_s</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">filmthickness</span><span class="p">,</span> <span class="n">anglefile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2493"></a>                   <span class="n">nthreads</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">eulerconvention</span><span class="p">,</span> <span class="n">Rin</span><span class="p">,</span> <span class="n">Rout</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2494"></a>                   <span class="n">gF</span><span class="p">,</span> <span class="n">gS</span><span class="p">,</span> <span class="n">tF</span><span class="p">,</span> <span class="n">tS</span><span class="p">,</span> <span class="n">energyfile</span><span class="p">,</span> <span class="n">filmfile</span><span class="p">,</span> <span class="n">subsfile</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2495"></a>                   <span class="n">numangle_anglefile</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">outputformat</span><span class="p">,</span> <span class="n">sampletilt</span><span class="p">,</span> <span class="n">workingdistance</span>
<a name="ln-2496"></a>
<a name="ln-2497"></a><span class="c">! default values</span>
<a name="ln-2498"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>                              <span class="c">! standard output</span>
<a name="ln-2499"></a><span class="n">fn_f</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>                    <span class="c">! beam direction [direction indices]</span>
<a name="ln-2500"></a><span class="n">fn_s</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>                    <span class="c">! foil normal [direction indices]</span>
<a name="ln-2501"></a><span class="n">gF</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>                      <span class="c">! plane normal in film</span>
<a name="ln-2502"></a><span class="n">gS</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>                      <span class="c">! plane normal in substrate</span>
<a name="ln-2503"></a><span class="n">tF</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>                      <span class="c">! direction in film</span>
<a name="ln-2504"></a><span class="n">tS</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>                      <span class="c">! direction in substrate</span>
<a name="ln-2505"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">200</span>                              <span class="c">! number of pixels in final image (npix x npix)</span>
<a name="ln-2506"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>                            <span class="c">! number of OpenMP threads</span>
<a name="ln-2507"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.04</span>                             <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-2508"></a><span class="n">thetac</span> <span class="o">=</span> <span class="mf">0.0</span>                            <span class="c">! beam convergence in mrad (either ktmax or thetac must be given)</span>
<a name="ln-2509"></a><span class="n">filmthickness</span> <span class="o">=</span> <span class="mf">0.0</span>                     <span class="c">! 0.0 if there is no film</span>
<a name="ln-2510"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>                  <span class="c">! initial value to check that the keyword is present in the nml file</span>
<a name="ln-2511"></a><span class="n">xtalname2</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>                 <span class="c">! initial value for substrate structure name</span>
<a name="ln-2512"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-2513"></a><span class="n">filmfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-2514"></a><span class="n">subsfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-2515"></a><span class="n">masterfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-2516"></a><span class="n">datafile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-2517"></a><span class="n">maskpattern</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
<a name="ln-2518"></a><span class="n">anglefile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-2519"></a><span class="n">eulerconvention</span> <span class="o">=</span> <span class="s1">&#39;hkl&#39;</span>
<a name="ln-2520"></a><span class="n">numangle_anglefile</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2521"></a><span class="n">gammavalue</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-2522"></a><span class="n">outputformat</span> <span class="o">=</span> <span class="s1">&#39;gui&#39;</span>
<a name="ln-2523"></a><span class="n">sampletilt</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-2524"></a><span class="n">Workingdistance</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">3.0</span>
<a name="ln-2525"></a><span class="n">Rin</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-2526"></a><span class="n">Rout</span> <span class="o">=</span> <span class="mf">6.0</span>
<a name="ln-2527"></a>
<a name="ln-2528"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2529"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2530"></a><span class="k">end if</span>
<a name="ln-2531"></a>
<a name="ln-2532"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2533"></a><span class="c">! read the namelist file</span>
<a name="ln-2534"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2535"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">ECPlist</span><span class="p">)</span>
<a name="ln-2536"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2537"></a>
<a name="ln-2538"></a><span class="c">! check for required entries</span>
<a name="ln-2539"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2540"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEECP:&#39;</span><span class="p">,</span><span class="s1">&#39; crystal file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2541"></a> <span class="k">end if</span>
<a name="ln-2542"></a><span class="k">end if</span>
<a name="ln-2543"></a>
<a name="ln-2544"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2545"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">fn_f</span> <span class="o">=</span> <span class="n">fn_f</span>
<a name="ln-2546"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">fn_s</span> <span class="o">=</span> <span class="n">fn_s</span>
<a name="ln-2547"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">gF</span> <span class="o">=</span> <span class="n">gF</span>
<a name="ln-2548"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">gS</span> <span class="o">=</span> <span class="n">gS</span>
<a name="ln-2549"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">tF</span> <span class="o">=</span> <span class="n">tF</span>
<a name="ln-2550"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">tS</span> <span class="o">=</span> <span class="n">tS</span>
<a name="ln-2551"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-2552"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-2553"></a><span class="n">ecpnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-2554"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-2555"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">filmthickness</span> <span class="o">=</span> <span class="n">filmthickness</span>
<a name="ln-2556"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-2557"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-2558"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">xtalname2</span> <span class="o">=</span> <span class="n">xtalname2</span>
<a name="ln-2559"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-2560"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">filmfile</span> <span class="o">=</span> <span class="n">filmfile</span>
<a name="ln-2561"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">subsfile</span> <span class="o">=</span> <span class="n">subsfile</span>
<a name="ln-2562"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span>
<a name="ln-2563"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>
<a name="ln-2564"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">anglefile</span> <span class="o">=</span> <span class="n">anglefile</span>
<a name="ln-2565"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">numangle_anglefile</span> <span class="o">=</span> <span class="n">numangle_anglefile</span>
<a name="ln-2566"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">eulerconvention</span> <span class="o">=</span> <span class="n">eulerconvention</span>
<a name="ln-2567"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-2568"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">outputformat</span> <span class="o">=</span> <span class="n">outputformat</span>
<a name="ln-2569"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">sampletilt</span> <span class="o">=</span> <span class="n">sampletilt</span>
<a name="ln-2570"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">workingdistance</span> <span class="o">=</span> <span class="n">workingdistance</span>
<a name="ln-2571"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">Rin</span> <span class="o">=</span> <span class="n">Rin</span>
<a name="ln-2572"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">Rout</span> <span class="o">=</span> <span class="n">Rout</span>
<a name="ln-2573"></a>
<a name="ln-2574"></a><span class="k">end subroutine </span><span class="n">GetECPNameList</span>
<a name="ln-2575"></a>
<a name="ln-2576"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2577"></a><span class="c">!</span>
<a name="ln-2578"></a><span class="c">! SUBROUTINE:GetLACBEDNameList</span>
<a name="ln-2579"></a><span class="c">!</span>
<a name="ln-2580"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2581"></a><span class="c">!</span>
<a name="ln-2582"></a><span class="c">!&gt; @brief read namelist file and fill lacbednl structure (used by EMLACBED.f90)</span>
<a name="ln-2583"></a><span class="c">!</span>
<a name="ln-2584"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2585"></a><span class="c">!&gt; @param lacbednl LACBED name list structure</span>
<a name="ln-2586"></a><span class="c">!</span>
<a name="ln-2587"></a><span class="c">!&gt; @date 07/01/14  MDG 1.0 new routine</span>
<a name="ln-2588"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2589"></a><span class="k">recursive subroutine </span><span class="n">GetLACBEDNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">lacbednl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2590"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetLACBEDNameList</span>
<a name="ln-2591"></a>
<a name="ln-2592"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2593"></a>
<a name="ln-2594"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2595"></a>
<a name="ln-2596"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2597"></a><span class="k">type</span><span class="p">(</span><span class="n">LACBEDNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">lacbednl</span>
<a name="ln-2598"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2599"></a>
<a name="ln-2600"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2601"></a>
<a name="ln-2602"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2603"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">k</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2604"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">fn</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2605"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">maxHOLZ</span>
<a name="ln-2606"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numthick</span>
<a name="ln-2607"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-2608"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-2609"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-2610"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-2611"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">convergence</span>
<a name="ln-2612"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">startthick</span>
<a name="ln-2613"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thickinc</span>
<a name="ln-2614"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">minten</span>
<a name="ln-2615"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-2616"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outname</span>
<a name="ln-2617"></a>
<a name="ln-2618"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">inputlist</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">convergence</span><span class="p">,</span> <span class="n">minten</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2619"></a>                              <span class="n">nthreads</span><span class="p">,</span> <span class="n">startthick</span><span class="p">,</span> <span class="n">thickinc</span><span class="p">,</span> <span class="n">numthick</span><span class="p">,</span> <span class="n">outname</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">maxHOLZ</span>
<a name="ln-2620"></a>
<a name="ln-2621"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>                      <span class="c">! standard output</span>
<a name="ln-2622"></a><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>               <span class="c">! beam direction [direction indices]</span>
<a name="ln-2623"></a><span class="n">fn</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>              <span class="c">! foil normal [direction indices]</span>
<a name="ln-2624"></a><span class="n">maxHOLZ</span> <span class="o">=</span> <span class="mi">2</span>                     <span class="c">! maximum HOLZ layer index to be used for the output file; note that his number</span>
<a name="ln-2625"></a>                                <span class="c">! does not affect the actual computations; it only determines which reflection </span>
<a name="ln-2626"></a>                                <span class="c">! families will end up in the output file</span>
<a name="ln-2627"></a><span class="n">numthick</span> <span class="o">=</span> <span class="mi">10</span>                   <span class="c">! number of increments</span>
<a name="ln-2628"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">256</span>                      <span class="c">! output arrays will have size npix x npix</span>
<a name="ln-2629"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>                    <span class="c">! number of computational threads</span>
<a name="ln-2630"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">20000</span><span class="mf">0.0</span>              <span class="c">! acceleration voltage [V]</span>
<a name="ln-2631"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.025</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-2632"></a><span class="n">convergence</span> <span class="o">=</span> <span class="mi">2</span><span class="mf">5.0</span>              <span class="c">! beam convergence angle [mrad]</span>
<a name="ln-2633"></a><span class="n">startthick</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>               <span class="c">! starting thickness [nm]</span>
<a name="ln-2634"></a><span class="n">thickinc</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>                 <span class="c">! thickness increment</span>
<a name="ln-2635"></a><span class="n">minten</span> <span class="o">=</span> <span class="mf">1.0E-5</span>                 <span class="c">! minimum intensity in diffraction disk to make it into the output file</span>
<a name="ln-2636"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>          <span class="c">! initial value to check that the keyword is present in the nml file</span>
<a name="ln-2637"></a><span class="n">outname</span> <span class="o">=</span> <span class="s1">&#39;lacbedout.data&#39;</span>      <span class="c">! output filename</span>
<a name="ln-2638"></a>
<a name="ln-2639"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2640"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2641"></a><span class="k">end if</span>
<a name="ln-2642"></a>
<a name="ln-2643"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2644"></a><span class="c">! read the namelist file</span>
<a name="ln-2645"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2646"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">inputlist</span><span class="p">)</span>
<a name="ln-2647"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2648"></a>
<a name="ln-2649"></a><span class="c">! check for required entries</span>
<a name="ln-2650"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2651"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMLACBED:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2652"></a><span class="k">end if</span>
<a name="ln-2653"></a><span class="k">end if</span>
<a name="ln-2654"></a>
<a name="ln-2655"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2656"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
<a name="ln-2657"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
<a name="ln-2658"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">maxHOLZ</span> <span class="o">=</span> <span class="n">maxHOLZ</span>
<a name="ln-2659"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">numthick</span> <span class="o">=</span> <span class="n">numthick</span>
<a name="ln-2660"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-2661"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-2662"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-2663"></a><span class="n">lacbednl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-2664"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">convergence</span> <span class="o">=</span> <span class="n">convergence</span>
<a name="ln-2665"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">startthick</span> <span class="o">=</span> <span class="n">startthick</span>
<a name="ln-2666"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">thickinc</span> <span class="o">=</span> <span class="n">thickinc</span>
<a name="ln-2667"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">minten</span> <span class="o">=</span> <span class="n">minten</span>
<a name="ln-2668"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-2669"></a><span class="n">lacbednl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
<a name="ln-2670"></a>
<a name="ln-2671"></a><span class="k">end subroutine </span><span class="n">GetLACBEDNameList</span>
<a name="ln-2672"></a>
<a name="ln-2673"></a>
<a name="ln-2674"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2675"></a><span class="c">!</span>
<a name="ln-2676"></a><span class="c">! SUBROUTINE:GetECPpatternNameList</span>
<a name="ln-2677"></a><span class="c">!</span>
<a name="ln-2678"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-2679"></a><span class="c">!</span>
<a name="ln-2680"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMECPpattern.f90)</span>
<a name="ln-2681"></a><span class="c">!</span>
<a name="ln-2682"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2683"></a><span class="c">!&gt; @param emnl ECP name list structure</span>
<a name="ln-2684"></a><span class="c">!</span>
<a name="ln-2685"></a><span class="c">!&gt; @date 06/19/14  SS 1.0 new routine</span>
<a name="ln-2686"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2687"></a><span class="k">recursive subroutine </span><span class="n">GetECPpatternNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span><span class="n">ecpnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2688"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetECPpatternNameList</span>
<a name="ln-2689"></a>
<a name="ln-2690"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2691"></a>
<a name="ln-2692"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2693"></a>
<a name="ln-2694"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2695"></a><span class="k">type</span><span class="p">(</span><span class="n">ECPpatternNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">ecpnl</span>
<a name="ln-2696"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2697"></a>
<a name="ln-2698"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2699"></a>
<a name="ln-2700"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2701"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-2702"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-2703"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">k</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2704"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-2705"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outname</span>
<a name="ln-2706"></a>
<a name="ln-2707"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-2708"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">ECPvars</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">outname</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-2709"></a>
<a name="ln-2710"></a><span class="c">! set the input parameters to default values (except for masterfile, which must be present)</span>
<a name="ln-2711"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-2712"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-2713"></a><span class="n">thetac</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-2714"></a><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="o">/</span><span class="p">)</span>
<a name="ln-2715"></a><span class="n">masterfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! default filename for master data from EMECPmaster</span>
<a name="ln-2716"></a><span class="n">outname</span> <span class="o">=</span> <span class="s1">&#39;ECP.data&#39;</span>  <span class="c">! default filename for final output</span>
<a name="ln-2717"></a>
<a name="ln-2718"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2719"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2720"></a><span class="k">end if</span>
<a name="ln-2721"></a>
<a name="ln-2722"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2723"></a><span class="c">! read the namelist file</span>
<a name="ln-2724"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2725"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">ECPvars</span><span class="p">)</span>
<a name="ln-2726"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2727"></a>
<a name="ln-2728"></a><span class="c">! check for required entries</span>
<a name="ln-2729"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2730"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECP:&#39;</span><span class="p">,</span><span class="s1">&#39; master file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2731"></a><span class="k">end if</span>
<a name="ln-2732"></a><span class="k">end if</span>
<a name="ln-2733"></a>
<a name="ln-2734"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-2735"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2736"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-2737"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-2738"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
<a name="ln-2739"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span>
<a name="ln-2740"></a><span class="n">ecpnl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
<a name="ln-2741"></a>
<a name="ln-2742"></a><span class="k">end subroutine </span><span class="n">GetECPpatternNameList</span>
<a name="ln-2743"></a>
<a name="ln-2744"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2745"></a><span class="c">!</span>
<a name="ln-2746"></a><span class="c">! SUBROUTINE:GetPEDkinNameList</span>
<a name="ln-2747"></a><span class="c">!</span>
<a name="ln-2748"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2749"></a><span class="c">!</span>
<a name="ln-2750"></a><span class="c">!&gt; @brief read namelist file and fill pednl structure (used by EMpedKIN.f90)</span>
<a name="ln-2751"></a><span class="c">!</span>
<a name="ln-2752"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2753"></a><span class="c">!&gt; @param pednl PED name list structure</span>
<a name="ln-2754"></a><span class="c">!</span>
<a name="ln-2755"></a><span class="c">!&gt; @date 03/02/15 MDG 1.0 new routine</span>
<a name="ln-2756"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2757"></a><span class="k">recursive subroutine </span><span class="n">GetPEDkinNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span><span class="n">pednl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2758"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetPEDkinNameList</span>
<a name="ln-2759"></a>
<a name="ln-2760"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2761"></a>
<a name="ln-2762"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2763"></a>
<a name="ln-2764"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2765"></a><span class="k">type</span><span class="p">(</span><span class="n">PEDkinNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">pednl</span>
<a name="ln-2766"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2767"></a>
<a name="ln-2768"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2769"></a>
<a name="ln-2770"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2771"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-2772"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">ncubochoric</span>
<a name="ln-2773"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-2774"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-2775"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thickness</span>
<a name="ln-2776"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">rnmpp</span>
<a name="ln-2777"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-2778"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-2779"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outname</span>
<a name="ln-2780"></a>
<a name="ln-2781"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-2782"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">PEDkinNameList</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">rnmpp</span><span class="p">,</span> <span class="n">ncubochoric</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2783"></a>                              <span class="n">thickness</span><span class="p">,</span> <span class="n">outname</span> <span class="p">,</span> <span class="nb">dmin</span>
<a name="ln-2784"></a>
<a name="ln-2785"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-2786"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>          <span class="c">! initial value to check that the keyword is present in the nml file</span>
<a name="ln-2787"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>                      <span class="c">! standard output</span>
<a name="ln-2788"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">20000</span><span class="mf">0.0</span>              <span class="c">! acceleration voltage [V]</span>
<a name="ln-2789"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>                    <span class="c">! number of OpenMP threads to start</span>
<a name="ln-2790"></a><span class="n">thickness</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>                <span class="c">! sample thickness [nm]</span>
<a name="ln-2791"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">256</span>                      <span class="c">! output arrays will have size npix x npix</span>
<a name="ln-2792"></a><span class="n">outname</span> <span class="o">=</span> <span class="s1">&#39;pedout.data&#39;</span>         <span class="c">! output filename</span>
<a name="ln-2793"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.04</span>                     <span class="c">! smallest d-spacing [nm]</span>
<a name="ln-2794"></a><span class="n">ncubochoric</span> <span class="o">=</span> <span class="mi">100</span>               <span class="c">! number of samples along the cubochoric edge length</span>
<a name="ln-2795"></a><span class="n">rnmpp</span> <span class="o">=</span> <span class="mf">0.2</span>                     <span class="c">! nm^{-1} per pattern pixel</span>
<a name="ln-2796"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2797"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2798"></a><span class="k">end if</span>
<a name="ln-2799"></a>
<a name="ln-2800"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2801"></a><span class="c">! read the namelist file</span>
<a name="ln-2802"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2803"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">PEDkinNameList</span><span class="p">)</span>
<a name="ln-2804"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2805"></a>
<a name="ln-2806"></a><span class="c">! check for required entries</span>
<a name="ln-2807"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2808"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMPED:&#39;</span><span class="p">,</span><span class="s1">&#39; crystal structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2809"></a><span class="k">end if</span>
<a name="ln-2810"></a><span class="k">end if</span>
<a name="ln-2811"></a>
<a name="ln-2812"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the pednl fields</span>
<a name="ln-2813"></a><span class="n">pednl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-2814"></a><span class="n">pednl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2815"></a><span class="n">pednl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-2816"></a><span class="n">pednl</span><span class="p">%</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">thickness</span>
<a name="ln-2817"></a><span class="n">pednl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-2818"></a><span class="n">pednl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-2819"></a><span class="n">pednl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-2820"></a><span class="n">pednl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
<a name="ln-2821"></a><span class="n">pednl</span><span class="p">%</span><span class="n">rnmpp</span> <span class="o">=</span> <span class="n">rnmpp</span>
<a name="ln-2822"></a><span class="n">pednl</span><span class="p">%</span><span class="n">ncubochoric</span> <span class="o">=</span> <span class="n">ncubochoric</span>
<a name="ln-2823"></a>
<a name="ln-2824"></a><span class="k">end subroutine </span><span class="n">GetPEDKINNameList</span>
<a name="ln-2825"></a>
<a name="ln-2826"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2827"></a><span class="c">!</span>
<a name="ln-2828"></a><span class="c">! SUBROUTINE:GetPEDZANameList</span>
<a name="ln-2829"></a><span class="c">!</span>
<a name="ln-2830"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2831"></a><span class="c">!</span>
<a name="ln-2832"></a><span class="c">!&gt; @brief read namelist file and fill pednl structure (used by EMPEDZA.f90)</span>
<a name="ln-2833"></a><span class="c">!</span>
<a name="ln-2834"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2835"></a><span class="c">!&gt; @param pednl PED name list structure</span>
<a name="ln-2836"></a><span class="c">!</span>
<a name="ln-2837"></a><span class="c">!&gt; @date 07/09/14 MDG 1.0 new routine</span>
<a name="ln-2838"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2839"></a><span class="k">recursive subroutine </span><span class="n">GetPEDZANameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span><span class="n">pednl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2840"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetPEDZANameList</span>
<a name="ln-2841"></a>
<a name="ln-2842"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2843"></a>
<a name="ln-2844"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2845"></a>
<a name="ln-2846"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2847"></a><span class="k">type</span><span class="p">(</span><span class="n">PEDZANameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">pednl</span>
<a name="ln-2848"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2849"></a>
<a name="ln-2850"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2851"></a>
<a name="ln-2852"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2853"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">k</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2854"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">fn</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2855"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">precsample</span>
<a name="ln-2856"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">precazimuthal</span>
<a name="ln-2857"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-2858"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-2859"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-2860"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-2861"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">precangle</span>
<a name="ln-2862"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">prechalfwidth</span>
<a name="ln-2863"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thickness</span>
<a name="ln-2864"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">camlen</span>
<a name="ln-2865"></a><span class="kt">character</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">filemode</span>
<a name="ln-2866"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-2867"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">outname</span>
<a name="ln-2868"></a>
<a name="ln-2869"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-2870"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">EMPEDZA</span><span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">precangle</span><span class="p">,</span> <span class="n">prechalfwidth</span><span class="p">,</span> <span class="n">precsample</span><span class="p">,</span> <span class="n">precazimuthal</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2871"></a>                              <span class="n">thickness</span><span class="p">,</span>  <span class="n">outname</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">camlen</span><span class="p">,</span> <span class="n">filemode</span><span class="p">,</span> <span class="n">nthreads</span>
<a name="ln-2872"></a>
<a name="ln-2873"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-2874"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>          <span class="c">! initial value to check that the keyword is present in the nml file</span>
<a name="ln-2875"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>                      <span class="c">! standard output</span>
<a name="ln-2876"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">20000</span><span class="mf">0.0</span>              <span class="c">! acceleration voltage [V]</span>
<a name="ln-2877"></a><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>               <span class="c">! beam direction [direction indices]</span>
<a name="ln-2878"></a><span class="n">fn</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>              <span class="c">! foil normal [direction indices]</span>
<a name="ln-2879"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.025</span>                    <span class="c">! smallest d-spacing to include in dynamical matrix [nm]</span>
<a name="ln-2880"></a><span class="n">precangle</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.472</span>              <span class="c">! beam precession angle [mrad]; default = 0.6 degrees</span>
<a name="ln-2881"></a><span class="n">prechalfwidth</span> <span class="o">=</span> <span class="mf">0.25</span>            <span class="c">! beam half width in the tilt direction [mrad]</span>
<a name="ln-2882"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>                    <span class="c">! number of OpenMP threads to start</span>
<a name="ln-2883"></a><span class="n">precsample</span> <span class="o">=</span> <span class="mi">10</span>                 <span class="c">! number of samples (concentric circles) in beam half width (total = 2*precsample + 1)</span>
<a name="ln-2884"></a><span class="n">precazimuthal</span> <span class="o">=</span> <span class="mi">360</span>             <span class="c">! number of azimuthal samples for each precession circle</span>
<a name="ln-2885"></a><span class="n">thickness</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>                <span class="c">! sample thickness [nm]</span>
<a name="ln-2886"></a><span class="n">filemode</span> <span class="o">=</span> <span class="s1">&#39;total&#39;</span>              <span class="c">! &#39;total&#39; mode or &#39;eachp&#39;</span>
<a name="ln-2887"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">256</span>                      <span class="c">! output arrays will have size npix x npix</span>
<a name="ln-2888"></a><span class="n">outname</span> <span class="o">=</span> <span class="s1">&#39;pedout.data&#39;</span>         <span class="c">! output filename</span>
<a name="ln-2889"></a><span class="n">camlen</span> <span class="o">=</span> <span class="mi">100</span><span class="mf">0.0</span>                 <span class="c">! camera length [mm]</span>
<a name="ln-2890"></a>
<a name="ln-2891"></a>
<a name="ln-2892"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2893"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2894"></a><span class="k">end if</span>
<a name="ln-2895"></a>
<a name="ln-2896"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2897"></a><span class="c">! read the namelist file</span>
<a name="ln-2898"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-2899"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EMPEDZA</span><span class="p">)</span>
<a name="ln-2900"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-2901"></a>
<a name="ln-2902"></a><span class="c">! check for required entries</span>
<a name="ln-2903"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2904"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMPEDZA:&#39;</span><span class="p">,</span><span class="s1">&#39; crystal structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-2905"></a><span class="k">end if</span>
<a name="ln-2906"></a><span class="k">end if</span>
<a name="ln-2907"></a>
<a name="ln-2908"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the pednl fields</span>
<a name="ln-2909"></a><span class="n">pednl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-2910"></a><span class="n">pednl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-2911"></a><span class="n">pednl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-2912"></a><span class="n">pednl</span><span class="p">%</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
<a name="ln-2913"></a><span class="n">pednl</span><span class="p">%</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
<a name="ln-2914"></a><span class="n">pednl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-2915"></a><span class="n">pednl</span><span class="p">%</span><span class="n">precangle</span> <span class="o">=</span> <span class="n">precangle</span>
<a name="ln-2916"></a><span class="n">pednl</span><span class="p">%</span><span class="n">prechalfwidth</span> <span class="o">=</span> <span class="n">prechalfwidth</span>
<a name="ln-2917"></a><span class="n">pednl</span><span class="p">%</span><span class="n">precsample</span> <span class="o">=</span> <span class="n">precsample</span>
<a name="ln-2918"></a><span class="n">pednl</span><span class="p">%</span><span class="n">precazimuthal</span> <span class="o">=</span> <span class="n">precazimuthal</span>
<a name="ln-2919"></a><span class="n">pednl</span><span class="p">%</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">thickness</span>
<a name="ln-2920"></a><span class="n">pednl</span><span class="p">%</span><span class="n">filemode</span> <span class="o">=</span> <span class="n">filemode</span>
<a name="ln-2921"></a><span class="n">pednl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-2922"></a><span class="n">pednl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-2923"></a><span class="n">pednl</span><span class="p">%</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
<a name="ln-2924"></a><span class="n">pednl</span><span class="p">%</span><span class="n">camlen</span> <span class="o">=</span> <span class="n">camlen</span>
<a name="ln-2925"></a>
<a name="ln-2926"></a><span class="k">end subroutine </span><span class="n">GetPEDZANameList</span>
<a name="ln-2927"></a>
<a name="ln-2928"></a>
<a name="ln-2929"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2930"></a><span class="c">!</span>
<a name="ln-2931"></a><span class="c">! SUBROUTINE:GetECCINameList</span>
<a name="ln-2932"></a><span class="c">!</span>
<a name="ln-2933"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2934"></a><span class="c">!</span>
<a name="ln-2935"></a><span class="c">!&gt; @brief read namelist file and fill eccinl structure (used by EMECCI.f90)</span>
<a name="ln-2936"></a><span class="c">!</span>
<a name="ln-2937"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-2938"></a><span class="c">!&gt; @param eccinl ECCI name list structure</span>
<a name="ln-2939"></a><span class="c">!</span>
<a name="ln-2940"></a><span class="c">!&gt; @date 10/04/14 MDG 1.0 new routine</span>
<a name="ln-2941"></a><span class="c">!&gt; @date 11/24/15 MDG 1.1 adapted for new namelist variables</span>
<a name="ln-2942"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2943"></a><span class="k">recursive subroutine </span><span class="n">GetECCINameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span><span class="n">eccinl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-2944"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetECCINameList</span>
<a name="ln-2945"></a>
<a name="ln-2946"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-2947"></a>
<a name="ln-2948"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2949"></a>
<a name="ln-2950"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-2951"></a><span class="k">type</span><span class="p">(</span><span class="n">ECCINameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">eccinl</span>
<a name="ln-2952"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-2953"></a>
<a name="ln-2954"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2955"></a>
<a name="ln-2956"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">i</span>
<a name="ln-2957"></a>
<a name="ln-2958"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-2959"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-2960"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">k</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-2961"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nktstep</span>
<a name="ln-2962"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">DF_npix</span>
<a name="ln-2963"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">DF_npiy</span>
<a name="ln-2964"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-2965"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dkt</span>
<a name="ln-2966"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ktmax</span>
<a name="ln-2967"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">lauec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2968"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">lauec2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2969"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-2970"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">DF_L</span>
<a name="ln-2971"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">DF_slice</span>
<a name="ln-2972"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">dispmode</span>
<a name="ln-2973"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">summode</span>
<a name="ln-2974"></a><span class="kt">character</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">progmode</span>
<a name="ln-2975"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-2976"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">defectfilename</span>
<a name="ln-2977"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dispfile</span>
<a name="ln-2978"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-2979"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">ECPname</span>
<a name="ln-2980"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">sgname</span>
<a name="ln-2981"></a>
<a name="ln-2982"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-2983"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">ECCIlist</span> <span class="o">/</span> <span class="n">DF_L</span><span class="p">,</span> <span class="n">DF_npix</span><span class="p">,</span> <span class="n">DF_npiy</span><span class="p">,</span> <span class="n">DF_slice</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">sgname</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2984"></a>                      <span class="n">progmode</span><span class="p">,</span> <span class="n">dispfile</span><span class="p">,</span> <span class="n">ktmax</span><span class="p">,</span> <span class="n">dkt</span><span class="p">,</span> <span class="n">ECPname</span><span class="p">,</span> <span class="n">summode</span><span class="p">,</span> <span class="n">lauec</span><span class="p">,</span> <span class="n">lauec2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2985"></a>                      <span class="n">dispmode</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nktstep</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2986"></a>                      <span class="n">dataname</span><span class="p">,</span> <span class="n">defectfilename</span>
<a name="ln-2987"></a>
<a name="ln-2988"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-2989"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-2990"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2991"></a><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2992"></a><span class="n">nktstep</span> <span class="o">=</span> <span class="mi">20</span>
<a name="ln-2993"></a><span class="n">DF_npix</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-2994"></a><span class="n">DF_npiy</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-2995"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">3000</span><span class="mf">0.</span>
<a name="ln-2996"></a><span class="n">dkt</span> <span class="o">=</span> <span class="mf">0.1</span>
<a name="ln-2997"></a><span class="n">ktmax</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-2998"></a><span class="n">lauec</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2999"></a><span class="n">lauec2</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-3000"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.1</span>
<a name="ln-3001"></a><span class="n">DF_L</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-3002"></a><span class="n">DF_slice</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-3003"></a><span class="n">dispmode</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
<a name="ln-3004"></a><span class="n">summode</span> <span class="o">=</span> <span class="s1">&#39;diag&#39;</span>
<a name="ln-3005"></a><span class="n">progmode</span> <span class="o">=</span> <span class="s1">&#39;array&#39;</span>
<a name="ln-3006"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3007"></a><span class="n">defectfilename</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3008"></a><span class="n">dispfile</span> <span class="o">=</span> <span class="s1">&#39;displacements.data&#39;</span>
<a name="ln-3009"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;ECCIout.data&#39;</span>
<a name="ln-3010"></a><span class="n">ECPname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3011"></a><span class="n">sgname</span> <span class="o">=</span> <span class="s1">&#39;nofile&#39;</span>
<a name="ln-3012"></a>
<a name="ln-3013"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3014"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3015"></a><span class="k">end if</span>
<a name="ln-3016"></a>
<a name="ln-3017"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3018"></a><span class="c">! read the namelist file</span>
<a name="ln-3019"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-3020"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">ECCIlist</span><span class="p">)</span>
<a name="ln-3021"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-3022"></a>
<a name="ln-3023"></a><span class="c">! check for required entries</span>
<a name="ln-3024"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3025"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECCI:&#39;</span><span class="p">,</span><span class="s1">&#39; crystal structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3026"></a><span class="k">end if</span>
<a name="ln-3027"></a>
<a name="ln-3028"></a><span class="c">! make sure the ECPname variable has been properly defined</span>
<a name="ln-3029"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">ECPname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3030"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECCI:&#39;</span><span class="p">,</span><span class="s1">&#39; ECP pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3031"></a><span class="k">end if</span>
<a name="ln-3032"></a><span class="k">end if</span>
<a name="ln-3033"></a>
<a name="ln-3034"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-3035"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-3036"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-3037"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
<a name="ln-3038"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">nktstep</span> <span class="o">=</span> <span class="n">nktstep</span>
<a name="ln-3039"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">DF_npix</span> <span class="o">=</span> <span class="n">DF_npix</span>
<a name="ln-3040"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">DF_npiy</span> <span class="o">=</span> <span class="n">DF_npiy</span>
<a name="ln-3041"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-3042"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">dkt</span> <span class="o">=</span> <span class="n">dkt</span>
<a name="ln-3043"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">ktmax</span> <span class="o">=</span> <span class="n">ktmax</span>
<a name="ln-3044"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">lauec</span> <span class="o">=</span> <span class="n">lauec</span>
<a name="ln-3045"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">lauec2</span> <span class="o">=</span> <span class="n">lauec2</span>
<a name="ln-3046"></a><span class="n">eccinl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-3047"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">DF_L</span> <span class="o">=</span> <span class="n">DF_L</span>
<a name="ln-3048"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">DF_slice</span> <span class="o">=</span> <span class="n">DF_slice</span>
<a name="ln-3049"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">dispmode</span> <span class="o">=</span> <span class="n">dispmode</span>
<a name="ln-3050"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">summode</span> <span class="o">=</span> <span class="n">summode</span>
<a name="ln-3051"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">progmode</span> <span class="o">=</span> <span class="n">progmode</span>
<a name="ln-3052"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-3053"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">defectfilename</span> <span class="o">=</span> <span class="n">defectfilename</span>
<a name="ln-3054"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">dispfile</span> <span class="o">=</span> <span class="n">dispfile</span>
<a name="ln-3055"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-3056"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">ECPname</span> <span class="o">=</span> <span class="n">ECPname</span>
<a name="ln-3057"></a><span class="n">eccinl</span><span class="p">%</span><span class="n">sgname</span> <span class="o">=</span> <span class="n">sgname</span>
<a name="ln-3058"></a>
<a name="ln-3059"></a><span class="k">end subroutine </span><span class="n">GetECCINameList</span>
<a name="ln-3060"></a>
<a name="ln-3061"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3062"></a><span class="c">!</span>
<a name="ln-3063"></a><span class="c">! SUBROUTINE:GetRFZNameList</span>
<a name="ln-3064"></a><span class="c">!</span>
<a name="ln-3065"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-3066"></a><span class="c">!</span>
<a name="ln-3067"></a><span class="c">!&gt; @brief read namelist file and fill rfznl structure (used by EMsampleRFZ.f90)</span>
<a name="ln-3068"></a><span class="c">!</span>
<a name="ln-3069"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-3070"></a><span class="c">!&gt; @param rfznl RFZ name list structure</span>
<a name="ln-3071"></a><span class="c">!</span>
<a name="ln-3072"></a><span class="c">!&gt; @date 12/09/14 MDG 1.0 new routine</span>
<a name="ln-3073"></a><span class="c">!&gt; @date 08/18/15 MDG 1.1 added options for all seven representations</span>
<a name="ln-3074"></a><span class="c">!&gt; @date 01/17/15 MDG 1.2 added gridtype option</span>
<a name="ln-3075"></a><span class="c">!&gt; @date 12/22/16 MDG 1.3 added new sampling mode</span>
<a name="ln-3076"></a><span class="c">!&gt; @date 02/01/17 MDG 1.4 added conical sampling mode</span>
<a name="ln-3077"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3078"></a><span class="k">recursive subroutine </span><span class="n">GetRFZNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span><span class="n">rfznl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-3079"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetRFZNameList</span>
<a name="ln-3080"></a>
<a name="ln-3081"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-3082"></a>
<a name="ln-3083"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-3084"></a>
<a name="ln-3085"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-3086"></a><span class="k">type</span><span class="p">(</span><span class="n">RFZNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">rfznl</span>
<a name="ln-3087"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-3088"></a>
<a name="ln-3089"></a><span class="kt">logical</span>                                         <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-3090"></a>
<a name="ln-3091"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                               <span class="kd">::</span> <span class="n">pgnum</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">gridtype</span>
<a name="ln-3092"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">rodrigues</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">maxmisor</span><span class="p">,</span> <span class="n">conevector</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">semiconeangle</span>
<a name="ln-3093"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">samplemode</span>
<a name="ln-3094"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">euoutname</span>
<a name="ln-3095"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">cuoutname</span>
<a name="ln-3096"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">hooutname</span>
<a name="ln-3097"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">rooutname</span>
<a name="ln-3098"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">quoutname</span>
<a name="ln-3099"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">omoutname</span>
<a name="ln-3100"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">axoutname</span>
<a name="ln-3101"></a>
<a name="ln-3102"></a><span class="c">! namelist components</span>
<a name="ln-3103"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">RFZlist</span> <span class="o">/</span> <span class="n">pgnum</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">,</span> <span class="n">euoutname</span><span class="p">,</span> <span class="n">cuoutname</span><span class="p">,</span> <span class="n">hooutname</span><span class="p">,</span> <span class="n">rooutname</span><span class="p">,</span> <span class="n">quoutname</span><span class="p">,</span> <span class="n">omoutname</span><span class="p">,</span> <span class="n">axoutname</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3104"></a>                     <span class="n">samplemode</span><span class="p">,</span> <span class="n">rodrigues</span><span class="p">,</span> <span class="n">maxmisor</span><span class="p">,</span> <span class="n">conevector</span><span class="p">,</span> <span class="n">semiconeangle</span>
<a name="ln-3105"></a>
<a name="ln-3106"></a><span class="c">! initialize to default values</span>
<a name="ln-3107"></a><span class="n">pgnum</span> <span class="o">=</span> <span class="mi">32</span>
<a name="ln-3108"></a><span class="n">nsteps</span> <span class="o">=</span> <span class="mi">50</span>
<a name="ln-3109"></a><span class="n">gridtype</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3110"></a><span class="n">rodrigues</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>  <span class="c">! initialize as the identity rotation</span>
<a name="ln-3111"></a><span class="n">maxmisor</span> <span class="o">=</span> <span class="mf">5.D0</span>                           <span class="c">! in degrees</span>
<a name="ln-3112"></a><span class="n">samplemode</span> <span class="o">=</span> <span class="s1">&#39;RFZ&#39;</span>                        <span class="c">! or &#39;MIS&#39; for sampling inside a ball with constant misorientation w.r.t. rodrigues</span>
<a name="ln-3113"></a><span class="c">! or &#39;CON&#39; for conical sampling around a unitvector for a cone with semi opening angle semiconangle</span>
<a name="ln-3114"></a><span class="n">conevector</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">1.D0</span> <span class="o">/</span><span class="p">)</span>       <span class="c">! default unit vector for cone axis</span>
<a name="ln-3115"></a><span class="n">semiconeangle</span> <span class="o">=</span> <span class="mf">2.0</span>                       <span class="c">! default opening semi-angle (in degrees)</span>
<a name="ln-3116"></a><span class="n">euoutname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3117"></a><span class="n">cuoutname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3118"></a><span class="n">hooutname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3119"></a><span class="n">rooutname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3120"></a><span class="n">quoutname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3121"></a><span class="n">omoutname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3122"></a><span class="n">axoutname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3123"></a>
<a name="ln-3124"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3125"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3126"></a><span class="k">end if</span>
<a name="ln-3127"></a>
<a name="ln-3128"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3129"></a><span class="c">! read the namelist file</span>
<a name="ln-3130"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-3131"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">RFZlist</span><span class="p">)</span>
<a name="ln-3132"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-3133"></a><span class="k">end if</span>
<a name="ln-3134"></a>
<a name="ln-3135"></a><span class="c">! and copy the variables to the rfznl variable</span>
<a name="ln-3136"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">pgnum</span>  <span class="o">=</span> <span class="n">pgnum</span>
<a name="ln-3137"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">nsteps</span> <span class="o">=</span> <span class="n">nsteps</span>
<a name="ln-3138"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">gridtype</span> <span class="o">=</span> <span class="n">gridtype</span>
<a name="ln-3139"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">rodrigues</span> <span class="o">=</span> <span class="n">rodrigues</span>
<a name="ln-3140"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">maxmisor</span> <span class="o">=</span> <span class="n">maxmisor</span>
<a name="ln-3141"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">samplemode</span> <span class="o">=</span> <span class="n">samplemode</span>
<a name="ln-3142"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">conevector</span> <span class="o">=</span> <span class="n">conevector</span>
<a name="ln-3143"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">semiconeangle</span> <span class="o">=</span> <span class="n">semiconeangle</span>
<a name="ln-3144"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">euoutname</span> <span class="o">=</span> <span class="n">euoutname</span>
<a name="ln-3145"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">cuoutname</span> <span class="o">=</span> <span class="n">cuoutname</span>
<a name="ln-3146"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">hooutname</span> <span class="o">=</span> <span class="n">hooutname</span>
<a name="ln-3147"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">rooutname</span> <span class="o">=</span> <span class="n">rooutname</span>
<a name="ln-3148"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">quoutname</span> <span class="o">=</span> <span class="n">quoutname</span>
<a name="ln-3149"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">omoutname</span> <span class="o">=</span> <span class="n">omoutname</span>
<a name="ln-3150"></a><span class="n">rfznl</span><span class="p">%</span><span class="n">axoutname</span> <span class="o">=</span> <span class="n">axoutname</span>
<a name="ln-3151"></a>
<a name="ln-3152"></a><span class="k">end subroutine </span><span class="n">GetRFZNameList</span>
<a name="ln-3153"></a>
<a name="ln-3154"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3155"></a><span class="c">!</span>
<a name="ln-3156"></a><span class="c">! SUBROUTINE:GetDictIndxOpenCLNameList</span>
<a name="ln-3157"></a><span class="c">!</span>
<a name="ln-3158"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-3159"></a><span class="c">!</span>
<a name="ln-3160"></a><span class="c">!&gt; @brief read namelist file and fill DictIndxOpenCLListType (used by EMDictIndxOpenCL.f90)</span>
<a name="ln-3161"></a><span class="c">!</span>
<a name="ln-3162"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-3163"></a><span class="c">!&gt; @param DictIndxOpenCL name list structure</span>
<a name="ln-3164"></a><span class="c">!</span>
<a name="ln-3165"></a><span class="c">!&gt; @date 13/01/15 SS 1.0 new routine</span>
<a name="ln-3166"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3167"></a><span class="k">recursive subroutine </span><span class="n">GetDictIndxOpenCLNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span><span class="n">dictindxnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-3168"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetDictIndxOpenCLNameList</span>
<a name="ln-3169"></a>
<a name="ln-3170"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-3171"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-3172"></a>
<a name="ln-3173"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-3174"></a>
<a name="ln-3175"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-3176"></a><span class="k">type</span><span class="p">(</span><span class="n">DictIndxOpenCLListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">dictindxnl</span>
<a name="ln-3177"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-3178"></a>
<a name="ln-3179"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-3180"></a>
<a name="ln-3181"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                           <span class="kd">::</span> <span class="n">numexptsingle</span>
<a name="ln-3182"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                           <span class="kd">::</span> <span class="n">numdictsingle</span>
<a name="ln-3183"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                           <span class="kd">::</span> <span class="n">totnumexpt</span>
<a name="ln-3184"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                           <span class="kd">::</span> <span class="n">totnumdict</span>
<a name="ln-3185"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                           <span class="kd">::</span> <span class="n">imght</span>
<a name="ln-3186"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                           <span class="kd">::</span> <span class="n">imgwd</span>
<a name="ln-3187"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                           <span class="kd">::</span> <span class="n">nnk</span>
<a name="ln-3188"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                            <span class="kd">::</span> <span class="n">exptfile</span>
<a name="ln-3189"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                            <span class="kd">::</span> <span class="n">dictfile</span>
<a name="ln-3190"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                            <span class="kd">::</span> <span class="n">eulerfile</span>
<a name="ln-3191"></a><span class="kt">logical</span>                                                     <span class="kd">::</span> <span class="n">MeanSubtraction</span>
<a name="ln-3192"></a><span class="kt">logical</span>                                                     <span class="kd">::</span> <span class="n">patternflip</span>
<a name="ln-3193"></a>
<a name="ln-3194"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-3195"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">DictIndxOpenCLvars</span><span class="o">/</span> <span class="n">numexptsingle</span><span class="p">,</span> <span class="n">numdictsingle</span><span class="p">,</span> <span class="n">totnumexpt</span><span class="p">,</span> <span class="n">totnumdict</span><span class="p">,&amp;</span>
<a name="ln-3196"></a>        <span class="n">imght</span><span class="p">,</span> <span class="n">imgwd</span><span class="p">,</span> <span class="n">exptfile</span><span class="p">,</span> <span class="n">dictfile</span><span class="p">,</span> <span class="n">eulerfile</span><span class="p">,</span> <span class="n">nnk</span><span class="p">,</span> <span class="n">MeanSubtraction</span><span class="p">,</span> <span class="n">patternflip</span>
<a name="ln-3197"></a>
<a name="ln-3198"></a><span class="c">! set some of the input parameters to default values </span>
<a name="ln-3199"></a><span class="n">numdictsingle</span> <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3200"></a><span class="n">numexptsingle</span> <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3201"></a><span class="n">imght</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3202"></a><span class="n">imgwd</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3203"></a><span class="n">nnk</span> <span class="o">=</span> <span class="mi">40</span>
<a name="ln-3204"></a><span class="n">exptfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3205"></a><span class="n">dictfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3206"></a><span class="n">eulerfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3207"></a><span class="n">totnumdict</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3208"></a><span class="n">totnumexpt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3209"></a><span class="n">MeanSubtraction</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3210"></a><span class="n">patternflip</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3211"></a>
<a name="ln-3212"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3213"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3214"></a><span class="k">end if</span>
<a name="ln-3215"></a>
<a name="ln-3216"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3217"></a><span class="c">! read the namelist file</span>
<a name="ln-3218"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-3219"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">DictIndxOpenCLvars</span><span class="p">)</span>
<a name="ln-3220"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-3221"></a>
<a name="ln-3222"></a><span class="c">! check for required entries</span>
<a name="ln-3223"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">exptfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3224"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDictIndxOpenCL:&#39;</span><span class="p">,</span><span class="s1">&#39; experimental file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3225"></a><span class="k">end if</span>
<a name="ln-3226"></a>
<a name="ln-3227"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dictfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3228"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDictIndxOpenCL:&#39;</span><span class="p">,</span><span class="s1">&#39; dictionary file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3229"></a><span class="k">end if</span>
<a name="ln-3230"></a>
<a name="ln-3231"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">eulerfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3232"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDictIndxOpenCL:&#39;</span><span class="p">,</span><span class="s1">&#39; euler angle file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3233"></a><span class="k">end if</span>
<a name="ln-3234"></a>
<a name="ln-3235"></a><span class="k">if</span> <span class="p">(</span><span class="n">totnumexpt</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3236"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDictIndxOpenCL:&#39;</span><span class="p">,</span><span class="s1">&#39; total number of experimental patterns is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3237"></a><span class="k">end if</span>
<a name="ln-3238"></a>
<a name="ln-3239"></a><span class="k">if</span> <span class="p">(</span><span class="n">totnumdict</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3240"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDictIndxOpenCL:&#39;</span><span class="p">,</span><span class="s1">&#39; total number of dictionary patterns is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3241"></a><span class="k">end if</span>
<a name="ln-3242"></a>
<a name="ln-3243"></a><span class="k">if</span> <span class="p">(</span><span class="n">imght</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3244"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDictIndxOpenCL:&#39;</span><span class="p">,</span><span class="s1">&#39; height of single pattern is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3245"></a><span class="k">end if</span>
<a name="ln-3246"></a>
<a name="ln-3247"></a><span class="k">if</span> <span class="p">(</span><span class="n">imgwd</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3248"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDictIndxOpenCL:&#39;</span><span class="p">,</span><span class="s1">&#39; width of single pattern is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3249"></a><span class="k">end if</span>
<a name="ln-3250"></a><span class="k">end if</span>
<a name="ln-3251"></a>
<a name="ln-3252"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-3253"></a>
<a name="ln-3254"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">numexptsingle</span> <span class="o">=</span> <span class="n">numexptsingle</span>
<a name="ln-3255"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">numdictsingle</span> <span class="o">=</span> <span class="n">numdictsingle</span>
<a name="ln-3256"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">imght</span> <span class="o">=</span> <span class="n">imght</span>
<a name="ln-3257"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">imgwd</span> <span class="o">=</span> <span class="n">imgwd</span>
<a name="ln-3258"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">exptfile</span> <span class="o">=</span> <span class="n">exptfile</span>
<a name="ln-3259"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">dictfile</span> <span class="o">=</span> <span class="n">dictfile</span>
<a name="ln-3260"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">eulerfile</span> <span class="o">=</span> <span class="n">eulerfile</span>
<a name="ln-3261"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">totnumdict</span> <span class="o">=</span> <span class="n">totnumdict</span>
<a name="ln-3262"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">totnumexpt</span> <span class="o">=</span> <span class="n">totnumexpt</span>
<a name="ln-3263"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">nnk</span> <span class="o">=</span> <span class="n">nnk</span>
<a name="ln-3264"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">MeanSubtraction</span> <span class="o">=</span> <span class="n">MeanSubtraction</span>
<a name="ln-3265"></a><span class="n">dictindxnl</span><span class="p">%</span><span class="n">patternflip</span> <span class="o">=</span> <span class="n">patternflip</span>
<a name="ln-3266"></a>
<a name="ln-3267"></a><span class="k">end subroutine </span><span class="n">GetDictIndxOpenCLNameList</span>
<a name="ln-3268"></a>
<a name="ln-3269"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3270"></a><span class="c">!</span>
<a name="ln-3271"></a><span class="c">! SUBROUTINE:GetPEDIndxNameList</span>
<a name="ln-3272"></a><span class="c">!</span>
<a name="ln-3273"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-3274"></a><span class="c">!</span>
<a name="ln-3275"></a><span class="c">!&gt; @brief read namelist file and fill PEDKINIndxListType (used by EMPEDIndexing.f90)</span>
<a name="ln-3276"></a><span class="c">!</span>
<a name="ln-3277"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-3278"></a><span class="c">!&gt; @param pednl PEDKINIndx name list structure</span>
<a name="ln-3279"></a><span class="c">!</span>
<a name="ln-3280"></a><span class="c">!&gt; @date 13/01/15 SS 1.0 new routine</span>
<a name="ln-3281"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3282"></a><span class="k">recursive subroutine </span><span class="n">GetPEDIndxNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span><span class="n">pednl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-3283"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetPEDIndxNameList</span>
<a name="ln-3284"></a>
<a name="ln-3285"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-3286"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-3287"></a>
<a name="ln-3288"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-3289"></a>
<a name="ln-3290"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-3291"></a><span class="k">type</span><span class="p">(</span><span class="n">PEDKINIndxListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">pednl</span>
<a name="ln-3292"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-3293"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-3294"></a>
<a name="ln-3295"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-3296"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">ncubochoric</span>
<a name="ln-3297"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-3298"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-3299"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">thickness</span>
<a name="ln-3300"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">rnmpp</span> <span class="c">! reciprocal nanometers per pixel</span>
<a name="ln-3301"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-3302"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">numexptsingle</span>
<a name="ln-3303"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">numdictsingle</span>
<a name="ln-3304"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">ipf_ht</span>
<a name="ln-3305"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">ipf_wd</span>
<a name="ln-3306"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nnk</span>
<a name="ln-3307"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">sgmax</span> <span class="c">! maximum sg value for a beam to be considered</span>
<a name="ln-3308"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">ww</span> <span class="c">! 2*ww+1 is the size of the spot</span>
<a name="ln-3309"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">var</span> <span class="c">! variance of gaussian peak</span>
<a name="ln-3310"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">exptfile</span>
<a name="ln-3311"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-3312"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">ctffile</span>
<a name="ln-3313"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-3314"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-3315"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-3316"></a>
<a name="ln-3317"></a>
<a name="ln-3318"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-3319"></a><span class="k">namelist</span> <span class="o">/</span><span class="n">inputlist</span><span class="o">/</span> <span class="n">npix</span><span class="p">,</span> <span class="n">ncubochoric</span><span class="p">,</span> <span class="n">numexptsingle</span><span class="p">,</span> <span class="n">numdictsingle</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">rnmpp</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3320"></a><span class="n">exptfile</span><span class="p">,</span> <span class="n">nnk</span><span class="p">,</span> <span class="n">ipf_ht</span><span class="p">,</span> <span class="n">ipf_wd</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">sgmax</span><span class="p">,</span> <span class="n">ww</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">ctffile</span>
<a name="ln-3321"></a>
<a name="ln-3322"></a><span class="c">! set some of the input parameters to default values</span>
<a name="ln-3323"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3324"></a><span class="n">ncubochoric</span> <span class="o">=</span> <span class="mi">50</span>
<a name="ln-3325"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">20000</span><span class="mf">0.0</span>
<a name="ln-3326"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.04</span>
<a name="ln-3327"></a><span class="n">thickness</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">0.0</span>
<a name="ln-3328"></a><span class="n">rnmpp</span> <span class="o">=</span> <span class="mf">0.20</span>
<a name="ln-3329"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3330"></a><span class="n">numdictsingle</span> <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3331"></a><span class="n">numexptsingle</span> <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3332"></a><span class="n">nnk</span> <span class="o">=</span> <span class="mi">40</span>
<a name="ln-3333"></a><span class="n">exptfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3334"></a><span class="n">datafile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3335"></a><span class="n">ctffile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3336"></a><span class="n">sgmax</span> <span class="o">=</span> <span class="mf">0.50</span>
<a name="ln-3337"></a><span class="n">ww</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-3338"></a><span class="n">var</span> <span class="o">=</span> <span class="mf">0.0020</span>
<a name="ln-3339"></a><span class="n">ipf_ht</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3340"></a><span class="n">ipf_wd</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3341"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3342"></a><span class="n">platid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3343"></a><span class="n">devid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3344"></a>
<a name="ln-3345"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3346"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3347"></a><span class="k">end if</span>
<a name="ln-3348"></a>
<a name="ln-3349"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3350"></a><span class="c">! read the namelist file</span>
<a name="ln-3351"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-3352"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">inputlist</span><span class="p">)</span>
<a name="ln-3353"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-3354"></a>
<a name="ln-3355"></a><span class="c">! check for required entries</span>
<a name="ln-3356"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">npix</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3357"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMPEDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; size of dictionary pattern not specified or set to 0 in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3358"></a>    <span class="k">end if</span>
<a name="ln-3359"></a>
<a name="ln-3360"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3361"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMPEDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; crystal file undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3362"></a>    <span class="k">end if</span>
<a name="ln-3363"></a>
<a name="ln-3364"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">exptfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3365"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMPEDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; experimental file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3366"></a>    <span class="k">end if</span>
<a name="ln-3367"></a>
<a name="ln-3368"></a>
<a name="ln-3369"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ipf_ht</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3370"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMPEDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; total number of experimental patterns is either set to 0 or is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3371"></a>    <span class="k">end if</span>
<a name="ln-3372"></a>
<a name="ln-3373"></a><span class="k">    if</span> <span class="p">(</span><span class="n">ipf_wd</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3374"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMPEDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; total number of experimental patterns is either set to 0 or is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3375"></a>    <span class="k">end if</span>
<a name="ln-3376"></a>
<a name="ln-3377"></a>
<a name="ln-3378"></a><span class="k">end if</span>
<a name="ln-3379"></a>
<a name="ln-3380"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-3381"></a><span class="n">pednl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-3382"></a><span class="n">pednl</span><span class="p">%</span><span class="n">ncubochoric</span> <span class="o">=</span> <span class="n">ncubochoric</span>
<a name="ln-3383"></a><span class="n">pednl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-3384"></a><span class="n">pednl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-3385"></a><span class="n">pednl</span><span class="p">%</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">thickness</span>
<a name="ln-3386"></a><span class="n">pednl</span><span class="p">%</span><span class="n">rnmpp</span> <span class="o">=</span> <span class="n">rnmpp</span>
<a name="ln-3387"></a><span class="n">pednl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-3388"></a><span class="n">pednl</span><span class="p">%</span><span class="n">numexptsingle</span> <span class="o">=</span> <span class="n">numexptsingle</span>
<a name="ln-3389"></a><span class="n">pednl</span><span class="p">%</span><span class="n">numdictsingle</span> <span class="o">=</span> <span class="n">numdictsingle</span>
<a name="ln-3390"></a><span class="n">pednl</span><span class="p">%</span><span class="n">exptfile</span> <span class="o">=</span> <span class="n">exptfile</span>
<a name="ln-3391"></a><span class="n">pednl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-3392"></a><span class="n">pednl</span><span class="p">%</span><span class="n">ctffile</span> <span class="o">=</span> <span class="n">ctffile</span> 
<a name="ln-3393"></a><span class="n">pednl</span><span class="p">%</span><span class="n">nnk</span> <span class="o">=</span> <span class="n">nnk</span>
<a name="ln-3394"></a><span class="n">pednl</span><span class="p">%</span><span class="n">sgmax</span> <span class="o">=</span> <span class="n">sgmax</span>
<a name="ln-3395"></a><span class="n">pednl</span><span class="p">%</span><span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span>
<a name="ln-3396"></a><span class="n">pednl</span><span class="p">%</span><span class="n">var</span> <span class="o">=</span> <span class="n">var</span>
<a name="ln-3397"></a><span class="n">pednl</span><span class="p">%</span><span class="n">ipf_ht</span> <span class="o">=</span> <span class="n">ipf_ht</span>
<a name="ln-3398"></a><span class="n">pednl</span><span class="p">%</span><span class="n">ipf_wd</span> <span class="o">=</span> <span class="n">ipf_wd</span>
<a name="ln-3399"></a><span class="n">pednl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-3400"></a><span class="n">pednl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>
<a name="ln-3401"></a><span class="n">pednl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>
<a name="ln-3402"></a>
<a name="ln-3403"></a><span class="k">end subroutine </span><span class="n">GetPEDIndxNameList</span>
<a name="ln-3404"></a>
<a name="ln-3405"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3406"></a><span class="c">!</span>
<a name="ln-3407"></a><span class="c">! SUBROUTINE:GetEBSDIndxNameList</span>
<a name="ln-3408"></a><span class="c">!</span>
<a name="ln-3409"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-3410"></a><span class="c">!</span>
<a name="ln-3411"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMDynamicEBSDIndeixing.f90)</span>
<a name="ln-3412"></a><span class="c">!</span>
<a name="ln-3413"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-3414"></a><span class="c">!&gt; @param enl EBSD indexing name list structure</span>
<a name="ln-3415"></a><span class="c">!</span>
<a name="ln-3416"></a><span class="c">!&gt; @date 06/10/15  SS 1.0 new routine</span>
<a name="ln-3417"></a><span class="c">!&gt; @date 11/19/15  SS 1.1 added new variables</span>
<a name="ln-3418"></a><span class="c">!&gt; @date 01/26/16  SS 1.2 adjusted for EBSDIndexing</span>
<a name="ln-3419"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3420"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDIndexingNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-3421"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDIndexingNameList</span>
<a name="ln-3422"></a>
<a name="ln-3423"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-3424"></a>
<a name="ln-3425"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-3426"></a>
<a name="ln-3427"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-3428"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDIndexingNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-3429"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-3430"></a>
<a name="ln-3431"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-3432"></a>
<a name="ln-3433"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-3434"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsy</span>
<a name="ln-3435"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">binning</span>
<a name="ln-3436"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">energyaverage</span>
<a name="ln-3437"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-3438"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-3439"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nregions</span>
<a name="ln-3440"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">L</span>
<a name="ln-3441"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-3442"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-3443"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">xpc</span>
<a name="ln-3444"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">ypc</span>
<a name="ln-3445"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-3446"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">beamcurrent</span>
<a name="ln-3447"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">dwelltime</span>
<a name="ln-3448"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">hipassw</span>
<a name="ln-3449"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-3450"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">stepX</span>
<a name="ln-3451"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">stepY</span>
<a name="ln-3452"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-3453"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-3454"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">scalingmode</span>
<a name="ln-3455"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-3456"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-3457"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">energymin</span>
<a name="ln-3458"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">energymax</span>
<a name="ln-3459"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">spatialaverage</span>
<a name="ln-3460"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">tmpfile</span>
<a name="ln-3461"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-3462"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">ctffile</span>
<a name="ln-3463"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">avctffile</span>
<a name="ln-3464"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">angfile</span>
<a name="ln-3465"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">eulerfile</span>
<a name="ln-3466"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">ncubochoric</span>
<a name="ln-3467"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numexptsingle</span>
<a name="ln-3468"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numdictsingle</span>
<a name="ln-3469"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">ipf_ht</span>
<a name="ln-3470"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">ipf_wd</span>
<a name="ln-3471"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nnk</span>
<a name="ln-3472"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nnav</span>
<a name="ln-3473"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nosm</span>
<a name="ln-3474"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">maskradius</span>
<a name="ln-3475"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile</span>
<a name="ln-3476"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">dictfile</span>
<a name="ln-3477"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">indexingmode</span>
<a name="ln-3478"></a>
<a name="ln-3479"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-3480"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">EBSDIndexingdata</span> <span class="o">/</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">numsy</span><span class="p">,</span> <span class="n">xpc</span><span class="p">,</span> <span class="n">ypc</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3481"></a><span class="n">beamcurrent</span><span class="p">,</span> <span class="n">dwelltime</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">energymin</span><span class="p">,</span> <span class="n">spatialaverage</span><span class="p">,</span> <span class="n">nregions</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3482"></a><span class="n">scalingmode</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">energyaverage</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">energymax</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">angfile</span><span class="p">,</span> <span class="n">ctffile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3483"></a><span class="n">ncubochoric</span><span class="p">,</span> <span class="n">numexptsingle</span><span class="p">,</span> <span class="n">numdictsingle</span><span class="p">,</span> <span class="n">ipf_ht</span><span class="p">,</span> <span class="n">ipf_wd</span><span class="p">,</span> <span class="n">nnk</span><span class="p">,</span> <span class="n">nnav</span><span class="p">,</span> <span class="n">exptfile</span><span class="p">,</span> <span class="n">maskradius</span><span class="p">,&amp;</span>
<a name="ln-3484"></a><span class="n">dictfile</span><span class="p">,</span> <span class="n">indexingmode</span><span class="p">,</span> <span class="n">hipassw</span><span class="p">,</span> <span class="n">stepX</span><span class="p">,</span> <span class="n">stepY</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">,</span> <span class="n">avctffile</span><span class="p">,</span> <span class="n">nosm</span><span class="p">,</span> <span class="n">eulerfile</span>
<a name="ln-3485"></a>
<a name="ln-3486"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-3487"></a><span class="n">ncubochoric</span>     <span class="o">=</span> <span class="mi">50</span>
<a name="ln-3488"></a><span class="n">numexptsingle</span>   <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3489"></a><span class="n">numdictsingle</span>   <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3490"></a><span class="n">platid</span>          <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3491"></a><span class="n">devid</span>           <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3492"></a><span class="n">nregions</span>        <span class="o">=</span> <span class="mi">10</span>
<a name="ln-3493"></a><span class="n">nnk</span>             <span class="o">=</span> <span class="mi">50</span>
<a name="ln-3494"></a><span class="n">nnav</span>            <span class="o">=</span> <span class="mi">20</span>
<a name="ln-3495"></a><span class="n">nosm</span>            <span class="o">=</span> <span class="mi">20</span>
<a name="ln-3496"></a><span class="n">exptfile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3497"></a><span class="n">numsx</span>           <span class="o">=</span> <span class="mi">640</span>           <span class="c">! [dimensionless]</span>
<a name="ln-3498"></a><span class="n">numsy</span>           <span class="o">=</span> <span class="mi">480</span>           <span class="c">! [dimensionless]</span>
<a name="ln-3499"></a><span class="n">maskradius</span>      <span class="o">=</span> <span class="mi">240</span>
<a name="ln-3500"></a><span class="n">binning</span>         <span class="o">=</span> <span class="mi">1</span>             <span class="c">! binning mode  (1, 2, 4, or 8)</span>
<a name="ln-3501"></a><span class="n">L</span>               <span class="o">=</span> <span class="mi">2000</span><span class="mf">0.0</span>       <span class="c">! [microns]</span>
<a name="ln-3502"></a><span class="n">energyaverage</span>   <span class="o">=</span> <span class="mi">1</span>             <span class="c">! apply energy averaging (1) or not (0); useful for dictionary computations</span>
<a name="ln-3503"></a><span class="n">thetac</span>          <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [degrees]</span>
<a name="ln-3504"></a><span class="n">delta</span>           <span class="o">=</span> <span class="mi">2</span><span class="mf">5.0</span>          <span class="c">! [microns]</span>
<a name="ln-3505"></a><span class="n">xpc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-3506"></a><span class="n">ypc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-3507"></a><span class="n">gammavalue</span>      <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! gamma factor</span>
<a name="ln-3508"></a><span class="n">beamcurrent</span>     <span class="o">=</span> <span class="mi">1</span><span class="mf">4.513D0</span>      <span class="c">! beam current (actually emission current) in nano ampere</span>
<a name="ln-3509"></a><span class="n">dwelltime</span>       <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0D0</span>       <span class="c">! in microseconds</span>
<a name="ln-3510"></a><span class="n">hipassw</span>         <span class="o">=</span> <span class="mf">0.05D0</span>        <span class="c">! hi pass inverted Gaussian mask parameter</span>
<a name="ln-3511"></a><span class="n">stepX</span>           <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! sampling step size along X</span>
<a name="ln-3512"></a><span class="n">stepY</span>           <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! sampling step size along Y</span>
<a name="ln-3513"></a><span class="n">maskpattern</span>     <span class="o">=</span> <span class="s1">&#39;n&#39;</span>           <span class="c">! &#39;y&#39; or &#39;n&#39; to include a circular mask</span>
<a name="ln-3514"></a><span class="n">scalingmode</span>     <span class="o">=</span> <span class="s1">&#39;not&#39;</span>         <span class="c">! intensity selector (&#39;lin&#39;, &#39;gam&#39;, or &#39;not&#39;)</span>
<a name="ln-3515"></a><span class="n">masterfile</span>      <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-3516"></a><span class="n">dotproductfile</span>  <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3517"></a><span class="n">energymin</span>       <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>
<a name="ln-3518"></a><span class="n">energymax</span>       <span class="o">=</span> <span class="mi">2</span><span class="mf">0.0</span>
<a name="ln-3519"></a><span class="n">ipf_ht</span>          <span class="o">=</span> <span class="mi">100</span>
<a name="ln-3520"></a><span class="n">ipf_wd</span>          <span class="o">=</span> <span class="mi">100</span>
<a name="ln-3521"></a><span class="n">nthreads</span>        <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3522"></a><span class="n">spatialaverage</span>  <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<a name="ln-3523"></a><span class="n">datafile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3524"></a><span class="n">ctffile</span>         <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3525"></a><span class="n">avctffile</span>       <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3526"></a><span class="n">angfile</span>         <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3527"></a><span class="n">eulerfile</span>       <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3528"></a><span class="n">omega</span>           <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-3529"></a><span class="n">tmpfile</span>         <span class="o">=</span> <span class="s1">&#39;EMEBSDDict_tmp.data&#39;</span>
<a name="ln-3530"></a><span class="n">dictfile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3531"></a><span class="n">indexingmode</span>    <span class="o">=</span> <span class="s1">&#39;dynamic&#39;</span>
<a name="ln-3532"></a>
<a name="ln-3533"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3534"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3535"></a><span class="k">end if</span>
<a name="ln-3536"></a>
<a name="ln-3537"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3538"></a><span class="c">! read the namelist file</span>
<a name="ln-3539"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-3540"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDIndexingdata</span><span class="p">)</span>
<a name="ln-3541"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-3542"></a>
<a name="ln-3543"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3544"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dictfile</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3545"></a><span class="k">            call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; dictionary file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3546"></a>        <span class="k">end if</span>
<a name="ln-3547"></a><span class="k">    end if</span>
<a name="ln-3548"></a>        
<a name="ln-3549"></a>
<a name="ln-3550"></a><span class="c">! check for required entries</span>
<a name="ln-3551"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3552"></a><span class="k">        </span>
<a name="ln-3553"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3554"></a><span class="k">            call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3555"></a>        <span class="k">end if</span>
<a name="ln-3556"></a>
<a name="ln-3557"></a><span class="k">    end if</span>
<a name="ln-3558"></a>
<a name="ln-3559"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">exptfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3560"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; experimental file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3561"></a>    <span class="k">end if</span>
<a name="ln-3562"></a>
<a name="ln-3563"></a>
<a name="ln-3564"></a><span class="k">end if</span>
<a name="ln-3565"></a>
<a name="ln-3566"></a>
<a name="ln-3567"></a>
<a name="ln-3568"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the enl fields</span>
<a name="ln-3569"></a>
<a name="ln-3570"></a><span class="n">enl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>
<a name="ln-3571"></a><span class="n">enl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>
<a name="ln-3572"></a><span class="n">enl</span><span class="p">%</span><span class="n">nregions</span> <span class="o">=</span> <span class="n">nregions</span>
<a name="ln-3573"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>
<a name="ln-3574"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile</span> <span class="o">=</span> <span class="n">exptfile</span>
<a name="ln-3575"></a><span class="n">enl</span><span class="p">%</span><span class="n">nnk</span> <span class="o">=</span> <span class="n">nnk</span>
<a name="ln-3576"></a><span class="n">enl</span><span class="p">%</span><span class="n">nnav</span> <span class="o">=</span> <span class="n">nnav</span>
<a name="ln-3577"></a><span class="n">enl</span><span class="p">%</span><span class="n">nosm</span> <span class="o">=</span> <span class="n">nosm</span>
<a name="ln-3578"></a><span class="n">enl</span><span class="p">%</span><span class="n">ipf_ht</span> <span class="o">=</span> <span class="n">ipf_ht</span>
<a name="ln-3579"></a><span class="n">enl</span><span class="p">%</span><span class="n">ipf_wd</span> <span class="o">=</span> <span class="n">ipf_wd</span>
<a name="ln-3580"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-3581"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-3582"></a><span class="n">enl</span><span class="p">%</span><span class="n">tmpfile</span> <span class="o">=</span> <span class="n">tmpfile</span>
<a name="ln-3583"></a><span class="n">enl</span><span class="p">%</span><span class="n">ctffile</span> <span class="o">=</span> <span class="n">ctffile</span>
<a name="ln-3584"></a><span class="n">enl</span><span class="p">%</span><span class="n">avctffile</span> <span class="o">=</span> <span class="n">avctffile</span>
<a name="ln-3585"></a><span class="n">enl</span><span class="p">%</span><span class="n">angfile</span> <span class="o">=</span> <span class="n">angfile</span>
<a name="ln-3586"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerfile</span> <span class="o">=</span> <span class="n">eulerfile</span>
<a name="ln-3587"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskradius</span> <span class="o">=</span> <span class="n">maskradius</span>
<a name="ln-3588"></a><span class="n">enl</span><span class="p">%</span><span class="n">numdictsingle</span> <span class="o">=</span> <span class="n">numdictsingle</span>
<a name="ln-3589"></a><span class="n">enl</span><span class="p">%</span><span class="n">numexptsingle</span> <span class="o">=</span> <span class="n">numexptsingle</span>
<a name="ln-3590"></a><span class="n">enl</span><span class="p">%</span><span class="n">hipassw</span> <span class="o">=</span> <span class="n">hipassw</span>
<a name="ln-3591"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span>
<a name="ln-3592"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span>
<a name="ln-3593"></a><span class="n">enl</span><span class="p">%</span><span class="n">StepX</span> <span class="o">=</span> <span class="n">stepX</span>
<a name="ln-3594"></a><span class="n">enl</span><span class="p">%</span><span class="n">StepY</span> <span class="o">=</span> <span class="n">stepY</span>
<a name="ln-3595"></a><span class="n">enl</span><span class="p">%</span><span class="n">indexingmode</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span>
<a name="ln-3596"></a>
<a name="ln-3597"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3598"></a><span class="k">    </span><span class="n">enl</span><span class="p">%</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
<a name="ln-3599"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-3600"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">numsy</span> <span class="o">=</span> <span class="n">numsy</span>
<a name="ln-3601"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span>
<a name="ln-3602"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">energyaverage</span> <span class="o">=</span> <span class="n">energyaverage</span>
<a name="ln-3603"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-3604"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>
<a name="ln-3605"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">xpc</span> <span class="o">=</span> <span class="n">xpc</span>
<a name="ln-3606"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">ypc</span> <span class="o">=</span> <span class="n">ypc</span>
<a name="ln-3607"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-3608"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">beamcurrent</span> <span class="o">=</span> <span class="n">beamcurrent</span>
<a name="ln-3609"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">dwelltime</span> <span class="o">=</span> <span class="n">dwelltime</span>
<a name="ln-3610"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">scalingmode</span> <span class="o">=</span> <span class="n">scalingmode</span>
<a name="ln-3611"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">ncubochoric</span> <span class="o">=</span> <span class="n">ncubochoric</span>
<a name="ln-3612"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-3613"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">energymin</span> <span class="o">=</span> <span class="n">energymin</span>
<a name="ln-3614"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">energymax</span> <span class="o">=</span> <span class="n">energymax</span>
<a name="ln-3615"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">spatialaverage</span> <span class="o">=</span> <span class="n">spatialaverage</span>
<a name="ln-3616"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">dictfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3617"></a><span class="k">else if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3618"></a><span class="k">    </span><span class="n">enl</span><span class="p">%</span><span class="n">dictfile</span> <span class="o">=</span> <span class="n">dictfile</span>
<a name="ln-3619"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">ncubochoric</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3620"></a><span class="k">else</span>
<a name="ln-3621"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; indexingmode is not known in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3622"></a><span class="k">end if</span>
<a name="ln-3623"></a>
<a name="ln-3624"></a><span class="k">end subroutine </span><span class="n">GetEBSDIndexingNameList</span>
<a name="ln-3625"></a>
<a name="ln-3626"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3627"></a><span class="c">!</span>
<a name="ln-3628"></a><span class="c">! SUBROUTINE:GetTKDIndexingNameList</span>
<a name="ln-3629"></a><span class="c">!</span>
<a name="ln-3630"></a><span class="c">!&gt; @author Marc De Graef , Carnegie Mellon University</span>
<a name="ln-3631"></a><span class="c">!</span>
<a name="ln-3632"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMTKDDI.f90)</span>
<a name="ln-3633"></a><span class="c">!</span>
<a name="ln-3634"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-3635"></a><span class="c">!&gt; @param enl TKD indexing name list structure</span>
<a name="ln-3636"></a><span class="c">!</span>
<a name="ln-3637"></a><span class="c">!&gt; @date 05/07/17 MDG 1.0 new routine, based on EBSD routine</span>
<a name="ln-3638"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3639"></a><span class="k">recursive subroutine </span><span class="n">GetTKDIndexingNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-3640"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetTKDIndexingNameList</span>
<a name="ln-3641"></a>
<a name="ln-3642"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-3643"></a>
<a name="ln-3644"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-3645"></a>
<a name="ln-3646"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-3647"></a><span class="k">type</span><span class="p">(</span><span class="n">TKDIndexingNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-3648"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-3649"></a>
<a name="ln-3650"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-3651"></a>
<a name="ln-3652"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-3653"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsy</span>
<a name="ln-3654"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">binning</span>
<a name="ln-3655"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">energyaverage</span>
<a name="ln-3656"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-3657"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-3658"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nregions</span>
<a name="ln-3659"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">L</span>
<a name="ln-3660"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-3661"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-3662"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">xpc</span>
<a name="ln-3663"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">ypc</span>
<a name="ln-3664"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-3665"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">beamcurrent</span>
<a name="ln-3666"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">dwelltime</span>
<a name="ln-3667"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">hipassw</span>
<a name="ln-3668"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-3669"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">stepX</span>
<a name="ln-3670"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">stepY</span>
<a name="ln-3671"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-3672"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-3673"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">scalingmode</span>
<a name="ln-3674"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-3675"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-3676"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">energymin</span>
<a name="ln-3677"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">energymax</span>
<a name="ln-3678"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">spatialaverage</span>
<a name="ln-3679"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">tmpfile</span>
<a name="ln-3680"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-3681"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">ctffile</span>
<a name="ln-3682"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">avctffile</span>
<a name="ln-3683"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">angfile</span>
<a name="ln-3684"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">eulerfile</span>
<a name="ln-3685"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">ncubochoric</span>
<a name="ln-3686"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numexptsingle</span>
<a name="ln-3687"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numdictsingle</span>
<a name="ln-3688"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">ipf_ht</span>
<a name="ln-3689"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">ipf_wd</span>
<a name="ln-3690"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nnk</span>
<a name="ln-3691"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nnav</span>
<a name="ln-3692"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nosm</span>
<a name="ln-3693"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">maskradius</span>
<a name="ln-3694"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile</span>
<a name="ln-3695"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">dictfile</span>
<a name="ln-3696"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">indexingmode</span>
<a name="ln-3697"></a>
<a name="ln-3698"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-3699"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">TKDIndexingdata</span> <span class="o">/</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">numsy</span><span class="p">,</span> <span class="n">xpc</span><span class="p">,</span> <span class="n">ypc</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3700"></a><span class="n">beamcurrent</span><span class="p">,</span> <span class="n">dwelltime</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">energymin</span><span class="p">,</span> <span class="n">spatialaverage</span><span class="p">,</span> <span class="n">nregions</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3701"></a><span class="n">scalingmode</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">energyaverage</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">energymax</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">angfile</span><span class="p">,</span> <span class="n">ctffile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-3702"></a><span class="n">ncubochoric</span><span class="p">,</span> <span class="n">numexptsingle</span><span class="p">,</span> <span class="n">numdictsingle</span><span class="p">,</span> <span class="n">ipf_ht</span><span class="p">,</span> <span class="n">ipf_wd</span><span class="p">,</span> <span class="n">nnk</span><span class="p">,</span> <span class="n">nnav</span><span class="p">,</span> <span class="n">exptfile</span><span class="p">,</span> <span class="n">maskradius</span><span class="p">,&amp;</span>
<a name="ln-3703"></a><span class="n">dictfile</span><span class="p">,</span> <span class="n">indexingmode</span><span class="p">,</span> <span class="n">hipassw</span><span class="p">,</span> <span class="n">stepX</span><span class="p">,</span> <span class="n">stepY</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">,</span> <span class="n">avctffile</span><span class="p">,</span> <span class="n">nosm</span><span class="p">,</span> <span class="n">eulerfile</span>
<a name="ln-3704"></a>
<a name="ln-3705"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-3706"></a><span class="n">ncubochoric</span>     <span class="o">=</span> <span class="mi">50</span>
<a name="ln-3707"></a><span class="n">numexptsingle</span>   <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3708"></a><span class="n">numdictsingle</span>   <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-3709"></a><span class="n">platid</span>          <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3710"></a><span class="n">devid</span>           <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3711"></a><span class="n">nregions</span>        <span class="o">=</span> <span class="mi">10</span>
<a name="ln-3712"></a><span class="n">nnk</span>             <span class="o">=</span> <span class="mi">50</span>
<a name="ln-3713"></a><span class="n">nnav</span>            <span class="o">=</span> <span class="mi">20</span>
<a name="ln-3714"></a><span class="n">nosm</span>            <span class="o">=</span> <span class="mi">20</span>
<a name="ln-3715"></a><span class="n">exptfile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3716"></a><span class="n">numsx</span>           <span class="o">=</span> <span class="mi">640</span>           <span class="c">! [dimensionless]</span>
<a name="ln-3717"></a><span class="n">numsy</span>           <span class="o">=</span> <span class="mi">480</span>           <span class="c">! [dimensionless]</span>
<a name="ln-3718"></a><span class="n">maskradius</span>      <span class="o">=</span> <span class="mi">240</span>
<a name="ln-3719"></a><span class="n">binning</span>         <span class="o">=</span> <span class="mi">1</span>             <span class="c">! binning mode  (1, 2, 4, or 8)</span>
<a name="ln-3720"></a><span class="n">L</span>               <span class="o">=</span> <span class="mi">2000</span><span class="mf">0.0</span>       <span class="c">! [microns]</span>
<a name="ln-3721"></a><span class="n">energyaverage</span>   <span class="o">=</span> <span class="mi">1</span>             <span class="c">! apply energy averaging (1) or not (0); useful for dictionary computations</span>
<a name="ln-3722"></a><span class="n">thetac</span>          <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [degrees]</span>
<a name="ln-3723"></a><span class="n">delta</span>           <span class="o">=</span> <span class="mi">2</span><span class="mf">5.0</span>          <span class="c">! [microns]</span>
<a name="ln-3724"></a><span class="n">xpc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-3725"></a><span class="n">ypc</span>             <span class="o">=</span> <span class="mf">0.0</span>           <span class="c">! [pixels]</span>
<a name="ln-3726"></a><span class="n">gammavalue</span>      <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! gamma factor</span>
<a name="ln-3727"></a><span class="n">beamcurrent</span>     <span class="o">=</span> <span class="mi">1</span><span class="mf">4.513D0</span>      <span class="c">! beam current (actually emission current) in nano ampere</span>
<a name="ln-3728"></a><span class="n">dwelltime</span>       <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0D0</span>       <span class="c">! in microseconds</span>
<a name="ln-3729"></a><span class="n">hipassw</span>         <span class="o">=</span> <span class="mf">0.05D0</span>        <span class="c">! hi pass inverted Gaussian mask parameter</span>
<a name="ln-3730"></a><span class="n">stepX</span>           <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! sampling step size along X</span>
<a name="ln-3731"></a><span class="n">stepY</span>           <span class="o">=</span> <span class="mf">1.0</span>           <span class="c">! sampling step size along Y</span>
<a name="ln-3732"></a><span class="n">maskpattern</span>     <span class="o">=</span> <span class="s1">&#39;n&#39;</span>           <span class="c">! &#39;y&#39; or &#39;n&#39; to include a circular mask</span>
<a name="ln-3733"></a><span class="n">scalingmode</span>     <span class="o">=</span> <span class="s1">&#39;not&#39;</span>         <span class="c">! intensity selector (&#39;lin&#39;, &#39;gam&#39;, or &#39;not&#39;)</span>
<a name="ln-3734"></a><span class="n">masterfile</span>      <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>   <span class="c">! filename</span>
<a name="ln-3735"></a><span class="n">dotproductfile</span>  <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3736"></a><span class="n">energymin</span>       <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>
<a name="ln-3737"></a><span class="n">energymax</span>       <span class="o">=</span> <span class="mi">2</span><span class="mf">0.0</span>
<a name="ln-3738"></a><span class="n">ipf_ht</span>          <span class="o">=</span> <span class="mi">100</span>
<a name="ln-3739"></a><span class="n">ipf_wd</span>          <span class="o">=</span> <span class="mi">100</span>
<a name="ln-3740"></a><span class="n">nthreads</span>        <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3741"></a><span class="n">spatialaverage</span>  <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<a name="ln-3742"></a><span class="n">datafile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3743"></a><span class="n">ctffile</span>         <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3744"></a><span class="n">avctffile</span>       <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3745"></a><span class="n">angfile</span>         <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3746"></a><span class="n">eulerfile</span>       <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3747"></a><span class="n">omega</span>           <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-3748"></a><span class="n">tmpfile</span>         <span class="o">=</span> <span class="s1">&#39;EMEBSDDict_tmp.data&#39;</span>
<a name="ln-3749"></a><span class="n">dictfile</span>        <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3750"></a><span class="n">indexingmode</span>    <span class="o">=</span> <span class="s1">&#39;dynamic&#39;</span>
<a name="ln-3751"></a>
<a name="ln-3752"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3753"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3754"></a><span class="k">end if</span>
<a name="ln-3755"></a>
<a name="ln-3756"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3757"></a><span class="c">! read the namelist file</span>
<a name="ln-3758"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-3759"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">TKDIndexingdata</span><span class="p">)</span>
<a name="ln-3760"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-3761"></a>
<a name="ln-3762"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3763"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dictfile</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3764"></a><span class="k">            call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMTKDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; dictionary file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3765"></a>        <span class="k">end if</span>
<a name="ln-3766"></a><span class="k">    end if</span>
<a name="ln-3767"></a>        
<a name="ln-3768"></a>
<a name="ln-3769"></a><span class="c">! check for required entries</span>
<a name="ln-3770"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3771"></a><span class="k">        </span>
<a name="ln-3772"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3773"></a><span class="k">            call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMTKDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3774"></a>        <span class="k">end if</span>
<a name="ln-3775"></a>
<a name="ln-3776"></a><span class="k">    end if</span>
<a name="ln-3777"></a>
<a name="ln-3778"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">exptfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3779"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMTKDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; experimental file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3780"></a>    <span class="k">end if</span>
<a name="ln-3781"></a>
<a name="ln-3782"></a>
<a name="ln-3783"></a><span class="k">end if</span>
<a name="ln-3784"></a>
<a name="ln-3785"></a>
<a name="ln-3786"></a>
<a name="ln-3787"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the enl fields</span>
<a name="ln-3788"></a>
<a name="ln-3789"></a><span class="n">enl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>
<a name="ln-3790"></a><span class="n">enl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>
<a name="ln-3791"></a><span class="n">enl</span><span class="p">%</span><span class="n">nregions</span> <span class="o">=</span> <span class="n">nregions</span>
<a name="ln-3792"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>
<a name="ln-3793"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile</span> <span class="o">=</span> <span class="n">exptfile</span>
<a name="ln-3794"></a><span class="n">enl</span><span class="p">%</span><span class="n">nnk</span> <span class="o">=</span> <span class="n">nnk</span>
<a name="ln-3795"></a><span class="n">enl</span><span class="p">%</span><span class="n">nnav</span> <span class="o">=</span> <span class="n">nnav</span>
<a name="ln-3796"></a><span class="n">enl</span><span class="p">%</span><span class="n">nosm</span> <span class="o">=</span> <span class="n">nosm</span>
<a name="ln-3797"></a><span class="n">enl</span><span class="p">%</span><span class="n">ipf_ht</span> <span class="o">=</span> <span class="n">ipf_ht</span>
<a name="ln-3798"></a><span class="n">enl</span><span class="p">%</span><span class="n">ipf_wd</span> <span class="o">=</span> <span class="n">ipf_wd</span>
<a name="ln-3799"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-3800"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-3801"></a><span class="n">enl</span><span class="p">%</span><span class="n">tmpfile</span> <span class="o">=</span> <span class="n">tmpfile</span>
<a name="ln-3802"></a><span class="n">enl</span><span class="p">%</span><span class="n">ctffile</span> <span class="o">=</span> <span class="n">ctffile</span>
<a name="ln-3803"></a><span class="n">enl</span><span class="p">%</span><span class="n">avctffile</span> <span class="o">=</span> <span class="n">avctffile</span>
<a name="ln-3804"></a><span class="n">enl</span><span class="p">%</span><span class="n">angfile</span> <span class="o">=</span> <span class="n">angfile</span>
<a name="ln-3805"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerfile</span> <span class="o">=</span> <span class="n">eulerfile</span>
<a name="ln-3806"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskradius</span> <span class="o">=</span> <span class="n">maskradius</span>
<a name="ln-3807"></a><span class="n">enl</span><span class="p">%</span><span class="n">numdictsingle</span> <span class="o">=</span> <span class="n">numdictsingle</span>
<a name="ln-3808"></a><span class="n">enl</span><span class="p">%</span><span class="n">numexptsingle</span> <span class="o">=</span> <span class="n">numexptsingle</span>
<a name="ln-3809"></a><span class="n">enl</span><span class="p">%</span><span class="n">hipassw</span> <span class="o">=</span> <span class="n">hipassw</span>
<a name="ln-3810"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span>
<a name="ln-3811"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span>
<a name="ln-3812"></a><span class="n">enl</span><span class="p">%</span><span class="n">StepX</span> <span class="o">=</span> <span class="n">stepX</span>
<a name="ln-3813"></a><span class="n">enl</span><span class="p">%</span><span class="n">StepY</span> <span class="o">=</span> <span class="n">stepY</span>
<a name="ln-3814"></a><span class="n">enl</span><span class="p">%</span><span class="n">indexingmode</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span>
<a name="ln-3815"></a>
<a name="ln-3816"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3817"></a><span class="k">    </span><span class="n">enl</span><span class="p">%</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
<a name="ln-3818"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-3819"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">numsy</span> <span class="o">=</span> <span class="n">numsy</span>
<a name="ln-3820"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span>
<a name="ln-3821"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">energyaverage</span> <span class="o">=</span> <span class="n">energyaverage</span>
<a name="ln-3822"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-3823"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>
<a name="ln-3824"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">xpc</span> <span class="o">=</span> <span class="n">xpc</span>
<a name="ln-3825"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">ypc</span> <span class="o">=</span> <span class="n">ypc</span>
<a name="ln-3826"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-3827"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">beamcurrent</span> <span class="o">=</span> <span class="n">beamcurrent</span>
<a name="ln-3828"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">dwelltime</span> <span class="o">=</span> <span class="n">dwelltime</span>
<a name="ln-3829"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">scalingmode</span> <span class="o">=</span> <span class="n">scalingmode</span>
<a name="ln-3830"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">ncubochoric</span> <span class="o">=</span> <span class="n">ncubochoric</span>
<a name="ln-3831"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-3832"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">energymin</span> <span class="o">=</span> <span class="n">energymin</span>
<a name="ln-3833"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">energymax</span> <span class="o">=</span> <span class="n">energymax</span>
<a name="ln-3834"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">spatialaverage</span> <span class="o">=</span> <span class="n">spatialaverage</span>
<a name="ln-3835"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">dictfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3836"></a><span class="k">else if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">indexingmode</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3837"></a><span class="k">    </span><span class="n">enl</span><span class="p">%</span><span class="n">dictfile</span> <span class="o">=</span> <span class="n">dictfile</span>
<a name="ln-3838"></a>    <span class="n">enl</span><span class="p">%</span><span class="n">ncubochoric</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3839"></a><span class="k">else</span>
<a name="ln-3840"></a><span class="k">    call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMTKDIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; indexingmode is not known in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3841"></a><span class="k">end if</span>
<a name="ln-3842"></a>
<a name="ln-3843"></a><span class="k">end subroutine </span><span class="n">GetTKDIndexingNameList</span>
<a name="ln-3844"></a>
<a name="ln-3845"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3846"></a><span class="c">!</span>
<a name="ln-3847"></a><span class="c">! SUBROUTINE:GetZAdefectNameList</span>
<a name="ln-3848"></a><span class="c">!</span>
<a name="ln-3849"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-3850"></a><span class="c">!</span>
<a name="ln-3851"></a><span class="c">!&gt; @brief read namelist file and fill ZAdefect structure (used by CTEMDefect.f90)</span>
<a name="ln-3852"></a><span class="c">!</span>
<a name="ln-3853"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-3854"></a><span class="c">!&gt; @param ZAdefect Zone Axis defect simulation name list structure</span>
<a name="ln-3855"></a><span class="c">!</span>
<a name="ln-3856"></a><span class="c">!&gt; @date 06/24/15  SS 1.0 new routine</span>
<a name="ln-3857"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3858"></a><span class="k">recursive subroutine </span><span class="n">GetZAdefectNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">ZAdefect</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-3859"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetZAdefectNameList</span>
<a name="ln-3860"></a>
<a name="ln-3861"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-3862"></a>
<a name="ln-3863"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-3864"></a>
<a name="ln-3865"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-3866"></a><span class="k">type</span><span class="p">(</span><span class="n">ZAdefectnameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">ZAdefect</span>
<a name="ln-3867"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-3868"></a>
<a name="ln-3869"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-3870"></a>
<a name="ln-3871"></a>
<a name="ln-3872"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-3873"></a>	<span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>			<span class="kd">::</span> <span class="n">voltage</span> 
<a name="ln-3874"></a>	<span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">kk</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 
<a name="ln-3875"></a>	<span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>			<span class="kd">::</span> <span class="n">lauec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 
<a name="ln-3876"></a>	<span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>			<span class="kd">::</span> <span class="nb">dmin</span> 
<a name="ln-3877"></a>
<a name="ln-3878"></a><span class="c">! EM or STEM ?</span>
<a name="ln-3879"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">progmode</span>
<a name="ln-3880"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">STEMnmlfile</span> 
<a name="ln-3881"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>			<span class="kd">::</span> <span class="n">foilnmlfile</span> 
<a name="ln-3882"></a> 
<a name="ln-3883"></a><span class="c">! column approximation parameters and image parameters </span>
<a name="ln-3884"></a>	<span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>			<span class="kd">::</span> <span class="n">DF_L</span> 
<a name="ln-3885"></a>	<span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>			<span class="kd">::</span> <span class="n">DF_npix</span> 
<a name="ln-3886"></a>	<span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>			<span class="kd">::</span> <span class="n">DF_npiy</span> 
<a name="ln-3887"></a>	<span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>			<span class="kd">::</span> <span class="n">DF_slice</span> 
<a name="ln-3888"></a>
<a name="ln-3889"></a>	<span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">dinfo</span>
<a name="ln-3890"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">sgname</span> 
<a name="ln-3891"></a>
<a name="ln-3892"></a><span class="c">! defect parameters</span>
<a name="ln-3893"></a>	<span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">numdisl</span>
<a name="ln-3894"></a>	<span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">numsf</span>
<a name="ln-3895"></a>	<span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">numinc</span>
<a name="ln-3896"></a>	<span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">numvoids</span>
<a name="ln-3897"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">voidname</span>
<a name="ln-3898"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">dislname</span>
<a name="ln-3899"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">sfname</span>
<a name="ln-3900"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">incname</span>
<a name="ln-3901"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">dispfile</span>
<a name="ln-3902"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">dispmode</span>
<a name="ln-3903"></a>
<a name="ln-3904"></a><span class="c">! output parameters</span>
<a name="ln-3905"></a>	<span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-3906"></a>	<span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">t_interval</span>
<a name="ln-3907"></a>
<a name="ln-3908"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-3909"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">rundata</span> <span class="o">/</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">kk</span><span class="p">,</span> <span class="n">lauec</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">progmode</span><span class="p">,</span> <span class="n">STEMnmlfile</span><span class="p">,</span> <span class="n">foilnmlfile</span><span class="p">,&amp;</span>
<a name="ln-3910"></a>			<span class="n">DF_L</span><span class="p">,</span> <span class="n">DF_npix</span><span class="p">,</span> <span class="n">DF_npiy</span><span class="p">,</span> <span class="n">DF_slice</span><span class="p">,</span> <span class="n">dinfo</span><span class="p">,</span> <span class="n">sgname</span><span class="p">,</span> <span class="n">numdisl</span><span class="p">,</span> <span class="n">numsf</span><span class="p">,</span> <span class="n">numinc</span><span class="p">,&amp;</span>
<a name="ln-3911"></a>			<span class="n">numvoids</span><span class="p">,</span> <span class="n">voidname</span><span class="p">,</span> <span class="n">dislname</span><span class="p">,</span> <span class="n">sfname</span><span class="p">,</span> <span class="n">incname</span><span class="p">,</span> <span class="n">dispfile</span><span class="p">,</span> <span class="n">dispmode</span><span class="p">,</span> <span class="n">dataname</span><span class="p">,</span> <span class="n">t_interval</span> 
<a name="ln-3912"></a>
<a name="ln-3913"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-3914"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3915"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">20000</span><span class="mf">0.0</span>
<a name="ln-3916"></a><span class="n">kk</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="o">/</span><span class="p">)</span>
<a name="ln-3917"></a><span class="n">lauec</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="o">/</span><span class="p">)</span>
<a name="ln-3918"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.04</span>
<a name="ln-3919"></a><span class="n">progmode</span> <span class="o">=</span> <span class="s1">&#39;CTEM&#39;</span>
<a name="ln-3920"></a><span class="n">STEMnmlfile</span> <span class="o">=</span> <span class="s1">&#39;STEM_rundata.nml&#39;</span>
<a name="ln-3921"></a><span class="n">foilnmlfile</span> <span class="o">=</span> <span class="s1">&#39;FOIL_rundata.nml&#39;</span>
<a name="ln-3922"></a><span class="n">DF_L</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-3923"></a><span class="n">DF_npix</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-3924"></a><span class="n">DF_npiy</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-3925"></a><span class="n">DF_slice</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-3926"></a><span class="n">dinfo</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3927"></a><span class="n">sgname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3928"></a><span class="n">numdisl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3929"></a><span class="n">numsf</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3930"></a><span class="n">numinc</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3931"></a><span class="n">numvoids</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3932"></a><span class="n">voidname</span> <span class="o">=</span> <span class="s1">&#39;void.nml&#39;</span>
<a name="ln-3933"></a><span class="n">dislname</span> <span class="o">=</span> <span class="s1">&#39;dislocation.nml&#39;</span>
<a name="ln-3934"></a><span class="n">sfname</span> <span class="o">=</span> <span class="s1">&#39;stackingfault.nml&#39;</span>
<a name="ln-3935"></a><span class="n">incname</span> <span class="o">=</span> <span class="s1">&#39;inclusion.nml&#39;</span>
<a name="ln-3936"></a><span class="n">dispfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3937"></a><span class="n">dispmode</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3938"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-3939"></a><span class="n">t_interval</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-3940"></a>
<a name="ln-3941"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3942"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-3943"></a><span class="k">end if</span>
<a name="ln-3944"></a>
<a name="ln-3945"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3946"></a><span class="c">! read the namelist file</span>
<a name="ln-3947"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-3948"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">rundata</span><span class="p">)</span>
<a name="ln-3949"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-3950"></a>
<a name="ln-3951"></a><span class="c">! check for required entries</span>
<a name="ln-3952"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3953"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;CTEMDefect:&#39;</span><span class="p">,</span><span class="s1">&#39; xtal file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-3954"></a><span class="k">end if</span>
<a name="ln-3955"></a><span class="k">end if</span>
<a name="ln-3956"></a>
<a name="ln-3957"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the emnl fields</span>
<a name="ln-3958"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-3959"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-3960"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span>
<a name="ln-3961"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">lauec</span> <span class="o">=</span> <span class="n">lauec</span>
<a name="ln-3962"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-3963"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">progmode</span> <span class="o">=</span> <span class="n">progmode</span>
<a name="ln-3964"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">STEMnmlfile</span> <span class="o">=</span> <span class="n">STEMnmlfile</span>
<a name="ln-3965"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">foilnmlfile</span> <span class="o">=</span> <span class="n">foilnmlfile</span>
<a name="ln-3966"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">DF_L</span> <span class="o">=</span> <span class="n">DF_L</span>
<a name="ln-3967"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">DF_npix</span> <span class="o">=</span> <span class="n">DF_npix</span>
<a name="ln-3968"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">DF_npiy</span> <span class="o">=</span> <span class="n">DF_npiy</span>
<a name="ln-3969"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">DF_slice</span> <span class="o">=</span> <span class="n">DF_slice</span>
<a name="ln-3970"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span>
<a name="ln-3971"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">sgname</span> <span class="o">=</span> <span class="n">sgname</span>
<a name="ln-3972"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">numdisl</span> <span class="o">=</span> <span class="n">numdisl</span>
<a name="ln-3973"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">numsf</span> <span class="o">=</span> <span class="n">numsf</span>
<a name="ln-3974"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">numinc</span> <span class="o">=</span> <span class="n">numinc</span>
<a name="ln-3975"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">numvoids</span> <span class="o">=</span> <span class="n">numvoids</span>
<a name="ln-3976"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">voidname</span> <span class="o">=</span> <span class="n">voidname</span>
<a name="ln-3977"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">dislname</span> <span class="o">=</span> <span class="n">dislname</span>
<a name="ln-3978"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">sfname</span> <span class="o">=</span> <span class="n">sfname</span>
<a name="ln-3979"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">incname</span> <span class="o">=</span> <span class="n">incname</span>
<a name="ln-3980"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">dispfile</span> <span class="o">=</span> <span class="n">dispfile</span>
<a name="ln-3981"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">dispmode</span> <span class="o">=</span> <span class="n">dispmode</span>
<a name="ln-3982"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-3983"></a><span class="n">ZAdefect</span><span class="p">%</span><span class="n">t_interval</span> <span class="o">=</span> <span class="n">t_interval</span>
<a name="ln-3984"></a>
<a name="ln-3985"></a><span class="k">end subroutine </span><span class="n">GetZADefectNameList</span>
<a name="ln-3986"></a>
<a name="ln-3987"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-3988"></a><span class="c">!</span>
<a name="ln-3989"></a><span class="c">! SUBROUTINE:GetECPIndexingNameList</span>
<a name="ln-3990"></a><span class="c">!</span>
<a name="ln-3991"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-3992"></a><span class="c">!</span>
<a name="ln-3993"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMDynamicECPIndeixing.f90)</span>
<a name="ln-3994"></a><span class="c">!</span>
<a name="ln-3995"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-3996"></a><span class="c">!&gt; @param enl ECP indexing name list structure</span>
<a name="ln-3997"></a><span class="c">!</span>
<a name="ln-3998"></a><span class="c">!&gt; @date 11/19/15  SS 1.0 original</span>
<a name="ln-3999"></a><span class="c">!&gt; @date 01/26/16  SS 1.1 modified for EMsoft3.1 indexing code</span>
<a name="ln-4000"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4001"></a><span class="k">recursive subroutine </span><span class="n">GetECPIndexingNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4002"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetECPIndexingNameList</span>
<a name="ln-4003"></a>
<a name="ln-4004"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4005"></a>
<a name="ln-4006"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4007"></a>
<a name="ln-4008"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4009"></a><span class="k">type</span><span class="p">(</span><span class="n">ECPIndexingNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-4010"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4011"></a>
<a name="ln-4012"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4013"></a>
<a name="ln-4014"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">ncubochoric</span>
<a name="ln-4015"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numexptsingle</span>
<a name="ln-4016"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numdictsingle</span>
<a name="ln-4017"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">totnumexpt</span>
<a name="ln-4018"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">maskradius</span>
<a name="ln-4019"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nnk</span>
<a name="ln-4020"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-4021"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-4022"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nregions</span>
<a name="ln-4023"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile</span> 
<a name="ln-4024"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-4025"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-4026"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-4027"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-4028"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-4029"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-4030"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">tmpfile</span>
<a name="ln-4031"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-4032"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">ctffile</span>
<a name="ln-4033"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-4034"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">sampletilt</span>
<a name="ln-4035"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">workingdistance</span>
<a name="ln-4036"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">Rin</span>
<a name="ln-4037"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">Rout</span>
<a name="ln-4038"></a>
<a name="ln-4039"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">ECPIndexingdata</span> <span class="o">/</span> <span class="n">ncubochoric</span><span class="p">,</span> <span class="n">numexptsingle</span><span class="p">,</span> <span class="n">numdictsingle</span><span class="p">,</span> <span class="n">totnumexpt</span><span class="p">,</span> <span class="n">nnk</span><span class="p">,</span> <span class="n">exptfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4040"></a><span class="n">stdout</span><span class="p">,</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4041"></a><span class="n">sampletilt</span><span class="p">,</span> <span class="n">workingdistance</span><span class="p">,</span> <span class="n">Rin</span><span class="p">,</span> <span class="n">Rout</span><span class="p">,</span> <span class="n">maskradius</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span> <span class="n">nregions</span><span class="p">,</span> <span class="n">ctffile</span><span class="p">,</span> <span class="n">tmpfile</span>
<a name="ln-4042"></a>
<a name="ln-4043"></a><span class="n">ncubochoric</span> <span class="o">=</span> <span class="mi">100</span> 
<a name="ln-4044"></a><span class="n">numexptsingle</span> <span class="o">=</span> <span class="mi">1024</span>
<a name="ln-4045"></a><span class="n">numdictsingle</span> <span class="o">=</span> <span class="mi">1024</span> 
<a name="ln-4046"></a><span class="n">totnumexpt</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-4047"></a><span class="n">nregions</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-4048"></a><span class="n">nnk</span> <span class="o">=</span> <span class="mi">2</span> 
<a name="ln-4049"></a><span class="n">platid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4050"></a><span class="n">devid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4051"></a><span class="n">exptfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4052"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span> 
<a name="ln-4053"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">256</span> 
<a name="ln-4054"></a><span class="n">thetac</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span> 
<a name="ln-4055"></a><span class="n">maskpattern</span> <span class="o">=</span><span class="s1">&#39;y&#39;</span> 
<a name="ln-4056"></a><span class="n">masterfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-4057"></a><span class="n">datafile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-4058"></a><span class="n">tmpfile</span> <span class="o">=</span> <span class="s1">&#39;EMECPDict_tmp.data&#39;</span>
<a name="ln-4059"></a><span class="n">ctffile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4060"></a><span class="n">gammavalue</span> <span class="o">=</span> <span class="mf">1.0</span> 
<a name="ln-4061"></a><span class="n">sampletilt</span> <span class="o">=</span> <span class="mf">0.0</span> 
<a name="ln-4062"></a><span class="n">workingdistance</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span> 
<a name="ln-4063"></a><span class="n">Rin</span> <span class="o">=</span> <span class="mf">3.0</span> 
<a name="ln-4064"></a><span class="n">Rout</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4065"></a><span class="n">maskradius</span> <span class="o">=</span> <span class="mi">128</span>
<a name="ln-4066"></a>
<a name="ln-4067"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4068"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4069"></a><span class="k">end if</span>
<a name="ln-4070"></a>
<a name="ln-4071"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4072"></a><span class="c">! read the namelist file</span>
<a name="ln-4073"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4074"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">ECPIndexingdata</span><span class="p">)</span>
<a name="ln-4075"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4076"></a>
<a name="ln-4077"></a><span class="c">! check for required entries</span>
<a name="ln-4078"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4079"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECPIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4080"></a>    <span class="k">end if</span>
<a name="ln-4081"></a>
<a name="ln-4082"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">exptfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4083"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMECPIndexing:&#39;</span><span class="p">,</span><span class="s1">&#39; experimental file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4084"></a>    <span class="k">end if</span>
<a name="ln-4085"></a>
<a name="ln-4086"></a><span class="k">end if</span>
<a name="ln-4087"></a>
<a name="ln-4088"></a><span class="n">enl</span><span class="p">%</span><span class="n">ncubochoric</span> <span class="o">=</span> <span class="n">ncubochoric</span>
<a name="ln-4089"></a><span class="n">enl</span><span class="p">%</span><span class="n">numexptsingle</span> <span class="o">=</span> <span class="n">numexptsingle</span>
<a name="ln-4090"></a><span class="n">enl</span><span class="p">%</span><span class="n">numdictsingle</span> <span class="o">=</span> <span class="n">numdictsingle</span>
<a name="ln-4091"></a><span class="n">enl</span><span class="p">%</span><span class="n">totnumexpt</span> <span class="o">=</span> <span class="n">totnumexpt</span>
<a name="ln-4092"></a><span class="n">enl</span><span class="p">%</span><span class="n">nnk</span> <span class="o">=</span> <span class="n">nnk</span>
<a name="ln-4093"></a><span class="n">enl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>
<a name="ln-4094"></a><span class="n">enl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>
<a name="ln-4095"></a><span class="n">enl</span><span class="p">%</span><span class="n">nregions</span> <span class="o">=</span> <span class="n">nregions</span>
<a name="ln-4096"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile</span> <span class="o">=</span> <span class="n">exptfile</span>
<a name="ln-4097"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-4098"></a><span class="n">enl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-4099"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-4100"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span> 
<a name="ln-4101"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span> 
<a name="ln-4102"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span>
<a name="ln-4103"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-4104"></a><span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-4105"></a><span class="n">enl</span><span class="p">%</span><span class="n">sampletilt</span> <span class="o">=</span> <span class="n">sampletilt</span>
<a name="ln-4106"></a><span class="n">enl</span><span class="p">%</span><span class="n">workingdistance</span> <span class="o">=</span> <span class="n">workingdistance</span>
<a name="ln-4107"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rin</span> <span class="o">=</span> <span class="n">Rin</span>
<a name="ln-4108"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rout</span> <span class="o">=</span> <span class="n">Rout</span>
<a name="ln-4109"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskradius</span> <span class="o">=</span> <span class="n">maskradius</span> 
<a name="ln-4110"></a><span class="n">enl</span><span class="p">%</span><span class="n">ctffile</span> <span class="o">=</span> <span class="n">ctffile</span>
<a name="ln-4111"></a><span class="n">enl</span><span class="p">%</span><span class="n">tmpfile</span> <span class="o">=</span> <span class="n">tmpfile</span>
<a name="ln-4112"></a>
<a name="ln-4113"></a><span class="k">end subroutine </span><span class="n">GetECPIndexingNameList</span>
<a name="ln-4114"></a>
<a name="ln-4115"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4116"></a><span class="c">!</span>
<a name="ln-4117"></a><span class="c">! SUBROUTINE:GetEMDPFit4NameList</span>
<a name="ln-4118"></a><span class="c">!</span>
<a name="ln-4119"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-4120"></a><span class="c">!</span>
<a name="ln-4121"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMDPFit.f90)</span>
<a name="ln-4122"></a><span class="c">!</span>
<a name="ln-4123"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-4124"></a><span class="c">!&gt; @param enl DPFit name list structure</span>
<a name="ln-4125"></a><span class="c">!</span>
<a name="ln-4126"></a><span class="c">!&gt; @date 02/22/16  SS 1.0 original</span>
<a name="ln-4127"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4128"></a><span class="k">recursive subroutine </span><span class="n">GetEMDPFit4NameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4129"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEMDPFit4NameList</span>
<a name="ln-4130"></a>
<a name="ln-4131"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4132"></a>
<a name="ln-4133"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4134"></a>
<a name="ln-4135"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4136"></a><span class="k">type</span><span class="p">(</span><span class="n">EMDPFit4ListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-4137"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4138"></a>
<a name="ln-4139"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4140"></a>
<a name="ln-4141"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-4142"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">modalityname</span>
<a name="ln-4143"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile_pat1</span>
<a name="ln-4144"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile_pat2</span>
<a name="ln-4145"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile_pat3</span>
<a name="ln-4146"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile_pat4</span>
<a name="ln-4147"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">rhobeg</span><span class="p">,</span> <span class="n">rhoend</span>
<a name="ln-4148"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">mask</span>
<a name="ln-4149"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-4150"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">phi_pat1</span><span class="p">,</span> <span class="n">phi1_pat1</span><span class="p">,</span> <span class="n">phi2_pat1</span>
<a name="ln-4151"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">phi_pat2</span><span class="p">,</span> <span class="n">phi1_pat2</span><span class="p">,</span> <span class="n">phi2_pat2</span>
<a name="ln-4152"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">phi_pat3</span><span class="p">,</span> <span class="n">phi1_pat3</span><span class="p">,</span> <span class="n">phi2_pat3</span>
<a name="ln-4153"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">phi_pat4</span><span class="p">,</span> <span class="n">phi1_pat4</span><span class="p">,</span> <span class="n">phi2_pat4</span>
<a name="ln-4154"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">L</span>
<a name="ln-4155"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-4156"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-4157"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-4158"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-4159"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsy</span>
<a name="ln-4160"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">binning</span>
<a name="ln-4161"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">xpc</span>
<a name="ln-4162"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">ypc</span>
<a name="ln-4163"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">beamcurrent</span>
<a name="ln-4164"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">dwelltime</span>
<a name="ln-4165"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-4166"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">Rin</span>
<a name="ln-4167"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">Rout</span>
<a name="ln-4168"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">thetacone</span>
<a name="ln-4169"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">sampletilt</span>
<a name="ln-4170"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">workingdistance</span>
<a name="ln-4171"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">maskradius</span>
<a name="ln-4172"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_xpc</span>
<a name="ln-4173"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_ypc</span>
<a name="ln-4174"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_L</span>
<a name="ln-4175"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_phi1</span>
<a name="ln-4176"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_phi</span>
<a name="ln-4177"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_phi2</span>
<a name="ln-4178"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_thetacone</span>
<a name="ln-4179"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nrun</span>
<a name="ln-4180"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">pixx_pat1</span><span class="p">,</span><span class="n">pixx_pat2</span><span class="p">,</span><span class="n">pixx_pat3</span><span class="p">,</span><span class="n">pixx_pat4</span>
<a name="ln-4181"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">pixy_pat1</span><span class="p">,</span><span class="n">pixy_pat2</span><span class="p">,</span><span class="n">pixy_pat3</span><span class="p">,</span><span class="n">pixy_pat4</span>
<a name="ln-4182"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">stepx</span>
<a name="ln-4183"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">stepy</span>
<a name="ln-4184"></a>
<a name="ln-4185"></a>
<a name="ln-4186"></a>
<a name="ln-4187"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">DPFitdata</span> <span class="o">/</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">modalityname</span><span class="p">,</span> <span class="n">exptfile_pat1</span><span class="p">,</span> <span class="n">rhobeg</span><span class="p">,</span> <span class="n">rhoend</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4188"></a>         <span class="n">phi1_pat1</span><span class="p">,</span> <span class="n">phi_pat1</span><span class="p">,</span> <span class="n">phi2_pat1</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">numsy</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">xpc</span><span class="p">,</span> <span class="n">ypc</span><span class="p">,</span> <span class="n">beamcurrent</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4189"></a>         <span class="n">dwelltime</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">Rin</span><span class="p">,</span> <span class="n">Rout</span><span class="p">,</span> <span class="n">thetacone</span><span class="p">,</span> <span class="n">sampletilt</span><span class="p">,</span> <span class="n">workingdistance</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">maskradius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4190"></a>         <span class="n">phi1_pat2</span><span class="p">,</span> <span class="n">phi_pat2</span><span class="p">,</span> <span class="n">phi2_pat2</span><span class="p">,</span> <span class="n">phi1_pat3</span><span class="p">,</span> <span class="n">phi_pat3</span><span class="p">,</span> <span class="n">phi2_pat3</span><span class="p">,</span> <span class="n">phi1_pat4</span><span class="p">,</span> <span class="n">phi_pat4</span><span class="p">,</span> <span class="n">phi2_pat4</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4191"></a>         <span class="n">exptfile_pat2</span><span class="p">,</span> <span class="n">exptfile_pat3</span><span class="p">,</span> <span class="n">exptfile_pat4</span><span class="p">,</span> <span class="n">step_xpc</span><span class="p">,</span> <span class="n">step_ypc</span><span class="p">,</span> <span class="n">step_L</span><span class="p">,</span> <span class="n">step_phi1</span><span class="p">,</span> <span class="n">step_phi</span><span class="p">,</span> <span class="n">step_phi2</span><span class="p">,&amp;</span>
<a name="ln-4192"></a>         <span class="n">step_thetacone</span><span class="p">,</span> <span class="n">nrun</span><span class="p">,</span> <span class="n">pixx_pat1</span><span class="p">,</span> <span class="n">pixy_pat1</span><span class="p">,</span> <span class="n">stepx</span><span class="p">,</span> <span class="n">stepy</span><span class="p">,</span>  <span class="n">pixx_pat2</span><span class="p">,</span> <span class="n">pixy_pat2</span><span class="p">,</span>  <span class="n">pixx_pat3</span><span class="p">,</span> <span class="n">pixy_pat3</span><span class="p">,&amp;</span>
<a name="ln-4193"></a>         <span class="n">pixx_pat4</span><span class="p">,</span> <span class="n">pixy_pat4</span>
<a name="ln-4194"></a>
<a name="ln-4195"></a><span class="n">masterfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-4196"></a><span class="n">modalityname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-4197"></a>
<a name="ln-4198"></a><span class="n">exptfile_pat1</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4199"></a><span class="n">exptfile_pat2</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4200"></a><span class="n">exptfile_pat3</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4201"></a><span class="n">exptfile_pat4</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4202"></a>
<a name="ln-4203"></a><span class="n">rhobeg</span> <span class="o">=</span> <span class="mf">1.0D-2</span>
<a name="ln-4204"></a><span class="n">rhoend</span> <span class="o">=</span> <span class="mf">1.0D-7</span>
<a name="ln-4205"></a><span class="n">verbose</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4206"></a><span class="n">mask</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4207"></a><span class="n">phi1_pat1</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4208"></a><span class="n">phi_pat1</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4209"></a><span class="n">phi2_pat1</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4210"></a>
<a name="ln-4211"></a><span class="n">phi1_pat2</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4212"></a><span class="n">phi_pat2</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4213"></a><span class="n">phi2_pat2</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4214"></a>
<a name="ln-4215"></a><span class="n">phi1_pat3</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4216"></a><span class="n">phi_pat3</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4217"></a><span class="n">phi2_pat3</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4218"></a>
<a name="ln-4219"></a><span class="n">phi1_pat4</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4220"></a><span class="n">phi_pat4</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4221"></a><span class="n">phi2_pat4</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4222"></a>
<a name="ln-4223"></a><span class="n">step_phi1</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4224"></a><span class="n">step_phi</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4225"></a><span class="n">step_phi2</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4226"></a>
<a name="ln-4227"></a><span class="n">L</span> <span class="o">=</span> <span class="mi">1500</span><span class="mf">0.0</span>
<a name="ln-4228"></a><span class="n">thetac</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>
<a name="ln-4229"></a><span class="n">delta</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">0.0</span>
<a name="ln-4230"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4231"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">640</span>
<a name="ln-4232"></a><span class="n">numsy</span> <span class="o">=</span> <span class="mi">480</span>
<a name="ln-4233"></a><span class="n">binning</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4234"></a><span class="n">xpc</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4235"></a><span class="n">ypc</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4236"></a><span class="n">beamcurrent</span> <span class="o">=</span> <span class="mi">100</span><span class="mf">0.0</span>
<a name="ln-4237"></a><span class="n">dwelltime</span> <span class="o">=</span> <span class="mi">100</span><span class="mf">0.0</span>
<a name="ln-4238"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">512</span>
<a name="ln-4239"></a><span class="n">Rin</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4240"></a><span class="n">Rout</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4241"></a><span class="n">thetacone</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4242"></a><span class="n">sampletilt</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4243"></a><span class="n">workingdistance</span> <span class="o">=</span> <span class="mf">7.0</span>
<a name="ln-4244"></a><span class="n">gammavalue</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4245"></a><span class="n">maskradius</span> <span class="o">=</span> <span class="mi">25</span><span class="mf">6.0</span>
<a name="ln-4246"></a>
<a name="ln-4247"></a><span class="n">step_xpc</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4248"></a><span class="n">step_ypc</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4249"></a><span class="n">step_L</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4250"></a><span class="n">step_thetacone</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4251"></a>
<a name="ln-4252"></a><span class="n">pixx_pat1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4253"></a><span class="n">pixy_pat1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4254"></a><span class="n">pixx_pat2</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4255"></a><span class="n">pixy_pat2</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4256"></a><span class="n">pixx_pat3</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4257"></a><span class="n">pixy_pat3</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4258"></a><span class="n">pixx_pat4</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4259"></a><span class="n">pixy_pat4</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-4260"></a>
<a name="ln-4261"></a><span class="n">stepx</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4262"></a><span class="n">stepy</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4263"></a>
<a name="ln-4264"></a><span class="n">nrun</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-4265"></a>
<a name="ln-4266"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4267"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4268"></a><span class="k">end if</span>
<a name="ln-4269"></a>
<a name="ln-4270"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4271"></a><span class="c">! read the namelist file</span>
<a name="ln-4272"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4273"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">DPFitdata</span><span class="p">)</span>
<a name="ln-4274"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4275"></a>
<a name="ln-4276"></a><span class="c">! check for required entries</span>
<a name="ln-4277"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4278"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDPFit:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4279"></a>    <span class="k">end if</span>
<a name="ln-4280"></a>
<a name="ln-4281"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">modalityname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4282"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDPFit:&#39;</span><span class="p">,</span><span class="s1">&#39; modality name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4283"></a>    <span class="k">end if</span>
<a name="ln-4284"></a>
<a name="ln-4285"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">exptfile_pat1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4286"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDPFit:&#39;</span><span class="p">,</span><span class="s1">&#39; experimental file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4287"></a>    <span class="k">end if</span>
<a name="ln-4288"></a>
<a name="ln-4289"></a><span class="k">end if</span>
<a name="ln-4290"></a>
<a name="ln-4291"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span> 
<a name="ln-4292"></a><span class="n">enl</span><span class="p">%</span><span class="n">modalityname</span> <span class="o">=</span> <span class="n">modalityname</span>
<a name="ln-4293"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile_pat1</span> <span class="o">=</span> <span class="n">exptfile_pat1</span>
<a name="ln-4294"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile_pat2</span> <span class="o">=</span> <span class="n">exptfile_pat2</span>
<a name="ln-4295"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile_pat3</span> <span class="o">=</span> <span class="n">exptfile_pat3</span>
<a name="ln-4296"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile_pat4</span> <span class="o">=</span> <span class="n">exptfile_pat4</span>
<a name="ln-4297"></a><span class="n">enl</span><span class="p">%</span><span class="n">rhobeg</span> <span class="o">=</span> <span class="n">rhobeg</span>
<a name="ln-4298"></a><span class="n">enl</span><span class="p">%</span><span class="n">rhoend</span> <span class="o">=</span> <span class="n">rhoend</span>
<a name="ln-4299"></a><span class="n">enl</span><span class="p">%</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
<a name="ln-4300"></a><span class="n">enl</span><span class="p">%</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
<a name="ln-4301"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi1_pat1</span> <span class="o">=</span> <span class="n">phi1_pat1</span>
<a name="ln-4302"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi_pat1</span> <span class="o">=</span> <span class="n">phi_pat1</span>
<a name="ln-4303"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi2_pat1</span> <span class="o">=</span> <span class="n">phi2_pat1</span>
<a name="ln-4304"></a>
<a name="ln-4305"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi1_pat2</span> <span class="o">=</span> <span class="n">phi1_pat2</span>
<a name="ln-4306"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi_pat2</span> <span class="o">=</span> <span class="n">phi_pat2</span>
<a name="ln-4307"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi2_pat2</span> <span class="o">=</span> <span class="n">phi2_pat2</span>
<a name="ln-4308"></a>
<a name="ln-4309"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi1_pat3</span> <span class="o">=</span> <span class="n">phi1_pat3</span>
<a name="ln-4310"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi_pat3</span> <span class="o">=</span> <span class="n">phi_pat3</span>
<a name="ln-4311"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi2_pat3</span> <span class="o">=</span> <span class="n">phi2_pat3</span>
<a name="ln-4312"></a>
<a name="ln-4313"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi1_pat4</span> <span class="o">=</span> <span class="n">phi1_pat4</span>
<a name="ln-4314"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi_pat4</span> <span class="o">=</span> <span class="n">phi_pat4</span>
<a name="ln-4315"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi2_pat4</span> <span class="o">=</span> <span class="n">phi2_pat4</span>
<a name="ln-4316"></a>
<a name="ln-4317"></a><span class="n">enl</span><span class="p">%</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
<a name="ln-4318"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-4319"></a><span class="n">enl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-4320"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-4321"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsy</span> <span class="o">=</span> <span class="n">numsy</span>
<a name="ln-4322"></a><span class="n">enl</span><span class="p">%</span><span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span>
<a name="ln-4323"></a><span class="n">enl</span><span class="p">%</span><span class="n">xpc</span> <span class="o">=</span> <span class="n">xpc</span>
<a name="ln-4324"></a><span class="n">enl</span><span class="p">%</span><span class="n">ypc</span> <span class="o">=</span> <span class="n">ypc</span>
<a name="ln-4325"></a><span class="n">enl</span><span class="p">%</span><span class="n">beamcurrent</span> <span class="o">=</span> <span class="n">beamcurrent</span>
<a name="ln-4326"></a><span class="n">enl</span><span class="p">%</span><span class="n">dwelltime</span> <span class="o">=</span> <span class="n">dwelltime</span>
<a name="ln-4327"></a><span class="n">enl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-4328"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rin</span> <span class="o">=</span> <span class="n">Rin</span>
<a name="ln-4329"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rout</span> <span class="o">=</span> <span class="n">Rout</span>
<a name="ln-4330"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetacone</span> <span class="o">=</span> <span class="n">thetacone</span>
<a name="ln-4331"></a><span class="n">enl</span><span class="p">%</span><span class="n">sampletilt</span> <span class="o">=</span> <span class="n">sampletilt</span>
<a name="ln-4332"></a><span class="n">enl</span><span class="p">%</span><span class="n">workingdistance</span> <span class="o">=</span> <span class="n">workingdistance</span>
<a name="ln-4333"></a><span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-4334"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskradius</span> <span class="o">=</span> <span class="n">maskradius</span>
<a name="ln-4335"></a><span class="n">enl</span><span class="p">%</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>
<a name="ln-4336"></a>
<a name="ln-4337"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_xpc</span> <span class="o">=</span> <span class="n">step_xpc</span>
<a name="ln-4338"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_ypc</span> <span class="o">=</span> <span class="n">step_ypc</span>
<a name="ln-4339"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_L</span> <span class="o">=</span> <span class="n">step_L</span>
<a name="ln-4340"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_phi1</span> <span class="o">=</span> <span class="n">step_phi1</span>
<a name="ln-4341"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_phi</span> <span class="o">=</span> <span class="n">step_phi</span>
<a name="ln-4342"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_phi2</span> <span class="o">=</span> <span class="n">step_phi2</span>
<a name="ln-4343"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_thetacone</span> <span class="o">=</span> <span class="n">step_thetacone</span>
<a name="ln-4344"></a>
<a name="ln-4345"></a><span class="n">enl</span><span class="p">%</span><span class="n">nrun</span> <span class="o">=</span> <span class="n">nrun</span>
<a name="ln-4346"></a>
<a name="ln-4347"></a><span class="n">enl</span><span class="p">%</span><span class="n">stepx</span> <span class="o">=</span> <span class="n">stepx</span>
<a name="ln-4348"></a><span class="n">enl</span><span class="p">%</span><span class="n">stepy</span> <span class="o">=</span> <span class="n">stepy</span>
<a name="ln-4349"></a>
<a name="ln-4350"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixx_pat1</span> <span class="o">=</span> <span class="n">pixx_pat1</span>
<a name="ln-4351"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixy_pat1</span> <span class="o">=</span> <span class="n">pixy_pat1</span>
<a name="ln-4352"></a>
<a name="ln-4353"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixx_pat2</span> <span class="o">=</span> <span class="n">pixx_pat2</span>
<a name="ln-4354"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixy_pat2</span> <span class="o">=</span> <span class="n">pixy_pat2</span>
<a name="ln-4355"></a>
<a name="ln-4356"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixx_pat3</span> <span class="o">=</span> <span class="n">pixx_pat3</span>
<a name="ln-4357"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixy_pat3</span> <span class="o">=</span> <span class="n">pixy_pat3</span>
<a name="ln-4358"></a>
<a name="ln-4359"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixx_pat4</span> <span class="o">=</span> <span class="n">pixx_pat4</span>
<a name="ln-4360"></a><span class="n">enl</span><span class="p">%</span><span class="n">pixy_pat4</span> <span class="o">=</span> <span class="n">pixy_pat4</span>
<a name="ln-4361"></a>
<a name="ln-4362"></a><span class="k">end subroutine </span><span class="n">GetEMDPFit4NameList</span>
<a name="ln-4363"></a>
<a name="ln-4364"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4365"></a><span class="c">!</span>
<a name="ln-4366"></a><span class="c">! SUBROUTINE:GetEMDPFitNameList</span>
<a name="ln-4367"></a><span class="c">!</span>
<a name="ln-4368"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-4369"></a><span class="c">!</span>
<a name="ln-4370"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMDPFit.f90)</span>
<a name="ln-4371"></a><span class="c">!</span>
<a name="ln-4372"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-4373"></a><span class="c">!&gt; @param enl DPFit name list structure</span>
<a name="ln-4374"></a><span class="c">!</span>
<a name="ln-4375"></a><span class="c">!&gt; @date 02/22/16  SS 1.0 original</span>
<a name="ln-4376"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4377"></a><span class="k">recursive subroutine </span><span class="n">GetEMDPFitNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4378"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEMDPFitNameList</span>
<a name="ln-4379"></a>
<a name="ln-4380"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4381"></a>
<a name="ln-4382"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4383"></a>
<a name="ln-4384"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4385"></a><span class="k">type</span><span class="p">(</span><span class="n">EMDPFitListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-4386"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4387"></a>
<a name="ln-4388"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4389"></a>
<a name="ln-4390"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">masterfile</span>
<a name="ln-4391"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">modalityname</span>
<a name="ln-4392"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">exptfile</span>
<a name="ln-4393"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">rhobeg</span><span class="p">,</span> <span class="n">rhoend</span>
<a name="ln-4394"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">mask</span>
<a name="ln-4395"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-4396"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">phi</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">phi2</span>
<a name="ln-4397"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">L</span>
<a name="ln-4398"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-4399"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-4400"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-4401"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-4402"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">numsy</span>
<a name="ln-4403"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">binning</span>
<a name="ln-4404"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">xpc</span>
<a name="ln-4405"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">ypc</span>
<a name="ln-4406"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">beamcurrent</span>
<a name="ln-4407"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">dwelltime</span>
<a name="ln-4408"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-4409"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">Rin</span>
<a name="ln-4410"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">Rout</span>
<a name="ln-4411"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">thetacone</span>
<a name="ln-4412"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">sampletilt</span>
<a name="ln-4413"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">workingdistance</span>
<a name="ln-4414"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">maskradius</span>
<a name="ln-4415"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_xpc</span>
<a name="ln-4416"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_ypc</span>
<a name="ln-4417"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_L</span>
<a name="ln-4418"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_phi1</span>
<a name="ln-4419"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_phi</span>
<a name="ln-4420"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_phi2</span>
<a name="ln-4421"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step_thetacone</span>
<a name="ln-4422"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nrun</span>
<a name="ln-4423"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nregions</span>
<a name="ln-4424"></a><span class="kt">character</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                                      <span class="kd">::</span> <span class="n">metric</span>
<a name="ln-4425"></a>
<a name="ln-4426"></a>
<a name="ln-4427"></a>
<a name="ln-4428"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">DPFitdata</span> <span class="o">/</span> <span class="n">masterfile</span><span class="p">,</span> <span class="n">modalityname</span><span class="p">,</span> <span class="n">exptfile</span><span class="p">,</span> <span class="n">rhobeg</span><span class="p">,</span> <span class="n">rhoend</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4429"></a>         <span class="n">phi1</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">phi2</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">numsy</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">xpc</span><span class="p">,</span> <span class="n">ypc</span><span class="p">,</span> <span class="n">beamcurrent</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4430"></a>         <span class="n">dwelltime</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">Rin</span><span class="p">,</span> <span class="n">Rout</span><span class="p">,</span> <span class="n">thetacone</span><span class="p">,</span> <span class="n">sampletilt</span><span class="p">,</span> <span class="n">workingdistance</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">maskradius</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4431"></a>         <span class="n">step_xpc</span><span class="p">,</span> <span class="n">step_ypc</span><span class="p">,</span> <span class="n">step_L</span><span class="p">,</span> <span class="n">step_phi1</span><span class="p">,</span> <span class="n">step_phi</span><span class="p">,</span> <span class="n">step_phi2</span><span class="p">,</span> <span class="n">step_thetacone</span><span class="p">,</span> <span class="n">nrun</span><span class="p">,</span> <span class="n">nregions</span><span class="p">,</span> <span class="n">metric</span>
<a name="ln-4432"></a>
<a name="ln-4433"></a><span class="n">masterfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-4434"></a><span class="n">modalityname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-4435"></a>
<a name="ln-4436"></a><span class="n">exptfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4437"></a>
<a name="ln-4438"></a><span class="n">rhobeg</span> <span class="o">=</span> <span class="mf">1.0D-2</span>
<a name="ln-4439"></a><span class="n">rhoend</span> <span class="o">=</span> <span class="mf">1.0D-7</span>
<a name="ln-4440"></a><span class="n">verbose</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4441"></a><span class="n">mask</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4442"></a><span class="n">phi1</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4443"></a><span class="n">phi</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4444"></a><span class="n">phi2</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4445"></a>
<a name="ln-4446"></a><span class="n">step_phi1</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4447"></a><span class="n">step_phi</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4448"></a><span class="n">step_phi2</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4449"></a>
<a name="ln-4450"></a><span class="n">L</span> <span class="o">=</span> <span class="mi">1500</span><span class="mf">0.0</span>
<a name="ln-4451"></a><span class="n">thetac</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>
<a name="ln-4452"></a><span class="n">delta</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">0.0</span>
<a name="ln-4453"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4454"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">640</span>
<a name="ln-4455"></a><span class="n">numsy</span> <span class="o">=</span> <span class="mi">480</span>
<a name="ln-4456"></a><span class="n">binning</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4457"></a><span class="n">xpc</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4458"></a><span class="n">ypc</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4459"></a><span class="n">beamcurrent</span> <span class="o">=</span> <span class="mi">100</span><span class="mf">0.0</span>
<a name="ln-4460"></a><span class="n">dwelltime</span> <span class="o">=</span> <span class="mi">100</span><span class="mf">0.0</span>
<a name="ln-4461"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">512</span>
<a name="ln-4462"></a><span class="n">Rin</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4463"></a><span class="n">Rout</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4464"></a><span class="n">thetacone</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4465"></a><span class="n">sampletilt</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-4466"></a><span class="n">workingdistance</span> <span class="o">=</span> <span class="mf">7.0</span>
<a name="ln-4467"></a><span class="n">gammavalue</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4468"></a><span class="n">maskradius</span> <span class="o">=</span> <span class="mi">25</span><span class="mf">6.0</span>
<a name="ln-4469"></a>
<a name="ln-4470"></a><span class="n">step_xpc</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4471"></a><span class="n">step_ypc</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4472"></a><span class="n">step_L</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4473"></a><span class="n">step_thetacone</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4474"></a>
<a name="ln-4475"></a><span class="n">nrun</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-4476"></a><span class="n">nregions</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-4477"></a><span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;DP&#39;</span>
<a name="ln-4478"></a>
<a name="ln-4479"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4480"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4481"></a><span class="k">end if</span>
<a name="ln-4482"></a>
<a name="ln-4483"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4484"></a><span class="c">! read the namelist file</span>
<a name="ln-4485"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4486"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">DPFitdata</span><span class="p">)</span>
<a name="ln-4487"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4488"></a>
<a name="ln-4489"></a><span class="c">! check for required entries</span>
<a name="ln-4490"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">masterfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4491"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDPFit:&#39;</span><span class="p">,</span><span class="s1">&#39; master pattern file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4492"></a>    <span class="k">end if</span>
<a name="ln-4493"></a>
<a name="ln-4494"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">modalityname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4495"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDPFit:&#39;</span><span class="p">,</span><span class="s1">&#39; modality name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4496"></a>    <span class="k">end if</span>
<a name="ln-4497"></a>
<a name="ln-4498"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">exptfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4499"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDPFit:&#39;</span><span class="p">,</span><span class="s1">&#39; experimental file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4500"></a>    <span class="k">end if</span>
<a name="ln-4501"></a>
<a name="ln-4502"></a><span class="k">end if</span>
<a name="ln-4503"></a>
<a name="ln-4504"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="n">masterfile</span> 
<a name="ln-4505"></a><span class="n">enl</span><span class="p">%</span><span class="n">modalityname</span> <span class="o">=</span> <span class="n">modalityname</span>
<a name="ln-4506"></a><span class="n">enl</span><span class="p">%</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
<a name="ln-4507"></a><span class="n">enl</span><span class="p">%</span><span class="n">nregions</span> <span class="o">=</span> <span class="n">nregions</span>
<a name="ln-4508"></a><span class="n">enl</span><span class="p">%</span><span class="n">exptfile</span> <span class="o">=</span> <span class="n">exptfile</span>
<a name="ln-4509"></a><span class="n">enl</span><span class="p">%</span><span class="n">rhobeg</span> <span class="o">=</span> <span class="n">rhobeg</span>
<a name="ln-4510"></a><span class="n">enl</span><span class="p">%</span><span class="n">rhoend</span> <span class="o">=</span> <span class="n">rhoend</span>
<a name="ln-4511"></a><span class="n">enl</span><span class="p">%</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
<a name="ln-4512"></a><span class="n">enl</span><span class="p">%</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
<a name="ln-4513"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi1</span> <span class="o">=</span> <span class="n">phi1</span>
<a name="ln-4514"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span>
<a name="ln-4515"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi2</span> <span class="o">=</span> <span class="n">phi2</span>
<a name="ln-4516"></a>
<a name="ln-4517"></a><span class="n">enl</span><span class="p">%</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
<a name="ln-4518"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-4519"></a><span class="n">enl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-4520"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-4521"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsy</span> <span class="o">=</span> <span class="n">numsy</span>
<a name="ln-4522"></a><span class="n">enl</span><span class="p">%</span><span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span>
<a name="ln-4523"></a><span class="n">enl</span><span class="p">%</span><span class="n">xpc</span> <span class="o">=</span> <span class="n">xpc</span>
<a name="ln-4524"></a><span class="n">enl</span><span class="p">%</span><span class="n">ypc</span> <span class="o">=</span> <span class="n">ypc</span>
<a name="ln-4525"></a><span class="n">enl</span><span class="p">%</span><span class="n">beamcurrent</span> <span class="o">=</span> <span class="n">beamcurrent</span>
<a name="ln-4526"></a><span class="n">enl</span><span class="p">%</span><span class="n">dwelltime</span> <span class="o">=</span> <span class="n">dwelltime</span>
<a name="ln-4527"></a><span class="n">enl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-4528"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rin</span> <span class="o">=</span> <span class="n">Rin</span>
<a name="ln-4529"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rout</span> <span class="o">=</span> <span class="n">Rout</span>
<a name="ln-4530"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetacone</span> <span class="o">=</span> <span class="n">thetacone</span>
<a name="ln-4531"></a><span class="n">enl</span><span class="p">%</span><span class="n">sampletilt</span> <span class="o">=</span> <span class="n">sampletilt</span>
<a name="ln-4532"></a><span class="n">enl</span><span class="p">%</span><span class="n">workingdistance</span> <span class="o">=</span> <span class="n">workingdistance</span>
<a name="ln-4533"></a><span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-4534"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskradius</span> <span class="o">=</span> <span class="n">maskradius</span>
<a name="ln-4535"></a><span class="n">enl</span><span class="p">%</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>
<a name="ln-4536"></a>
<a name="ln-4537"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_xpc</span> <span class="o">=</span> <span class="n">step_xpc</span>
<a name="ln-4538"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_ypc</span> <span class="o">=</span> <span class="n">step_ypc</span>
<a name="ln-4539"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_L</span> <span class="o">=</span> <span class="n">step_L</span>
<a name="ln-4540"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_phi1</span> <span class="o">=</span> <span class="n">step_phi1</span>
<a name="ln-4541"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_phi</span> <span class="o">=</span> <span class="n">step_phi</span>
<a name="ln-4542"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_phi2</span> <span class="o">=</span> <span class="n">step_phi2</span>
<a name="ln-4543"></a><span class="n">enl</span><span class="p">%</span><span class="n">step_thetacone</span> <span class="o">=</span> <span class="n">step_thetacone</span>
<a name="ln-4544"></a>
<a name="ln-4545"></a><span class="n">enl</span><span class="p">%</span><span class="n">nrun</span> <span class="o">=</span> <span class="n">nrun</span>
<a name="ln-4546"></a>
<a name="ln-4547"></a><span class="k">end subroutine </span><span class="n">GetEMDPFitNameList</span>
<a name="ln-4548"></a>
<a name="ln-4549"></a>
<a name="ln-4550"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4551"></a><span class="c">!</span>
<a name="ln-4552"></a><span class="c">! SUBROUTINE:GetECPSingleNameList</span>
<a name="ln-4553"></a><span class="c">!</span>
<a name="ln-4554"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-4555"></a><span class="c">!</span>
<a name="ln-4556"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMDPFit.f90)</span>
<a name="ln-4557"></a><span class="c">!</span>
<a name="ln-4558"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-4559"></a><span class="c">!&gt; @param enl ECP single name list structure</span>
<a name="ln-4560"></a><span class="c">!</span>
<a name="ln-4561"></a><span class="c">!&gt; @date 02/22/16  SS 1.0 original</span>
<a name="ln-4562"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4563"></a><span class="k">recursive subroutine </span><span class="n">GetECPSingleNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4564"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetECPSingleNameList</span>
<a name="ln-4565"></a>
<a name="ln-4566"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4567"></a>
<a name="ln-4568"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4569"></a>
<a name="ln-4570"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4571"></a><span class="k">type</span><span class="p">(</span><span class="n">ECPSingleNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-4572"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4573"></a>
<a name="ln-4574"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4575"></a>
<a name="ln-4576"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-4577"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">npix</span>
<a name="ln-4578"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-4579"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-4580"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">energyfile</span>
<a name="ln-4581"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-4582"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">eulerconvention</span>
<a name="ln-4583"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-4584"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sampletilt</span>
<a name="ln-4585"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">workingdistance</span>
<a name="ln-4586"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Rin</span>
<a name="ln-4587"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Rout</span>
<a name="ln-4588"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">phi2</span>
<a name="ln-4589"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-4590"></a>
<a name="ln-4591"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">ECPSinglelist</span> <span class="o">/</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">npix</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,</span> <span class="n">energyfile</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">eulerconvention</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4592"></a><span class="n">gammavalue</span><span class="p">,</span> <span class="n">sampletilt</span><span class="p">,</span> <span class="n">workingdistance</span><span class="p">,</span> <span class="n">Rin</span><span class="p">,</span> <span class="n">Rout</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">phi2</span><span class="p">,</span> <span class="nb">dmin</span>
<a name="ln-4593"></a>
<a name="ln-4594"></a>
<a name="ln-4595"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4596"></a><span class="n">npix</span> <span class="o">=</span> <span class="mi">512</span>
<a name="ln-4597"></a><span class="n">thetac</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4598"></a><span class="n">maskpattern</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<a name="ln-4599"></a><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4600"></a><span class="n">datafile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4601"></a><span class="n">eulerconvention</span> <span class="o">=</span> <span class="s1">&#39;tsl&#39;</span>
<a name="ln-4602"></a><span class="n">gammavalue</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4603"></a><span class="n">sampletilt</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-4604"></a><span class="n">workingdistance</span> <span class="o">=</span> <span class="mf">7.0</span>
<a name="ln-4605"></a><span class="n">Rin</span> <span class="o">=</span> <span class="mf">2.0</span>
<a name="ln-4606"></a><span class="n">Rout</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-4607"></a><span class="n">phi1</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-4608"></a><span class="n">phi</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-4609"></a><span class="n">phi2</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-4610"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.03</span>
<a name="ln-4611"></a>
<a name="ln-4612"></a>
<a name="ln-4613"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4614"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4615"></a><span class="k">end if</span>
<a name="ln-4616"></a>
<a name="ln-4617"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4618"></a><span class="c">! read the namelist file</span>
<a name="ln-4619"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4620"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">ECPSinglelist</span><span class="p">)</span>
<a name="ln-4621"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4622"></a>
<a name="ln-4623"></a><span class="c">! check for required entries</span>
<a name="ln-4624"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">energyfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4625"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMDPFit:&#39;</span><span class="p">,</span><span class="s1">&#39; energy file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4626"></a>    <span class="k">end if</span>
<a name="ln-4627"></a>
<a name="ln-4628"></a><span class="k">end if</span>
<a name="ln-4629"></a>
<a name="ln-4630"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-4631"></a><span class="n">enl</span><span class="p">%</span><span class="n">npix</span> <span class="o">=</span> <span class="n">npix</span>
<a name="ln-4632"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>
<a name="ln-4633"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>
<a name="ln-4634"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="n">energyfile</span>
<a name="ln-4635"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-4636"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerconvention</span> <span class="o">=</span> <span class="n">eulerconvention</span>
<a name="ln-4637"></a><span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>
<a name="ln-4638"></a><span class="n">enl</span><span class="p">%</span><span class="n">sampletilt</span> <span class="o">=</span> <span class="n">sampletilt</span>
<a name="ln-4639"></a><span class="n">enl</span><span class="p">%</span><span class="n">workingdistance</span> <span class="o">=</span> <span class="n">workingdistance</span>
<a name="ln-4640"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rin</span> <span class="o">=</span> <span class="n">Rin</span>
<a name="ln-4641"></a><span class="n">enl</span><span class="p">%</span><span class="n">Rout</span> <span class="o">=</span> <span class="n">Rout</span>
<a name="ln-4642"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi1</span> <span class="o">=</span> <span class="n">phi1</span>
<a name="ln-4643"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span>
<a name="ln-4644"></a><span class="n">enl</span><span class="p">%</span><span class="n">phi2</span> <span class="o">=</span> <span class="n">phi2</span>
<a name="ln-4645"></a><span class="n">enl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-4646"></a>
<a name="ln-4647"></a><span class="k">end subroutine </span><span class="n">GetECPSingleNameList</span>
<a name="ln-4648"></a>
<a name="ln-4649"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4650"></a><span class="c">!</span>
<a name="ln-4651"></a><span class="c">! SUBROUTINE:GetEMSTEMDCINameList</span>
<a name="ln-4652"></a><span class="c">!</span>
<a name="ln-4653"></a><span class="c">!&gt; @author Patrick Callahan</span>
<a name="ln-4654"></a><span class="c">!</span>
<a name="ln-4655"></a><span class="c">!&gt; @brief read namelist file for EMSTEMDCI</span>
<a name="ln-4656"></a><span class="c">!</span>
<a name="ln-4657"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-4658"></a><span class="c">!</span>
<a name="ln-4659"></a><span class="c">!&gt; @date 11/01/16  PGC 1.0 new routine</span>
<a name="ln-4660"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4661"></a>
<a name="ln-4662"></a><span class="k">recursive SUBROUTINE </span><span class="n">GetSTEMDCINameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">dcinl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4663"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetSTEMDCINameList</span>
<a name="ln-4664"></a>
<a name="ln-4665"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4666"></a>
<a name="ln-4667"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4668"></a>
<a name="ln-4669"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4670"></a><span class="k">type</span><span class="p">(</span><span class="n">STEMDCINameListType</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dcinl</span>
<a name="ln-4671"></a><span class="kt">logical</span><span class="p">,</span> <span class="k">OPTIONAL</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4672"></a>
<a name="ln-4673"></a><span class="kt">logical</span>                                  <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4674"></a>
<a name="ln-4675"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-4676"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-4677"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">progmode</span>
<a name="ln-4678"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-4679"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">kk</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-4680"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">lauec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-4681"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">STEMnmlfile</span>
<a name="ln-4682"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-4683"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">defectfilename</span>
<a name="ln-4684"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dispmode</span>
<a name="ln-4685"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">dispfile</span>
<a name="ln-4686"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">output</span>
<a name="ln-4687"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">dinfo</span>
<a name="ln-4688"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">t_interval</span>
<a name="ln-4689"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">DF_L</span>
<a name="ln-4690"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">DF_npix</span>
<a name="ln-4691"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">DF_npiy</span>
<a name="ln-4692"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">DF_slice</span>
<a name="ln-4693"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>        <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-4694"></a>
<a name="ln-4695"></a><span class="c">! DEFINE THE IO NAMELIST FOR VARIABLE PASSING</span>
<a name="ln-4696"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">STEMDCIdata</span> <span class="o">/</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">progmode</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">kk</span><span class="p">,</span> <span class="n">lauec</span><span class="p">,</span> <span class="n">STEMnmlfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4697"></a>                         <span class="n">dataname</span><span class="p">,</span> <span class="n">defectfilename</span><span class="p">,</span> <span class="n">dispmode</span><span class="p">,</span> <span class="n">dispfile</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">dinfo</span><span class="p">,</span> <span class="n">t_interval</span><span class="p">,</span> <span class="n">DF_L</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4698"></a>                         <span class="n">DF_npix</span><span class="p">,</span> <span class="n">DF_npiy</span><span class="p">,</span> <span class="n">DF_slice</span><span class="p">,</span> <span class="nb">dmin</span>
<a name="ln-4699"></a>
<a name="ln-4700"></a><span class="c">! SET INPUT PARAMETERS TO DEFAULT VALUES (EXCEPT XTALNAME, WHICH MUST BE PRESENT)</span>
<a name="ln-4701"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-4702"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">200000</span>
<a name="ln-4703"></a><span class="n">progmode</span> <span class="o">=</span> <span class="s1">&#39;STEM&#39;</span>
<a name="ln-4704"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4705"></a><span class="n">kk</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-4706"></a><span class="n">lauec</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-4707"></a><span class="n">STEMnmlfile</span> <span class="o">=</span> <span class="s1">&#39;STEM_rundata.nml&#39;</span>
<a name="ln-4708"></a><span class="n">defectfilename</span> <span class="o">=</span> <span class="s1">&#39;EMdefec/dispt.json&#39;</span>
<a name="ln-4709"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;/folder/to/trialbinary.data&#39;</span>
<a name="ln-4710"></a><span class="n">dispmode</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
<a name="ln-4711"></a><span class="n">dispfile</span> <span class="o">=</span> <span class="s1">&#39;test_ZA.data&#39;</span>
<a name="ln-4712"></a><span class="n">output</span> <span class="o">=</span> <span class="mi">6</span> <span class="c">! screen output</span>
<a name="ln-4713"></a><span class="n">dinfo</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! 1 is verbose</span>
<a name="ln-4714"></a><span class="n">t_interval</span> <span class="o">=</span> <span class="mi">5</span> <span class="c">! update every x steps</span>
<a name="ln-4715"></a><span class="n">DF_L</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4716"></a><span class="n">DF_npix</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-4717"></a><span class="n">DF_npiy</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-4718"></a><span class="n">DF_slice</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c">! slice thickness for scattering matrix approach (nmu)</span>
<a name="ln-4719"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.03</span>
<a name="ln-4720"></a>
<a name="ln-4721"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4722"></a><span class="c">! read the namelist file</span>
<a name="ln-4723"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4724"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">STEMDCIdata</span><span class="p">)</span>
<a name="ln-4725"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4726"></a>
<a name="ln-4727"></a><span class="c">! check for required entries</span>
<a name="ln-4728"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4729"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;STEMDCI:&#39;</span><span class="p">,</span><span class="s1">&#39; crystal structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4730"></a><span class="k">end if</span>
<a name="ln-4731"></a>
<a name="ln-4732"></a><span class="k">end if</span>
<a name="ln-4733"></a>
<a name="ln-4734"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-4735"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-4736"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">progmode</span> <span class="o">=</span> <span class="n">progmode</span>
<a name="ln-4737"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-4738"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">kk</span> <span class="o">=</span> <span class="n">kk</span>
<a name="ln-4739"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">lauec</span> <span class="o">=</span> <span class="n">lauec</span>
<a name="ln-4740"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">STEMnmlfile</span> <span class="o">=</span> <span class="n">STEMnmlfile</span>
<a name="ln-4741"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-4742"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">defectfilename</span> <span class="o">=</span> <span class="n">defectfilename</span>
<a name="ln-4743"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">dispmode</span> <span class="o">=</span> <span class="n">dispmode</span>
<a name="ln-4744"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">dispfile</span> <span class="o">=</span> <span class="n">dispfile</span>
<a name="ln-4745"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
<a name="ln-4746"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span>
<a name="ln-4747"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">t_interval</span> <span class="o">=</span> <span class="n">t_interval</span>
<a name="ln-4748"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">DF_L</span> <span class="o">=</span> <span class="n">DF_L</span>
<a name="ln-4749"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">DF_npix</span> <span class="o">=</span> <span class="n">DF_npix</span>
<a name="ln-4750"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">DF_npiy</span> <span class="o">=</span> <span class="n">DF_npiy</span>
<a name="ln-4751"></a><span class="n">dcinl</span><span class="p">%</span><span class="n">DF_slice</span> <span class="o">=</span> <span class="n">DF_slice</span>
<a name="ln-4752"></a><span class="n">dcinl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-4753"></a>
<a name="ln-4754"></a>
<a name="ln-4755"></a><span class="k">END SUBROUTINE </span><span class="n">GetSTEMDCINameList</span>
<a name="ln-4756"></a>
<a name="ln-4757"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4758"></a><span class="c">!</span>
<a name="ln-4759"></a><span class="c">! SUBROUTINE:GetRefineOrientationNameList</span>
<a name="ln-4760"></a><span class="c">!</span>
<a name="ln-4761"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-4762"></a><span class="c">!</span>
<a name="ln-4763"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMRefineOrientation.f90)</span>
<a name="ln-4764"></a><span class="c">!</span>
<a name="ln-4765"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-4766"></a><span class="c">!&gt; @param enl single name list structure</span>
<a name="ln-4767"></a><span class="c">!</span>
<a name="ln-4768"></a><span class="c">!&gt; @date 02/22/16  SS 1.0 original</span>
<a name="ln-4769"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4770"></a><span class="k">recursive subroutine </span><span class="n">GetRefineOrientationNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4771"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetRefineOrientationNameList</span>
<a name="ln-4772"></a>
<a name="ln-4773"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4774"></a>
<a name="ln-4775"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4776"></a>
<a name="ln-4777"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4778"></a><span class="k">type</span><span class="p">(</span><span class="n">RefineOrientationtype</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-4779"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4780"></a>
<a name="ln-4781"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4782"></a>
<a name="ln-4783"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-4784"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-4785"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">ctffile</span>
<a name="ln-4786"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nmis</span>
<a name="ln-4787"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">niter</span>
<a name="ln-4788"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step</span>
<a name="ln-4789"></a>
<a name="ln-4790"></a>
<a name="ln-4791"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">RefineOrientations</span> <span class="o">/</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">dotproductfile</span><span class="p">,</span> <span class="n">ctffile</span><span class="p">,</span> <span class="n">nmis</span><span class="p">,</span> <span class="n">niter</span><span class="p">,</span> <span class="n">step</span>
<a name="ln-4792"></a>
<a name="ln-4793"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4794"></a><span class="n">dotproductfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4795"></a><span class="n">ctffile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4796"></a><span class="n">nmis</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4797"></a><span class="n">niter</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4798"></a><span class="n">step</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4799"></a>
<a name="ln-4800"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4801"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4802"></a><span class="k">end if</span>
<a name="ln-4803"></a>
<a name="ln-4804"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4805"></a><span class="c">! read the namelist file</span>
<a name="ln-4806"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4807"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">RefineOrientations</span><span class="p">)</span>
<a name="ln-4808"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4809"></a>
<a name="ln-4810"></a><span class="c">! check for required entries</span>
<a name="ln-4811"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4812"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMRefineOrientation:&#39;</span><span class="p">,</span><span class="s1">&#39; dotproduct file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4813"></a>    <span class="k">end if</span>
<a name="ln-4814"></a>
<a name="ln-4815"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4816"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMRefineOrientation:&#39;</span><span class="p">,</span><span class="s1">&#39; ctf file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4817"></a>    <span class="k">end if</span>
<a name="ln-4818"></a>
<a name="ln-4819"></a>
<a name="ln-4820"></a><span class="k">end if</span>
<a name="ln-4821"></a>
<a name="ln-4822"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-4823"></a><span class="n">enl</span><span class="p">%</span><span class="n">dotproductfile</span> <span class="o">=</span> <span class="n">dotproductfile</span>
<a name="ln-4824"></a><span class="n">enl</span><span class="p">%</span><span class="n">ctffile</span> <span class="o">=</span> <span class="n">ctffile</span>
<a name="ln-4825"></a><span class="n">enl</span><span class="p">%</span><span class="n">nmis</span> <span class="o">=</span> <span class="n">nmis</span>
<a name="ln-4826"></a><span class="n">enl</span><span class="p">%</span><span class="n">niter</span> <span class="o">=</span> <span class="n">niter</span>
<a name="ln-4827"></a><span class="n">enl</span><span class="p">%</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
<a name="ln-4828"></a>
<a name="ln-4829"></a><span class="k">end subroutine </span><span class="n">GetRefineOrientationNameList</span>
<a name="ln-4830"></a>
<a name="ln-4831"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4832"></a><span class="c">!</span>
<a name="ln-4833"></a><span class="c">! SUBROUTINE:GetFitOrientationPSNameList</span>
<a name="ln-4834"></a><span class="c">!</span>
<a name="ln-4835"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-4836"></a><span class="c">!</span>
<a name="ln-4837"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMFitOrientationPS.f90)</span>
<a name="ln-4838"></a><span class="c">!</span>
<a name="ln-4839"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-4840"></a><span class="c">!&gt; @param enl single name list structure</span>
<a name="ln-4841"></a><span class="c">!</span>
<a name="ln-4842"></a><span class="c">!&gt; @date 02/22/16  SS 1.0 original</span>
<a name="ln-4843"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4844"></a><span class="k">recursive subroutine </span><span class="n">GetFitOrientationPSNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4845"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetFitOrientationPSNameList</span>
<a name="ln-4846"></a>
<a name="ln-4847"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4848"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-4849"></a>
<a name="ln-4850"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4851"></a>
<a name="ln-4852"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4853"></a><span class="k">type</span><span class="p">(</span><span class="n">FitOrientationPStype</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-4854"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4855"></a>
<a name="ln-4856"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4857"></a>
<a name="ln-4858"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-4859"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">dotproductfile</span>
<a name="ln-4860"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">ctffile</span>
<a name="ln-4861"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">step</span>
<a name="ln-4862"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>                                    <span class="kd">::</span> <span class="n">angleaxis</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-4863"></a>
<a name="ln-4864"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">FitOrientationPS</span> <span class="o">/</span> <span class="n">nthreads</span><span class="p">,</span> <span class="n">dotproductfile</span><span class="p">,</span> <span class="n">ctffile</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">angleaxis</span>
<a name="ln-4865"></a>
<a name="ln-4866"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4867"></a><span class="n">dotproductfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4868"></a><span class="n">ctffile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4869"></a><span class="n">step</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-4870"></a><span class="n">angleaxis</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">12</span><span class="mf">0.0</span><span class="o">/</span><span class="p">)</span>
<a name="ln-4871"></a>
<a name="ln-4872"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4873"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4874"></a><span class="k">end if</span>
<a name="ln-4875"></a>
<a name="ln-4876"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4877"></a><span class="c">! read the namelist file</span>
<a name="ln-4878"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4879"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">FitOrientationPS</span><span class="p">)</span>
<a name="ln-4880"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4881"></a>
<a name="ln-4882"></a><span class="c">! check for required entries</span>
<a name="ln-4883"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4884"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMRefineOrientation:&#39;</span><span class="p">,</span><span class="s1">&#39; dotproduct file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4885"></a>    <span class="k">end if</span>
<a name="ln-4886"></a>
<a name="ln-4887"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dotproductfile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4888"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMRefineOrientation:&#39;</span><span class="p">,</span><span class="s1">&#39; ctf file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-4889"></a>    <span class="k">end if</span>
<a name="ln-4890"></a>
<a name="ln-4891"></a><span class="k">    if</span><span class="p">(</span><span class="nb">NORM2</span><span class="p">(</span><span class="n">angleaxis</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4892"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;GetFitOrientationPSNameList:&#39;</span><span class="p">,</span><span class="s1">&#39;The angle axis for pseudosymmetric variant has norm 0&#39;</span><span class="p">)</span>
<a name="ln-4893"></a>    <span class="k">end if</span>
<a name="ln-4894"></a>
<a name="ln-4895"></a><span class="k">end if</span>
<a name="ln-4896"></a>
<a name="ln-4897"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-4898"></a><span class="n">enl</span><span class="p">%</span><span class="n">dotproductfile</span> <span class="o">=</span> <span class="n">dotproductfile</span>
<a name="ln-4899"></a><span class="n">enl</span><span class="p">%</span><span class="n">ctffile</span> <span class="o">=</span> <span class="n">ctffile</span>
<a name="ln-4900"></a><span class="n">enl</span><span class="p">%</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
<a name="ln-4901"></a><span class="n">enl</span><span class="p">%</span><span class="n">angleaxis</span> <span class="o">=</span> <span class="n">angleaxis</span>
<a name="ln-4902"></a>
<a name="ln-4903"></a><span class="k">end subroutine </span><span class="n">GetFitOrientationPSNameList</span>
<a name="ln-4904"></a>
<a name="ln-4905"></a>
<a name="ln-4906"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4907"></a><span class="c">!</span>
<a name="ln-4908"></a><span class="c">! SUBROUTINE:GetMCCLsphereNameList</span>
<a name="ln-4909"></a><span class="c">!</span>
<a name="ln-4910"></a><span class="c">!&gt; @author Saransh Singh/Marc De Graef, Carnegie Mellon University</span>
<a name="ln-4911"></a><span class="c">!</span>
<a name="ln-4912"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMMCCL.f90)</span>
<a name="ln-4913"></a><span class="c">!</span>
<a name="ln-4914"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-4915"></a><span class="c">!&gt; @param mcnl Monte Carloname list structure</span>
<a name="ln-4916"></a><span class="c">!</span>
<a name="ln-4917"></a><span class="c">!&gt; @date 10/20/16  SS 1.0 new routine; adapted from GetMCCLNameList</span>
<a name="ln-4918"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-4919"></a><span class="k">recursive subroutine </span><span class="n">GetMCCLsphereNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">mcnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-4920"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetMCCLsphereNameList</span>
<a name="ln-4921"></a>
<a name="ln-4922"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-4923"></a>
<a name="ln-4924"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-4925"></a>
<a name="ln-4926"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-4927"></a><span class="k">type</span><span class="p">(</span><span class="n">MCCLNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">mcnl</span>
<a name="ln-4928"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-4929"></a>
<a name="ln-4930"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-4931"></a>
<a name="ln-4932"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-4933"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-4934"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">globalworkgrpsz</span>
<a name="ln-4935"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">num_el</span>
<a name="ln-4936"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">totnum_el</span>
<a name="ln-4937"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">multiplier</span>
<a name="ln-4938"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-4939"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-4940"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sig</span>
<a name="ln-4941"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sigstart</span>
<a name="ln-4942"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sigend</span>
<a name="ln-4943"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sigstep</span>
<a name="ln-4944"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-4945"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">EkeV</span>
<a name="ln-4946"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ehistmin</span>
<a name="ln-4947"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ebinsize</span>
<a name="ln-4948"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthmax</span>
<a name="ln-4949"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthstep</span>
<a name="ln-4950"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MCmode</span>
<a name="ln-4951"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-4952"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-4953"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">mode</span>
<a name="ln-4954"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">incloc</span>
<a name="ln-4955"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">radius</span>
<a name="ln-4956"></a>
<a name="ln-4957"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-4958"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">MCCLdata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">sigstart</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">num_el</span><span class="p">,</span> <span class="n">globalworkgrpsz</span><span class="p">,</span> <span class="n">EkeV</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4959"></a><span class="n">dataname</span><span class="p">,</span> <span class="n">totnum_el</span><span class="p">,</span> <span class="n">Ehistmin</span><span class="p">,</span> <span class="n">Ebinsize</span><span class="p">,</span> <span class="n">depthstep</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">MCmode</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-4960"></a><span class="n">sigend</span><span class="p">,</span> <span class="n">sigstep</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">incloc</span>
<a name="ln-4961"></a>
<a name="ln-4962"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-4963"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-4964"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">1501</span>
<a name="ln-4965"></a><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="mi">100</span>
<a name="ln-4966"></a><span class="n">num_el</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-4967"></a><span class="n">totnum_el</span> <span class="o">=</span> <span class="mi">2000000000</span>
<a name="ln-4968"></a><span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4969"></a><span class="n">devid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4970"></a><span class="n">platid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-4971"></a><span class="n">sig</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-4972"></a><span class="n">sigstart</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-4973"></a><span class="n">sigend</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>
<a name="ln-4974"></a><span class="n">sigstep</span> <span class="o">=</span> <span class="mf">1.D0</span>
<a name="ln-4975"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-4976"></a><span class="n">EkeV</span> <span class="o">=</span> <span class="mi">3</span><span class="mf">0.D0</span>
<a name="ln-4977"></a><span class="n">Ehistmin</span> <span class="o">=</span> <span class="mf">5.D0</span>
<a name="ln-4978"></a><span class="n">Ebinsize</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-4979"></a><span class="n">depthstep</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-4980"></a><span class="n">MCmode</span> <span class="o">=</span> <span class="s1">&#39;CSDA&#39;</span>
<a name="ln-4981"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-4982"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;MCoutput.data&#39;</span>
<a name="ln-4983"></a><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>
<a name="ln-4984"></a><span class="n">radius</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.D0</span>
<a name="ln-4985"></a><span class="n">incloc</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-4986"></a>
<a name="ln-4987"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4988"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-4989"></a><span class="k">end if</span>
<a name="ln-4990"></a>
<a name="ln-4991"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4992"></a><span class="c">! read the namelist file</span>
<a name="ln-4993"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-4994"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">MCCLdata</span><span class="p">)</span>
<a name="ln-4995"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-4996"></a>
<a name="ln-4997"></a><span class="c">! check for required entries</span>
<a name="ln-4998"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4999"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMMC:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5000"></a><span class="k">end if</span>
<a name="ln-5001"></a><span class="k">end if</span>
<a name="ln-5002"></a>
<a name="ln-5003"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the mcnl fields</span>
<a name="ln-5004"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-5005"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-5006"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="n">globalworkgrpsz</span>
<a name="ln-5007"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">num_el</span> <span class="o">=</span> <span class="n">num_el</span>
<a name="ln-5008"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">totnum_el</span> <span class="o">=</span> <span class="n">totnum_el</span>
<a name="ln-5009"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">multiplier</span>
<a name="ln-5010"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>
<a name="ln-5011"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>
<a name="ln-5012"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sigstart</span> <span class="o">=</span> <span class="n">sigstart</span>
<a name="ln-5013"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sigend</span> <span class="o">=</span> <span class="n">sigend</span>
<a name="ln-5014"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sigstep</span> <span class="o">=</span> <span class="n">sigstep</span>
<a name="ln-5015"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span>
<a name="ln-5016"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-5017"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">EkeV</span> <span class="o">=</span> <span class="n">EkeV</span>
<a name="ln-5018"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ehistmin</span> <span class="o">=</span> <span class="n">Ehistmin</span>
<a name="ln-5019"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ebinsize</span> <span class="o">=</span> <span class="n">Ebinsize</span>
<a name="ln-5020"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthstep</span> <span class="o">=</span> <span class="n">depthstep</span>
<a name="ln-5021"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">MCmode</span> <span class="o">=</span> <span class="n">MCmode</span>
<a name="ln-5022"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-5023"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-5024"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
<a name="ln-5025"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
<a name="ln-5026"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">incloc</span> <span class="o">=</span> <span class="n">incloc</span>
<a name="ln-5027"></a>
<a name="ln-5028"></a><span class="k">end subroutine </span><span class="n">GetMCCLsphereNameList</span>
<a name="ln-5029"></a>
<a name="ln-5030"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5031"></a><span class="c">!</span>
<a name="ln-5032"></a><span class="c">! SUBROUTINE:GetMCCLfoilNameList</span>
<a name="ln-5033"></a><span class="c">!</span>
<a name="ln-5034"></a><span class="c">!&gt; @author Saransh Singh/Marc De Graef, Carnegie Mellon University</span>
<a name="ln-5035"></a><span class="c">!</span>
<a name="ln-5036"></a><span class="c">!&gt; @brief read namelist file and fill mcnl structure (used by EMMCfoil.f90)</span>
<a name="ln-5037"></a><span class="c">!</span>
<a name="ln-5038"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-5039"></a><span class="c">!&gt; @param mcnl Monte Carloname list structure</span>
<a name="ln-5040"></a><span class="c">!</span>
<a name="ln-5041"></a><span class="c">!&gt; @date 01/15/17 MDG 1.0 new routine; adapted from GetMCCLNameList</span>
<a name="ln-5042"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5043"></a><span class="k">recursive subroutine </span><span class="n">GetMCCLfoilNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">mcnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-5044"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetMCCLfoilNameList</span>
<a name="ln-5045"></a>
<a name="ln-5046"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-5047"></a>
<a name="ln-5048"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-5049"></a>
<a name="ln-5050"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-5051"></a><span class="k">type</span><span class="p">(</span><span class="n">MCCLNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">mcnl</span>
<a name="ln-5052"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-5053"></a>
<a name="ln-5054"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-5055"></a>
<a name="ln-5056"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">stdout</span>
<a name="ln-5057"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-5058"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">globalworkgrpsz</span>
<a name="ln-5059"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">num_el</span>
<a name="ln-5060"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">totnum_el</span>
<a name="ln-5061"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">multiplier</span>
<a name="ln-5062"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-5063"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-5064"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sig</span>
<a name="ln-5065"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-5066"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">EkeV</span>
<a name="ln-5067"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ehistmin</span>
<a name="ln-5068"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ebinsize</span>
<a name="ln-5069"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthmax</span>
<a name="ln-5070"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthstep</span>
<a name="ln-5071"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thickness</span>
<a name="ln-5072"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MCmode</span>
<a name="ln-5073"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-5074"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-5075"></a>
<a name="ln-5076"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-5077"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">MCCLfoildata</span> <span class="o">/</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">num_el</span><span class="p">,</span> <span class="n">globalworkgrpsz</span><span class="p">,</span> <span class="n">EkeV</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5078"></a><span class="n">dataname</span><span class="p">,</span> <span class="n">totnum_el</span><span class="p">,</span> <span class="n">Ehistmin</span><span class="p">,</span> <span class="n">Ebinsize</span><span class="p">,</span> <span class="n">depthstep</span><span class="p">,</span> <span class="n">depthmax</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">MCmode</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5079"></a><span class="n">sig</span><span class="p">,</span> <span class="n">thickness</span>
<a name="ln-5080"></a>
<a name="ln-5081"></a><span class="c">! set the input parameters to default values (except for xtalname, which must be present)</span>
<a name="ln-5082"></a><span class="n">stdout</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-5083"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">501</span>
<a name="ln-5084"></a><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="mi">100</span>
<a name="ln-5085"></a><span class="n">num_el</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-5086"></a><span class="n">totnum_el</span> <span class="o">=</span> <span class="mi">2000000000</span>
<a name="ln-5087"></a><span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-5088"></a><span class="n">devid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-5089"></a><span class="n">platid</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-5090"></a><span class="n">sig</span> <span class="o">=</span> <span class="mi">2</span><span class="mf">0.D0</span>
<a name="ln-5091"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-5092"></a><span class="n">EkeV</span> <span class="o">=</span> <span class="mi">3</span><span class="mf">0.D0</span>
<a name="ln-5093"></a><span class="n">Ehistmin</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.D0</span>
<a name="ln-5094"></a><span class="n">Ebinsize</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-5095"></a><span class="n">depthmax</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0D0</span>
<a name="ln-5096"></a><span class="n">depthstep</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-5097"></a><span class="n">MCmode</span> <span class="o">=</span> <span class="s1">&#39;CSDA&#39;</span>
<a name="ln-5098"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-5099"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;MCoutput.data&#39;</span>
<a name="ln-5100"></a><span class="n">thickness</span> <span class="o">=</span> <span class="mi">20</span><span class="mf">0.0</span>
<a name="ln-5101"></a>
<a name="ln-5102"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5103"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-5104"></a><span class="k">end if</span>
<a name="ln-5105"></a>
<a name="ln-5106"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5107"></a><span class="c">! read the namelist file</span>
<a name="ln-5108"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-5109"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">MCCLfoildata</span><span class="p">)</span>
<a name="ln-5110"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-5111"></a>
<a name="ln-5112"></a><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">MCCLfoildata</span><span class="p">)</span>
<a name="ln-5113"></a>
<a name="ln-5114"></a><span class="c">! check for required entries</span>
<a name="ln-5115"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5116"></a><span class="k">call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMMC:&#39;</span><span class="p">,</span><span class="s1">&#39; structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5117"></a><span class="k">end if</span>
<a name="ln-5118"></a><span class="k">end if</span>
<a name="ln-5119"></a>
<a name="ln-5120"></a><span class="c">! if we get here, then all appears to be ok, and we need to fill in the mcnl fields</span>
<a name="ln-5121"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span>
<a name="ln-5122"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>
<a name="ln-5123"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="n">globalworkgrpsz</span>
<a name="ln-5124"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">num_el</span> <span class="o">=</span> <span class="n">num_el</span>
<a name="ln-5125"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">totnum_el</span> <span class="o">=</span> <span class="n">totnum_el</span>
<a name="ln-5126"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">multiplier</span>
<a name="ln-5127"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>
<a name="ln-5128"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>
<a name="ln-5129"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span>
<a name="ln-5130"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
<a name="ln-5131"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">EkeV</span> <span class="o">=</span> <span class="n">EkeV</span>
<a name="ln-5132"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ehistmin</span> <span class="o">=</span> <span class="n">Ehistmin</span>
<a name="ln-5133"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">Ebinsize</span> <span class="o">=</span> <span class="n">Ebinsize</span>
<a name="ln-5134"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthmax</span> <span class="o">=</span> <span class="n">depthmax</span>
<a name="ln-5135"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">depthstep</span> <span class="o">=</span> <span class="n">depthstep</span>
<a name="ln-5136"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">MCmode</span> <span class="o">=</span> <span class="n">MCmode</span>
<a name="ln-5137"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-5138"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-5139"></a><span class="n">mcnl</span><span class="p">%</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">thickness</span>
<a name="ln-5140"></a>
<a name="ln-5141"></a><span class="k">end subroutine </span><span class="n">GetMCCLfoilNameList</span>
<a name="ln-5142"></a>
<a name="ln-5143"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5144"></a><span class="c">!</span>
<a name="ln-5145"></a><span class="c">! SUBROUTINE:GetEBSDFullNameList</span>
<a name="ln-5146"></a><span class="c">!</span>
<a name="ln-5147"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-5148"></a><span class="c">!</span>
<a name="ln-5149"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by EMEBSDFull.f90)</span>
<a name="ln-5150"></a><span class="c">!</span>
<a name="ln-5151"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-5152"></a><span class="c">!&gt; @param enl EBSD name list structure</span>
<a name="ln-5153"></a><span class="c">!</span>
<a name="ln-5154"></a><span class="c">!&gt; @date 01/24/17  SS 1.0 new routine</span>
<a name="ln-5155"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5156"></a><span class="k">recursive subroutine </span><span class="n">GetEBSDFullNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">enl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-5157"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetEBSDFullNameList</span>
<a name="ln-5158"></a>
<a name="ln-5159"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-5160"></a>
<a name="ln-5161"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-5162"></a>
<a name="ln-5163"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-5164"></a><span class="k">type</span><span class="p">(</span><span class="n">EBSDNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">enl</span>
<a name="ln-5165"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-5166"></a>
<a name="ln-5167"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-5168"></a>
<a name="ln-5169"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-5170"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-5171"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">totnum_el</span>
<a name="ln-5172"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">EkeV</span>
<a name="ln-5173"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ehistmin</span>
<a name="ln-5174"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">Ebinsize</span>
<a name="ln-5175"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthmax</span>
<a name="ln-5176"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">depthstep</span>
<a name="ln-5177"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">beamcurrent</span>
<a name="ln-5178"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dwelltime</span>
<a name="ln-5179"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">sig</span>
<a name="ln-5180"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">omega</span>
<a name="ln-5181"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">L</span>
<a name="ln-5182"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">xpc</span>
<a name="ln-5183"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ypc</span>
<a name="ln-5184"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">thetac</span>
<a name="ln-5185"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">delta</span>
<a name="ln-5186"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsx</span>
<a name="ln-5187"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">numsy</span>
<a name="ln-5188"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">binning</span>
<a name="ln-5189"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">scalingmode</span>
<a name="ln-5190"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">gammavalue</span>
<a name="ln-5191"></a><span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">maskpattern</span>
<a name="ln-5192"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-5193"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">platid</span>
<a name="ln-5194"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">devid</span>
<a name="ln-5195"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">globalworkgrpsz</span>
<a name="ln-5196"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">eulerconvention</span>
<a name="ln-5197"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">anglefile</span>
<a name="ln-5198"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">datafile</span>
<a name="ln-5199"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">multiplier</span>
<a name="ln-5200"></a>
<a name="ln-5201"></a>
<a name="ln-5202"></a><span class="c">! define the IO namelist to facilitate passing variables to the program.</span>
<a name="ln-5203"></a><span class="k">namelist</span>  <span class="o">/</span> <span class="n">EBSDFulldata</span> <span class="o">/</span> <span class="n">xtalname</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">totnum_el</span><span class="p">,</span> <span class="n">EkeV</span><span class="p">,</span> <span class="n">Ehistmin</span><span class="p">,</span> <span class="n">Ebinsize</span><span class="p">,</span> <span class="n">depthmax</span><span class="p">,</span> <span class="n">depthstep</span><span class="p">,</span> <span class="n">beamcurrent</span><span class="p">,&amp;</span>
<a name="ln-5204"></a>          <span class="n">dwelltime</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">xpc</span><span class="p">,</span> <span class="n">ypc</span><span class="p">,</span> <span class="n">thetac</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">numsx</span><span class="p">,</span> <span class="n">numsy</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">scalingmode</span><span class="p">,</span> <span class="n">gammavalue</span><span class="p">,</span> <span class="n">maskpattern</span><span class="p">,&amp;</span>
<a name="ln-5205"></a>          <span class="n">nthreads</span><span class="p">,</span> <span class="n">platid</span><span class="p">,</span> <span class="n">devid</span><span class="p">,</span>  <span class="n">globalworkgrpsz</span><span class="p">,</span> <span class="n">eulerconvention</span><span class="p">,</span> <span class="n">anglefile</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">multiplier</span>
<a name="ln-5206"></a><span class="c">! set the input parameters to default values (except for xtalname, anglefile and datafile, which must be present)</span>
<a name="ln-5207"></a>
<a name="ln-5208"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! name of xtal</span>
<a name="ln-5209"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.04D0</span>                 <span class="c">! maximum g vector used in computation</span>
<a name="ln-5210"></a><span class="n">totnum_el</span> <span class="o">=</span> <span class="mi">2000000000</span>        <span class="c">! number of electrons for MC run</span>
<a name="ln-5211"></a><span class="n">EkeV</span> <span class="o">=</span> <span class="mi">2</span><span class="mf">0.D0</span>                  <span class="c">! incident electron energy [kV]</span>
<a name="ln-5212"></a><span class="n">Ehistmin</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.D0</span>              <span class="c">! cutoff energy [kV]</span>
<a name="ln-5213"></a><span class="n">Ebinsize</span> <span class="o">=</span> <span class="mf">1.D0</span>               <span class="c">! energy step size [kV]</span>
<a name="ln-5214"></a><span class="n">depthmax</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.D0</span>             <span class="c">! depth cutoff [nm]</span>
<a name="ln-5215"></a><span class="n">depthstep</span> <span class="o">=</span> <span class="mf">1.D0</span>              <span class="c">! depth bin size [nm]</span>
<a name="ln-5216"></a><span class="n">beamcurrent</span> <span class="o">=</span> <span class="mi">100</span><span class="mf">0.D0</span>         <span class="c">! [nA]</span>
<a name="ln-5217"></a><span class="n">dwelltime</span> <span class="o">=</span> <span class="mi">100</span><span class="mf">0.D0</span>           <span class="c">! [micro seconds]</span>
<a name="ln-5218"></a><span class="n">sig</span> <span class="o">=</span> <span class="mi">7</span><span class="mf">0.D0</span>                   <span class="c">! sample tilt angle [degrees]</span>
<a name="ln-5219"></a><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.D0</span>                  <span class="c">! tilt about RD axis [degrees]</span>
<a name="ln-5220"></a><span class="n">L</span> <span class="o">=</span> <span class="mi">1500</span><span class="mf">0.0</span>                   <span class="c">! scintillator to sample distance [micro m]</span>
<a name="ln-5221"></a><span class="n">xpc</span> <span class="o">=</span> <span class="mf">0.0</span>                     <span class="c">! units of pixel [dimensionless]</span>
<a name="ln-5222"></a><span class="n">ypc</span> <span class="o">=</span> <span class="mf">0.0</span>                     <span class="c">! units of pixel [dimensionless] </span>
<a name="ln-5223"></a><span class="n">thetac</span> <span class="o">=</span> <span class="mi">1</span><span class="mf">0.0</span>                 <span class="c">! camera elevation [degrees]</span>
<a name="ln-5224"></a><span class="n">delta</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">9.2</span>                  <span class="c">! physical size of detector pixel [micro m]</span>
<a name="ln-5225"></a><span class="n">numsx</span> <span class="o">=</span> <span class="mi">480</span>                   <span class="c">! number of pixel is x direction of scintillator</span>
<a name="ln-5226"></a><span class="n">numsy</span> <span class="o">=</span> <span class="mi">480</span>                   <span class="c">! number of pixel is y direction of scintillator</span>
<a name="ln-5227"></a><span class="n">binning</span> <span class="o">=</span> <span class="mi">1</span>                   <span class="c">! detector binning</span>
<a name="ln-5228"></a><span class="n">scalingmode</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>           <span class="c">! intensity scaling in detector</span>
<a name="ln-5229"></a><span class="n">gammavalue</span> <span class="o">=</span> <span class="mf">0.34</span>             <span class="c">! intensity scaling factor</span>
<a name="ln-5230"></a><span class="n">maskpattern</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>             <span class="c">! circular mask or not</span>
<a name="ln-5231"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">1</span>                  <span class="c">! number of CPU threads for computation</span>
<a name="ln-5232"></a><span class="n">platid</span> <span class="o">=</span> <span class="mi">2</span>                    <span class="c">! platform id for GPU</span>
<a name="ln-5233"></a><span class="n">devid</span> <span class="o">=</span> <span class="mi">1</span>                     <span class="c">! device id for GPU</span>
<a name="ln-5234"></a><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="mi">256</span>         <span class="c">! work group size</span>
<a name="ln-5235"></a><span class="n">eulerconvention</span> <span class="o">=</span> <span class="s1">&#39;tsl&#39;</span>       <span class="c">! euler angle convention</span>
<a name="ln-5236"></a><span class="n">anglefile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>       <span class="c">! list of euler angles for which simulation is done</span>
<a name="ln-5237"></a><span class="n">datafile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>        <span class="c">! output HDF5 file</span>
<a name="ln-5238"></a><span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-5239"></a>
<a name="ln-5240"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5241"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-5242"></a><span class="k">end if</span>
<a name="ln-5243"></a>
<a name="ln-5244"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5245"></a><span class="c">! read the namelist file</span>
<a name="ln-5246"></a> <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-5247"></a> <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">EBSDFulldata</span><span class="p">)</span>
<a name="ln-5248"></a> <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-5249"></a>
<a name="ln-5250"></a><span class="c">! check for required entries</span>
<a name="ln-5251"></a>
<a name="ln-5252"></a> <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">anglefile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5253"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; angle file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5254"></a> <span class="k">end if</span>
<a name="ln-5255"></a>
<a name="ln-5256"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5257"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; xtal file is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5258"></a> <span class="k">end if</span>
<a name="ln-5259"></a>
<a name="ln-5260"></a><span class="k"> if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">datafile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5261"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;EMEBSD:&#39;</span><span class="p">,</span><span class="s1">&#39; output file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5262"></a> <span class="k">end if</span>
<a name="ln-5263"></a><span class="k">end if</span>
<a name="ln-5264"></a>
<a name="ln-5265"></a><span class="n">enl</span><span class="p">%</span><span class="n">MCxtalname</span> <span class="o">=</span> <span class="n">xtalname</span>                     <span class="c">! name of xtal</span>
<a name="ln-5266"></a><span class="n">enl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>                               <span class="c">! maximum g vector used in computation</span>
<a name="ln-5267"></a><span class="n">enl</span><span class="p">%</span><span class="n">totnum_el</span> <span class="o">=</span> <span class="n">totnum_el</span>                     <span class="c">! number of electrons for MC run</span>
<a name="ln-5268"></a><span class="n">enl</span><span class="p">%</span><span class="n">EkeV</span> <span class="o">=</span> <span class="n">EkeV</span>                               <span class="c">! incident electron energy [kV]</span>
<a name="ln-5269"></a><span class="n">enl</span><span class="p">%</span><span class="n">Ehistmin</span> <span class="o">=</span> <span class="n">Ehistmin</span>                       <span class="c">! cutoff energy [kV]</span>
<a name="ln-5270"></a><span class="n">enl</span><span class="p">%</span><span class="n">Ebinsize</span> <span class="o">=</span> <span class="n">Ebinsize</span>                       <span class="c">! energy step size [kV]</span>
<a name="ln-5271"></a><span class="n">enl</span><span class="p">%</span><span class="n">depthmax</span> <span class="o">=</span> <span class="n">depthmax</span>                       <span class="c">! depth cutoff [nm]</span>
<a name="ln-5272"></a><span class="n">enl</span><span class="p">%</span><span class="n">depthstep</span> <span class="o">=</span> <span class="n">depthstep</span>                     <span class="c">! depth bin size [nm]</span>
<a name="ln-5273"></a><span class="n">enl</span><span class="p">%</span><span class="n">beamcurrent</span> <span class="o">=</span> <span class="n">beamcurrent</span>                 <span class="c">! [nA]</span>
<a name="ln-5274"></a><span class="n">enl</span><span class="p">%</span><span class="n">dwelltime</span> <span class="o">=</span> <span class="n">dwelltime</span>                     <span class="c">! [micro seconds]</span>
<a name="ln-5275"></a><span class="n">enl</span><span class="p">%</span><span class="n">MCsig</span> <span class="o">=</span> <span class="n">sig</span>                               <span class="c">! sample tilt angle [degrees]</span>
<a name="ln-5276"></a><span class="n">enl</span><span class="p">%</span><span class="n">MComega</span> <span class="o">=</span> <span class="n">omega</span>                           <span class="c">! tilt about RD axis [degrees]</span>
<a name="ln-5277"></a><span class="n">enl</span><span class="p">%</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>                                     <span class="c">! scintillator to sample distance [micro m]</span>
<a name="ln-5278"></a><span class="n">enl</span><span class="p">%</span><span class="n">xpc</span> <span class="o">=</span> <span class="n">xpc</span>                                 <span class="c">! units of pixel [dimensionless]</span>
<a name="ln-5279"></a><span class="n">enl</span><span class="p">%</span><span class="n">ypc</span> <span class="o">=</span> <span class="n">ypc</span>                                 <span class="c">! units of pixel [dimensionless] </span>
<a name="ln-5280"></a><span class="n">enl</span><span class="p">%</span><span class="n">thetac</span> <span class="o">=</span> <span class="n">thetac</span>                           <span class="c">! camera elevation [degrees]</span>
<a name="ln-5281"></a><span class="n">enl</span><span class="p">%</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>                             <span class="c">! physical size of detector pixel [micro m]</span>
<a name="ln-5282"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsx</span> <span class="o">=</span> <span class="n">numsx</span>                             <span class="c">! number of pixel is x direction of scintillator</span>
<a name="ln-5283"></a><span class="n">enl</span><span class="p">%</span><span class="n">numsy</span> <span class="o">=</span> <span class="n">numsy</span>                             <span class="c">! number of pixel is y direction of scintillator</span>
<a name="ln-5284"></a><span class="n">enl</span><span class="p">%</span><span class="n">binning</span> <span class="o">=</span> <span class="n">binning</span>                         <span class="c">! detector binning</span>
<a name="ln-5285"></a><span class="n">enl</span><span class="p">%</span><span class="n">scalingmode</span> <span class="o">=</span> <span class="n">scalingmode</span>                 <span class="c">! intensity scaling in detector</span>
<a name="ln-5286"></a><span class="n">enl</span><span class="p">%</span><span class="n">gammavalue</span> <span class="o">=</span> <span class="n">gammavalue</span>                   <span class="c">! intensity scaling factor</span>
<a name="ln-5287"></a><span class="n">enl</span><span class="p">%</span><span class="n">maskpattern</span> <span class="o">=</span> <span class="n">maskpattern</span>                 <span class="c">! circular mask or not</span>
<a name="ln-5288"></a><span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>                       <span class="c">! number of CPU threads for computation</span>
<a name="ln-5289"></a><span class="n">enl</span><span class="p">%</span><span class="n">platid</span> <span class="o">=</span> <span class="n">platid</span>                           <span class="c">! platform id for GPU</span>
<a name="ln-5290"></a><span class="n">enl</span><span class="p">%</span><span class="n">devid</span> <span class="o">=</span> <span class="n">devid</span>                             <span class="c">! device id for GPU</span>
<a name="ln-5291"></a><span class="n">enl</span><span class="p">%</span><span class="n">globalworkgrpsz</span> <span class="o">=</span> <span class="n">globalworkgrpsz</span>         <span class="c">! work group size</span>
<a name="ln-5292"></a><span class="n">enl</span><span class="p">%</span><span class="n">eulerconvention</span> <span class="o">=</span> <span class="n">eulerconvention</span>         <span class="c">! euler angle convention</span>
<a name="ln-5293"></a><span class="n">enl</span><span class="p">%</span><span class="n">anglefile</span> <span class="o">=</span> <span class="n">anglefile</span>                     <span class="c">! list of euler angles for which simulation is done</span>
<a name="ln-5294"></a><span class="n">enl</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>                       <span class="c">! output HDF5 file</span>
<a name="ln-5295"></a><span class="n">enl</span><span class="p">%</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">multiplier</span>
<a name="ln-5296"></a>
<a name="ln-5297"></a><span class="c">! fill other namelist variables in the ebsd namelist; will be used to write the HDF5 files etc.</span>
<a name="ln-5298"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyaverage</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5299"></a><span class="n">enl</span><span class="p">%</span><span class="n">spatialaverage</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<a name="ln-5300"></a><span class="n">enl</span><span class="p">%</span><span class="n">alphaBD</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-5301"></a><span class="n">enl</span><span class="p">%</span><span class="n">energyfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-5302"></a><span class="n">enl</span><span class="p">%</span><span class="n">masterfile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-5303"></a><span class="n">enl</span><span class="p">%</span><span class="n">nsx</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">numsx</span>
<a name="ln-5304"></a><span class="n">enl</span><span class="p">%</span><span class="n">nsy</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">numsy</span>
<a name="ln-5305"></a><span class="n">enl</span><span class="p">%</span><span class="n">num_el</span> <span class="o">=</span> <span class="mi">10</span> <span class="c">! this is variable in the MCOpenCL program, here we keep it to a fixed value</span>
<a name="ln-5306"></a><span class="n">enl</span><span class="p">%</span><span class="n">MCnthreads</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">nthreads</span>
<a name="ln-5307"></a><span class="n">enl</span><span class="p">%</span><span class="n">npx</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">numsx</span>
<a name="ln-5308"></a><span class="n">enl</span><span class="p">%</span><span class="n">npy</span> <span class="o">=</span> <span class="n">enl</span><span class="p">%</span><span class="n">numsy</span>
<a name="ln-5309"></a><span class="n">enl</span><span class="p">%</span><span class="n">MCmode</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span>
<a name="ln-5310"></a><span class="n">enl</span><span class="p">%</span><span class="n">numEbins</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">((</span><span class="n">enl</span><span class="p">%</span><span class="n">EkeV</span><span class="o">-</span><span class="n">enl</span><span class="p">%</span><span class="n">Ehistmin</span><span class="p">)</span><span class="o">/</span><span class="n">enl</span><span class="p">%</span><span class="n">Ebinsize</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-5311"></a><span class="n">enl</span><span class="p">%</span><span class="n">numzbins</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">(</span><span class="n">enl</span><span class="p">%</span><span class="n">depthmax</span><span class="o">/</span><span class="n">enl</span><span class="p">%</span><span class="n">depthstep</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-5312"></a>
<a name="ln-5313"></a><span class="k">end subroutine </span><span class="n">GetEBSDFullNameList</span>
<a name="ln-5314"></a>
<a name="ln-5315"></a>
<a name="ln-5316"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5317"></a><span class="c">!</span>
<a name="ln-5318"></a><span class="c">! SUBROUTINE:GetSRdefectNameList</span>
<a name="ln-5319"></a><span class="c">!</span>
<a name="ln-5320"></a><span class="c">!&gt; @author Patrick Callahan</span>
<a name="ln-5321"></a><span class="c">!</span>
<a name="ln-5322"></a><span class="c">!&gt; @brief read namelist file for EMSRdefect</span>
<a name="ln-5323"></a><span class="c">!</span>
<a name="ln-5324"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-5325"></a><span class="c">!</span>
<a name="ln-5326"></a><span class="c">!&gt; @date 02/10/17  PGC 1.0 new routine</span>
<a name="ln-5327"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5328"></a>
<a name="ln-5329"></a><span class="k">recursive SUBROUTINE </span><span class="n">GetSRdefectNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">srdnl</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-5330"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetSRdefectNameList</span>
<a name="ln-5331"></a>
<a name="ln-5332"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-5333"></a>
<a name="ln-5334"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-5335"></a>
<a name="ln-5336"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-5337"></a><span class="k">type</span><span class="p">(</span><span class="n">SRdefectNameListType</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="n">srdnl</span>
<a name="ln-5338"></a><span class="kt">logical</span><span class="p">,</span> <span class="k">OPTIONAL</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-5339"></a>
<a name="ln-5340"></a><span class="kt">logical</span>                                  <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-5341"></a>
<a name="ln-5342"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF_L</span>
<a name="ln-5343"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF_npix</span>
<a name="ln-5344"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">DF_npiy</span>
<a name="ln-5345"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">DF_slice</span>
<a name="ln-5346"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>    <span class="kd">::</span> <span class="nb">dmin</span>
<a name="ln-5347"></a><span class="kt">character</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">progmode</span>
<a name="ln-5348"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dinfo</span>
<a name="ln-5349"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">outputformat</span>
<a name="ln-5350"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">output</span>
<a name="ln-5351"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">dataname</span>
<a name="ln-5352"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">t_interval</span>
<a name="ln-5353"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">dispfile</span>
<a name="ln-5354"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nthreads</span>
<a name="ln-5355"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">dispmode</span>
<a name="ln-5356"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-5357"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">voltage</span>
<a name="ln-5358"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">SRG</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-5359"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Grange</span>
<a name="ln-5360"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">GLaue</span>
<a name="ln-5361"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">STEMnmlfile</span>
<a name="ln-5362"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">defectfilename</span>
<a name="ln-5363"></a>
<a name="ln-5364"></a><span class="c">! DEFINE THE IO NAMELIST FOR VARIABLE PASSING</span>
<a name="ln-5365"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">SRdefectdata</span> <span class="o">/</span> <span class="n">DF_L</span><span class="p">,</span> <span class="n">DF_npix</span><span class="p">,</span> <span class="n">DF_npiy</span><span class="p">,</span> <span class="n">DF_slice</span><span class="p">,</span> <span class="nb">dmin</span><span class="p">,</span> <span class="n">progmode</span><span class="p">,&amp;</span>
<a name="ln-5366"></a>                  <span class="n">dinfo</span><span class="p">,</span> <span class="n">outputformat</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">dataname</span><span class="p">,</span> <span class="n">t_interval</span><span class="p">,</span> <span class="n">dispfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5367"></a>                  <span class="n">nthreads</span><span class="p">,</span> <span class="n">dispmode</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">SRG</span><span class="p">,</span> <span class="n">Grange</span><span class="p">,</span> <span class="n">GLaue</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5368"></a>                  <span class="n">STEMnmlfile</span><span class="p">,</span> <span class="n">defectfilename</span>
<a name="ln-5369"></a>
<a name="ln-5370"></a>
<a name="ln-5371"></a><span class="c">!nthreads, voltage, progmode, xtalname, SRG, lauec, STEMnmlfile, &amp;</span>
<a name="ln-5372"></a><span class="c">!                         dataname, defectfilename, dispmode, dispfile, output, dinfo, t_interval, DF_L, &amp;</span>
<a name="ln-5373"></a><span class="c">!                         DF_npix, DF_npiy, DF_slice, dmin</span>
<a name="ln-5374"></a>
<a name="ln-5375"></a><span class="c">! SET INPUT PARAMETERS TO DEFAULT VALUES (EXCEPT XTALNAME, WHICH MUST BE PRESENT)</span>
<a name="ln-5376"></a><span class="n">nthreads</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-5377"></a><span class="n">voltage</span> <span class="o">=</span> <span class="mi">200000</span>
<a name="ln-5378"></a><span class="n">progmode</span> <span class="o">=</span> <span class="s1">&#39;STEM&#39;</span>
<a name="ln-5379"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-5380"></a><span class="n">SRG</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-5381"></a><span class="n">Grange</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-5382"></a><span class="n">GLaue</span> <span class="o">=</span> <span class="mf">0.5</span>
<a name="ln-5383"></a><span class="c">!lauec = (/ 0.0, 0.0 /)</span>
<a name="ln-5384"></a><span class="n">STEMnmlfile</span> <span class="o">=</span> <span class="s1">&#39;STEM_rundata.nml&#39;</span>
<a name="ln-5385"></a><span class="n">defectfilename</span> <span class="o">=</span> <span class="s1">&#39;EMdefec/dispt.json&#39;</span>
<a name="ln-5386"></a><span class="n">dataname</span> <span class="o">=</span> <span class="s1">&#39;/folder/to/trialbinary.data&#39;</span>
<a name="ln-5387"></a><span class="n">dispmode</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
<a name="ln-5388"></a><span class="n">dispfile</span> <span class="o">=</span> <span class="s1">&#39;test_ZA.data&#39;</span>
<a name="ln-5389"></a><span class="n">output</span> <span class="o">=</span> <span class="mi">6</span> <span class="c">! screen output</span>
<a name="ln-5390"></a><span class="n">dinfo</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! 1 is verbose</span>
<a name="ln-5391"></a><span class="n">t_interval</span> <span class="o">=</span> <span class="mi">5</span> <span class="c">! update every x steps</span>
<a name="ln-5392"></a><span class="n">DF_L</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-5393"></a><span class="n">DF_npix</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-5394"></a><span class="n">DF_npiy</span> <span class="o">=</span> <span class="mi">256</span>
<a name="ln-5395"></a><span class="n">DF_slice</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c">! slice thickness for scattering matrix approach (nmu)</span>
<a name="ln-5396"></a><span class="nb">dmin</span> <span class="o">=</span> <span class="mf">0.03</span>
<a name="ln-5397"></a>
<a name="ln-5398"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5399"></a><span class="c">! read the namelist file</span>
<a name="ln-5400"></a><span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-5401"></a><span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">SRdefectdata</span><span class="p">)</span>
<a name="ln-5402"></a><span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-5403"></a>
<a name="ln-5404"></a><span class="c">! check for required entries</span>
<a name="ln-5405"></a><span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5406"></a><span class="k">  call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;SRdefect:&#39;</span><span class="p">,</span><span class="s1">&#39; crystal structure file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5407"></a><span class="k">end if</span>
<a name="ln-5408"></a>
<a name="ln-5409"></a><span class="k">end if</span>
<a name="ln-5410"></a>
<a name="ln-5411"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">DF_L</span> <span class="o">=</span> <span class="n">DF_L</span>
<a name="ln-5412"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">DF_npix</span> <span class="o">=</span> <span class="n">DF_npix</span>
<a name="ln-5413"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">DF_npiy</span> <span class="o">=</span> <span class="n">DF_npiy</span>
<a name="ln-5414"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">DF_slice</span> <span class="o">=</span> <span class="n">DF_slice</span>
<a name="ln-5415"></a><span class="n">srdnl</span><span class="p">%</span><span class="nb">dmin</span> <span class="o">=</span> <span class="nb">dmin</span>
<a name="ln-5416"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">progmode</span> <span class="o">=</span> <span class="n">progmode</span>
<a name="ln-5417"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">dinfo</span> <span class="o">=</span> <span class="n">dinfo</span>
<a name="ln-5418"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">outputformat</span> <span class="o">=</span> <span class="n">outputformat</span>
<a name="ln-5419"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
<a name="ln-5420"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">dataname</span> <span class="o">=</span> <span class="n">dataname</span>
<a name="ln-5421"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">t_interval</span> <span class="o">=</span> <span class="n">t_interval</span>
<a name="ln-5422"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">dispfile</span> <span class="o">=</span> <span class="n">dispfile</span>
<a name="ln-5423"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">nthreads</span> <span class="o">=</span> <span class="n">nthreads</span>
<a name="ln-5424"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">dispmode</span> <span class="o">=</span> <span class="n">dispmode</span>
<a name="ln-5425"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-5426"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">voltage</span> <span class="o">=</span> <span class="n">voltage</span>
<a name="ln-5427"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">SRG</span> <span class="o">=</span> <span class="n">SRG</span>
<a name="ln-5428"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">Grange</span> <span class="o">=</span> <span class="n">Grange</span>
<a name="ln-5429"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">GLaue</span> <span class="o">=</span> <span class="n">GLaue</span>
<a name="ln-5430"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">STEMnmlfile</span> <span class="o">=</span> <span class="n">STEMnmlfile</span>
<a name="ln-5431"></a><span class="n">srdnl</span><span class="p">%</span><span class="n">defectfilename</span> <span class="o">=</span> <span class="n">defectfilename</span>
<a name="ln-5432"></a>
<a name="ln-5433"></a><span class="c">!srdnl%nthreads = nthreads</span>
<a name="ln-5434"></a><span class="c">!srdnl%voltage = voltage</span>
<a name="ln-5435"></a><span class="c">!srdnl%progmode = progmode</span>
<a name="ln-5436"></a><span class="c">!srdnl%xtalname = xtalname</span>
<a name="ln-5437"></a><span class="c">!srdnl%SRG = SRG</span>
<a name="ln-5438"></a><span class="c">!srdnl%lauec = lauec</span>
<a name="ln-5439"></a><span class="c">!srdnl%STEMnmlfile = STEMnmlfile</span>
<a name="ln-5440"></a><span class="c">!srdnl%dataname = dataname</span>
<a name="ln-5441"></a><span class="c">!srdnl%defectfilename = defectfilename</span>
<a name="ln-5442"></a><span class="c">!srdnl%dispmode = dispmode</span>
<a name="ln-5443"></a><span class="c">!srdnl%dispfile = dispfile</span>
<a name="ln-5444"></a><span class="c">!srdnl%output = output</span>
<a name="ln-5445"></a><span class="c">!srdnl%dinfo = dinfo</span>
<a name="ln-5446"></a><span class="c">!srdnl%t_interval = t_interval</span>
<a name="ln-5447"></a><span class="c">!srdnl%DF_L = DF_L</span>
<a name="ln-5448"></a><span class="c">!srdnl%DF_npix = DF_npix</span>
<a name="ln-5449"></a><span class="c">!srdnl%DF_npiy = DF_npiy</span>
<a name="ln-5450"></a><span class="c">!srdnl%DF_slice = DF_slice</span>
<a name="ln-5451"></a><span class="c">!srdnl%dmin = dmin</span>
<a name="ln-5452"></a>
<a name="ln-5453"></a>
<a name="ln-5454"></a><span class="k">END SUBROUTINE </span><span class="n">GetSRdefectNameList</span>
<a name="ln-5455"></a>
<a name="ln-5456"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5457"></a><span class="c">!</span>
<a name="ln-5458"></a><span class="c">! SUBROUTINE:GetPFInversionNameList</span>
<a name="ln-5459"></a><span class="c">!</span>
<a name="ln-5460"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-5461"></a><span class="c">!</span>
<a name="ln-5462"></a><span class="c">!&gt; @brief read namelist file and fill enl structure (used by PFInversionSIRT.f90)</span>
<a name="ln-5463"></a><span class="c">!</span>
<a name="ln-5464"></a><span class="c">!&gt; @param nmlfile namelist file name</span>
<a name="ln-5465"></a><span class="c">!&gt; @param epf single name list structure</span>
<a name="ln-5466"></a><span class="c">!</span>
<a name="ln-5467"></a><span class="c">!&gt; @date 04/02/17  SS 1.0 original</span>
<a name="ln-5468"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-5469"></a><span class="k">recursive subroutine </span><span class="n">GetPFInversionNameList</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">,</span> <span class="n">epf</span><span class="p">,</span> <span class="n">initonly</span><span class="p">)</span>
<a name="ln-5470"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: GetPFInversionNameList</span>
<a name="ln-5471"></a>
<a name="ln-5472"></a><span class="k">use </span><span class="n">error</span>
<a name="ln-5473"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-5474"></a>
<a name="ln-5475"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-5476"></a>
<a name="ln-5477"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-5478"></a><span class="k">type</span><span class="p">(</span><span class="n">PFInversionNameListType</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">epf</span>
<a name="ln-5479"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">initonly</span>
<a name="ln-5480"></a>
<a name="ln-5481"></a><span class="kt">logical</span>                                           <span class="kd">::</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-5482"></a>
<a name="ln-5483"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                                 <span class="kd">::</span> <span class="n">nLam</span><span class="p">,</span> <span class="n">nfiles</span><span class="p">,</span> <span class="n">nSIRT</span><span class="p">,</span> <span class="n">ncub</span>
<a name="ln-5484"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">xtalname</span>
<a name="ln-5485"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                                  <span class="kd">::</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">flist</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-5486"></a>
<a name="ln-5487"></a><span class="k">namelist</span> <span class="o">/</span> <span class="n">PFInversion</span> <span class="o">/</span> <span class="n">nLam</span><span class="p">,</span> <span class="n">xtalname</span><span class="p">,</span> <span class="n">datafile</span><span class="p">,</span> <span class="n">nfiles</span><span class="p">,</span> <span class="n">flist</span><span class="p">,</span> <span class="n">nSIRT</span><span class="p">,</span> <span class="n">ncub</span>
<a name="ln-5488"></a>
<a name="ln-5489"></a><span class="n">nLam</span> <span class="o">=</span> <span class="mi">20</span>
<a name="ln-5490"></a><span class="n">xtalname</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-5491"></a><span class="n">flist</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span>
<a name="ln-5492"></a><span class="n">nfiles</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-5493"></a><span class="n">datafile</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> 
<a name="ln-5494"></a><span class="n">nSIRT</span> <span class="o">=</span> <span class="mi">20</span>
<a name="ln-5495"></a><span class="n">ncub</span> <span class="o">=</span> <span class="mi">40</span>
<a name="ln-5496"></a>
<a name="ln-5497"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">initonly</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5498"></a><span class="k">  if</span> <span class="p">(</span><span class="n">initonly</span><span class="p">)</span> <span class="n">skipread</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-5499"></a><span class="k">end if</span>
<a name="ln-5500"></a>
<a name="ln-5501"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">skipread</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5502"></a><span class="c">! read the namelist file</span>
<a name="ln-5503"></a>    <span class="k">open</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">),</span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;apostrophe&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-5504"></a>    <span class="k">read</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">PFInversion</span><span class="p">)</span>
<a name="ln-5505"></a>    <span class="k">close</span><span class="p">(</span><span class="n">UNIT</span><span class="o">=</span><span class="n">dataunit</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-5506"></a>
<a name="ln-5507"></a><span class="c">! check for required entries</span>
<a name="ln-5508"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">xtalname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5509"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;PFForwardTest:&#39;</span><span class="p">,</span><span class="s1">&#39; xtal file name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5510"></a>    <span class="k">end if</span>
<a name="ln-5511"></a>
<a name="ln-5512"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">datafile</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5513"></a><span class="k">        call </span><span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;PFForwardTest:&#39;</span><span class="p">,</span><span class="s1">&#39; datafile name is undefined in &#39;</span><span class="o">//</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-5514"></a>    <span class="k">end if</span>
<a name="ln-5515"></a>
<a name="ln-5516"></a><span class="k">end if</span>
<a name="ln-5517"></a>
<a name="ln-5518"></a><span class="n">epf</span><span class="p">%</span><span class="n">xtalname</span> <span class="o">=</span> <span class="n">xtalname</span>
<a name="ln-5519"></a><span class="n">epf</span><span class="p">%</span><span class="n">nfiles</span> <span class="o">=</span> <span class="n">nfiles</span>
<a name="ln-5520"></a><span class="n">epf</span><span class="p">%</span><span class="n">flist</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nfiles</span><span class="p">)</span> <span class="o">=</span> <span class="n">flist</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nfiles</span><span class="p">)</span>
<a name="ln-5521"></a><span class="n">epf</span><span class="p">%</span><span class="n">nLam</span> <span class="o">=</span> <span class="n">nLam</span>
<a name="ln-5522"></a><span class="n">epf</span><span class="p">%</span><span class="n">datafile</span> <span class="o">=</span> <span class="n">datafile</span>
<a name="ln-5523"></a><span class="n">epf</span><span class="p">%</span><span class="n">nSIRT</span> <span class="o">=</span> <span class="n">nSIRT</span>
<a name="ln-5524"></a><span class="n">epf</span><span class="p">%</span><span class="n">ncub</span> <span class="o">=</span> <span class="n">ncub</span>
<a name="ln-5525"></a>
<a name="ln-5526"></a><span class="k">end subroutine </span><span class="n">GetPFInversionNameList</span>
<a name="ln-5527"></a>
<a name="ln-5528"></a><span class="k">end module </span><span class="n">NameListHandlers</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 <a rel="license" href="http://www.freebsd.org/copyright/freebsd-doc-license.html">FreeBSD Documentation License</a></p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> Fortran Program was developed by Marc De Graef Research Group/Carnegie Mellon University</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>