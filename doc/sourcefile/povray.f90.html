<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="EMsoft main library">
    
    <meta name="author" content="Marc De Graef Research Group/Carnegie Mellon University" >
    <link rel="icon" href="../favicon.png">

    <title>povray.f90 &ndash; Fortran Program</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran Program </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../lists/programs.html">Programs</a></li>
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>povray.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 5.6% of total for source files.">1720 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/povray.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">povray.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/povray.html">povray</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/povray.f90.html#src">povray.f90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
    <h3>This File Depends On</h3>
    
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~povray.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilepovrayf90EfferentGraph" width="181pt" height="32pt"
 viewBox="0.00 0.00 181.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~povray.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~povray.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 177,-28 177,4 -4,4"/>
<!-- sourcefile~povray.f90 -->
<g id="sourcefile~~povray.f90~~EfferentGraph_node1" class="node"><title>sourcefile~povray.f90</title>
<polygon fill="none" stroke="black" points="173,-24 111,-24 111,-0 173,-0 173,-24"/>
<text text-anchor="middle" x="142" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">povray.f90</text>
</g>
<!-- sourcefile~constants.f90 -->
<g id="sourcefile~~povray.f90~~EfferentGraph_node2" class="node"><title>sourcefile~constants.f90</title>
<g id="a_sourcefile~~povray.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/constants.f90.html" xlink:title="constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="75,-24 0,-24 0,-0 75,-0 75,-24"/>
<text text-anchor="middle" x="37.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~constants.f90&#45;&gt;sourcefile~povray.f90 -->
<g id="sourcefile~~povray.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~constants.f90&#45;&gt;sourcefile~povray.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M75.2153,-12C83.5465,-12 92.4363,-12 100.9,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="100.946,-15.5001 110.946,-12 100.946,-8.5001 100.946,-15.5001"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
    
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/povray.html">povray</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/povray.f90.html#src">povray.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! ###################################################################</span>
<a name="ln-2"></a><span class="c">! Copyright (c) 2016, Marc De Graef/Carnegie Mellon University</span>
<a name="ln-3"></a><span class="c">! All rights reserved.</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">! Redistribution and use in source and binary forms, with or without modification, are </span>
<a name="ln-6"></a><span class="c">! permitted provided that the following conditions are met:</span>
<a name="ln-7"></a><span class="c">!</span>
<a name="ln-8"></a><span class="c">!     - Redistributions of source code must retain the above copyright notice, this list </span>
<a name="ln-9"></a><span class="c">!        of conditions and the following disclaimer.</span>
<a name="ln-10"></a><span class="c">!     - Redistributions in binary form must reproduce the above copyright notice, this </span>
<a name="ln-11"></a><span class="c">!        list of conditions and the following disclaimer in the documentation and/or </span>
<a name="ln-12"></a><span class="c">!        other materials provided with the distribution.</span>
<a name="ln-13"></a><span class="c">!     - Neither the names of Marc De Graef, Carnegie Mellon University nor the names </span>
<a name="ln-14"></a><span class="c">!        of its contributors may be used to endorse or promote products derived from </span>
<a name="ln-15"></a><span class="c">!        this software without specific prior written permission.</span>
<a name="ln-16"></a><span class="c">!</span>
<a name="ln-17"></a><span class="c">! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; </span>
<a name="ln-18"></a><span class="c">! AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE </span>
<a name="ln-19"></a><span class="c">! IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE </span>
<a name="ln-20"></a><span class="c">! ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE </span>
<a name="ln-21"></a><span class="c">! LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL </span>
<a name="ln-22"></a><span class="c">! DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR </span>
<a name="ln-23"></a><span class="c">! SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER </span>
<a name="ln-24"></a><span class="c">! CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, </span>
<a name="ln-25"></a><span class="c">! OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE </span>
<a name="ln-26"></a><span class="c">! USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="ln-27"></a><span class="c">! ###################################################################</span>
<a name="ln-28"></a>
<a name="ln-29"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-30"></a><span class="c">! EMsoft:povray.f90</span>
<a name="ln-31"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-32"></a><span class="c">!</span>
<a name="ln-33"></a><span class="c">! MODULE: povray</span>
<a name="ln-34"></a><span class="c">!</span>
<a name="ln-35"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-36"></a><span class="c">!</span>
<a name="ln-37"></a><span class="c">!&gt; @brief all povray-related routines</span>
<a name="ln-38"></a><span class="c">!</span>
<a name="ln-39"></a><span class="c">!&gt; @details routines to generate output for PoVray file creation; this is mostly</span>
<a name="ln-40"></a><span class="c">!&gt; used for the visualization of orientation data sets in one of the many</span>
<a name="ln-41"></a><span class="c">!&gt; representations and fundamental zones...</span>
<a name="ln-42"></a><span class="c">! </span>
<a name="ln-43"></a><span class="c">!&gt; @date  09/08/16 MDG 1.0 original</span>
<a name="ln-44"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-45"></a>
<a name="ln-46"></a><span class="k">module </span><span class="n">povray</span>
<a name="ln-47"></a>
<a name="ln-48"></a><span class="k">use </span><span class="n">io</span>
<a name="ln-49"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-50"></a><span class="k">use </span><span class="n">files</span>
<a name="ln-51"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-52"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-53"></a><span class="k">use </span><span class="n">Lambert</span>
<a name="ln-54"></a><span class="k">use </span><span class="n">quaternions</span>
<a name="ln-55"></a>
<a name="ln-56"></a><span class="k">contains</span>
<a name="ln-57"></a>
<a name="ln-58"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-59"></a><span class="c">!</span>
<a name="ln-60"></a><span class="c">! SUBROUTINE: PoVRay_openFile</span>
<a name="ln-61"></a><span class="c">!</span>
<a name="ln-62"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-63"></a><span class="c">!</span>
<a name="ln-64"></a><span class="c">!&gt; @brief  add the camera command to the current PoVRay file</span>
<a name="ln-65"></a><span class="c">! </span>
<a name="ln-66"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-67"></a><span class="c">!&gt; @param locationline string that defines the camera position</span>
<a name="ln-68"></a><span class="c">!</span>
<a name="ln-69"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-70"></a><span class="c">!&gt; @date    01/30/17 MDG 1.1 added optional name list file variable</span>
<a name="ln-71"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-72"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_openFile</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">povray_filename</span><span class="p">,</span> <span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-73"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_openFile</span>
<a name="ln-74"></a>
<a name="ln-75"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-76"></a>
<a name="ln-77"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-78"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">povray_filename</span>
<a name="ln-79"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">),</span><span class="k">OPTIONAL</span>  <span class="kd">::</span> <span class="n">nmlfile</span>
<a name="ln-80"></a>
<a name="ln-81"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">fname</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">cwd</span>
<a name="ln-82"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                     <span class="kd">::</span> <span class="n">io</span>
<a name="ln-83"></a>
<a name="ln-84"></a><span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">dunit</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">povray_filename</span><span class="p">),</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
<a name="ln-85"></a>
<a name="ln-86"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;//Persistence of Vision Ray Tracer Scene Description File&quot;</span>
<a name="ln-87"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;//Created by EMsoft package&quot;</span>
<a name="ln-88"></a>
<a name="ln-89"></a><span class="c">! should we copy the complete namelist file as a comment at this point ?</span>
<a name="ln-90"></a><span class="k">if</span> <span class="p">(</span><span class="nb">PRESENT</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-91"></a><span class="k">  call </span><span class="nb">getcwd</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
<a name="ln-92"></a>  <span class="n">fname</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;/&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">nmlfile</span><span class="p">)</span>
<a name="ln-93"></a>  <span class="n">fname</span> <span class="o">=</span> <span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<a name="ln-94"></a>  <span class="k">write</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;// &quot;</span>
<a name="ln-95"></a>  <span class="k">write</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;// contents of the namelist used to create this file &quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<a name="ln-96"></a>  <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">88</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-97"></a>  <span class="k">do</span>
<a name="ln-98"></a><span class="k">    read</span><span class="p">(</span><span class="mi">88</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">io</span><span class="p">)</span> <span class="n">line</span>
<a name="ln-99"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-100"></a><span class="k">      write</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;// &quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-101"></a>    <span class="k">else </span>
<a name="ln-102"></a><span class="k">      EXIT </span>
<a name="ln-103"></a><span class="k">    end if</span>
<a name="ln-104"></a><span class="k">  end do</span>
<a name="ln-105"></a><span class="k">  close</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">88</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-106"></a>  <span class="k">write</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;// &quot;</span>
<a name="ln-107"></a><span class="k">end if</span> 
<a name="ln-108"></a>
<a name="ln-109"></a><span class="c">! and write the include statements to the file</span>
<a name="ln-110"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#include &quot;&quot;colors.inc&quot;&quot;&quot;</span>
<a name="ln-111"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#include &quot;&quot;textures.inc&quot;&quot;&quot;</span>
<a name="ln-112"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#include &quot;&quot;glass.inc&quot;&quot;&quot;</span>
<a name="ln-113"></a><span class="k">write</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;// &quot;</span>
<a name="ln-114"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;global_settings&quot;</span>
<a name="ln-115"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;{  ambient_light &lt;1,1,1&gt;&quot;</span>
<a name="ln-116"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;   assumed_gamma 1&quot;</span>
<a name="ln-117"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;}&quot;</span>
<a name="ln-118"></a>
<a name="ln-119"></a><span class="k">end subroutine </span><span class="n">PoVRay_openFile</span>
<a name="ln-120"></a>
<a name="ln-121"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-122"></a><span class="c">!</span>
<a name="ln-123"></a><span class="c">! SUBROUTINE: PoVRay_setCamera</span>
<a name="ln-124"></a><span class="c">!</span>
<a name="ln-125"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-126"></a><span class="c">!</span>
<a name="ln-127"></a><span class="c">!&gt; @brief  add the camera command to the current PoVRay file</span>
<a name="ln-128"></a><span class="c">! </span>
<a name="ln-129"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-130"></a><span class="c">!&gt; @param locationline string that defines the camera position</span>
<a name="ln-131"></a><span class="c">!</span>
<a name="ln-132"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-133"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-134"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_setCamera</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">locationline</span><span class="p">,</span> <span class="n">skyline</span><span class="p">)</span>
<a name="ln-135"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_setCamera</span>
<a name="ln-136"></a>
<a name="ln-137"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-138"></a>
<a name="ln-139"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-140"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">locationline</span>
<a name="ln-141"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">),</span><span class="k">OPTIONAL</span> <span class="kd">::</span> <span class="n">skyline</span>
<a name="ln-142"></a>
<a name="ln-143"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot; &quot;</span>
<a name="ln-144"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;camera {&quot;</span>
<a name="ln-145"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;perspective &quot;</span>
<a name="ln-146"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="nb">trim</span><span class="p">(</span><span class="n">locationline</span><span class="p">)</span>
<a name="ln-147"></a><span class="k">if</span> <span class="p">(</span><span class="nb">PRESENT</span><span class="p">(</span><span class="n">skyline</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-148"></a><span class="k">  write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="nb">trim</span><span class="p">(</span><span class="n">skyline</span><span class="p">)</span>
<a name="ln-149"></a><span class="k">else</span>
<a name="ln-150"></a><span class="k">  write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;sky &lt; 0.0, 0.0, 1.0&gt;&quot;</span>
<a name="ln-151"></a><span class="k">end if</span>
<a name="ln-152"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;right y * 1&quot;</span>
<a name="ln-153"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;up z&quot;</span>
<a name="ln-154"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;angle 50&quot;</span>
<a name="ln-155"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;look_at &lt; 0.0, 0.0, 0.0&gt;&quot;</span>
<a name="ln-156"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;}&quot;</span>
<a name="ln-157"></a>
<a name="ln-158"></a>
<a name="ln-159"></a><span class="k">end subroutine </span><span class="n">PoVRay_setCamera</span>
<a name="ln-160"></a>
<a name="ln-161"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-162"></a><span class="c">!</span>
<a name="ln-163"></a><span class="c">! SUBROUTINE: PoVRay_setLightSource</span>
<a name="ln-164"></a><span class="c">!</span>
<a name="ln-165"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-166"></a><span class="c">!</span>
<a name="ln-167"></a><span class="c">!&gt; @brief  add a light command to the current PoVRay file</span>
<a name="ln-168"></a><span class="c">! </span>
<a name="ln-169"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-170"></a><span class="c">!&gt; @param lightline string that defines the camera position</span>
<a name="ln-171"></a><span class="c">!</span>
<a name="ln-172"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-173"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-174"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_setLightSource</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">lightline</span><span class="p">,</span> <span class="n">nobackground</span><span class="p">)</span>
<a name="ln-175"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_setLightSource</span>
<a name="ln-176"></a>
<a name="ln-177"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-178"></a>
<a name="ln-179"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-180"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">lightline</span>
<a name="ln-181"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">nobackground</span>
<a name="ln-182"></a>
<a name="ln-183"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot; &quot;</span>
<a name="ln-184"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;light_source {&quot;</span>
<a name="ln-185"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="nb">trim</span><span class="p">(</span><span class="n">lightline</span><span class="p">)</span>
<a name="ln-186"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;color White&quot;</span>
<a name="ln-187"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;media_interaction on&quot;</span>
<a name="ln-188"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;media_attenuation on&quot;</span>
<a name="ln-189"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;shadowless&quot;</span>
<a name="ln-190"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;}&quot;</span>
<a name="ln-191"></a><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">PRESENT</span><span class="p">(</span><span class="n">nobackground</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-192"></a><span class="k">  write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;background { color White }&quot;</span>
<a name="ln-193"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot; &quot;</span>
<a name="ln-194"></a><span class="k">end if</span>
<a name="ln-195"></a>
<a name="ln-196"></a><span class="k">end subroutine </span><span class="n">PoVRay_setLightSource</span>
<a name="ln-197"></a>
<a name="ln-198"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-199"></a><span class="c">!</span>
<a name="ln-200"></a><span class="c">! SUBROUTINE: PoVRay_addEulerBox</span>
<a name="ln-201"></a><span class="c">!</span>
<a name="ln-202"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-203"></a><span class="c">!</span>
<a name="ln-204"></a><span class="c">!&gt; @brief  add a wireframe Euler Box to the current PoVRay file</span>
<a name="ln-205"></a><span class="c">! </span>
<a name="ln-206"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-207"></a><span class="c">!&gt; @param sphereRadius radius of sphere</span>
<a name="ln-208"></a><span class="c">!</span>
<a name="ln-209"></a><span class="c">!&gt; @date    11/23/16 MDG 1.0 original</span>
<a name="ln-210"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-211"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_addEulerBox</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-212"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_addEulerBox</span>
<a name="ln-213"></a>
<a name="ln-214"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-215"></a>
<a name="ln-216"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-217"></a>
<a name="ln-218"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt;-3.141593,-1.570796,-3.141593&gt;,&lt;-3.141593, 1.570796,-3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-219"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt;-3.141593,-1.570796, 3.141593&gt;,&lt;-3.141593, 1.570796, 3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-220"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt; 3.141593,-1.570796,-3.141593&gt;,&lt; 3.141593, 1.570796,-3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-221"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt; 3.141593,-1.570796, 3.141593&gt;,&lt; 3.141593, 1.570796, 3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-222"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt;-3.141593,-1.570796,-3.141593&gt;,&lt;-3.141593,-1.570796, 3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-223"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt;-3.141593,-1.570796, 3.141593&gt;,&lt; 3.141593,-1.570796, 3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-224"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt; 3.141593,-1.570796, 3.141593&gt;,&lt; 3.141593,-1.570796,-3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-225"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt; 3.141593,-1.570796,-3.141593&gt;,&lt;-3.141593,-1.570796,-3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-226"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt;-3.141593, 1.570796,-3.141593&gt;,&lt;-3.141593, 1.570796, 3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-227"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt;-3.141593, 1.570796, 3.141593&gt;,&lt; 3.141593, 1.570796, 3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-228"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt; 3.141593, 1.570796, 3.141593&gt;,&lt; 3.141593, 1.570796,-3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-229"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;cylinder {&lt; 3.141593, 1.570796,-3.141593&gt;,&lt;-3.141593, 1.570796,-3.141593&gt;, 0.005 pigment {color Green*0.7}}&quot;</span>
<a name="ln-230"></a>
<a name="ln-231"></a><span class="k">end subroutine </span><span class="n">PoVRay_addEulerBox</span>
<a name="ln-232"></a>
<a name="ln-233"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-234"></a><span class="c">!</span>
<a name="ln-235"></a><span class="c">! SUBROUTINE: PoVRay_declare_DF3file</span>
<a name="ln-236"></a><span class="c">!</span>
<a name="ln-237"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-238"></a><span class="c">!</span>
<a name="ln-239"></a><span class="c">!&gt; @brief set up the code to include a 3D density field (df3) file</span>
<a name="ln-240"></a><span class="c">! </span>
<a name="ln-241"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-242"></a><span class="c">!&gt; @param df3 file name</span>
<a name="ln-243"></a><span class="c">!&gt; @param levelset if TRUE, then different colors are used for level contours</span>
<a name="ln-244"></a><span class="c">!</span>
<a name="ln-245"></a><span class="c">!&gt; @date    11/23/16 MDG 1.0 original</span>
<a name="ln-246"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-247"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_declare_DF3file</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">df3name</span><span class="p">,</span> <span class="n">levelset</span><span class="p">)</span>
<a name="ln-248"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_declare_DF3file</span>
<a name="ln-249"></a>
<a name="ln-250"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-251"></a>
<a name="ln-252"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-253"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">df3name</span>
<a name="ln-254"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">levelset</span>
<a name="ln-255"></a>
<a name="ln-256"></a><span class="kt">logical</span>         <span class="kd">::</span> <span class="n">levels</span>
<a name="ln-257"></a>
<a name="ln-258"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;&#39;</span>
<a name="ln-259"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;#declare DENS = interior&#39;</span>
<a name="ln-260"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;  {  media&#39;</span>
<a name="ln-261"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;    {  intervals 100                   // number of ray-intervals&#39;</span>
<a name="ln-262"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      ratio 0.5&#39;</span>
<a name="ln-263"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      samples 4,4                     // maximum,minimum of samples per voxel&#39;</span>
<a name="ln-264"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      method 2                        // 1, 2 or 3 (3 requires samples 3,3)&#39;</span>
<a name="ln-265"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      emission 20*&lt;1,1,1&gt;&#39;</span>
<a name="ln-266"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      absorption &lt;1,1,1&gt;&#39;</span>
<a name="ln-267"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      scattering { 1, &lt;0,0,0&gt; }&#39;</span>
<a name="ln-268"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      confidence 0.9                // default: 0.9&#39;</span>
<a name="ln-269"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      variance 1/100                // default: 1/128&#39;</span>
<a name="ln-270"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      density&#39;</span>
<a name="ln-271"></a>     <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(&#39;      {  density_file df3 &quot;&quot;&#39;,A,&#39;&quot;&quot;&#39;)&quot;</span><span class="p">)</span> <span class="nb">trim</span><span class="p">(</span><span class="n">df3name</span><span class="p">)</span>
<a name="ln-272"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;        interpolate 1&#39;</span>
<a name="ln-273"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;        color_map                    // colour map with (smooth) linear transition(s)&#39;</span>
<a name="ln-274"></a>
<a name="ln-275"></a><span class="n">levels</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-276"></a><span class="k">if</span> <span class="p">(</span><span class="nb">PRESENT</span><span class="p">(</span><span class="n">levelset</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-277"></a><span class="k">  if</span> <span class="p">(</span><span class="n">levelset</span><span class="p">.</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-278"></a><span class="k">    </span><span class="n">levels</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-279"></a>  <span class="k">end if</span>
<a name="ln-280"></a><span class="k">end if</span>
<a name="ln-281"></a>
<a name="ln-282"></a><span class="k">if</span> <span class="p">(</span><span class="n">levels</span><span class="p">.</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then </span>
<a name="ln-283"></a><span class="k">  write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;        {  [0.0 rgb &lt;0.0,0.0,0.0&gt;] &#39;</span>
<a name="ln-284"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.1 rgb &lt;0.6,0.0,0.0&gt;]&#39;</span>
<a name="ln-285"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.2 rgb &lt;0.0,0.6,0.0&gt;]&#39;</span>
<a name="ln-286"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.4 rgb &lt;0.2,0.3,0.8&gt;]&#39;</span>
<a name="ln-287"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.6 rgb &lt;0.6,0.5,0.8&gt;]&#39;</span>
<a name="ln-288"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [1.0 rgb &lt;1.0,1.0,1.0&gt;]&#39;</span>
<a name="ln-289"></a><span class="k">else</span>
<a name="ln-290"></a><span class="k">  write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;        {  [0.1 rgb &lt;0.0,0.0,0.0&gt;] &#39;</span>
<a name="ln-291"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.2 rgb &lt;0.5,0.0,0.0&gt;]&#39;</span>
<a name="ln-292"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.3 rgb &lt;1.0,0.0,0.0&gt;]&#39;</span>
<a name="ln-293"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.4 rgb &lt;1.0,0.3,0.0&gt;]&#39;</span>
<a name="ln-294"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.5 rgb &lt;1.0,0.6,0.0&gt;]&#39;</span>
<a name="ln-295"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.6 rgb &lt;1.0,1.0,0.0&gt;]&#39;</span>
<a name="ln-296"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.7 rgb &lt;1.0,1.0,0.3&gt;]&#39;</span>
<a name="ln-297"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.8 rgb &lt;1.0,1.0,0.6&gt;]&#39;</span>
<a name="ln-298"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;           [0.9 rgb &lt;1.0,1.0,1.0&gt;]&#39;</span>
<a name="ln-299"></a><span class="k">end if</span>
<a name="ln-300"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;        }&#39;</span>
<a name="ln-301"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;      }&#39;</span>
<a name="ln-302"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;    }&#39;</span>
<a name="ln-303"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;  }&#39;</span>
<a name="ln-304"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;&#39;</span>
<a name="ln-305"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;#declare renderbox = box&#39;</span>
<a name="ln-306"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;  {  &lt;0,0,0&gt;, &lt;1,1,1&gt;&#39;</span>
<a name="ln-307"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;     pigment { rgbt &lt;0,0,0,1&gt; }&#39;</span>
<a name="ln-308"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;     hollow&#39;</span>
<a name="ln-309"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;     interior { DENS }&#39;</span>
<a name="ln-310"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s1">&#39;  }&#39;</span>
<a name="ln-311"></a>
<a name="ln-312"></a><span class="k">end subroutine </span><span class="n">PoVRay_declare_DF3file</span>
<a name="ln-313"></a>
<a name="ln-314"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-315"></a><span class="c">!</span>
<a name="ln-316"></a><span class="c">! SUBROUTINE: PoVRay_write_DF3file</span>
<a name="ln-317"></a><span class="c">!</span>
<a name="ln-318"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-319"></a><span class="c">!</span>
<a name="ln-320"></a><span class="c">!&gt; @brief set up the code to include a 3D density field (df3) file</span>
<a name="ln-321"></a><span class="c">! </span>
<a name="ln-322"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-323"></a><span class="c">!&gt; @param df3 file name</span>
<a name="ln-324"></a><span class="c">!&gt; @param volume the volume array to be written to the file</span>
<a name="ln-325"></a><span class="c">!&gt; @param ndims dimensions of the volume array</span>
<a name="ln-326"></a><span class="c">!&gt; @param scalingmode  &#39;lin&#39; or &#39;log&#39; or &#39;lev&#39;</span>
<a name="ln-327"></a><span class="c">!</span>
<a name="ln-328"></a><span class="c">!&gt; @date    11/23/16 MDG 1.0 original</span>
<a name="ln-329"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-330"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_write_DF3file</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">df3name</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">scalingmode</span><span class="p">)</span>
<a name="ln-331"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_write_DF3file</span>
<a name="ln-332"></a>
<a name="ln-333"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-334"></a>
<a name="ln-335"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-336"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">df3name</span>
<a name="ln-337"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">ndims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-338"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">volume</span><span class="p">(</span><span class="o">-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">ndims</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="n">ndims</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="n">ndims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-339"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">scalingmode</span>
<a name="ln-340"></a>
<a name="ln-341"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">ish</span><span class="p">)</span>				    <span class="kd">::</span> <span class="n">ivol</span><span class="p">(</span><span class="o">-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">ndims</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="n">ndims</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span><span class="n">ndims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-342"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">ish</span><span class="p">)</span>					  <span class="kd">::</span> <span class="n">idims</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">mval</span>
<a name="ln-343"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">)</span>						  <span class="kd">::</span> <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">levels</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-344"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>					  <span class="kd">::</span> <span class="n">recno</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-345"></a>
<a name="ln-346"></a><span class="c">! This format is described on the following web pages:</span>
<a name="ln-347"></a><span class="c">! http://wwwmpa.mpa-garching.mpg.de/~mselig/povray/povray.html</span>
<a name="ln-348"></a><span class="c">! http://www.povray.org/documentation/view/3.6.1/374/</span>
<a name="ln-349"></a><span class="c">!</span>
<a name="ln-350"></a><span class="c">! Essentially, this is a binary file with first 3 2-byte integers</span>
<a name="ln-351"></a><span class="c">! with the array dimensions, and then the array itself as 4-byte integers.</span>
<a name="ln-352"></a><span class="c">! Note that this file *must* be written in big-endian format (most significant</span>
<a name="ln-353"></a><span class="c">! byte first).  This can be achieved by using the CONVERT=&#39;BIG_ENDIAN&#39; qualifier</span>
<a name="ln-354"></a><span class="c">! when the file is opened.</span>
<a name="ln-355"></a>
<a name="ln-356"></a><span class="c">! we will write this as a file of 16 bit integers, so we need to rescale them all</span>
<a name="ln-357"></a><span class="c">! to the correct range</span>
<a name="ln-358"></a><span class="n">mval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">15</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">kind</span><span class="o">=</span><span class="n">ish</span><span class="p">)</span>
<a name="ln-359"></a><span class="k">if</span> <span class="p">((</span><span class="n">scalingmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;log&#39;</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">scalingmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;lev&#39;</span><span class="p">))</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">alog10</span><span class="p">(</span><span class="n">volume</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>
<a name="ln-360"></a><span class="n">mi</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-361"></a><span class="n">ma</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-362"></a><span class="n">volume</span> <span class="o">=</span> <span class="p">(</span><span class="n">volume</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span>
<a name="ln-363"></a>
<a name="ln-364"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;volume range &#39;</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span>
<a name="ln-365"></a>
<a name="ln-366"></a><span class="k">if</span> <span class="p">(</span><span class="n">scalingmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;lev&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-367"></a><span class="c">! we discretize the logarithmic values into bins (levels) which are then displayed</span>
<a name="ln-368"></a><span class="c">! as nested contour surfaces (ideally) by PoVRay&#39;s Density_field routine...</span>
<a name="ln-369"></a><span class="c">! Since we are testing this capability, we&#39;ll only include 5 different contour levels</span>
<a name="ln-370"></a><span class="c">! for now; this can be modified later on...</span>
<a name="ln-371"></a>  <span class="n">levels</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-372"></a><span class="c">! levels = (/ 0.1, 0.2, 0.4, 0.6, 0.8, 1.0 /)</span>
<a name="ln-373"></a>  <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-374"></a>    <span class="k">where</span> <span class="p">((</span><span class="n">volume</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="n">levels</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)).</span><span class="nb">and</span><span class="p">.(</span><span class="n">volume</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">levels</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">levels</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-375"></a>  <span class="k">end do</span>
<a name="ln-376"></a><span class="n">endif</span>
<a name="ln-377"></a>
<a name="ln-378"></a><span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">*</span> <span class="n">mval</span>
<a name="ln-379"></a><span class="n">ivol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="nb">kind</span><span class="o">=</span><span class="n">ish</span><span class="p">)</span>
<a name="ln-380"></a>
<a name="ln-381"></a><span class="c">! open the file and write the rescaled integer data</span>
<a name="ln-382"></a><span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">dunit</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">df3name</span><span class="p">),</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span><span class="nb">access</span><span class="o">=</span><span class="s2">&quot;DIRECT&quot;</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-383"></a>     <span class="n">recl</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span><span class="n">convert</span><span class="o">=</span><span class="s1">&#39;big_endian&#39;</span><span class="p">)</span>
<a name="ln-384"></a><span class="n">idims</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">ndims</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-385"></a><span class="n">recno</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-386"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-387"></a>  <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">rec</span><span class="o">=</span><span class="n">recno</span><span class="p">)</span> <span class="n">idims</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-388"></a>  <span class="n">recno</span> <span class="o">=</span> <span class="n">recno</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-389"></a><span class="k">end do</span>
<a name="ln-390"></a><span class="k">do </span><span class="n">k</span><span class="o">=-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">ndims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-391"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ndims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-392"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="n">ndims</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ndims</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-393"></a>      <span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">rec</span><span class="o">=</span><span class="n">recno</span><span class="p">)</span> <span class="n">ivol</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-394"></a>      <span class="n">recno</span> <span class="o">=</span> <span class="n">recno</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-395"></a>    <span class="k">end do</span>
<a name="ln-396"></a><span class="k">  end do</span>
<a name="ln-397"></a><span class="k">end do</span>
<a name="ln-398"></a><span class="k">close</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-399"></a>
<a name="ln-400"></a><span class="k">end subroutine </span><span class="n">PoVRay_write_DF3file</span>
<a name="ln-401"></a>
<a name="ln-402"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-403"></a><span class="c">!</span>
<a name="ln-404"></a><span class="c">! SUBROUTINE: PoVRay_addWireFrameSphere</span>
<a name="ln-405"></a><span class="c">!</span>
<a name="ln-406"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-407"></a><span class="c">!</span>
<a name="ln-408"></a><span class="c">!&gt; @brief  add a wireframe sphere to the current PoVRay file</span>
<a name="ln-409"></a><span class="c">! </span>
<a name="ln-410"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-411"></a><span class="c">!&gt; @param sphereRadius radius of sphere</span>
<a name="ln-412"></a><span class="c">!</span>
<a name="ln-413"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-414"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-415"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">sphereRadius</span><span class="p">)</span>
<a name="ln-416"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_addWireFrameSphere</span>
<a name="ln-417"></a>
<a name="ln-418"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-419"></a>
<a name="ln-420"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-421"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">sphereRadius</span>
<a name="ln-422"></a>
<a name="ln-423"></a><span class="kt">character</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">px</span>
<a name="ln-424"></a>
<a name="ln-425"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#macro WireFrameSphere(NrLongitudes, NrLatitudes, Rmaj, Rmin)&quot;</span>
<a name="ln-426"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-427"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #local dLongitude = 360/NrLongitudes;&quot;</span>
<a name="ln-428"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #local dLatitude = 180/NrLatitudes;&quot;</span>
<a name="ln-429"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #local Cnt = 0;&quot;</span>
<a name="ln-430"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #while (Cnt &lt; NrLongitudes)&quot;</span>
<a name="ln-431"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    #local Longitude = Cnt*dLongitude;&quot;</span>
<a name="ln-432"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    difference {&quot;</span>
<a name="ln-433"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;      torus { Rmaj, Rmin }&quot;</span>
<a name="ln-434"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;      plane { -z, 0 }&quot;</span>
<a name="ln-435"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;      rotate -90*z&quot;</span>
<a name="ln-436"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;      rotate Longitude*y&quot;</span>
<a name="ln-437"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    }&quot;</span>
<a name="ln-438"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    #local Cnt = Cnt + 1;&quot;</span>
<a name="ln-439"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #end // while&quot;</span>
<a name="ln-440"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-441"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #local Cnt = 1;&quot;</span>
<a name="ln-442"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #while (Cnt &lt; NrLatitudes)&quot;</span>
<a name="ln-443"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    #local Latitude = radians(Cnt*dLatitude - 90);&quot;</span>
<a name="ln-444"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    torus {&quot;</span>
<a name="ln-445"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;      Rmaj*cos(Latitude), Rmin&quot;</span>
<a name="ln-446"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;      translate Rmaj*sin(Latitude)*y&quot;</span>
<a name="ln-447"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    }&quot;</span>
<a name="ln-448"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;    #local Cnt = Cnt + 1;&quot;</span>
<a name="ln-449"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  #end // while&quot;</span>
<a name="ln-450"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-451"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#end // macro WireFrameSphere&quot;</span>
<a name="ln-452"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-453"></a>
<a name="ln-454"></a><span class="k">write</span> <span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="s2">&quot;(F12.6)&quot;</span><span class="p">)</span> <span class="n">sphereRadius</span>
<a name="ln-455"></a>
<a name="ln-456"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#declare Rglobe = &quot;</span><span class="o">//</span><span class="n">px</span><span class="o">//</span><span class="s2">&quot;;&quot;</span>
<a name="ln-457"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#declare Rwireframe = 0.0033;&quot;</span>
<a name="ln-458"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#declare Rspheres = Rwireframe*2;&quot;</span>
<a name="ln-459"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-460"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;// Number of longitude intervals&quot;</span>
<a name="ln-461"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#declare Longitudes = 12;&quot;</span>
<a name="ln-462"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-463"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;// Number of latitude intervals&quot;</span>
<a name="ln-464"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;#declare Latitudes = 6;&quot;</span>
<a name="ln-465"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-466"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;&quot;</span>
<a name="ln-467"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;union {&quot;</span>
<a name="ln-468"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  WireFrameSphere(Longitudes, Latitudes, Rglobe, Rwireframe)&quot;</span>
<a name="ln-469"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  rotate 90.0*x&quot;</span>
<a name="ln-470"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;  pigment { color Black*0.7 }&quot;</span>
<a name="ln-471"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot;}&quot;</span>
<a name="ln-472"></a>
<a name="ln-473"></a><span class="k">end subroutine </span><span class="n">PoVRay_addWireFrameSphere</span>
<a name="ln-474"></a>
<a name="ln-475"></a>
<a name="ln-476"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-477"></a><span class="c">!</span>
<a name="ln-478"></a><span class="c">! SUBROUTINE: PoVRay_addReferenceFrame</span>
<a name="ln-479"></a><span class="c">!</span>
<a name="ln-480"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-481"></a><span class="c">!</span>
<a name="ln-482"></a><span class="c">!&gt; @brief  add a reference frame to the current PoVRay file</span>
<a name="ln-483"></a><span class="c">! </span>
<a name="ln-484"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-485"></a><span class="c">!&gt; @param ac maximum semi-length of axis</span>
<a name="ln-486"></a><span class="c">!</span>
<a name="ln-487"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-488"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-489"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">,</span> <span class="n">cylr</span><span class="p">)</span>
<a name="ln-490"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_addReferenceFrame</span>
<a name="ln-491"></a>
<a name="ln-492"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-493"></a>
<a name="ln-494"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-495"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">ac</span>
<a name="ln-496"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">cylr</span>
<a name="ln-497"></a>
<a name="ln-498"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">cc</span>
<a name="ln-499"></a>
<a name="ln-500"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">cylr</span><span class="p">).</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-501"></a><span class="k">  </span><span class="n">cc</span> <span class="o">=</span> <span class="n">cylr</span>
<a name="ln-502"></a><span class="k">else</span>
<a name="ln-503"></a><span class="k">  </span><span class="n">cc</span> <span class="o">=</span> <span class="mf">0.005D0</span>
<a name="ln-504"></a><span class="k">end if</span>
<a name="ln-505"></a>
<a name="ln-506"></a>
<a name="ln-507"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(&#39;cylinder { &lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&#39;,F9.6,&#39; pigment { color Red*0.7 } }&#39;)&quot;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-508"></a>      <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">cc</span>
<a name="ln-509"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(&#39;cylinder { &lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&#39;,F9.6,&#39; pigment { color Green*0.7 } }&#39;)&quot;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-510"></a>      <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">cc</span>
<a name="ln-511"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(&#39;cylinder { &lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&#39;,F9.6,&#39; pigment { color Blue*0.7 } }&#39;)&quot;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-512"></a>      <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="n">cc</span>
<a name="ln-513"></a>
<a name="ln-514"></a><span class="k">end subroutine </span><span class="n">PoVRay_addReferenceFrame</span>
<a name="ln-515"></a>
<a name="ln-516"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-517"></a><span class="c">!</span>
<a name="ln-518"></a><span class="c">! SUBROUTINE: PoVRay_addSphere</span>
<a name="ln-519"></a><span class="c">!</span>
<a name="ln-520"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-521"></a><span class="c">!</span>
<a name="ln-522"></a><span class="c">!&gt; @brief  add a sphere to the current PoVRay file</span>
<a name="ln-523"></a><span class="c">! </span>
<a name="ln-524"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-525"></a><span class="c">!&gt; @param ctr center coordinates of the sphere</span>
<a name="ln-526"></a><span class="c">!&gt; @param radius sphere radius</span>
<a name="ln-527"></a><span class="c">!&gt; @param rgb color triplet (RGB)</span>
<a name="ln-528"></a><span class="c">!</span>
<a name="ln-529"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-530"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-531"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_addSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ctr</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
<a name="ln-532"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_addSphere</span>
<a name="ln-533"></a>
<a name="ln-534"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-535"></a>
<a name="ln-536"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-537"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">ctr</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-538"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">radius</span> 
<a name="ln-539"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">rgb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-540"></a>
<a name="ln-541"></a><span class="k">write</span> <span class="p">(</span><span class="n">dataunit</span><span class="p">,</span><span class="s2">&quot;(&#39;sphere { &lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&#39;,F9.6,&#39;  pigment { rgb &lt;&#39;, &amp;</span>
<a name="ln-542"></a><span class="s2">                2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;}}&#39;)&quot;</span><span class="p">),</span><span class="n">ctr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">rgb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-543"></a>
<a name="ln-544"></a><span class="k">end subroutine </span><span class="n">PoVRay_addSphere</span>
<a name="ln-545"></a>
<a name="ln-546"></a>
<a name="ln-547"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-548"></a><span class="c">!</span>
<a name="ln-549"></a><span class="c">! SUBROUTINE: PoVRay_addCylinder</span>
<a name="ln-550"></a><span class="c">!</span>
<a name="ln-551"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-552"></a><span class="c">!</span>
<a name="ln-553"></a><span class="c">!&gt; @brief  add a cylinder to the current PoVRay file</span>
<a name="ln-554"></a><span class="c">! </span>
<a name="ln-555"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-556"></a><span class="c">!&gt; @param p1 starting point of cylinder (on axis)</span>
<a name="ln-557"></a><span class="c">!&gt; @param p2 end point of cylinder (on axis)</span>
<a name="ln-558"></a><span class="c">!&gt; @param radius cylinder radius</span>
<a name="ln-559"></a><span class="c">!&gt; @param rgb color triplet (RGB)</span>
<a name="ln-560"></a><span class="c">!</span>
<a name="ln-561"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-562"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-563"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span>
<a name="ln-564"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_addCylinder</span>
<a name="ln-565"></a>
<a name="ln-566"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-567"></a>
<a name="ln-568"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-569"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">p2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-570"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">radius</span> 
<a name="ln-571"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">rgb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-572"></a>
<a name="ln-573"></a><span class="k">write</span> <span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="s2">&quot;(&#39;cylinder { &lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;,&#39;, F9.6,&#39; pigment { &#39;, &amp;</span>
<a name="ln-574"></a><span class="s2">           &#39;rgb &lt;&#39;,2(F9.6,&#39;,&#39;),F9.6,&#39;&gt;}}&#39;)&quot;</span><span class="p">),</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">p2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">rgb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-575"></a>
<a name="ln-576"></a><span class="k">end subroutine </span><span class="n">PoVRay_addCylinder</span>
<a name="ln-577"></a>
<a name="ln-578"></a>
<a name="ln-579"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-580"></a><span class="c">!</span>
<a name="ln-581"></a><span class="c">! SUBROUTINE: PoVRay_addCubochoricCube</span>
<a name="ln-582"></a><span class="c">!</span>
<a name="ln-583"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-584"></a><span class="c">!</span>
<a name="ln-585"></a><span class="c">!&gt; @brief  add a reference frame to the current PoVRay file</span>
<a name="ln-586"></a><span class="c">! </span>
<a name="ln-587"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-588"></a><span class="c">!</span>
<a name="ln-589"></a><span class="c">!&gt; @date    09/08/16 MDG 1.0 original</span>
<a name="ln-590"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-591"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_addCubochoricCube</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-592"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_addCubochoricCube</span>
<a name="ln-593"></a>
<a name="ln-594"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-595"></a>
<a name="ln-596"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-597"></a>
<a name="ln-598"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">ac</span>
<a name="ln-599"></a>
<a name="ln-600"></a><span class="c">! create the cubochoric cube</span>
<a name="ln-601"></a><span class="n">ac</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-602"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-603"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-604"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-605"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-606"></a>
<a name="ln-607"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-608"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-609"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-610"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-611"></a>
<a name="ln-612"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span>  <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-613"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-614"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span>  <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/</span> <span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-615"></a><span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,(</span><span class="o">/</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="p">(</span><span class="o">/-</span><span class="n">ac</span><span class="p">,</span> <span class="o">-</span><span class="n">ac</span><span class="p">,</span>  <span class="n">ac</span> <span class="o">/</span><span class="p">),</span> <span class="mf">0.005D0</span><span class="p">,</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-616"></a>
<a name="ln-617"></a><span class="k">end subroutine </span><span class="n">PoVRay_addCubochoricCube</span>
<a name="ln-618"></a>
<a name="ln-619"></a>
<a name="ln-620"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-621"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-622"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-623"></a><span class="c">! below this line are a number of routines for different rotation representations</span>
<a name="ln-624"></a><span class="c">! and different crystallographic fundamental zones... below this line, there</span>
<a name="ln-625"></a><span class="c">! should be no direct writing to the dunit file; all writes should pass </span>
<a name="ln-626"></a><span class="c">! through the routines above.</span>
<a name="ln-627"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-628"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-629"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-630"></a>
<a name="ln-631"></a>
<a name="ln-632"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-633"></a><span class="c">!</span>
<a name="ln-634"></a><span class="c">! SUBROUTINE: PoVRay_getpos_FZ432</span>
<a name="ln-635"></a><span class="c">!</span>
<a name="ln-636"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-637"></a><span class="c">!</span>
<a name="ln-638"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 432</span>
<a name="ln-639"></a><span class="c">! </span>
<a name="ln-640"></a><span class="c">!&gt; @param dims dimensions for subsequent arrays</span>
<a name="ln-641"></a><span class="c">!&gt; @param cpos vertex coordinates</span>
<a name="ln-642"></a><span class="c">!&gt; @param s_edge first set of edge connectivities</span>
<a name="ln-643"></a><span class="c">!&gt; @param t_edge second set of edge connectivities</span>
<a name="ln-644"></a><span class="c">!&gt; @param ns, d, nt  auxiliary parameters</span>
<a name="ln-645"></a><span class="c">!&gt; @param MFZ (optional) return coordinates for Mackenzie FZ instead of regular FZ</span>
<a name="ln-646"></a><span class="c">!</span>
<a name="ln-647"></a><span class="c">!&gt; @date    09/10/16 MDG 1.0 original</span>
<a name="ln-648"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-649"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_getpos_FZ432</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-650"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_getpos_FZ432</span>
<a name="ln-651"></a>
<a name="ln-652"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-653"></a>
<a name="ln-654"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-655"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-656"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-657"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-658"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ns</span>
<a name="ln-659"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">d</span>
<a name="ln-660"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-661"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">MFZ</span>
<a name="ln-662"></a>
<a name="ln-663"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.41421356237D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.17157287525D0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.34314575050D0</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="mf">0.6340506711D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-664"></a>                           <span class="n">dd</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">0.29289323D0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">0.333333333D0</span>
<a name="ln-665"></a>
<a name="ln-666"></a><span class="n">d</span> <span class="o">=</span> <span class="mf">0.610395774912</span>
<a name="ln-667"></a>
<a name="ln-668"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">MFZ</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-669"></a><span class="k">  if</span> <span class="p">(</span><span class="n">MFZ</span><span class="p">)</span> <span class="k">then</span> 
<a name="ln-670"></a>
<a name="ln-671"></a><span class="c">! define the coordinates of the cubic Mackenzie FZ in Rodrigues Space</span>
<a name="ln-672"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mf">0.D0</span><span class="p">,</span>  <span class="mf">0.D0</span><span class="p">,</span>  <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-673"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="mf">0.D0</span><span class="p">,</span>  <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-674"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-675"></a>
<a name="ln-676"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-677"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">f</span><span class="p">,</span>  <span class="n">f</span><span class="p">,</span>  <span class="n">f</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-678"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">e</span><span class="p">,</span>  <span class="n">e</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-679"></a>
<a name="ln-680"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">/</span><span class="n">d</span>
<a name="ln-681"></a>
<a name="ln-682"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-683"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-684"></a>
<a name="ln-685"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-686"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-687"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-688"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-689"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-690"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-691"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-692"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-693"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-694"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-695"></a>   <span class="k">end if</span> 
<a name="ln-696"></a><span class="c">! define the coordinates of the cubic FZ in Rodrigues Space</span>
<a name="ln-697"></a> <span class="k">else</span>
<a name="ln-698"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-699"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-700"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-701"></a>
<a name="ln-702"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-703"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-704"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-705"></a>
<a name="ln-706"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-707"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-708"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-709"></a>
<a name="ln-710"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-711"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-712"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-713"></a>
<a name="ln-714"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-715"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-716"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-717"></a>
<a name="ln-718"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-719"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-720"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-721"></a>
<a name="ln-722"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-723"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-724"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-725"></a>
<a name="ln-726"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-727"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-728"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-729"></a>
<a name="ln-730"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">/</span><span class="n">d</span>
<a name="ln-731"></a>
<a name="ln-732"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-733"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-734"></a>
<a name="ln-735"></a>    <span class="c">! define the connectivity of all the edges</span>
<a name="ln-736"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-737"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">22</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-738"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">23</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-739"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-740"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-741"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-742"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">24</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-743"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-744"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-745"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-746"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">20</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-747"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-748"></a>
<a name="ln-749"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-750"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-751"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-752"></a>
<a name="ln-753"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-754"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-755"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-756"></a>
<a name="ln-757"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-758"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-759"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-760"></a>
<a name="ln-761"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-762"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-763"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">10</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-764"></a>
<a name="ln-765"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-766"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-767"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">13</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-768"></a>
<a name="ln-769"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-770"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-771"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">16</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-772"></a>
<a name="ln-773"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-774"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-775"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">19</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-776"></a>
<a name="ln-777"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-778"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-779"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">22</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-780"></a><span class="k">end if</span>
<a name="ln-781"></a>
<a name="ln-782"></a><span class="k">end subroutine </span><span class="n">PoVRay_getpos_FZ432</span>
<a name="ln-783"></a>
<a name="ln-784"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-785"></a><span class="c">!</span>
<a name="ln-786"></a><span class="c">! SUBROUTINE: PoVRay_getpos_FZ23</span>
<a name="ln-787"></a><span class="c">!</span>
<a name="ln-788"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-789"></a><span class="c">!</span>
<a name="ln-790"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 23</span>
<a name="ln-791"></a><span class="c">! </span>
<a name="ln-792"></a><span class="c">!&gt; @param dims dimensions for subsequent arrays</span>
<a name="ln-793"></a><span class="c">!&gt; @param cpos vertex coordinates</span>
<a name="ln-794"></a><span class="c">!&gt; @param s_edge first set of edge connectivities</span>
<a name="ln-795"></a><span class="c">!&gt; @param t_edge second set of edge connectivities</span>
<a name="ln-796"></a><span class="c">!&gt; @param ns, d, nt  auxiliary parameters</span>
<a name="ln-797"></a><span class="c">!&gt; @param MFZ (optional) return coordinates for Mackenzie FZ instead of regular FZ</span>
<a name="ln-798"></a><span class="c">!</span>
<a name="ln-799"></a><span class="c">!&gt; @date    09/10/16 MDG 1.0 original</span>
<a name="ln-800"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-801"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_getpos_FZ23</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-802"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_getpos_FZ23</span>
<a name="ln-803"></a>
<a name="ln-804"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-805"></a>
<a name="ln-806"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-807"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-808"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-809"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-810"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ns</span>
<a name="ln-811"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">d</span>
<a name="ln-812"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-813"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">MFZ</span>
<a name="ln-814"></a>
<a name="ln-815"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.0D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.5773502692D0</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">0.333333333D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-816"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">0.6340506711D0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">1.4142135623730D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">oo</span> <span class="o">=</span> <span class="mf">1.D0</span>
<a name="ln-817"></a>
<a name="ln-818"></a><span class="n">d</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="ln-819"></a>
<a name="ln-820"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">MFZ</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-821"></a><span class="k">  if</span> <span class="p">(</span><span class="n">MFZ</span><span class="p">)</span> <span class="k">then</span> 
<a name="ln-822"></a>
<a name="ln-823"></a><span class="c">! define the coordinates of the cubic Mackenzie FZ in Rodrigues Space</span>
<a name="ln-824"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-825"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-826"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-827"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">e</span><span class="p">,</span>  <span class="n">e</span><span class="p">,</span>  <span class="n">e</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-828"></a>
<a name="ln-829"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">/</span><span class="n">d</span>
<a name="ln-830"></a>
<a name="ln-831"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-832"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-833"></a>
<a name="ln-834"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-835"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-836"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-837"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-838"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-839"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-840"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-841"></a>   <span class="k">end if</span> 
<a name="ln-842"></a><span class="c">! define the coordinates of the cubic FZ in Rodrigues Space</span>
<a name="ln-843"></a> <span class="k">else</span>
<a name="ln-844"></a>  <span class="c">! define the coordinates of the cubic D3 FZ in Rodrigues Space</span>
<a name="ln-845"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-846"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-847"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-848"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-849"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-850"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-851"></a>
<a name="ln-852"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span> <span class="o">/</span> <span class="n">d</span>
<a name="ln-853"></a>
<a name="ln-854"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-855"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-856"></a>
<a name="ln-857"></a>    <span class="c">! define the connectivity of all the edges</span>
<a name="ln-858"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-859"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-860"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-861"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-862"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-863"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-864"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-865"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-866"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-867"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-868"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-869"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-870"></a> 
<a name="ln-871"></a><span class="k">end if</span>
<a name="ln-872"></a>
<a name="ln-873"></a><span class="k">end subroutine </span><span class="n">PoVRay_getpos_FZ23</span>
<a name="ln-874"></a>
<a name="ln-875"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-876"></a><span class="c">!</span>
<a name="ln-877"></a><span class="c">! SUBROUTINE: PoVRay_getpos_FZ622</span>
<a name="ln-878"></a><span class="c">!</span>
<a name="ln-879"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-880"></a><span class="c">!</span>
<a name="ln-881"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 622</span>
<a name="ln-882"></a><span class="c">! </span>
<a name="ln-883"></a><span class="c">!&gt; @param dims dimensions for subsequent arrays</span>
<a name="ln-884"></a><span class="c">!&gt; @param cpos vertex coordinates</span>
<a name="ln-885"></a><span class="c">!&gt; @param s_edge first set of edge connectivities</span>
<a name="ln-886"></a><span class="c">!&gt; @param t_edge second set of edge connectivities</span>
<a name="ln-887"></a><span class="c">!&gt; @param ns, d, nt  auxiliary parameters</span>
<a name="ln-888"></a><span class="c">!&gt; @param MFZ (optional) return coordinates for Mackenzie FZ instead of regular FZ</span>
<a name="ln-889"></a><span class="c">!</span>
<a name="ln-890"></a><span class="c">!&gt; @date    09/10/16 MDG 1.0 original</span>
<a name="ln-891"></a><span class="c">!&gt; @date    02/05/17 MDG 1.1 correction of d parameter</span>
<a name="ln-892"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-893"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_getpos_FZ622</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-894"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_getpos_FZ622</span>
<a name="ln-895"></a>
<a name="ln-896"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-897"></a>
<a name="ln-898"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-899"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-900"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-901"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-902"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ns</span>
<a name="ln-903"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">d</span>
<a name="ln-904"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-905"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">MFZ</span>
<a name="ln-906"></a>
<a name="ln-907"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.267949192431D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.732050807569D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-908"></a>                           <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.5358983848622454D0</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="mf">0.5358983848622454D0</span><span class="p">,</span> <span class="n">di</span> <span class="o">=</span><span class="mf">1.069389330154823D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-909"></a>                           <span class="n">z</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="mf">0.86602540378443D0</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-910"></a>
<a name="ln-911"></a>
<a name="ln-912"></a><span class="n">d</span> <span class="o">=</span> <span class="mf">1.0693893290743279D0</span>
<a name="ln-913"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">MFZ</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-914"></a><span class="k">  if</span> <span class="p">(</span><span class="n">MFZ</span><span class="p">)</span> <span class="k">then</span> 
<a name="ln-915"></a>
<a name="ln-916"></a><span class="c">! define the coordinates of the hexagonal Mackenzie FZ in Rodrigues Space</span>
<a name="ln-917"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-918"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-919"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-920"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-921"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-922"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-923"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">o</span><span class="p">,</span>  <span class="n">p</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-924"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">o</span><span class="p">,</span>  <span class="n">p</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-925"></a>
<a name="ln-926"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">/</span><span class="n">d</span>
<a name="ln-927"></a>
<a name="ln-928"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-929"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-930"></a>
<a name="ln-931"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-932"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-933"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-934"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-935"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-936"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-937"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-938"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-939"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-940"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-941"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-942"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-943"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-944"></a>   <span class="k">end if </span>
<a name="ln-945"></a>
<a name="ln-946"></a><span class="k"> else</span>
<a name="ln-947"></a>
<a name="ln-948"></a>
<a name="ln-949"></a>    <span class="c">! define the coordinates of the hexagonal FZ in Rodrigues Space</span>
<a name="ln-950"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-951"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-952"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-953"></a>
<a name="ln-954"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-955"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-956"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-957"></a>
<a name="ln-958"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-959"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-960"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-961"></a>
<a name="ln-962"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-963"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-964"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-965"></a>
<a name="ln-966"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-967"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-968"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-969"></a>
<a name="ln-970"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-971"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-972"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-973"></a>
<a name="ln-974"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-975"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-976"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-977"></a>
<a name="ln-978"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-979"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-980"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-981"></a>
<a name="ln-982"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span> <span class="o">/</span> <span class="n">d</span>
<a name="ln-983"></a>
<a name="ln-984"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-985"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-986"></a>
<a name="ln-987"></a>    <span class="c">! define the connectivity of all the edges</span>
<a name="ln-988"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-989"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-990"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-991"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-992"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-993"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-994"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-995"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-996"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-997"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-998"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-999"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">12</span><span class="p">,</span>  <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1000"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1001"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1002"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1003"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1004"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1005"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1006"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1007"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1008"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1009"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1010"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1011"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">13</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1012"></a>
<a name="ln-1013"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1014"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">14</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1015"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1016"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1017"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">17</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1018"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1019"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1020"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">20</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1021"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">21</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1022"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">22</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1023"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">23</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1024"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1025"></a>
<a name="ln-1026"></a>
<a name="ln-1027"></a><span class="k">end if</span>
<a name="ln-1028"></a>
<a name="ln-1029"></a><span class="k">end subroutine </span><span class="n">PoVRay_getpos_FZ622</span>
<a name="ln-1030"></a>
<a name="ln-1031"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1032"></a><span class="c">!</span>
<a name="ln-1033"></a><span class="c">! SUBROUTINE: PoVRay_getpos_FZ422</span>
<a name="ln-1034"></a><span class="c">!</span>
<a name="ln-1035"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1036"></a><span class="c">!</span>
<a name="ln-1037"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 422</span>
<a name="ln-1038"></a><span class="c">! </span>
<a name="ln-1039"></a><span class="c">!&gt; @param dims dimensions for subsequent arrays</span>
<a name="ln-1040"></a><span class="c">!&gt; @param cpos vertex coordinates</span>
<a name="ln-1041"></a><span class="c">!&gt; @param s_edge first set of edge connectivities</span>
<a name="ln-1042"></a><span class="c">!&gt; @param t_edge second set of edge connectivities</span>
<a name="ln-1043"></a><span class="c">!&gt; @param ns, d, nt  auxiliary parameters</span>
<a name="ln-1044"></a><span class="c">!&gt; @param MFZ (optional) return coordinates for Mackenzie FZ instead of regular FZ</span>
<a name="ln-1045"></a><span class="c">!</span>
<a name="ln-1046"></a><span class="c">!&gt; @date    09/10/16 MDG 1.0 original</span>
<a name="ln-1047"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1048"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_getpos_FZ422</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1049"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_getpos_FZ422</span>
<a name="ln-1050"></a>
<a name="ln-1051"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1052"></a>
<a name="ln-1053"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1054"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1055"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-1056"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1057"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ns</span>
<a name="ln-1058"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">d</span>
<a name="ln-1059"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-1060"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">MFZ</span>
<a name="ln-1061"></a>
<a name="ln-1062"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.41421354D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.41421354D0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.8284270763397216D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1063"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">0.8284270763397216D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="mf">0.70710678118654746D0</span>
<a name="ln-1064"></a>
<a name="ln-1065"></a><span class="n">d</span> <span class="o">=</span> <span class="mf">1.158941651036677D0</span>
<a name="ln-1066"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">MFZ</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1067"></a><span class="k">  if</span> <span class="p">(</span><span class="n">MFZ</span><span class="p">)</span> <span class="k">then</span> 
<a name="ln-1068"></a>
<a name="ln-1069"></a><span class="c">! define the coordinates of the tetragonal Mackenzie FZ in Rodrigues Space</span>
<a name="ln-1070"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1071"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1072"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1073"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1074"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1075"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1076"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">o</span><span class="p">,</span>  <span class="n">o</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1077"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">o</span><span class="p">,</span>  <span class="n">o</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1078"></a>
<a name="ln-1079"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">/</span><span class="n">d</span>
<a name="ln-1080"></a>
<a name="ln-1081"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-1082"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-1083"></a>
<a name="ln-1084"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-1085"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1086"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1087"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1088"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1089"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1090"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1091"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1092"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1093"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1094"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1095"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1096"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1097"></a>   <span class="k">end if</span> 
<a name="ln-1098"></a><span class="c">! define the coordinates of the cubic FZ in Rodrigues Space</span>
<a name="ln-1099"></a> <span class="k">else</span>
<a name="ln-1100"></a><span class="c">! define the coordinates of the tetragonal 422 FZ in Rodrigues Space</span>
<a name="ln-1101"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1102"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1103"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1104"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1105"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1106"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1107"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1108"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1109"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1110"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1111"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1112"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1113"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1114"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1115"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1116"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1117"></a>
<a name="ln-1118"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span> <span class="o">/</span> <span class="n">d</span>
<a name="ln-1119"></a>
<a name="ln-1120"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-1121"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-1122"></a>
<a name="ln-1123"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-1124"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1125"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1126"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1127"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1128"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1129"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1130"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1131"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1132"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1133"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1134"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1135"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1136"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1137"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1138"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1139"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">16</span><span class="p">,</span>  <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1140"></a>
<a name="ln-1141"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1142"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1143"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1144"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1145"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">13</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1146"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">14</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1147"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">15</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1148"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1149"></a>
<a name="ln-1150"></a><span class="k">end if</span>
<a name="ln-1151"></a>
<a name="ln-1152"></a><span class="k">end subroutine </span><span class="n">PoVRay_getpos_FZ422</span>
<a name="ln-1153"></a>
<a name="ln-1154"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1155"></a><span class="c">!</span>
<a name="ln-1156"></a><span class="c">! SUBROUTINE: PoVRay_getpos_FZ32</span>
<a name="ln-1157"></a><span class="c">!</span>
<a name="ln-1158"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1159"></a><span class="c">!</span>
<a name="ln-1160"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 32</span>
<a name="ln-1161"></a><span class="c">! </span>
<a name="ln-1162"></a><span class="c">!&gt; @param dims dimensions for subsequent arrays</span>
<a name="ln-1163"></a><span class="c">!&gt; @param cpos vertex coordinates</span>
<a name="ln-1164"></a><span class="c">!&gt; @param s_edge first set of edge connectivities</span>
<a name="ln-1165"></a><span class="c">!&gt; @param t_edge second set of edge connectivities</span>
<a name="ln-1166"></a><span class="c">!&gt; @param ns, d, nt  auxiliary parameters</span>
<a name="ln-1167"></a><span class="c">!&gt; @param MFZ (optional) return coordinates for Mackenzie FZ instead of regular FZ</span>
<a name="ln-1168"></a><span class="c">!</span>
<a name="ln-1169"></a><span class="c">!&gt; @date    09/10/16 MDG 1.0 original</span>
<a name="ln-1170"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1171"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_getpos_FZ32</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1172"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_getpos_FZ32</span>
<a name="ln-1173"></a>
<a name="ln-1174"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1175"></a>
<a name="ln-1176"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1177"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1178"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-1179"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1180"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ns</span>
<a name="ln-1181"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">d</span>
<a name="ln-1182"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-1183"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">MFZ</span>
<a name="ln-1184"></a>
<a name="ln-1185"></a>
<a name="ln-1186"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.8660254038D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.5773502692D0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.34314575050D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1187"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">0.6340506711D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">oo</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="mf">0.86602540378443D0</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-1188"></a>
<a name="ln-1189"></a><span class="n">d</span> <span class="o">=</span> <span class="mf">1.1547005384D0</span>
<a name="ln-1190"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">MFZ</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1191"></a><span class="k">  if</span> <span class="p">(</span><span class="n">MFZ</span><span class="p">)</span> <span class="k">then</span> 
<a name="ln-1192"></a>
<a name="ln-1193"></a><span class="c">! define the coordinates of the tetragonal Mackenzie FZ in Rodrigues Space</span>
<a name="ln-1194"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1195"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1196"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">p</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1197"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">p</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1198"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">p</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1199"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">p</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1200"></a>
<a name="ln-1201"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">/</span><span class="n">d</span>
<a name="ln-1202"></a>
<a name="ln-1203"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-1204"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-1205"></a>
<a name="ln-1206"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-1207"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1208"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1209"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1210"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1211"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1212"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1213"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1214"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1215"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1216"></a>   <span class="k">end if </span>
<a name="ln-1217"></a><span class="k"> else</span>
<a name="ln-1218"></a><span class="c">! define the coordinates of the cubic FZ in Rodrigues Space</span>
<a name="ln-1219"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1220"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1221"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1222"></a>
<a name="ln-1223"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1224"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span><span class="o">-</span><span class="n">oo</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1225"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1226"></a>
<a name="ln-1227"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1228"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1229"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1232"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span><span class="o">-</span><span class="n">oo</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1233"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1234"></a>
<a name="ln-1235"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span> <span class="o">/</span> <span class="n">d</span>
<a name="ln-1236"></a>
<a name="ln-1237"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-1238"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-1239"></a>
<a name="ln-1240"></a>    <span class="c">! define the connectivity of all the edges</span>
<a name="ln-1241"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1242"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1243"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1244"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1245"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1246"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1247"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1248"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1249"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1250"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1251"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1252"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">12</span><span class="p">,</span>  <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1253"></a>
<a name="ln-1254"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1255"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1256"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1257"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1258"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1259"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1260"></a>
<a name="ln-1261"></a><span class="k">end if</span>
<a name="ln-1262"></a>
<a name="ln-1263"></a><span class="k">end subroutine </span><span class="n">PoVRay_getpos_FZ32</span>
<a name="ln-1264"></a>
<a name="ln-1265"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1266"></a><span class="c">!</span>
<a name="ln-1267"></a><span class="c">! SUBROUTINE: PoVRay_getpos_FZ222</span>
<a name="ln-1268"></a><span class="c">!</span>
<a name="ln-1269"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1270"></a><span class="c">!</span>
<a name="ln-1271"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 222</span>
<a name="ln-1272"></a><span class="c">! </span>
<a name="ln-1273"></a><span class="c">!&gt; @param dims dimensions for subsequent arrays</span>
<a name="ln-1274"></a><span class="c">!&gt; @param cpos vertex coordinates</span>
<a name="ln-1275"></a><span class="c">!&gt; @param s_edge first set of edge connectivities</span>
<a name="ln-1276"></a><span class="c">!&gt; @param t_edge second set of edge connectivities</span>
<a name="ln-1277"></a><span class="c">!&gt; @param ns, d, nt  auxiliary parameters</span>
<a name="ln-1278"></a><span class="c">!&gt; @param MFZ (optional) return coordinates for Mackenzie FZ instead of regular FZ</span>
<a name="ln-1279"></a><span class="c">!</span>
<a name="ln-1280"></a><span class="c">!&gt; @date    09/10/16 MDG 1.0 original</span>
<a name="ln-1281"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1282"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_getpos_FZ222</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1283"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_getpos_FZ222</span>
<a name="ln-1284"></a>
<a name="ln-1285"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1286"></a>
<a name="ln-1287"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1288"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1289"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-1290"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1291"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ns</span>
<a name="ln-1292"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">d</span>
<a name="ln-1293"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nt</span>
<a name="ln-1294"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">MFZ</span>
<a name="ln-1295"></a>
<a name="ln-1296"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="n">D0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">2.0D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1297"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">2.0D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">oo</span> <span class="o">=</span> <span class="mf">1.D0</span>
<a name="ln-1298"></a>
<a name="ln-1299"></a><span class="n">d</span> <span class="o">=</span> <span class="mf">1.7320508075688772D0</span>
<a name="ln-1300"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">MFZ</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1301"></a><span class="k">  if</span> <span class="p">(</span><span class="n">MFZ</span><span class="p">)</span> <span class="k">then</span> 
<a name="ln-1302"></a>
<a name="ln-1303"></a><span class="c">! define the coordinates of the tetragonal Mackenzie FZ in Rodrigues Space</span>
<a name="ln-1304"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1305"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1306"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1307"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1308"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1309"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1310"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1311"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">z</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1312"></a>
<a name="ln-1313"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">/</span><span class="n">d</span>
<a name="ln-1314"></a>
<a name="ln-1315"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-1316"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-1317"></a>
<a name="ln-1318"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-1319"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1320"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1321"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1322"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1323"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1324"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1325"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1326"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1327"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1328"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1329"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1330"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1331"></a>   <span class="k">end if</span> 
<a name="ln-1332"></a><span class="c">! define the coordinates of the cubic FZ in Rodrigues Space</span>
<a name="ln-1333"></a> <span class="k">else</span>
<a name="ln-1334"></a>
<a name="ln-1335"></a>    <span class="c">! define the coordinates of the FZ in Rodrigues Space</span>
<a name="ln-1336"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1337"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1338"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1339"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1340"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1341"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1342"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1343"></a>    <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1344"></a>
<a name="ln-1345"></a>    <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span> <span class="o">/</span> <span class="n">d</span>
<a name="ln-1346"></a>
<a name="ln-1347"></a>    <span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-1348"></a>    <span class="n">nt</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span> <span class="n">ns</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="n">ds</span> <span class="p">)</span>
<a name="ln-1349"></a>
<a name="ln-1350"></a>    <span class="c">! define the connectivity of all the edges</span>
<a name="ln-1351"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1352"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1353"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1354"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1355"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1356"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1357"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1358"></a>    <span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1359"></a>
<a name="ln-1360"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">5</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1361"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1362"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">7</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1363"></a>    <span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1364"></a><span class="k">end if</span>
<a name="ln-1365"></a>
<a name="ln-1366"></a><span class="k">end subroutine </span><span class="n">PoVRay_getpos_FZ222</span>
<a name="ln-1367"></a>
<a name="ln-1368"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1369"></a><span class="c">!</span>
<a name="ln-1370"></a><span class="c">! SUBROUTINE: PoVRay_drawFZ</span>
<a name="ln-1371"></a><span class="c">!</span>
<a name="ln-1372"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1373"></a><span class="c">!</span>
<a name="ln-1374"></a><span class="c">!&gt; @brief initialize the PoVRay output for any rotation group</span>
<a name="ln-1375"></a><span class="c">! </span>
<a name="ln-1376"></a><span class="c">!&gt; @details This routine draws the outline of either the Rodrigues Fundamental</span>
<a name="ln-1377"></a><span class="c">!&gt; zone, or the Mackenzie Fundamental Zone (if MFZ is set and true).</span>
<a name="ln-1378"></a><span class="c">!</span>
<a name="ln-1379"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-1380"></a><span class="c">!&gt; @param rmode  1(cubochoric)|2(homochoric)|3(stereographic)|4(Rodrigues)|5(Euler)</span>
<a name="ln-1381"></a><span class="c">!&gt; @param cylr cylinder radius</span>
<a name="ln-1382"></a><span class="c">!&gt; @param FZtype  Fundamental zone type </span>
<a name="ln-1383"></a><span class="c">!&gt; @param FZorder order of the FZ point group</span>
<a name="ln-1384"></a><span class="c">!&gt; @param MFZ (optional) Mackenzie FZ instead of regular FZ</span>
<a name="ln-1385"></a><span class="c">!</span>
<a name="ln-1386"></a><span class="c">!&gt; @date    09/10/16 MDG 1.0 original</span>
<a name="ln-1387"></a><span class="c">!&gt; @date    11/23/16 MDG 1.1 added Euler representation</span>
<a name="ln-1388"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1389"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_drawFZ</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rmode</span><span class="p">,</span> <span class="n">cylr</span><span class="p">,</span> <span class="n">FZtype</span><span class="p">,</span> <span class="n">FZorder</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1390"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_drawFZ</span>
<a name="ln-1391"></a>
<a name="ln-1392"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1393"></a>
<a name="ln-1394"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-1395"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">rmode</span>
<a name="ln-1396"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">cylr</span>
<a name="ln-1397"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">FZtype</span>
<a name="ln-1398"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">FZorder</span>
<a name="ln-1399"></a><span class="kt">logical</span><span class="p">,</span><span class="k">OPTIONAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">MFZ</span>
<a name="ln-1400"></a>
<a name="ln-1401"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">eul</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axang</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rv</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">qu</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ho</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">zsmall</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1402"></a>                           <span class="n">eyepos</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ac</span><span class="p">,</span> <span class="n">sh</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ron</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1403"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">euld</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">om</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">culast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">holast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">splast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">sp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1404"></a>                           <span class="n">eu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">eulast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">xx</span> 
<a name="ln-1405"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtype</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">ot</span>
<a name="ln-1406"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtyped</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">otd</span>
<a name="ln-1407"></a>
<a name="ln-1408"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">s_edge</span><span class="p">(:,:),</span> <span class="n">t_edge</span><span class="p">(:,:)</span>
<a name="ln-1409"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">allocatable</span>    <span class="kd">::</span> <span class="n">cpos</span><span class="p">(:,:)</span>
<a name="ln-1410"></a>
<a name="ln-1411"></a><span class="kt">logical</span>                 <span class="kd">::</span> <span class="n">doMFZ</span><span class="p">,</span> <span class="n">twostep</span>
<a name="ln-1412"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">icnt</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> 
<a name="ln-1413"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">d</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hpi</span>
<a name="ln-1414"></a>
<a name="ln-1415"></a><span class="n">tpi</span> <span class="o">=</span> <span class="mf">2.D0</span> <span class="o">*</span> <span class="n">cPi</span>
<a name="ln-1416"></a><span class="n">hpi</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">cPi</span>
<a name="ln-1417"></a><span class="n">doMFZ</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1418"></a><span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">MFZ</span><span class="p">))</span> <span class="n">doMFZ</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1419"></a>
<a name="ln-1420"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;inside PoVRay_drawFZ; MFZ = &#39;</span><span class="p">,</span> <span class="n">doMFZ</span><span class="p">,</span> <span class="n">dunit</span><span class="p">,</span> <span class="n">rmode</span><span class="p">,</span> <span class="n">cylr</span><span class="p">,</span> <span class="n">FZtype</span><span class="p">,</span> <span class="n">FZorder</span>
<a name="ln-1421"></a>
<a name="ln-1422"></a><span class="k">if</span> <span class="p">(</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1423"></a><span class="k">    if</span> <span class="p">(</span><span class="n">FZorder</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1424"></a><span class="k">    if</span> <span class="p">(</span><span class="n">doMFZ</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1425"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1426"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1427"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1428"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ622</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1429"></a>    <span class="k">else</span>
<a name="ln-1430"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1431"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1432"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1433"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ622</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-1434"></a>    <span class="k">end if</span>
<a name="ln-1435"></a><span class="k">  end if</span>
<a name="ln-1436"></a><span class="k">  if</span> <span class="p">(</span><span class="n">FZorder</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1437"></a><span class="k">    if</span> <span class="p">(</span><span class="n">doMFZ</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1438"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1439"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1440"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1441"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ422</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1442"></a>    <span class="k">else</span>
<a name="ln-1443"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1444"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1445"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1446"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ422</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-1447"></a>    <span class="k">end if</span>
<a name="ln-1448"></a><span class="k">  end if</span>
<a name="ln-1449"></a><span class="k">  if</span> <span class="p">(</span><span class="n">FZorder</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1450"></a><span class="k">    if</span> <span class="p">(</span><span class="n">doMFZ</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1451"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1452"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1453"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1454"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ32</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1455"></a>    <span class="k">else</span>
<a name="ln-1456"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1457"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1458"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1459"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ32</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-1460"></a>    <span class="k">end if</span>
<a name="ln-1461"></a><span class="k">  end if</span>
<a name="ln-1462"></a><span class="k">  if</span> <span class="p">(</span><span class="n">FZorder</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1463"></a><span class="k">    if</span> <span class="p">(</span><span class="n">doMFZ</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1464"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1465"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1466"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1467"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ222</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1468"></a>    <span class="k">else</span>
<a name="ln-1469"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1470"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1471"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1472"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ222</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-1473"></a>    <span class="k">end if</span>
<a name="ln-1474"></a><span class="k">  end if</span>
<a name="ln-1475"></a><span class="k">end if</span>
<a name="ln-1476"></a>
<a name="ln-1477"></a><span class="k">if</span> <span class="p">(</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1478"></a><span class="c">! rotational group 23</span>
<a name="ln-1479"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">doMFZ</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1480"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1481"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1482"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1483"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ23</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1484"></a>    <span class="k">else</span>
<a name="ln-1485"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1486"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1487"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1488"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ23</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-1489"></a>    <span class="k">end if</span>
<a name="ln-1490"></a><span class="k">end if</span>
<a name="ln-1491"></a>
<a name="ln-1492"></a><span class="k">if</span> <span class="p">(</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1493"></a><span class="c">! rotational group 432</span>
<a name="ln-1494"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">doMFZ</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1495"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1496"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1497"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1498"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ432</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">MFZ</span><span class="p">)</span>
<a name="ln-1499"></a>    <span class="k">else</span>
<a name="ln-1500"></a><span class="k">      </span><span class="n">twostep</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1501"></a>      <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1502"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1503"></a>      <span class="k">call </span><span class="n">PoVRay_getpos_FZ432</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">cpos</span><span class="p">,</span> <span class="n">s_edge</span><span class="p">,</span> <span class="n">t_edge</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
<a name="ln-1504"></a>    <span class="k">end if</span>
<a name="ln-1505"></a><span class="k">end if</span>
<a name="ln-1506"></a>
<a name="ln-1507"></a><span class="c">! add the reference frame and any necessary wireframes </span>
<a name="ln-1508"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1509"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-1510"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">,</span> <span class="n">cylr</span><span class="p">)</span>
<a name="ln-1511"></a>  <span class="k">call </span><span class="n">PoVRay_addCubochoricCube</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-1512"></a><span class="k">end if</span>
<a name="ln-1513"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1514"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.33067D0</span>
<a name="ln-1515"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">,</span> <span class="n">cylr</span><span class="p">)</span>
<a name="ln-1516"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-1517"></a><span class="k">end if</span>
<a name="ln-1518"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-1519"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-1520"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">,</span> <span class="n">cylr</span><span class="p">)</span>
<a name="ln-1521"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-1522"></a><span class="k">end if</span>
<a name="ln-1523"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-1524"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-1525"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">,</span> <span class="n">cylr</span><span class="p">)</span>
<a name="ln-1526"></a><span class="k">end if</span>
<a name="ln-1527"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-1528"></a><span class="k">  call </span><span class="n">PoVRay_addEulerBox</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-1529"></a><span class="k">end if</span>
<a name="ln-1530"></a>
<a name="ln-1531"></a><span class="c">! and next, draw the outline of the FZ or MFZ</span>
<a name="ln-1532"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1533"></a><span class="c">! create the square edges first</span>
<a name="ln-1534"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-1535"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1536"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1537"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1538"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1539"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1540"></a>  <span class="n">culast</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1541"></a>  <span class="n">holast</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1542"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1543"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-1544"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1545"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-1546"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-1547"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1548"></a>    <span class="n">ho</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1549"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-1550"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1551"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">culast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1552"></a>    <span class="k">else</span>
<a name="ln-1553"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">holast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">ho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1554"></a>    <span class="k">end if</span>
<a name="ln-1555"></a><span class="k">    </span><span class="n">culast</span> <span class="o">=</span> <span class="n">cu</span>
<a name="ln-1556"></a>    <span class="n">holast</span> <span class="o">=</span> <span class="n">ho</span>
<a name="ln-1557"></a>  <span class="k">end do </span>
<a name="ln-1558"></a><span class="k"> end do</span>
<a name="ln-1559"></a>
<a name="ln-1560"></a><span class="k"> if</span> <span class="p">(</span><span class="n">twostep</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1561"></a><span class="k">   </span><span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-1562"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1563"></a>    <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1564"></a>    <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1565"></a>    <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1566"></a>    <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1567"></a>    <span class="n">culast</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1568"></a>    <span class="n">holast</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1569"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1570"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-1571"></a>      <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1572"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-1573"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-1574"></a>      <span class="n">cu</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1575"></a>      <span class="n">ho</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1576"></a>  <span class="c">! and create a cylinder with these points</span>
<a name="ln-1577"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1578"></a><span class="k">        call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">culast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1579"></a>      <span class="k">else</span>
<a name="ln-1580"></a><span class="k">        call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">holast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">ho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1581"></a>      <span class="k">end if</span>
<a name="ln-1582"></a><span class="k">      </span><span class="n">culast</span> <span class="o">=</span> <span class="n">cu</span>
<a name="ln-1583"></a>      <span class="n">holast</span> <span class="o">=</span> <span class="n">ho</span>
<a name="ln-1584"></a>    <span class="k">end do </span>
<a name="ln-1585"></a><span class="k">   end do</span>
<a name="ln-1586"></a><span class="k">  end if </span>
<a name="ln-1587"></a><span class="k">end if</span>
<a name="ln-1588"></a>
<a name="ln-1589"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1590"></a><span class="k"> </span><span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-1591"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1592"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1593"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1594"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1595"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1596"></a>  <span class="n">rolast</span> <span class="o">=</span> <span class="n">ro1</span>
<a name="ln-1597"></a>  <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1598"></a>  <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1599"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1600"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-1601"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1602"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-1603"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-1604"></a>    <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1605"></a>    <span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1606"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-1607"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1608"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1609"></a>    <span class="k">else</span>
<a name="ln-1610"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1611"></a>    <span class="k">end if</span>
<a name="ln-1612"></a><span class="k">    </span><span class="n">rolast</span> <span class="o">=</span> <span class="n">ro</span>
<a name="ln-1613"></a>    <span class="n">splast</span> <span class="o">=</span> <span class="n">sp</span>
<a name="ln-1614"></a>  <span class="k">end do </span>
<a name="ln-1615"></a><span class="k"> end do</span>
<a name="ln-1616"></a>
<a name="ln-1617"></a><span class="k"> if</span> <span class="p">(</span><span class="n">twostep</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1618"></a><span class="k">   </span><span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-1619"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1620"></a>    <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1621"></a>    <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1622"></a>    <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1623"></a>    <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1624"></a>    <span class="n">rolast</span> <span class="o">=</span> <span class="n">ro1</span>
<a name="ln-1625"></a>    <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1626"></a>    <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1627"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1628"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-1629"></a>      <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1630"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-1631"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-1632"></a>      <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1633"></a>      <span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1634"></a>  <span class="c">! and create a cylinder with these points</span>
<a name="ln-1635"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1636"></a><span class="k">         call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1637"></a>      <span class="k">else</span>
<a name="ln-1638"></a><span class="k">         call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1639"></a>      <span class="k">end if</span>
<a name="ln-1640"></a><span class="k">      </span><span class="n">rolast</span> <span class="o">=</span> <span class="n">ro</span>
<a name="ln-1641"></a>      <span class="n">splast</span> <span class="o">=</span> <span class="n">sp</span>
<a name="ln-1642"></a>    <span class="k">end do </span>
<a name="ln-1643"></a><span class="k">   end do</span>
<a name="ln-1644"></a><span class="k"> end if</span>
<a name="ln-1645"></a><span class="k">end if</span>
<a name="ln-1646"></a>  
<a name="ln-1647"></a><span class="c">! and next, draw the outline of the FZ or MFZ</span>
<a name="ln-1648"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1649"></a><span class="k">  </span><span class="n">sh</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">cPi</span><span class="o">/</span><span class="mf">2.D0</span><span class="p">,</span> <span class="n">cPi</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1650"></a><span class="c">! create the square edges first</span>
<a name="ln-1651"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-1652"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1653"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">s_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1654"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1655"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">s_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1656"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1657"></a>  <span class="n">eulast</span> <span class="o">=</span> <span class="n">ro2eu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1658"></a>  <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1659"></a>  <span class="n">eulast</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eulast</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1660"></a>  <span class="n">eulast</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eulast</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1661"></a>  <span class="n">eulast</span> <span class="o">=</span> <span class="n">eulast</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1662"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1663"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-1664"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1665"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-1666"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-1667"></a>    <span class="n">eu</span> <span class="o">=</span> <span class="n">ro2eu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1668"></a>    <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1669"></a>    <span class="n">eu</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eu</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1670"></a>    <span class="n">eu</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eu</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1671"></a>    <span class="n">eu</span> <span class="o">=</span> <span class="n">eu</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1672"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-1673"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eulast</span><span class="o">-</span><span class="n">eu</span><span class="p">)).</span><span class="n">lt</span><span class="p">.</span><span class="n">cPi</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-1674"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1675"></a>    <span class="k">end if</span>
<a name="ln-1676"></a><span class="k">    </span><span class="n">eulast</span> <span class="o">=</span> <span class="n">eu</span>
<a name="ln-1677"></a>  <span class="k">end do </span>
<a name="ln-1678"></a><span class="k"> end do</span>
<a name="ln-1679"></a>
<a name="ln-1680"></a><span class="k"> if</span> <span class="p">(</span><span class="n">twostep</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1681"></a><span class="k">   </span><span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
<a name="ln-1682"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dims</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1683"></a>    <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">t_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1684"></a>    <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1685"></a>    <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">t_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1686"></a>    <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span>
<a name="ln-1687"></a>    <span class="n">eulast</span> <span class="o">=</span> <span class="n">ro2eu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-1688"></a>    <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1689"></a>    <span class="n">eulast</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eulast</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1690"></a>    <span class="n">eulast</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eulast</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1691"></a>    <span class="n">eulast</span> <span class="o">=</span> <span class="n">eulast</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1692"></a>    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1693"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-1694"></a>      <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1695"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-1696"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-1697"></a>      <span class="n">eu</span> <span class="o">=</span> <span class="n">ro2eu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-1698"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1699"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eu</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1700"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">eu</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">,</span><span class="mf">2.D0</span><span class="o">*</span><span class="n">cPi</span><span class="p">)</span>
<a name="ln-1701"></a>      <span class="n">eu</span> <span class="o">=</span> <span class="n">eu</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1702"></a>  <span class="c">! and create a cylinder with these points</span>
<a name="ln-1703"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eulast</span><span class="o">-</span><span class="n">eu</span><span class="p">)).</span><span class="n">lt</span><span class="p">.</span><span class="n">cPi</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-1704"></a><span class="k">        call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1705"></a>      <span class="k">end if</span>
<a name="ln-1706"></a><span class="k">      </span><span class="n">eulast</span> <span class="o">=</span> <span class="n">eu</span>
<a name="ln-1707"></a>    <span class="k">end do </span>
<a name="ln-1708"></a><span class="k">   end do</span>
<a name="ln-1709"></a><span class="k">  end if</span> 
<a name="ln-1710"></a><span class="c">! for the Euler representation of the Rodrigues fundamental zones we also need to draw</span>
<a name="ln-1711"></a><span class="c">! a few additional lines to complete the volume appearance of the FZ; this depends on</span>
<a name="ln-1712"></a><span class="c">! the order of the FZ, naturally, so we have a couple of possible cases...</span>
<a name="ln-1713"></a>
<a name="ln-1714"></a><span class="c">! the diagonal lines in the Phi=0 plane are the most important lines; they should be drawn</span>
<a name="ln-1715"></a><span class="c">! for all the rotation groups except for the identity</span>
<a name="ln-1716"></a>  <span class="k">if</span> <span class="p">((</span><span class="n">FZtype</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">FZtype</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1717"></a><span class="k">    if</span> <span class="p">(</span><span class="n">FZorder</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! we have cyclic or dihedral</span>
<a name="ln-1718"></a>      <span class="n">xx</span> <span class="o">=</span> <span class="n">cPi</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">FZorder</span><span class="p">)</span>
<a name="ln-1719"></a><span class="c">! draw four diagonal lines</span>
<a name="ln-1720"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1721"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1722"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1723"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1724"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1725"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1726"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1727"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1728"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1729"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1730"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1731"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1732"></a><span class="c">! for cyclic groups we also need to draw the diagonals in the top surface</span>
<a name="ln-1733"></a><span class="c">! and the vertical lines connecting bottom and top planes</span>
<a name="ln-1734"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1735"></a><span class="c">! top plane</span>
<a name="ln-1736"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1737"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1738"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1739"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1740"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1741"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1742"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1743"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1744"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1745"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1746"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1747"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1748"></a><span class="c">! verticals</span>
<a name="ln-1749"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1750"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1751"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1752"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1753"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1754"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1755"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1756"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1757"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1758"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1759"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1760"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1761"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1762"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1763"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1764"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1765"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1766"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1767"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1768"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1769"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1770"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1771"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">cPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1772"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1773"></a>      <span class="k">end if</span>
<a name="ln-1774"></a><span class="k">      if</span> <span class="p">(</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1775"></a><span class="c">! in this case, the verticals need to be drawn but only up to the level of the FZ surface</span>
<a name="ln-1776"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1777"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1778"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1779"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1780"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1781"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1782"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1783"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1784"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1785"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1786"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1787"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1788"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1789"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1790"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1791"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1792"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1793"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1794"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1795"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1796"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1797"></a>        <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1798"></a>        <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1799"></a>        <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1800"></a>      <span class="k">end if</span>
<a name="ln-1801"></a><span class="k">    end if</span>
<a name="ln-1802"></a><span class="k">  end if</span>
<a name="ln-1803"></a>
<a name="ln-1804"></a><span class="k">  if</span> <span class="p">(</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1805"></a><span class="k">      </span><span class="n">xx</span> <span class="o">=</span> <span class="n">cPi</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1806"></a><span class="c">! draw four diagonal lines</span>
<a name="ln-1807"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1808"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1809"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1810"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1811"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1812"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1813"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1814"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1815"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1816"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1817"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1818"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1819"></a><span class="c">! and verticals</span>
<a name="ln-1820"></a>      <span class="n">hPi</span> <span class="o">=</span> <span class="n">hPi</span> <span class="o">*</span> <span class="mf">0.5D0</span>
<a name="ln-1821"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1822"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1823"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1824"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1825"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1826"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1827"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1828"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1829"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1830"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1831"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1832"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1833"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1834"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1835"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1836"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1837"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1838"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1839"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1840"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1841"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1842"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1843"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1844"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1845"></a> <span class="c">! and the closing segments</span>
<a name="ln-1846"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1847"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1848"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1849"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1850"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1851"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1852"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1853"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1854"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1855"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1856"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1857"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1858"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1859"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1860"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1861"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1862"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1863"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1864"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1865"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1866"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1867"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1868"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1869"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-1870"></a><span class="c">! and finally the corner posts</span>
<a name="ln-1871"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1872"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1873"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1874"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1875"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1876"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1877"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1878"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1879"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1880"></a>
<a name="ln-1881"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1882"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span> <span class="o">-</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1883"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1884"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1885"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1886"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1887"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1888"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1889"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1890"></a>
<a name="ln-1891"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1892"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span> <span class="o">-</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1893"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1894"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1895"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1896"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1897"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1898"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">tpi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">hPi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1899"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1900"></a>
<a name="ln-1901"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1902"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span> <span class="o">+</span> <span class="n">hPi</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1903"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1904"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1905"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">hPi</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1906"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1907"></a>      <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1908"></a>      <span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">tpi</span><span class="o">-</span><span class="n">hPi</span> <span class="o">/</span><span class="p">)</span> <span class="o">-</span> <span class="n">sh</span>
<a name="ln-1909"></a>      <span class="k">call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span><span class="n">eulast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cylr</span><span class="p">,(</span><span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="o">/</span><span class="p">))</span> 
<a name="ln-1910"></a>  <span class="k">end if</span>
<a name="ln-1911"></a><span class="k">end if</span>
<a name="ln-1912"></a>
<a name="ln-1913"></a>
<a name="ln-1914"></a><span class="k">end subroutine </span><span class="n">PoVRay_drawFZ</span>
<a name="ln-1915"></a>
<a name="ln-1916"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1917"></a><span class="c">!</span>
<a name="ln-1918"></a><span class="c">! SUBROUTINE: PoVRay_initFZ2</span>
<a name="ln-1919"></a><span class="c">!</span>
<a name="ln-1920"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1921"></a><span class="c">!</span>
<a name="ln-1922"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 2</span>
<a name="ln-1923"></a><span class="c">! </span>
<a name="ln-1924"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-1925"></a><span class="c">!&gt; @param rmode  1(cubochoric)|2(homochoric)|3(stereographic)|4(Rodrigues)</span>
<a name="ln-1926"></a><span class="c">!</span>
<a name="ln-1927"></a><span class="c">!&gt; @date    09/09/16 MDG 1.0 original</span>
<a name="ln-1928"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1929"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_initFZ2</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rmode</span><span class="p">)</span>
<a name="ln-1930"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_initFZ2</span>
<a name="ln-1931"></a>
<a name="ln-1932"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1933"></a>
<a name="ln-1934"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-1935"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">rmode</span>
<a name="ln-1936"></a>
<a name="ln-1937"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">eul</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axang</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rv</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">qu</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ho</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">zsmall</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1938"></a>                           <span class="n">eyepos</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ac</span><span class="p">,</span> <span class="n">dpos</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="n">tmp</span>
<a name="ln-1939"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">euld</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">om</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">culast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">holast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">splast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">sp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">xx</span> 
<a name="ln-1940"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtype</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">ot</span>
<a name="ln-1941"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtyped</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">otd</span>
<a name="ln-1942"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">icnt</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<a name="ln-1943"></a><span class="c">! the parameter a represents infinity as tan(178°/2)</span>
<a name="ln-1944"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">57</span><span class="mf">0.289922125538D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">11</span><span class="mf">4.57984425107713D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1945"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">2.0D0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">1.7320508075688772D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">oo</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="p">,</span> <span class="n">dtor</span> <span class="o">=</span>  <span class="mf">0.017453292D0</span>
<a name="ln-1946"></a>
<a name="ln-1947"></a>
<a name="ln-1948"></a><span class="c">! define the coordinates of the monoclinic C2 (2) FZ in Rodrigues Space</span>
<a name="ln-1949"></a><span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span>
<a name="ln-1950"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">12</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-1951"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="nb">dtan</span><span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="mf">5.D0</span><span class="o">*</span><span class="n">dtor</span><span class="o">*</span><span class="mf">0.5D0</span><span class="p">)</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1952"></a>  <span class="k">else</span>
<a name="ln-1953"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1954"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1955"></a>  <span class="k">end if</span>
<a name="ln-1956"></a><span class="k">end do</span>
<a name="ln-1957"></a>
<a name="ln-1958"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span>
<a name="ln-1959"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">25</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1960"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1961"></a><span class="k">end do</span>
<a name="ln-1962"></a>
<a name="ln-1963"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span>
<a name="ln-1964"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1965"></a>  <span class="n">tmp</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1966"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1967"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-1968"></a><span class="k">end do</span>
<a name="ln-1969"></a>
<a name="ln-1970"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span>
<a name="ln-1971"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1972"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1973"></a><span class="k">end do</span>
<a name="ln-1974"></a>
<a name="ln-1975"></a><span class="c">! and normalize</span>
<a name="ln-1976"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">200</span>
<a name="ln-1977"></a>  <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-1978"></a><span class="k">end do</span>
<a name="ln-1979"></a>
<a name="ln-1980"></a><span class="n">ns</span> <span class="o">=</span> <span class="mi">2000</span>
<a name="ln-1981"></a><span class="n">dx</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ns</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1982"></a>
<a name="ln-1983"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-1984"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span>
<a name="ln-1985"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="p">(</span><span class="o">/</span>    <span class="n">i</span><span class="p">,</span> <span class="mi">25</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1986"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">25</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">50</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">75</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1987"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">100</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">125</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1988"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">75</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">150</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">175</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1989"></a><span class="k">end do</span>
<a name="ln-1990"></a>
<a name="ln-1991"></a><span class="c">! first add the reference frame and any necessary wireframe diagrams</span>
<a name="ln-1992"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1993"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-1994"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-1995"></a>  <span class="k">call </span><span class="n">PoVRay_addCubochoricCube</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-1996"></a><span class="k">end if</span>
<a name="ln-1997"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1998"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.33067D0</span>
<a name="ln-1999"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2000"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2001"></a><span class="k">end if</span>
<a name="ln-2002"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2003"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2004"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2005"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2006"></a><span class="k">end if</span>
<a name="ln-2007"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2008"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2009"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2010"></a><span class="k">end if</span>
<a name="ln-2011"></a>
<a name="ln-2012"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2013"></a><span class="c">! create the top and bottom planes first</span>
<a name="ln-2014"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2015"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span>
<a name="ln-2016"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2017"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2018"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2019"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2020"></a>  <span class="n">culast</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2021"></a>  <span class="n">holast</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2022"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2023"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2024"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2025"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2026"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2027"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2028"></a>    <span class="n">ho</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2029"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2030"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2031"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">culast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2032"></a>    <span class="k">else</span>
<a name="ln-2033"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">holast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">ho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2034"></a>    <span class="k">end if</span>
<a name="ln-2035"></a><span class="k">    </span><span class="n">culast</span> <span class="o">=</span> <span class="n">cu</span>
<a name="ln-2036"></a>    <span class="n">holast</span> <span class="o">=</span> <span class="n">ho</span>
<a name="ln-2037"></a>  <span class="k">end do </span>
<a name="ln-2038"></a><span class="k"> end do</span>
<a name="ln-2039"></a><span class="k">end if</span>
<a name="ln-2040"></a><span class="k">  </span>
<a name="ln-2041"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2042"></a><span class="c">! create the square edges first</span>
<a name="ln-2043"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2044"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span>
<a name="ln-2045"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2046"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2047"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2048"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2049"></a>  <span class="n">rolast</span> <span class="o">=</span> <span class="n">ro1</span>
<a name="ln-2050"></a>  <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2051"></a>  <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2052"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2053"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2054"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2055"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2056"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2057"></a>    <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2058"></a>    <span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2059"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2060"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2061"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2062"></a>    <span class="k">else</span>
<a name="ln-2063"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2064"></a>    <span class="k">end if</span>
<a name="ln-2065"></a><span class="k">    </span><span class="n">rolast</span> <span class="o">=</span> <span class="n">ro</span>
<a name="ln-2066"></a>    <span class="n">splast</span> <span class="o">=</span> <span class="n">sp</span>
<a name="ln-2067"></a>  <span class="k">end do </span>
<a name="ln-2068"></a><span class="k"> end do</span>
<a name="ln-2069"></a><span class="k">end if</span>
<a name="ln-2070"></a><span class="k">  </span>
<a name="ln-2071"></a><span class="k">end subroutine </span><span class="n">PoVRay_initFZ2</span>
<a name="ln-2072"></a>
<a name="ln-2073"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2074"></a><span class="c">!</span>
<a name="ln-2075"></a><span class="c">! SUBROUTINE: PoVRay_initFZ3</span>
<a name="ln-2076"></a><span class="c">!</span>
<a name="ln-2077"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2078"></a><span class="c">!</span>
<a name="ln-2079"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 3</span>
<a name="ln-2080"></a><span class="c">! </span>
<a name="ln-2081"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-2082"></a><span class="c">!&gt; @param rmode  1(cubochoric)|2(homochoric)|3(stereographic)|4(Rodrigues)</span>
<a name="ln-2083"></a><span class="c">!</span>
<a name="ln-2084"></a><span class="c">!&gt; @date    09/09/16 MDG 1.0 original</span>
<a name="ln-2085"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2086"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_initFZ3</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rmode</span><span class="p">)</span>
<a name="ln-2087"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_initFZ3</span>
<a name="ln-2088"></a>
<a name="ln-2089"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2090"></a>
<a name="ln-2091"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-2092"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">rmode</span>
<a name="ln-2093"></a>
<a name="ln-2094"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">eul</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axang</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rv</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">qu</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ho</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">zsmall</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2095"></a>                           <span class="n">eyepos</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ac</span><span class="p">,</span> <span class="n">dpos</span><span class="p">(</span><span class="mi">208</span><span class="p">),</span> <span class="n">tmp</span>
<a name="ln-2096"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">euld</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">om</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">culast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">holast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">splast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">sp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">xx</span> 
<a name="ln-2097"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtype</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">ot</span>
<a name="ln-2098"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtyped</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">otd</span>
<a name="ln-2099"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">icnt</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">104</span><span class="p">)</span>
<a name="ln-2100"></a><span class="c">! the parameter a represents infinity as tan(178°/2)</span>
<a name="ln-2101"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">7.289922125538D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.577350269120D0</span><span class="p">,</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">208</span><span class="p">),</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">11</span><span class="mf">4.57984425107713D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2102"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">2.0D0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">1.7320508075688772D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">oo</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="p">,</span> <span class="n">dtor</span> <span class="o">=</span>  <span class="mf">0.017453292D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2103"></a>                           <span class="n">c2</span> <span class="o">=</span> <span class="mf">1.7320508075688767D0</span>
<a name="ln-2104"></a>
<a name="ln-2105"></a>
<a name="ln-2106"></a><span class="c">! define the coordinates of the trigonal C3 (3) FZ in Rodrigues Space</span>
<a name="ln-2107"></a><span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span> 
<a name="ln-2108"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2109"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="nb">dtan</span><span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">dtor</span><span class="o">*</span><span class="mf">0.5D0</span><span class="p">)</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2110"></a>  <span class="k">else</span>
<a name="ln-2111"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2112"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2113"></a>  <span class="k">end if</span>
<a name="ln-2114"></a><span class="k">end do</span>
<a name="ln-2115"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span>
<a name="ln-2116"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2117"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2118"></a><span class="k">end do</span>
<a name="ln-2119"></a>
<a name="ln-2120"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span>
<a name="ln-2121"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2122"></a>  <span class="n">tmp</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2123"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2124"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-2125"></a><span class="k">end do</span>
<a name="ln-2126"></a>
<a name="ln-2127"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span>
<a name="ln-2128"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2129"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2130"></a><span class="k">end do</span>
<a name="ln-2131"></a>
<a name="ln-2132"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">104</span>
<a name="ln-2133"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">104</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2134"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">104</span><span class="o">+</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2135"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">104</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c2</span>
<a name="ln-2136"></a>  <span class="k">else </span>
<a name="ln-2137"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">104</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">c2</span>
<a name="ln-2138"></a>  <span class="k">end if</span>
<a name="ln-2139"></a><span class="k">end do</span>
<a name="ln-2140"></a>
<a name="ln-2141"></a><span class="c">! and normalize</span>
<a name="ln-2142"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">208</span>
<a name="ln-2143"></a>  <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-2144"></a><span class="k">end do</span>
<a name="ln-2145"></a>
<a name="ln-2146"></a><span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-2147"></a><span class="n">dx</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ns</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2148"></a>
<a name="ln-2149"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-2150"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span>
<a name="ln-2151"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="p">(</span><span class="o">/</span>    <span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2152"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">39</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2153"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">65</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2154"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">39</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">78</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">91</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2155"></a>
<a name="ln-2156"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">104</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">117</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2157"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">65</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">130</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">143</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2158"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">78</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">156</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">169</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2159"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">91</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mi">182</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="mi">195</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2160"></a><span class="k">end do</span>
<a name="ln-2161"></a>
<a name="ln-2162"></a><span class="c">! first add the reference frame and any necessary wireframe diagrams</span>
<a name="ln-2163"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2164"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-2165"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2166"></a>  <span class="k">call </span><span class="n">PoVRay_addCubochoricCube</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-2167"></a><span class="k">end if</span>
<a name="ln-2168"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2169"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.33067D0</span>
<a name="ln-2170"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2171"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2172"></a><span class="k">end if</span>
<a name="ln-2173"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2174"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2175"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2176"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2177"></a><span class="k">end if</span>
<a name="ln-2178"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2179"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2180"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2181"></a><span class="k">end if</span>
<a name="ln-2182"></a>
<a name="ln-2183"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2184"></a><span class="c">! create the top and bottom planes first</span>
<a name="ln-2185"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2186"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">104</span>
<a name="ln-2187"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2188"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2189"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2190"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2191"></a>  <span class="n">culast</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2192"></a>  <span class="n">holast</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2193"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2194"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2195"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2196"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2197"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2198"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2199"></a>    <span class="n">ho</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2200"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2201"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2202"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">culast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2203"></a>    <span class="k">else</span>
<a name="ln-2204"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">holast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">ho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2205"></a>    <span class="k">end if</span>
<a name="ln-2206"></a><span class="k">    </span><span class="n">culast</span> <span class="o">=</span> <span class="n">cu</span>
<a name="ln-2207"></a>    <span class="n">holast</span> <span class="o">=</span> <span class="n">ho</span>
<a name="ln-2208"></a>  <span class="k">end do </span>
<a name="ln-2209"></a><span class="k"> end do</span>
<a name="ln-2210"></a><span class="k">end if</span>
<a name="ln-2211"></a><span class="k">  </span>
<a name="ln-2212"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2213"></a><span class="c">! create the square edges first</span>
<a name="ln-2214"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2215"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">104</span>
<a name="ln-2216"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2217"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2218"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2219"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2220"></a>  <span class="n">rolast</span> <span class="o">=</span> <span class="n">ro1</span>
<a name="ln-2221"></a>  <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2222"></a>  <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2223"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2224"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2225"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2226"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2227"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2228"></a>    <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2229"></a>    <span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2230"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2231"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2232"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2233"></a>    <span class="k">else</span>
<a name="ln-2234"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2235"></a>    <span class="k">end if</span>
<a name="ln-2236"></a><span class="k">    </span><span class="n">rolast</span> <span class="o">=</span> <span class="n">ro</span>
<a name="ln-2237"></a>    <span class="n">splast</span> <span class="o">=</span> <span class="n">sp</span>
<a name="ln-2238"></a>  <span class="k">end do </span>
<a name="ln-2239"></a><span class="k"> end do</span>
<a name="ln-2240"></a><span class="k">end if</span>
<a name="ln-2241"></a><span class="k">  </span>
<a name="ln-2242"></a><span class="k">end subroutine </span><span class="n">PoVRay_initFZ3</span>
<a name="ln-2243"></a>
<a name="ln-2244"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2245"></a><span class="c">!</span>
<a name="ln-2246"></a><span class="c">! SUBROUTINE: PoVRay_initFZ4</span>
<a name="ln-2247"></a><span class="c">!</span>
<a name="ln-2248"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2249"></a><span class="c">!</span>
<a name="ln-2250"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 4</span>
<a name="ln-2251"></a><span class="c">! </span>
<a name="ln-2252"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-2253"></a><span class="c">!&gt; @param rmode  1(cubochoric)|2(homochoric)|3(stereographic)|4(Rodrigues)</span>
<a name="ln-2254"></a><span class="c">!</span>
<a name="ln-2255"></a><span class="c">!&gt; @date    09/09/16 MDG 1.0 original</span>
<a name="ln-2256"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2257"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_initFZ4</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rmode</span><span class="p">)</span>
<a name="ln-2258"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_initFZ4</span>
<a name="ln-2259"></a>
<a name="ln-2260"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2261"></a>
<a name="ln-2262"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-2263"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">rmode</span>
<a name="ln-2264"></a>
<a name="ln-2265"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">eul</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axang</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rv</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">qu</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ho</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">zsmall</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2266"></a>                           <span class="n">eyepos</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ac</span><span class="p">,</span> <span class="n">dpos</span><span class="p">(</span><span class="mi">104</span><span class="p">),</span> <span class="n">tmp</span>
<a name="ln-2267"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">euld</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">om</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">culast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">holast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">splast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">sp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">xx</span> 
<a name="ln-2268"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtype</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">ot</span>
<a name="ln-2269"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtyped</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">otd</span>
<a name="ln-2270"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">icnt</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">52</span><span class="p">)</span>
<a name="ln-2271"></a><span class="c">! the parameter a represents infinity as tan(178°/2)</span>
<a name="ln-2272"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">7.289922125538D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">104</span><span class="p">),</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">11</span><span class="mf">4.57984425107713D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2273"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">2.0D0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">1.7320508075688772D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">oo</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="p">,</span> <span class="n">dtor</span> <span class="o">=</span>  <span class="mf">0.017453292D0</span>
<a name="ln-2274"></a>
<a name="ln-2275"></a>
<a name="ln-2276"></a><span class="c">! define the coordinates of the tetragonal C4 (4) FZ in Rodrigues Space</span>
<a name="ln-2277"></a><span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span> 
<a name="ln-2278"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2279"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="nb">dtan</span><span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">dtor</span><span class="o">*</span><span class="mf">0.5D0</span><span class="p">)</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2280"></a>  <span class="k">else</span>
<a name="ln-2281"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2282"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2283"></a>  <span class="k">end if</span>
<a name="ln-2284"></a><span class="k">end do</span>
<a name="ln-2285"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span>
<a name="ln-2286"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2287"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2288"></a><span class="k">end do</span>
<a name="ln-2289"></a>
<a name="ln-2290"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span>
<a name="ln-2291"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2292"></a>  <span class="n">tmp</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2293"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2294"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-2295"></a><span class="k">end do</span>
<a name="ln-2296"></a>
<a name="ln-2297"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span>
<a name="ln-2298"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2299"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2300"></a><span class="k">end do</span>
<a name="ln-2301"></a>
<a name="ln-2302"></a><span class="c">! and normalize</span>
<a name="ln-2303"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">104</span>
<a name="ln-2304"></a>  <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-2305"></a><span class="k">end do</span>
<a name="ln-2306"></a>
<a name="ln-2307"></a><span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-2308"></a><span class="n">dx</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ns</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2309"></a>
<a name="ln-2310"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-2311"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span>
<a name="ln-2312"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="p">(</span><span class="o">/</span>    <span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2313"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">39</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2314"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">65</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2315"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">39</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">78</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">91</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2316"></a><span class="k">end do</span>
<a name="ln-2317"></a>
<a name="ln-2318"></a><span class="c">! first add the reference frame and any necessary wireframe diagrams</span>
<a name="ln-2319"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2320"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-2321"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2322"></a>  <span class="k">call </span><span class="n">PoVRay_addCubochoricCube</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-2323"></a><span class="k">end if</span>
<a name="ln-2324"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2325"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.33067D0</span>
<a name="ln-2326"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2327"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2328"></a><span class="k">end if</span>
<a name="ln-2329"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2330"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2331"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2332"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2333"></a><span class="k">end if</span>
<a name="ln-2334"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2335"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2336"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2337"></a><span class="k">end if</span>
<a name="ln-2338"></a>
<a name="ln-2339"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2340"></a><span class="c">! create the top and bottom planes first</span>
<a name="ln-2341"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2342"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span>
<a name="ln-2343"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2344"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2345"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2346"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2347"></a>  <span class="n">culast</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2348"></a>  <span class="n">holast</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2349"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2350"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2351"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2352"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2353"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2354"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2355"></a>    <span class="n">ho</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2356"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2357"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2358"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">culast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2359"></a>    <span class="k">else</span>
<a name="ln-2360"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">holast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">ho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2361"></a>    <span class="k">end if</span>
<a name="ln-2362"></a><span class="k">    </span><span class="n">culast</span> <span class="o">=</span> <span class="n">cu</span>
<a name="ln-2363"></a>    <span class="n">holast</span> <span class="o">=</span> <span class="n">ho</span>
<a name="ln-2364"></a>  <span class="k">end do </span>
<a name="ln-2365"></a><span class="k"> end do</span>
<a name="ln-2366"></a><span class="k">end if</span>
<a name="ln-2367"></a><span class="k">  </span>
<a name="ln-2368"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2369"></a><span class="c">! create the square edges first</span>
<a name="ln-2370"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2371"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span>
<a name="ln-2372"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2373"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2374"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2375"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2376"></a>  <span class="n">rolast</span> <span class="o">=</span> <span class="n">ro1</span>
<a name="ln-2377"></a>  <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2378"></a>  <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2379"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2380"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2381"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2382"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2383"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2384"></a>    <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2385"></a>    <span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2386"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2387"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2388"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2389"></a>    <span class="k">else</span>
<a name="ln-2390"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2391"></a>    <span class="k">end if</span>
<a name="ln-2392"></a><span class="k">    </span><span class="n">rolast</span> <span class="o">=</span> <span class="n">ro</span>
<a name="ln-2393"></a>    <span class="n">splast</span> <span class="o">=</span> <span class="n">sp</span>
<a name="ln-2394"></a>  <span class="k">end do </span>
<a name="ln-2395"></a><span class="k"> end do</span>
<a name="ln-2396"></a><span class="k">end if</span>
<a name="ln-2397"></a><span class="k">  </span>
<a name="ln-2398"></a><span class="k">end subroutine </span><span class="n">PoVRay_initFZ4</span>
<a name="ln-2399"></a>
<a name="ln-2400"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2401"></a><span class="c">!</span>
<a name="ln-2402"></a><span class="c">! SUBROUTINE: PoVRay_initFZ6</span>
<a name="ln-2403"></a><span class="c">!</span>
<a name="ln-2404"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-2405"></a><span class="c">!</span>
<a name="ln-2406"></a><span class="c">!&gt; @brief initialize the PoVRay output for rotational group 6</span>
<a name="ln-2407"></a><span class="c">! </span>
<a name="ln-2408"></a><span class="c">!&gt; @param dunit output unit number</span>
<a name="ln-2409"></a><span class="c">!&gt; @param rmode  1(cubochoric)|2(homochoric)|3(stereographic)|4(Rodrigues)</span>
<a name="ln-2410"></a><span class="c">!</span>
<a name="ln-2411"></a><span class="c">!&gt; @date    09/09/16 MDG 1.0 original</span>
<a name="ln-2412"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-2413"></a><span class="k">recursive subroutine </span><span class="n">PoVRay_initFZ6</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rmode</span><span class="p">)</span>
<a name="ln-2414"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: PoVRay_initFZ6</span>
<a name="ln-2415"></a>
<a name="ln-2416"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-2417"></a>
<a name="ln-2418"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dunit</span>
<a name="ln-2419"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">rmode</span>
<a name="ln-2420"></a>
<a name="ln-2421"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">eul</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axang</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rv</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">qu</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ho</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">zsmall</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2422"></a>                           <span class="n">eyepos</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ac</span><span class="p">,</span> <span class="n">dpos</span><span class="p">(</span><span class="mi">104</span><span class="p">),</span> <span class="n">tmp</span>
<a name="ln-2423"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">euld</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">om</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">culast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">holast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">splast</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">sp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">xx</span> 
<a name="ln-2424"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtype</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">ot</span>
<a name="ln-2425"></a><span class="k">type</span><span class="p">(</span><span class="n">orientationtyped</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">otd</span>
<a name="ln-2426"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">icnt</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">52</span><span class="p">)</span>
<a name="ln-2427"></a><span class="c">! the parameter a represents infinity as tan(178°/2)</span>
<a name="ln-2428"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="mf">7.289922125538D0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">1.0D0</span><span class="p">,</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">104</span><span class="p">),</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">11</span><span class="mf">4.57984425107713D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2429"></a>                           <span class="n">ds</span> <span class="o">=</span> <span class="mf">2.0D0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">1.7320508075688772D0</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="n">oo</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="p">,</span> <span class="n">dtor</span> <span class="o">=</span>  <span class="mf">0.017453292D0</span>
<a name="ln-2430"></a>
<a name="ln-2431"></a>
<a name="ln-2432"></a><span class="c">! define the coordinates of the hexagonal C6 (6) FZ in Rodrigues Space</span>
<a name="ln-2433"></a><span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span> 
<a name="ln-2434"></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">6</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2435"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="nb">dtan</span><span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="mf">0.D0</span><span class="o">*</span><span class="n">dtor</span><span class="o">*</span><span class="mf">0.5D0</span><span class="p">)</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2436"></a>  <span class="k">else</span>
<a name="ln-2437"></a><span class="k">    </span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="p">,</span>  <span class="n">c</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2438"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2439"></a>  <span class="k">end if</span>
<a name="ln-2440"></a><span class="k">end do</span>
<a name="ln-2441"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span>
<a name="ln-2442"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2443"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2444"></a><span class="k">end do</span>
<a name="ln-2445"></a>
<a name="ln-2446"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span>
<a name="ln-2447"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2448"></a>  <span class="n">tmp</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2449"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2450"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-2451"></a><span class="k">end do</span>
<a name="ln-2452"></a>
<a name="ln-2453"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span>
<a name="ln-2454"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2455"></a>  <span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2456"></a><span class="k">end do</span>
<a name="ln-2457"></a>
<a name="ln-2458"></a><span class="c">! and normalize</span>
<a name="ln-2459"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">104</span>
<a name="ln-2460"></a>  <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-2461"></a><span class="k">end do</span>
<a name="ln-2462"></a>
<a name="ln-2463"></a><span class="n">ns</span> <span class="o">=</span> <span class="mi">200</span>
<a name="ln-2464"></a><span class="n">dx</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ns</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2465"></a>
<a name="ln-2466"></a><span class="c">! define the connectivity of all the edges</span>
<a name="ln-2467"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span>
<a name="ln-2468"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>    <span class="o">=</span> <span class="p">(</span><span class="o">/</span>    <span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2469"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">39</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2470"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">52</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">65</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2471"></a>  <span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">39</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">78</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">91</span><span class="o">+</span><span class="n">i</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-2472"></a><span class="k">end do</span>
<a name="ln-2473"></a>
<a name="ln-2474"></a><span class="c">! first add the reference frame and any necessary wireframe diagrams</span>
<a name="ln-2475"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2476"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-2477"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2478"></a>  <span class="k">call </span><span class="n">PoVRay_addCubochoricCube</span><span class="p">(</span><span class="n">dunit</span><span class="p">)</span>
<a name="ln-2479"></a><span class="k">end if</span>
<a name="ln-2480"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2481"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.33067D0</span>
<a name="ln-2482"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2483"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2484"></a><span class="k">end if</span>
<a name="ln-2485"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2486"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2487"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2488"></a>  <span class="k">call </span><span class="n">PoVRay_addWireFrameSphere</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2489"></a><span class="k">end if</span>
<a name="ln-2490"></a><span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-2491"></a><span class="k">  </span><span class="n">ac</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-2492"></a>  <span class="k">call </span><span class="n">PoVRay_addReferenceFrame</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
<a name="ln-2493"></a><span class="k">end if</span>
<a name="ln-2494"></a>
<a name="ln-2495"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2496"></a><span class="c">! create the top and bottom planes first</span>
<a name="ln-2497"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2498"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span>
<a name="ln-2499"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2500"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2501"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2502"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2503"></a>  <span class="n">culast</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2504"></a>  <span class="n">holast</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2505"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2506"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2507"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2508"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2509"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2510"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="n">ro2cu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2511"></a>    <span class="n">ho</span> <span class="o">=</span> <span class="n">ro2ho</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2512"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2513"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2514"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">culast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">cu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2515"></a>    <span class="k">else</span>
<a name="ln-2516"></a><span class="k">      call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">holast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">ho</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2517"></a>    <span class="k">end if</span>
<a name="ln-2518"></a><span class="k">    </span><span class="n">culast</span> <span class="o">=</span> <span class="n">cu</span>
<a name="ln-2519"></a>    <span class="n">holast</span> <span class="o">=</span> <span class="n">ho</span>
<a name="ln-2520"></a>  <span class="k">end do </span>
<a name="ln-2521"></a><span class="k"> end do</span>
<a name="ln-2522"></a><span class="k">end if</span>
<a name="ln-2523"></a><span class="k">  </span>
<a name="ln-2524"></a><span class="k">if</span> <span class="p">((</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">4</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2525"></a><span class="c">! create the square edges first</span>
<a name="ln-2526"></a> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.D0</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-2527"></a> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span>
<a name="ln-2528"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2529"></a>  <span class="n">ro1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2530"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpos</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">h_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2531"></a>  <span class="n">ro2</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-2532"></a>  <span class="n">rolast</span> <span class="o">=</span> <span class="n">ro1</span>
<a name="ln-2533"></a>  <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro1</span><span class="p">)</span>
<a name="ln-2534"></a>  <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2535"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2536"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">dpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ro2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">ro1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span>
<a name="ln-2537"></a>    <span class="n">xx</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span> <span class="nb">sum</span> <span class="p">(</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2538"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">xx</span>
<a name="ln-2539"></a>    <span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xx</span>
<a name="ln-2540"></a>    <span class="n">qu</span> <span class="o">=</span> <span class="n">ro2qu</span><span class="p">(</span><span class="n">ro</span><span class="p">)</span>
<a name="ln-2541"></a>    <span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">qu</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="n">qu</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2542"></a><span class="c">! and create a cylinder with these points</span>
<a name="ln-2543"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">rmode</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2544"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">splast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">sp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2545"></a>    <span class="k">else</span>
<a name="ln-2546"></a><span class="k">       call </span><span class="n">PoVRay_addCylinder</span><span class="p">(</span><span class="n">dunit</span><span class="p">,</span> <span class="n">rolast</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rolast</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">ro</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="mf">0.005D0</span><span class="p">,(</span><span class="o">/</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span><span class="p">))</span>
<a name="ln-2547"></a>    <span class="k">end if</span>
<a name="ln-2548"></a><span class="k">    </span><span class="n">rolast</span> <span class="o">=</span> <span class="n">ro</span>
<a name="ln-2549"></a>    <span class="n">splast</span> <span class="o">=</span> <span class="n">sp</span>
<a name="ln-2550"></a>  <span class="k">end do </span>
<a name="ln-2551"></a><span class="k"> end do</span>
<a name="ln-2552"></a><span class="k">end if</span>
<a name="ln-2553"></a><span class="k">  </span>
<a name="ln-2554"></a><span class="k">end subroutine </span><span class="n">PoVRay_initFZ6</span>
<a name="ln-2555"></a>
<a name="ln-2556"></a>
<a name="ln-2557"></a>
<a name="ln-2558"></a>
<a name="ln-2559"></a>
<a name="ln-2560"></a>
<a name="ln-2561"></a>
<a name="ln-2562"></a>
<a name="ln-2563"></a><span class="k">end module </span><span class="n">povray</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 <a rel="license" href="http://www.freebsd.org/copyright/freebsd-doc-license.html">FreeBSD Documentation License</a></p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> Fortran Program was developed by Marc De Graef Research Group/Carnegie Mellon University</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>